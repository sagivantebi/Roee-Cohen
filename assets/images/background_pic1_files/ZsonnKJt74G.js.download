;/*FB_PKG_DELIM*/

__d("ACTSanitizerApiLazyLoader",["ACTSanitizerApiTypes","FBLogger","JSResourceForInteraction","MAWParseXMAProtocol","Promise","asyncToGeneratorRuntime","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h,i=null,j={isMessageTextValid:function(){c("FBLogger")("armadillo_act").mustfix("Function not implemented yet. Assuming the message text is invalid");return d("ACTSanitizerApiTypes").ACTSanitizerValidationResult.MessageTextFailure},isXMAValid:function(a){a=d("MAWParseXMAProtocol").isXMAContentValid(a);return a?d("ACTSanitizerApiTypes").ACTSanitizerValidationResult.Valid:d("ACTSanitizerApiTypes").ACTSanitizerValidationResult.UrlFailure}};function a(){var a=c("gkx")("2243");if(!a)return(h||(h=b("Promise"))).resolve(j);i==null&&(i=new(h||(h=b("Promise")))(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield c("JSResourceForInteraction")("ACTSanitizerApiWasm").__setRef("ACTSanitizerApiLazyLoader").load());a(b.ACTSanitizerWasm())});return function(b){return a.apply(this,arguments)}}()));return i}g.fallbackACTSanitizerApi=j;g.loadACTSanitizerApi=a}),98);
__d("ArmadilloTaskHandlers",["JSResourceForInteraction"],(function(a,b,c,d,e,f,g){"use strict";b={add:(a=c("JSResourceForInteraction"))("AddTaskHandler").__setRef("ArmadilloTaskHandlers"),get_messenger_db_dump_attachments_for_bug_reporting:a("GetMessengerDBDumpAttachments").__setRef("ArmadilloTaskHandlers"),maw_get_devices:a("MAWGetDevicesTaskHandler").__setRef("ArmadilloTaskHandlers"),preload_messenger_db_dump_attachments_for_bug_reporting:a("PreloadDBDumpAttachments").__setRef("ArmadilloTaskHandlers"),test:a("TestNativeTaskHandler").__setRef("ArmadilloTaskHandlers"),zenon_send_chatd_mws_message:a("MAWZenonSendMultiwayMsgChatdTaskHandler").__setRef("ArmadilloTaskHandlers")};g.TASK_HANDLERS_RESOURCES=b}),98);
__d("BroadcastChannelClientServerHandshake",["FBLogger","Promise","Random","setTimeout"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){a.addEventListener("message",function(b){var c;((c=b.data)==null?void 0:c.type)==="BroadcastChannelHandshake-syn"&&a.postMessage({nonce:b.data.nonce,type:"BroadcastChannelHandshake-syn-ack"})})}function e(a,e){var f=d("Random").random(),g=0;return new(h||(h=b("Promise")))(function(b,d){var h=!1,i=function b(){if(g===6){h=!0;a.removeEventListener("message",j);try{throw c("FBLogger")("ls_web_init").mustfixThrow("BC handshake failed, failing, likely worker failure%s",e!=null?" for"+e:"")}catch(a){d(a)}return}if(h)return;a.postMessage({nonce:f,type:"BroadcastChannelHandshake-syn"});c("setTimeout")(b,100*Math.pow(2,g++))},j=function c(d){var e;((e=d.data)==null?void 0:e.type)==="BroadcastChannelHandshake-syn-ack"&&((e=d.data)==null?void 0:e.nonce)===f&&(b(),h=!0,a.removeEventListener("message",c))};a.addEventListener("message",j);i()})}g.listen=a;g.checkAlive=e}),98);
__d("InstamadilloTaskHandlers",["JSResourceForInteraction"],(function(a,b,c,d,e,f,g){"use strict";b={33:(a=c("JSResourceForInteraction"))("IGDUnsendMessageTaskHandler").__setRef("InstamadilloTaskHandlers"),46:a("IGDSendMessageTaskHandler").__setRef("InstamadilloTaskHandlers"),igd_edit_message:a("IGDEditMessageTaskHandler").__setRef("InstamadilloTaskHandlers"),igd_react_message:a("IGDSendRemoveReactionTaskHandler").__setRef("InstamadilloTaskHandlers"),igd_send_media_message:a("IGDSendMediaMessageTaskHandler").__setRef("InstamadilloTaskHandlers"),igd_send_xma_receiver_fetch:a("IGDSendXmaReceiverFetchTaskHandler").__setRef("InstamadilloTaskHandlers")};g.TASK_HANDLERS_RESOURCES=b}),98);
__d("CometTaskHandlers",["ArmadilloTaskHandlers","InstamadilloTaskHandlers"],(function(a,b,c,d,e,f,g){"use strict";a=babelHelpers["extends"]({},d("ArmadilloTaskHandlers").TASK_HANDLERS_RESOURCES,d("InstamadilloTaskHandlers").TASK_HANDLERS_RESOURCES);g.TASK_HANDLERS_RESOURCES=a}),98);
__d("WorkerBootstrap",["HasteSupportData","ServerJSDefine"],(function(a,b,c,d,e,f,g){"use strict";function h(a){Object.keys(a).forEach(function(b){c("ServerJSDefine").handleDefine(b,[],a[b],-1,null)})}function a(a,c){var f,g;a.hsdp&&d("HasteSupportData").handle(a.hsdp);var i=(f=(g=a.jsmods)!=null?g:a.dynamicModules)!=null?f:{};h(i);var j=b.call(null,c);a.rds!=null&&a.rds.length>0&&e.call(null,a.rds,function(){});if(typeof j==="function"||j!==null)try{for(var k=arguments.length,l=new Array(k>2?k-2:0),m=2;m<k;m++)l[m-2]=arguments[m];j.apply(void 0,l)}catch(a){}}function f(a){a=a;if(typeof a==="function"||a!==null)try{a()}catch(a){}}g.initDynamicModules=h;g.start=a;g.startServerJS=f}),98);
__d("CurrentSharedWorker",["HasteSupportData","QPLUserFlow","SharedWorkerStatusLock","WorkerBootstrap","emptyFunction","err","qpl","structuredClone"],(function(a,b,c,d,e,f,g){"use strict";var h=null,i=[],j=new Set(),k=[],l=!1,m=!1,n=null,o=!1,p=c("qpl")._(931609794,"2369");c("QPLUserFlow").start(p);var q=d("SharedWorkerStatusLock").getStatusLock();c("QPLUserFlow").addPoint(p,"status_lock");c("QPLUserFlow").addAnnotations(p,{string:{id:self.worker_id}});self.setTimeout(function(){if(!o){try{var a;(a=j.values().next().value)==null?void 0:a.postMessage({type:"self-terminate",response:{from:"bundle",workerID:self.worker_id}})}catch(a){c("QPLUserFlow").endFailure(p,"timeout_termination_error"),x(a)}self.close()}},3e5);function r(){m=!0,n=null,h!==null&&(c("QPLUserFlow").addPoint(p,"process_message_buffer"),c("QPLUserFlow").addAnnotations(p,{"int":{message_buffer_size:i.length}}),i.forEach(function(a){return a()}),i=[]),c("QPLUserFlow").endSuccess(p)}function s(a,f){var g=a.data;if(typeof g==="object"&&(g==null?void 0:g.type)==="execute-worker"){var k=!l;try{if(!l&&g.args instanceof Array){var u=g.args[0],v=u.hsdp,w=u.jsmods,x=u.dynamicModules;u=u.rds;c("QPLUserFlow").addPoint(p,"first_init");v!=null&&d("HasteSupportData").handle(v);d("WorkerBootstrap").initDynamicModules((w=(v=w)!=null?v:x)!=null?w:{});u!=null&&u.length>0&&e.call(null,u,function(){});q.init();c("QPLUserFlow").addPoint(p,"status_lock_init");l=!0;n!=null&&(n(),r())}v=b.call(b,"SiteData");j.size>1&&f.postMessage({type:"execute-worker-imports",response:{}});f.postMessage({type:"execute-worker-ack",response:{firstInit:k,workerRevision:v.client_revision,spinMode:v.spin,spinTime:v.__spin_t}});o=!0}catch(a){c("QPLUserFlow").endFailure(p,"worker_init_error"),q.release(),f.postMessage({type:"execute-worker-ack",response:{firstInit:k,error:a.message}}),self.close()}}else if(typeof g==="object"&&(g==null?void 0:g.type)==="sw-get-rev")try{x=b.call(b,"SiteData");f.postMessage({type:"sw-get-rev",response:{workerRevision:x.client_revision,spinMode:x.spin,spinTime:x.__spin_t}})}catch(a){f.postMessage({type:"sw-get-rev",response:{error:a.message}})}else if(typeof g==="object"&&(g==null?void 0:g.type)==="sw-shutdown"){w=Array.isArray(g.args)?g.args[0]:null;q.release();typeof w==="object"&&(w==null?void 0:w.upgrade)===!0?t({type:"sw-shutdown",response:{reason:"requested-upgrade",workerID:self.worker_id,isInitialized:o}}):typeof w==="object"&&typeof (w==null?void 0:w.reason)==="string"?t({type:"sw-shutdown",response:{reason:w==null?void 0:w.reason,workerID:self.worker_id,isInitialized:o}}):t({type:"sw-shutdown",response:{workerID:self.worker_id,isInitialized:o}});self.close()}else if(typeof g==="object"&&(g==null?void 0:g.type)==="sw-uptime-tracking"){v=typeof (g==null?void 0:g.args)==="object"?(u=g.args)==null?void 0:u.trackerID:null;f.postMessage({type:"sw-uptime-tracking",response:{trackerID:v}})}else typeof g==="object"&&(g==null?void 0:g.type)==="ww-hrp-init"?f.postMessage({type:"ww-hrp-init",response:{}}):typeof g==="object"&&(g==null?void 0:g.type)==="ww-connection-ack"?f.postMessage({type:"connection-ack",response:{from:"bundle",workerID:self.worker_id}}):h!==null&&m?h(g):i.push(function(){return s(a,f)})}function a(a){var b=h==null;h=(a=a)!=null?a:c("emptyFunction");b&&m&&(i.forEach(function(a){return a()}),i=[])}function t(a,b){j.forEach(function(c){try{c.postMessage(a,b)}catch(b){c.postMessage(a)}})}function f(a){if(l){c("QPLUserFlow").addPoint(p,"init_complete_handler_ran");a();r();return}c("QPLUserFlow").addPoint(p,"init_complete_handler_attached");n=a}["log","error","info","debug","warn"].forEach(function(a){if(self.console[a]==null)throw c("err")('"'+a+'" is not a valid console method.');var b=self.console[a];self.console[a]=function(){for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];b.apply(void 0,e);var g=!1;try{c("structuredClone")!=null&&c("structuredClone")(e),g=!0}catch(a){}if(!g){t({type:"console",response:{method:"error",args:["DataCloneError: Failed to forward console message from web worker due to args not being serializable."]}});return}t({type:"console",response:{method:a,args:e}})}});try{c("QPLUserFlow").addPoint(p,"bootstrap_start");var u=self.shared_worker_bootstrap_buffer==null?void 0:self.shared_worker_bootstrap_buffer();if(u!=null){var v=u.ports,w=u.messages;c("QPLUserFlow").addAnnotations(p,{"int":{bootstrap_ports_num:v.length}});v==null?void 0:v.forEach(function(a){try{a.postMessage({type:"connection-ack",response:{from:"bundle",workerID:self.worker_id}}),a.addEventListener("message",function(b){return s(b,a)}),j.add(a)}catch(a){c("QPLUserFlow").addPoint(p,"connection_fail"),x(a)}});w==null?void 0:w.forEach(function(a){try{s(a.e,a.port)}catch(b){c("QPLUserFlow").addPoint(p,"message_processing_fail");c("QPLUserFlow").addAnnotations(p,{string:{failed_msg_type:(a=(a=a.e.data)==null?void 0:a.type)!=null?a:"unknown"}});x(b)}c("QPLUserFlow").addAnnotations(p,{"int":{msg_num:w.length},string_array:{msgs:w.map(function(a){return(a=a.e.data)==null?void 0:a.type})}})})}else c("QPLUserFlow").addPoint(p,"bootstrap_buffer_empty")}catch(a){x(a),c("QPLUserFlow").endFailure(p,"uncaught_bootstrap_error")}function x(a){try{t({type:"sw-uncaught-error",e:{message:a.message,lineno:a.lineno,colno:a.colno,filename:a.filename,error:a.error}})}catch(b){c("QPLUserFlow").addPoint(p,"sending_error_failed");c("QPLUserFlow").addAnnotations(p,{string:{error:String((a=b.message)!=null?a:b)}})}}self.addEventListener("error",function(a){if(j.size===0){k.push(a);return}x(a)});self.addEventListener("connect",function(a){var b=a.ports[0];b.postMessage({type:"connection-ack",response:{from:"bundle",workerID:self.worker_id}});b.addEventListener("message",function(a){return s(a,b)});b.start();j.add(b);k.length>0&&(k.forEach(x),k.splice(0,k.length))});g.setMessageHandler=a;g.postMessage=t;g.onInitComplete=f}),98);
__d("CurrentSharedWorkerAdapter",["CurrentSharedWorker","FBLogger"],(function(a,b,c,d,e,f,g){a=function(){function a(){}var b=a.prototype;b.addEventListener=function(a,b,e){switch(a){case"message":d("CurrentSharedWorker").setMessageHandler(function(a){return b({data:a})});break;case"error":break;default:c("FBLogger")("worker").mustfix("Unexpected message type %",a)}};b.removeEventListener=function(a,b,e){switch(a){case"message":d("CurrentSharedWorker").setMessageHandler(null);break;case"error":break;default:c("FBLogger")("worker").mustfix("Unexpected message type %",a)}};b.postMessage=function(a,b){d("CurrentSharedWorker").postMessage(a,b)};return a}();g.CurrentSharedWorkerAdapter=a}),98);
__d("CurrentWorkerMessagePort",["CurrentSharedWorkerAdapter"],(function(a,b,c,d,e,f,g){"use strict";var h=null;function a(){if(h==null)if("SharedWorkerGlobalScope"in self&&self instanceof self.SharedWorkerGlobalScope)h=new(d("CurrentSharedWorkerAdapter").CurrentSharedWorkerAdapter)();else if("DedicatedWorkerGlobalScope"in self&&self instanceof self.DedicatedWorkerGlobalScope)h=self;else throw new Error("CurrentWorkerAdapter: Unsupported worker type");return h}g.getMessagePort=a}),98);
__d("EBLSDeferred",["requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h=c("requireDeferred")("EBLS").__setRef("EBLSDeferred");function a(){return h.load().then(function(a){return a.init()})}function b(){return h.load().then(function(a){return a.genLSClient()})}function d(){return h.load().then(function(a){return a.getLSStorage()})}function e(a,b,c){return h.load().then(function(d){return d.platformClientInit(a,b,c)})}g.init=a;g.genLSClient=b;g.getLSStorage=d;g.platformClientInit=e}),98);
__d("EBLSUploadMessagesDeferred",["requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h=c("requireDeferred")("EBLSUploadMessages").__setRef("EBLSUploadMessagesDeferred");function a(a){return h.load().then(function(b){return b.eblsUploadMessages(a)})}g.eblsUploadMessages=a}),98);
__d("IGDAWAdminWriteICDCMsgTxn",["Promise","cr:2327","cr:7625"],(function(a,b,c,d,e,f,g){"use strict";var h,i=(c=b("cr:2327"))!=null?c:b("cr:7625");function a(a,c,d){return i?i.writeICDCAdminMsg(a,c,d):(h||(h=b("Promise"))).resolve()}g.writeICDCAdminMsg=a}),98);
__d("IGDAWAdminWriteUserDeviceMsgTxn",["Promise","cr:2693","cr:7627"],(function(a,b,c,d,e,f,g){"use strict";var h,i=(c=b("cr:2693"))!=null?c:b("cr:7627");function a(a,c,d,e,f,g){return i?i.writeUserDeviceAdminMsg(a,c,d,e,f,g):(h||(h=b("Promise"))).resolve()}g.writeUserDeviceAdminMsg=a}),98);
__d("IGDAWDbAddDeviceChangeAlertsTxn",["asyncToGeneratorRuntime"],(function(a,b,c,d,e,f){"use strict";function a(a,b){return g.apply(this,arguments)}function g(){g=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){yield a.e2ee_deviceChangeAlerts.put(b)});return g.apply(this,arguments)}f.addDeviceChangeAlertsTxn=a}),66);
__d("IGDAWDbUpdateDeviceChangeAlertsTxn",["I64","MAWUnsafeCoerce","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){yield a.e2ee_deviceChangeAlerts.upsert([b.deviceChangeAlertsId],b)});return i.apply(this,arguments)}function c(a){return d("MAWUnsafeCoerce").unsafeCoerce((h||(h=d("I64"))).of_float(a))}g.updateDeviceChangeAlertsTxn=a;g.convertDeviceChangeAlertsId=c}),98);
__d("IGDAWDbUpdateDeviceChangeAlertsLogInStatusTxn",["IGDAWDbUpdateDeviceChangeAlertsTxn","Promise","ReQL","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c){c=(yield d("ReQL").toArrayAsync(d("ReQL").fromTableDescending(a.e2ee_deviceChangeAlerts.index("deviceJid")).getKeyRange(c).filter(function(a){return!a.loggedOut})));yield (h||(h=b("Promise"))).all(c.map(function(b){return d("IGDAWDbUpdateDeviceChangeAlertsTxn").updateDeviceChangeAlertsTxn(a,babelHelpers["extends"]({},b,{loggedOut:!0}))}))});return i.apply(this,arguments)}g.updateDeviceChangeAlertsLogInStatusTxn=a}),98);
__d("IGDDbThreadTxns",["I64","Promise","ReQL","WAJids","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a,b){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c){return new Map(yield a.runInTransaction(function(a){return(i||(i=b("Promise"))).all(c.map(function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){var c;b=d("WAJids").extractUserId(b);return[b,yield (c=d("ReQL")).toArrayAsync(c.mergeJoin(c.fromTableAscending(a.participants.index("contactIdThreadKey"),[]).getKeyRange((h||(h=d("I64"))).of_string(b)),d("ReQL").fromTableAscending(a.threads)).map(function(a){a[0];a=a[1];return a}))]});return function(a){return c.apply(this,arguments)}}()))},"readonly",void 0,void 0,f.id+":24"))});return j.apply(this,arguments)}g.getAllThreadsForUsers=a}),98);
__d("IGDHandleICDCErrorInstruction",["IGDAWAdminWriteICDCMsgTxn","MAWODSProxy","Promise","WAOdsEnums","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b,c){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,e){var g=e.shouldShowAdminMessages,i=e.threads;if(!g)return;yield a.runInTransaction(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield (h||(h=b("Promise"))).all(i.map(function(b){return d("IGDAWAdminWriteICDCMsgTxn").writeICDCAdminMsg(a,b,c.notificationTs)})),d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.ICDC,key:"icdc"})});return function(b){return a.apply(this,arguments)}}(),"readwrite",void 0,void 0,f.id+":30")});return i.apply(this,arguments)}g.handleICDCError=a}),98);
__d("MAWAdminMsgHelpers",["MAWCreateParticipantAdminMsg","MAWExternalId","MAWRemoveParticipantAdminMsg","WAAckLevel","WAGlobals","WAJids","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";var h="Facebook User";function a(a){return a==null||a===""?h:a}function b(a){return a!=null?d("WAJids").userIdFromJid(a):h}function c(a,b,c){return{ack:d("WAAckLevel").ACK.SENT,id:{author:d("WAJids").AUTHOR_SYSTEM,chat:a,externalId:d("MAWExternalId").generateExternalId()},msgContent:d("MAWCreateParticipantAdminMsg").createParticipantAdminMessage(c==="@me"?d("WAGlobals").getMyUserJid():c,b),ts:d("WATimeUtils").unixTime(),type:"Admin"}}function e(a,b,c){return{ack:d("WAAckLevel").ACK.SENT,id:{author:d("WAJids").AUTHOR_SYSTEM,chat:a,externalId:d("MAWExternalId").generateExternalId()},msgContent:d("MAWRemoveParticipantAdminMsg").removeParticipantAdminMessage(c==="@me"?d("WAGlobals").getMyUserJid():c,b),ts:d("WATimeUtils").unixTime(),type:"Admin"}}function f(a,b,c){var e,f=d("WAGlobals").getMyUserJid();c=c==="@me"?f:c;if(c===f)e={adminMsgContent:[d("WAJids").userIdFromJid(b)],adminType:"currentUserPromotedParticipant"};else if(c==null)e=b===f?{adminMsgContent:[],adminType:"currentUserGotPromoted"}:{adminMsgContent:[d("WAJids").userIdFromJid(b)],adminType:"participantGotPromoted"};else{c=d("WAJids").userIdFromJid(c);e=b===f?{adminMsgContent:[c],adminType:"participantPromotedYou"}:{adminMsgContent:[c,d("WAJids").userIdFromJid(b)],adminType:"participantPromotedParticipant"}}return{ack:d("WAAckLevel").ACK.SENT,id:{author:d("WAJids").AUTHOR_SYSTEM,chat:a,externalId:d("MAWExternalId").generateExternalId()},msgContent:e,ts:d("WATimeUtils").unixTime(),type:"Admin"}}function i(a,b,c){var e,f=d("WAGlobals").getMyUserJid();c=c==="@me"?f:c;if(c===f)e=b===f?{adminMsgContent:[],adminType:"currentUserSelfDemoted"}:{adminMsgContent:[d("WAJids").userIdFromJid(b)],adminType:"currentUserDemotedParticipant"};else if(c==null)e=b===f?{adminMsgContent:[],adminType:"currentUserGotDemoted"}:{adminMsgContent:[d("WAJids").userIdFromJid(b)],adminType:"participantGotDemoted"};else{var g=d("WAJids").userIdFromJid(c);e=b===f?{adminMsgContent:[g],adminType:"participantDemotedYou"}:{adminMsgContent:[g,d("WAJids").userIdFromJid(b)],adminType:c===b?"participantSelfDemoted":"participantDemotedParticipant"}}return{ack:d("WAAckLevel").ACK.SENT,id:{author:d("WAJids").AUTHOR_SYSTEM,chat:a,externalId:d("MAWExternalId").generateExternalId()},msgContent:e,ts:d("WATimeUtils").unixTime(),type:"Admin"}}function j(a,b,c){var e=[],f=b.subject.content;if(f==null)return;b.subject.user===d("WAGlobals").getMyUserJid()?(b="currentUserNamedGroup",e.push(f)):c==null?(b="unkonwnUserNamedGroup",e.push(f)):(b="participantNamedGroup",e.push(c,f));return{ack:d("WAAckLevel").ACK.SENT,id:{author:d("WAJids").AUTHOR_SYSTEM,chat:a,externalId:d("MAWExternalId").generateExternalId()},msgContent:{adminMsgContent:e,adminType:b},ts:d("WATimeUtils").unixTime(),type:"Admin"}}function k(a,b,c){var e,f=[];if(c===d("WAGlobals").getMyUserJid())switch(b){case"all_member_add":e="currentUserSetAddModeAllMembers";break;case"admin_add":e="currentUserSetAddModeAdminOnly";break}else if(c!=null){f.push(d("WAJids").userIdFromJid(c));switch(b){case"all_member_add":e="participantSetAddModeAllMembers";break;case"admin_add":e="participantSetAddModeAdminOnly";break}}else switch(b){case"all_member_add":e="serverSetAddModeAllMembers";break;case"admin_add":e="serverSetAddModeAdminOnly";break}if(e==null)return;return{ack:d("WAAckLevel").ACK.SENT,id:{author:d("WAJids").AUTHOR_SYSTEM,chat:a,externalId:d("MAWExternalId").generateExternalId()},msgContent:{adminMsgContent:f,adminType:e},ts:d("WATimeUtils").unixTime(),type:"Admin"}}g.UNKNOWN_USER=h;g.maybeUnknownParticipantName=a;g.createAdminMsgContactId=b;g.createParticipantAddAdminMessage=c;g.createParticipantRemoveAdminMsg=e;g.createParticipantPromoteAdminMsg=f;g.createParticipantDemoteAdminMsg=i;g.createGroupNameChangeAdminMsg=j;g.createMemberAddModeChangeAdminMsg=k}),98);
__d("MAWCreateParticipantAdminMsg",["MAWAdminMsgHelpers","WAGlobals"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b,c){switch(a){case 1:return{adminMsgContent:[b],adminType:"participantAddedYou"};case 2:return{adminMsgContent:[b,c],adminType:"participantAddedYouAndOneUser"};default:return{adminMsgContent:[b,a.toString()],adminType:"participantAddedYouAndMoreThanOneUsers"}}}function i(a,b,c){switch(a){case 1:return{adminMsgContent:[b],adminType:"currentUserAddedOneParticipant"};case 2:return{adminMsgContent:[b,c],adminType:"currentUserAddedTwoParticipant"};default:return{adminMsgContent:[b,a.toString()],adminType:"currentUserAddedMoreThanTwoParticipant"}}}function j(a,b,c,d){switch(a){case 1:return{adminMsgContent:[b,c],adminType:"participantAddedOneUser"};case 2:return{adminMsgContent:[b,c,d],adminType:"participantAddedTwoUser"}}return{adminMsgContent:[b,c,a.toString()],adminType:"participantAddedMoreThanTwoUser"}}function a(a,b,c,e){e=e==null?b.map(d("MAWAdminMsgHelpers").createAdminMsgContactId):e;var f=e[0];e=e[1];c=c==null?d("MAWAdminMsgHelpers").createAdminMsgContactId(a):d("MAWAdminMsgHelpers").maybeUnknownParticipantName(c);if(a===d("WAGlobals").getMyUserJid())return i(b.length,d("MAWAdminMsgHelpers").maybeUnknownParticipantName(f),d("MAWAdminMsgHelpers").maybeUnknownParticipantName(e));return b.includes(d("WAGlobals").getMyUserJid())?h(b.length,d("MAWAdminMsgHelpers").maybeUnknownParticipantName(c),d("MAWAdminMsgHelpers").maybeUnknownParticipantName(b[0]===d("WAGlobals").getMyUserJid()?e:f)):j(b.length,c,d("MAWAdminMsgHelpers").maybeUnknownParticipantName(f),d("MAWAdminMsgHelpers").maybeUnknownParticipantName(e))}g.createParticipantAdminMessage=a}),98);
__d("MAWRemoveParticipantAdminMsg",["MAWAdminMsgHelpers","WAGlobals"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b,c){switch(a){case 1:return{adminMsgContent:[b],adminType:"participantRemovedYou"};case 2:return{adminMsgContent:[b,c],adminType:"participantRemovedYouAndOneUser"};default:return{adminMsgContent:[b,a.toString()],adminType:"participantRemovedYouAndMoreThanOneUsers"}}}function i(a,b,c,d){switch(a){case 1:return d?{adminMsgContent:[],adminType:"currentUserLeftGroup"}:{adminMsgContent:[b],adminType:"currentUserRemovedOneParticipant"};case 2:return{adminMsgContent:[b,c],adminType:"currentUserRemovedTwoParticipant"};default:return{adminMsgContent:[b,a.toString()],adminType:"currentUserRemovedMoreThanTwoParticipant"}}}function j(a,b,c,d,e){switch(a){case 1:return e?{adminMsgContent:[b],adminType:"participantLeftGroup"}:{adminMsgContent:[b,c],adminType:"participantRemovedOneUser"};case 2:return{adminMsgContent:[b,c,d],adminType:"participantRemovedTwoUser"}}return{adminMsgContent:[b,c,a.toString()],adminType:"participantRemovedMoreThanTwoUser"}}function a(a,b,c,e){e=e==null?b.map(d("MAWAdminMsgHelpers").createAdminMsgContactId):e;var f=e[0];e=e[1];c=c==null?d("MAWAdminMsgHelpers").createAdminMsgContactId(a):d("MAWAdminMsgHelpers").maybeUnknownParticipantName(c);if(a===d("WAGlobals").getMyUserJid())return i(b.length,d("MAWAdminMsgHelpers").maybeUnknownParticipantName(f),d("MAWAdminMsgHelpers").maybeUnknownParticipantName(e),b[0]===d("WAGlobals").getMyUserJid());return b.includes(d("WAGlobals").getMyUserJid())?h(b.length,c,d("MAWAdminMsgHelpers").maybeUnknownParticipantName(b[0]===d("WAGlobals").getMyUserJid()?e:f)):j(b.length,c,d("MAWAdminMsgHelpers").maybeUnknownParticipantName(f),d("MAWAdminMsgHelpers").maybeUnknownParticipantName(e),b[0]===a)}g.removeParticipantAdminMessage=a}),98);
__d("MAWAdminWriteUserDeviceMsgTxn",["MAWAckLevel","MAWAdminMsgHelpers","MAWDbMsgTxns","MAWDexieTable","MAWExternalId","MAWLocalizationType","MAWLocalizationUtils","MAWMsgType","MAWWriteMsgTxns","WAGlobals","WAJids","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";c={add:"add",remove:"remove",update:"update"};function h(a,b){switch(a){case"add":if(b)return d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_DEVICE;else return d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_DEVICE;case"remove":if(b)return d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_REMOVED_DEVICE;else return d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_DEVICE;case"update":if(b)return d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_UPDATED_DEVICE;else return d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_UPDATED_DEVICE}}function a(a,b,c,e,f){return d("MAWDbMsgTxns").getIsThreadEmpty(a,c.jid).then(function(g){if(g)return d("MAWDexieTable").dexieResolve();g=b===d("WAGlobals").getMyUserJid();var i=h(e,g);g=g?[]:[d("WAJids").userIdFromJid(b)];g=d("MAWLocalizationUtils").buildUnstoredDbAdminMsg({adminMsgContent:g,adminType:i,version:1},c.jid,f);return d("MAWWriteMsgTxns").writeMsg(a,g,c).then(function(){})})}function b(a,b,c,e){var f=d("MAWAdminMsgHelpers").UNKNOWN_USER,g=b===d("WAGlobals").getMyUserJid();b={ack:d("MAWAckLevel").ACK.received,altIndex:void 0,author:g?d("WAJids").AUTHOR_ME:b,externalId:d("MAWExternalId").generateExternalId(),msgContent:{adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.ICDC_ALERT_ADMIN_MESSAGE,authorName:f},threadJid:c.jid,ts:(g=e)!=null?g:d("WATimeUtils").unixTime(),type:d("MAWMsgType").MSG_TYPE.ICDC_ALERT};return d("MAWWriteMsgTxns").writeMsg(a,b,c).then(function(){})}g.DeviceChange=c;g.getUserDeviceAdminType=h;g.writeUserDeviceAdminMsg=a;g.writeICDCAlert=b}),98);
__d("MAWDbDeviceChangeAlerts",[],(function(a,b,c,d,e,f){"use strict";b="add";c="keyChange";d="remove";function a(a){return a}f.ADD=b;f.KEY_CHANGE=c;f.REMOVE=d;f.unsafeCoerceToDeviceChangeAlertsID=a}),66);
__d("IGDHandleIdentityAddedInstruction",["IGDAWAdminWriteUserDeviceMsgTxn","IGDAWDbAddDeviceChangeAlertsTxn","MAWAdminWriteUserDeviceMsgTxn","MAWDbDeviceChangeAlerts","MAWODSProxy","Promise","WAOdsEnums","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b,c){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,e){var g=e.allowSecurityAlertForSelf,i=e.contactId,k=e.isMe,l=e.shouldShowAdminMessages,m=e.threads;yield a.runInTransaction(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=j(a,c,k,g),f=e.promise;e=e.showSelfAlerts;var n=l?m.map(function(b){return d("IGDAWAdminWriteUserDeviceMsgTxn").writeUserDeviceAdminMsg(a,i,k,b,d("MAWAdminWriteUserDeviceMsgTxn").DeviceChange.add,c.notificationTs)}):[];yield (h||(h=b("Promise"))).all([f].concat(n));(e||l)&&d("MAWODSProxy").odsBumpEntityKey({entity:k?d("WAOdsEnums").Entity.SECURITY_ALERT_FOR_SELF:d("WAOdsEnums").Entity.SECURITY_ALERT_FOR_CONTACT,key:d("MAWDbDeviceChangeAlerts").ADD})});return function(b){return a.apply(this,arguments)}}(),"readwrite",void 0,void 0,f.id+":47")});return i.apply(this,arguments)}function j(a,c,e,f){var g=!1,i=(h||(h=b("Promise"))).resolve();if(e&&c.model!=null&&c.platform!=null&&c.notificationTs!=null){g=!0;e=c.instruction==="identityChanged"?d("MAWDbDeviceChangeAlerts").KEY_CHANGE:d("MAWDbDeviceChangeAlerts").ADD;i=d("IGDAWDbAddDeviceChangeAlertsTxn").addDeviceChangeAlertsTxn(a,{action:e,deviceJid:c.device,identity:c.identity,isArchived:!f,isConfirmed:!1,isNotified:!1,model:c.model,platform:c.platform,ts:c.notificationTs})}return{promise:i,showSelfAlerts:g}}g.handleIdentityAdded=a;g.addDeviceChangeAlerts=j}),98);
__d("IGDHandleIdentityChangedInstruction",["IGDAWAdminWriteUserDeviceMsgTxn","IGDHandleIdentityAddedInstruction","MAWAdminWriteUserDeviceMsgTxn","MAWDbDeviceChangeAlerts","MAWODSProxy","Promise","WAJids","WAOdsEnums","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b,c){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,e){var g=e.allowSecurityAlertForSelf,i=e.isMe,j=e.shouldShowAdminMessages,k=e.threads;yield a.runInTransaction(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=d("IGDHandleIdentityAddedInstruction").addDeviceChangeAlerts(a,c,i,g),f=e.promise;e=e.showSelfAlerts;var l=j?k.map(function(b){return d("IGDAWAdminWriteUserDeviceMsgTxn").writeUserDeviceAdminMsg(a,d("WAJids").extractUserId(c.jid),i,b,d("MAWAdminWriteUserDeviceMsgTxn").DeviceChange.update,c.notificationTs)}):[];yield (h||(h=b("Promise"))).all([f].concat(l));(e||j)&&d("MAWODSProxy").odsBumpEntityKey({entity:i?d("WAOdsEnums").Entity.SECURITY_ALERT_FOR_SELF:d("WAOdsEnums").Entity.SECURITY_ALERT_FOR_CONTACT,key:d("MAWDbDeviceChangeAlerts").KEY_CHANGE})});return function(b){return a.apply(this,arguments)}}(),"readwrite",void 0,void 0,f.id+":31")});return i.apply(this,arguments)}g.handleIdentityChanged=a}),98);
__d("IGDHandleIdentityRemovedInstruction",["IGDAWAdminWriteUserDeviceMsgTxn","IGDAWDbUpdateDeviceChangeAlertsLogInStatusTxn","MAWAdminWriteUserDeviceMsgTxn","MAWDbDeviceChangeAlerts","MAWODSProxy","Promise","WAOdsEnums","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b,c){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,e){var g=e.contactId,i=e.isMe,j=e.shouldShowAdminMessages,k=e.threads;yield a.runInTransaction(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=i?d("IGDAWDbUpdateDeviceChangeAlertsLogInStatusTxn").updateDeviceChangeAlertsLogInStatusTxn(a,c.device):(h||(h=b("Promise"))).resolve(),f=j?k.map(function(b){return d("IGDAWAdminWriteUserDeviceMsgTxn").writeUserDeviceAdminMsg(a,g,i,b,d("MAWAdminWriteUserDeviceMsgTxn").DeviceChange.remove,c.notificationTs)}):[];yield (h||(h=b("Promise"))).all([e].concat(f));(i||j)&&d("MAWODSProxy").odsBumpEntityKey({entity:i?d("WAOdsEnums").Entity.SECURITY_ALERT_FOR_SELF:d("WAOdsEnums").Entity.SECURITY_ALERT_FOR_CONTACT,key:d("MAWDbDeviceChangeAlerts").REMOVE})});return function(b){return a.apply(this,arguments)}}(),"readwrite",void 0,void 0,f.id+":30")});return i.apply(this,arguments)}g.handleIdentityRemoved=a}),98);
__d("IGDAWProtocolQueueInstructions",["FBLogger","IGDDbThreadTxns","IGDHandleICDCErrorInstruction","IGDHandleIdentityAddedInstruction","IGDHandleIdentityChangedInstruction","IGDHandleIdentityRemovedInstruction","MAWDbAppMeta","MAWReStoreDb","Promise","WAAssertUnreachable","WAGlobals","WAJids","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield d("MAWReStoreDb").getDB(f.id+":33")),e=(yield j(b,a)),g=e[0],h=g.allowSecurityAlertForContact;g=g.allowSecurityAlertForSelf;e=e[1];var i=[];for(a of a){var k=a.jid,m=d("WAJids").extractUserId(k);k=k===d("WAGlobals").getMyUserJid();var n=l({allowSecurityAlertForContact:h,isICDCError:a.instruction==="icdcError",isMe:k});n={allowSecurityAlertForSelf:g,contactId:m,isMe:k,shouldShowAdminMessages:n,threads:(k=e.get(m))!=null?k:[]};try{yield o(b,a,n),i.push(a.stanzaQueueId)}catch(a){c("FBLogger")("igd_web_on_msgr").warn("Failed to handle instruction. The error is %s",a)}}return{followUpParams:void 0,toAck:i}});return i.apply(this,arguments)}function j(a,b){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=new Set(b.map(function(a){return a.jid})),e=(yield m(a)),f=e.allowSecurityAlertForContact&&b.some(function(a){return a.jid!==d("WAGlobals").getMyUserJid()});b=b.some(function(a){return a.instruction==="icdcError"});f=f||b;b=f?yield d("IGDDbThreadTxns").getAllThreadsForUsers(a,Array.from(c)):new Map();return[e,b]});return k.apply(this,arguments)}function l(a){var b=a.allowSecurityAlertForContact,c=a.isICDCError;a=a.isMe;return!a&&(b||c)}function m(a){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield (h||(h=b("Promise"))).all([a.tables.e2ee_appMeta.get(d("MAWDbAppMeta").AppMetaKeysEnum.allowSecurityAlertForSelf),a.tables.e2ee_appMeta.get(d("MAWDbAppMeta").AppMetaKeysEnum.allowSecurityAlert)]));var c=a[0];a=a[1];return{allowSecurityAlertForContact:(a=a==null?void 0:a.value.allowSecurityAlert)!=null?a:!1,allowSecurityAlertForSelf:(a=c==null?void 0:c.value.allowSecurityAlertForSelf)!=null?a:!0}});return n.apply(this,arguments)}function o(a,b,e){switch(b.instruction){case"identityChanged":return d("IGDHandleIdentityChangedInstruction").handleIdentityChanged(a,b,e);case"identityAdded":return d("IGDHandleIdentityAddedInstruction").handleIdentityAdded(a,b,e);case"identityRemoved":return d("IGDHandleIdentityRemovedInstruction").handleIdentityRemoved(a,b,e);case"icdcError":return d("IGDHandleICDCErrorInstruction").handleICDCError(a,b,e);default:throw c("WAAssertUnreachable")(b)}}g.handleInstructions=a;g.getShouldShowAdminMessages=l}),98);
__d("MessagingArmadilloThreadCutoverNonTALClientDomain",[],(function(a,b,c,d,e,f){a=Object.freeze({ARMADILLO_CUTOVER_CLIENT_DOMAIN_MESSENGER_CUTOVER_DASM_NATIVE_OPERATIONS:"MessengerCutoverDasmNativeOperations"});f["default"]=a}),66);
__d("MessagingArmadilloThreadCutoverNonTALClientEvent",[],(function(a,b,c,d,e,f){a=Object.freeze({ARMADILLO_CUTOVER_CLIENT_EVENT_COMPLETE_CUTOVER:"CompleteCutover",ARMADILLO_CUTOVER_CLIENT_EVENT_THREAD_FETCH:"ThreadFetch"});f["default"]=a}),66);
__d("MessagingArmadilloThreadCutoverNonTALClientEventDetails",[],(function(a,b,c,d,e,f){a=Object.freeze({ARMADILLO_CUTOVER_CLIENT_EVENT_DETAILS_SUCCESS:"Success",ARMADILLO_CUTOVER_CLIENT_EVENT_DETAILS_APPEND_ADMIN_MESSAGES:"AppendAdminMessages",ARMADILLO_CUTOVER_CLIENT_EVENT_DETAILS_GENERIC_ERROR:"GenericError",ARMADILLO_CUTOVER_CLIENT_EVENT_DETAILS_MISSING_ACT_THREAD:"MissingActThread",ARMADILLO_CUTOVER_CLIENT_EVENT_DETAILS_THREAD_ALREADY_MIGRATED:"ThreadAlreadyMigrated"});f["default"]=a}),66);
__d("MAWAdminWriteCutoverThreadMsgTxn",["CurrentEnvironment","MAWBridge","MAWBridgeMsg","MAWBridgeTypesCreators","MAWDbMessageHandler","MAWDbMsg","MAWDbThreadTxns","MAWIndexedDb","MAWLocalizationType","MAWLocalizationUtils","MAWMsgType","MAWThreadSnippetBuildTxns","MAWWriteBulkWriteIncomingAdminMsgTxns","MAWWriteMsgTxns","MessagingArmadilloThreadCutoverNonTALClientDomain","MessagingArmadilloThreadCutoverNonTALClientEvent","MessagingArmadilloThreadCutoverNonTALClientEventDetails","WAJids","WALogger","WATimeUtils","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["cutoverThreadAdminMessage failed to get the thread"]);h=function(){return a};return a}function i(a,b,e,f,g){a=d("WAJids").switchOnMsgrChatJidType(a,{group:function(a){return d("WAJids").groupIdFromJid(a)},user:function(a){return d("WAJids").userIdFromJid(a)}});d("MAWBridge").getBridge().fireAndForget("event","logCutoverEvent",{armadilloThreadId:a,domain:c("MessagingArmadilloThreadCutoverNonTALClientDomain").ARMADILLO_CUTOVER_CLIENT_DOMAIN_MESSENGER_CUTOVER_DASM_NATIVE_OPERATIONS,event:c("MessagingArmadilloThreadCutoverNonTALClientEvent").ARMADILLO_CUTOVER_CLIENT_EVENT_COMPLETE_CUTOVER,eventDetails:f,openThreadId:b,success:g,traceId:e})}function a(a,b,e,f){return d("MAWDbThreadTxns").getThread(a,b).then(function(g){var j=function(a,c){i(b,e,f,a,c)};if(!g.success){d("WALogger").WARN(h());j(c("MessagingArmadilloThreadCutoverNonTALClientEventDetails").ARMADILLO_CUTOVER_CLIENT_EVENT_DETAILS_MISSING_ACT_THREAD,!1);return{needsMarkThreadAsMigrated:!1}}var k=g.value;if(k.isMigratedLocally===!0){j(c("MessagingArmadilloThreadCutoverNonTALClientEventDetails").ARMADILLO_CUTOVER_CLIENT_EVENT_DETAILS_THREAD_ALREADY_MIGRATED,!0);return{needsMarkThreadAsMigrated:!1}}g=d("MAWDbMsg").craftE2eeAdminMsgAltIndex(k.chatId);var l=d("MAWDbMsg").craftCutoverAdminMsgAltIndex(k.chatId);return a.messages.where("altIndex").equals(g).first().then(function(b){var e=c("CurrentEnvironment").instagramdotcom?d("MAWLocalizationType").LOCALIZATION_TYPE.CUTOVER_IGD_THREAD_ADMIN_MESSAGE:d("MAWLocalizationType").LOCALIZATION_TYPE.CUTOVER_THREAD_ADMIN_MESSAGE;if(!b){var f=d("MAWLocalizationUtils").buildUnstoredDbAdminMsg({adminMsgContent:[],adminType:e,version:1},k.jid,d("WATimeUtils").castToUnixTime(0),l);return d("MAWWriteMsgTxns").writeMsg(a,f,k,{sortOrderMs:0}).then(function(){j(c("MessagingArmadilloThreadCutoverNonTALClientEventDetails").ARMADILLO_CUTOVER_CLIENT_EVENT_DETAILS_APPEND_ADMIN_MESSAGES,!0);return{needsMarkThreadAsMigrated:!0}})}var g=babelHelpers["extends"]({},b,{altIndex:l,author:d("WAJids").AUTHOR_SYSTEM,msgContent:{adminMsgContent:[],adminType:e},type:d("MAWMsgType").MSG_TYPE.ADMIN});return a.messages.put(g).then(function(){d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(g)});j(c("MessagingArmadilloThreadCutoverNonTALClientEventDetails").ARMADILLO_CUTOVER_CLIENT_EVENT_DETAILS_APPEND_ADMIN_MESSAGES,!0);return{needsMarkThreadAsMigrated:!0}})})})}function b(a,b){var e=d("MAWLocalizationUtils").buildUnstoredDbAdminMsg({adminMsgContent:[],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.CUTOVER_ROLLBACK_ADMIN_MESSAGE},b.jid),f=babelHelpers["extends"]({},b,{didInsertDualThreadCutoverAdminMsg:!1});return a.threads.put(f).then(function(){return d("MAWWriteMsgTxns").writeMsg(a,e,f).then(c("emptyFunction"))})}function e(a,b){var c=d("MAWDbMsg").craftCutoverAdminMsgAltIndex(b.chatId),e=d("MAWDbMsg").craftE2eeAdminMsgAltIndex(b.chatId);return a.messages.where("altIndex").equals(e).first().then(function(f){if(f!=null)return;return a.messages.where("altIndex").equals(c).first().then(function(c){if(!c)return d("MAWWriteBulkWriteIncomingAdminMsgTxns").writeE2EEAdminMsgsForIncomingCreatedThreads(a,[b]).then(function(){});var f=babelHelpers["extends"]({},c,{altIndex:e,author:d("WAJids").AUTHOR_SYSTEM,msgContent:{adminMsgContent:[],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.E2EE_THREAD_DESCRIPTION},type:d("MAWMsgType").MSG_TYPE.ADMIN});return a.messages.put(f).then(function(){d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(f)});if(!d("MAWDbMessageHandler").isThreadUpdateEnabledViaMiddlewareForMsgType(f.type))return d("MAWThreadSnippetBuildTxns").buildThreadSnippet(a,f).then(function(a){var c=a.snippetParams,e=a.snippetSenderContactId;a=a.snippetType;d("MAWIndexedDb").afterTransaction({tag:"ThreadUpdated",value:d("MAWBridgeTypesCreators").createBridgeUpdatedThread({snippetParams:c,snippetSenderContactId:e,snippetType:a,threadJid:b.jid})})})})})})}g.writeCutoverThreadAdminMsg=a;g.writeRollbackCutoverAdminMsg=b;g.revertCutoverThreadAdminMsg=e}),98);
__d("MAWCreateThreadThroughMI",["MAWDexieTable","MAWGetOrCreateThreadTxns","MAWIndexedDb","MAWLoadThreadsTxns","MAWThreadManagementTxns","MAWTransactionMode","WAGlobals","WAJids","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";b=d("MAWIndexedDb").makeMsgrTransactor({chunk:(a=d("MAWTransactionMode")).READONLY,editMsgHistory:a.READONLY,groupInfo:a.READONLY,media:a.READONLY,messages:a.READWRITE,participants:a.READWRITE,reactions:a.READONLY,receiverFetchInfo:a.READONLY,threads:a.READWRITE,xma:a.READONLY},"createThreadByJid",function(a){return function(b){var c=b.authoritativeThreadKey,e=b.chatJid,f=b.description,g=b.lastActivityTimestampMs,h=b.lastReadWatermarkTimestampMs,i=b.numOfMsgsToLoad,j=d("WATimeUtils").castToMillisTime(g),k=d("WATimeUtils").castToMillisTime(h),l=d("WAGlobals").getMyUserJid();return d("WAJids").switchOnMsgrChatJidType(e,{group:function(b){return d("MAWGetOrCreateThreadTxns").getOrCreateThread(a,{authoritativeThreadKey:c,description:f,jid:b,lastActivityTimestamp:j,lastReadWatermarkTimestamp:k})},user:function(b){return d("MAWThreadManagementTxns").getOrSetupOneToOneThread(a,{authoritativeThreadKey:c,description:f,lastActivityTimestamp:j,lastReadWatermarkTimestamp:k,userJid:b})}}).then(function(b){var c=d("WAJids").interpretAsGroupJid(b.thread.jid),e=c!=null;c=b.thread?b.thread:b;return d("MAWDexieTable").dexieAll([d("MAWLoadThreadsTxns").loadParticipantsAndMsgs(a,b.created&&e,c,(c=i)!=null?c:1)]).then(function(a){a=a[0];a=e&&(b.created||a.length===0||a.some(function(a){return a.addressable!==!0}));e&&d("MAWIndexedDb").afterTransaction({tag:"GroupInviteLoaded",value:{actorId:d("WAJids").extractUserId(l),threadJid:b.thread.jid}});return{chatJid:b.thread.jid,isCreated:b.created,shouldQueryForGroup:a}})})}});g.createThreadThroughMI=b}),98);
__d("MAWDbAddDeviceChangeAlertsTxn",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){return a.deviceChangeAlerts.add(b)}f.addDeviceChangeAlertsTxn=a}),66);
__d("MAWDbAppDataTxns",["MAWAckLevel","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["updateAppDataSystemAck on sent appData"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["updateAppDataSystemAck on non existing appData"]);i=function(){return a};return a}function a(a,b,c){return a.appData.get({externalId:b}).then(function(b){if(!b){d("WALogger").LOG(i());return null}if(b.ack>d("MAWAckLevel").ACK.clock){d("WALogger").LOG(h());return b}var e=babelHelpers["extends"]({},b,{ack:c});return a.appData.put(e).then(function(){return e})})}function b(a,b){return a.appData.bulkGet(b)}g.updateAppDataSystemAck=a;g.bulkGetAppData=b}),98);
__d("MAWDbGetDeviceChangeAlertsByOptionsTxn",["WAGlobals","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";var h=d("WATimeUtils").pastUnixTime(30*d("WATimeUtils").DAY_SECONDS);function a(a,b){var c=b.after,e=b.isArchived,f=e===void 0?!1:e;e=b.limit;b=e===void 0?20:e;e=a.deviceChangeAlerts;return(c==null?e:e.where("deviceChangeAlertsId").above(c)).filter(function(a){return a.isArchived===f&&a.ts>=h}).reverse().limit(b).toArray().then(function(a){return a.map(function(a){return babelHelpers["extends"]({},a,{isCurrentDevice:d("WAGlobals").getMyDeviceJid()===a.deviceJid})})})}g.getDeviceChangeAlertsByOptionsTxn=a}),98);
__d("MAWDbGetDeviceChangeAlertsTxn",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){return a.deviceChangeAlerts.get(b)}f.getDeviceChangeAlertsTxn=a}),66);
__d("MAWDbGetUnArchivedDeviceChangeAlertsCountTxn",["MAWIndexedDb"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return a.deviceChangeAlerts.filter(function(a){return a.isArchived===!1}).toArray().then(function(a){return d("MAWIndexedDb").afterTransaction({tag:"UnArchivedSelfDeviceChangeAlerts",value:a.length})})}g.getUnArchivedDeviceChangeAlertsCountTxn=a}),98);
__d("MAWDbPendingReceiptTxns",["WAJids","WAMsg"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){var c=b.map(function(a){var b=a.author,c=a.externalId;a=a.thread;return d("WAMsg").craftWAMsgIdString({author:b,chat:a,externalId:c})});return a.pendingReceipts.where("id").anyOf(c).toArray().then(function(c){var e=new Map();c.forEach(function(a){e.set(a.id,a)});var f=b.map(function(a){var b=a.author,c=a.externalId,f=a.thread,g=d("WAMsg").craftWAMsgIdString({author:b,chat:f,externalId:c}),h=e.get(g),i=(h=h)!=null?h:{author:b,deliveryReceipts:[],externalId:c,id:g,readReceipts:[],thread:f};b===d("WAJids").AUTHOR_ME?(a.deliveryReceipts.forEach(function(a){i.deliveryReceipts.push(a)}),a.readReceipts.forEach(function(a){i.readReceipts.push(a)})):(i.deliveryReceipts=[],a.readReceipts.forEach(function(a){i.readReceipts.push(a)}));return i});return a.pendingReceipts.bulkPut(f).then(function(){return f})})}function b(a,b){return a.pendingReceipts.bulkGet(b)}g.bulkAddPendingReceipts=a;g.getPendingReceipts=b}),98);
__d("MAWDbGetAlertsWithDeviceJidTxn",["err"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return a.deviceChangeAlerts.filter(function(a){return a.deviceJid===b&&!a.loggedOut}).toArray().then(function(a){a.length>1&&c("err")("Invalid result, more than one active devices with the same deviceJid: "+b);return a[0]})}g.getAlertsWithDeviceJidTxn=a}),98);
__d("MAWDbUpdateDeviceChangeAlertsTxn",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){return a.deviceChangeAlerts.put(b)}f.updateDeviceChangeAlertsTxn=a}),66);
__d("MAWDbUpdateDeviceChangeAlertsLogInStatusTxn",["MAWDbGetAlertsWithDeviceJidTxn","MAWDbUpdateDeviceChangeAlertsTxn"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return d("MAWDbGetAlertsWithDeviceJidTxn").getAlertsWithDeviceJidTxn(a,b).then(function(b){return d("MAWDbUpdateDeviceChangeAlertsTxn").updateDeviceChangeAlertsTxn(a,babelHelpers["extends"]({},b,{loggedOut:!0}))})}g.updateDeviceChangeAlertsLogInStatusTxn=a}),98);
__d("WADevToolsDebugFns",["WADevToolsBridge"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b={};for(var c in a){var e=a[c];b[c]={id:c,args:e.serializedArgs,desc:e.desc,title:e.name}}d("WADevToolsBridge").getDevToolBridge().setHandlers("backend",{getDebugFns:function(){return b},callDebugFn:function(b){var c=b.id;b=b.args;(c=a[c]).execute.apply(c,b)}})}function b(a,b){return babelHelpers["extends"]({name:a},b)}g.registerDebugFnsToDevTool=a;g.defineDebugFunction=b}),98);
__d("MAWDebugHydrateOfflineQueue",["MAWExternalId","MAWIndexedDb","MAWJobDefinitions","MAWJobManager","MAWTransactionMode","WADbTransactor","WADevToolsDebugFns","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){"use strict";var h=function(a,c){var e=c.maxMessages,f=c.minMessages;return d("MAWIndexedDb").makeMsgrTransactor({participants:d("MAWTransactionMode").READONLY,threads:d("MAWTransactionMode").READONLY},"debug",function(c){return function(){return c.participants.toArray().then(function(b){return b.filter(function(b){return b.userJid===a.contactJid})}).then(function(a){a=a.map(function(a){return a.threadJid});return c.threads.where("jid").anyOf(a).toArray().then(function(a){return Array.from(new Set(a.filter(function(a){return(a==null?void 0:a.archived)!==!0}).map(function(a){return a==null?void 0:a.jid}).filter(Boolean)))})}).then(function(a){setTimeout(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){for(var b of a){var c=Math.floor(Math.random()*e)+f;for(var g=0;g<c;g++)yield d("MAWJobManager").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.sendMsg(b,{content:"Message "+g},d("MAWExternalId").generateExternalId()))}}),0)})}})()},i=function(a){return d("WADbTransactor").makeSignalTransactor({contacts:d("MAWTransactionMode").READONLY},"debug",function(b){return function(){var d=b.contacts.filter(function(b){return b.contactJid===a}).toArray();return d.then(function(a){if(a.length===0)throw c("err")("No participant found");a=a[0];return a})}})()};a=d("WADevToolsDebugFns").defineDebugFunction("hydrateOfflineQueue",{desc:"Hydrate the offline queue for a target user",execute:function(a,b,c){return i(a).then(function(a){return h(a,{maxMessages:b,minMessages:c})})},serializedArgs:[{desc:"Name or Jid of the target user",name:"targetUserNameOrJid",placeholder:"Target user name or Jid",type:"string"},{desc:"Max number of messages per thread to send",name:"maxMessages",placeholder:"30",type:"number"},{desc:"Min number of messages per thread to send",name:"minMessages",placeholder:"1",type:"number"}]});g.hydrateOfflineQueue=a}),98);
__d("MAWDebugSendMultipleMsgs",["MAWJobDefinitions","MAWJobManager","Promise","WADevToolsDebugFns"],(function(a,b,c,d,e,f,g){"use strict";var h;a=d("WADevToolsDebugFns").defineDebugFunction("sendMultipleMsgs",{desc:"Sends multiple messages to a thread",execute:function(a,c){return(h||(h=b("Promise"))).all(Array.from(Array(c).keys()).map(function(b){return d("MAWJobManager").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.sendMsg(a,{content:b+" message"}))}))},serializedArgs:[{desc:"ChatJid of the thread to send messages to",name:"chatJid",placeholder:"1234@msgr",type:"string"},{desc:"Number of messages to send",name:"numberOfMsgs",placeholder:"100",type:"number"}]});g.sendMultipleMsgs=a}),98);
__d("MAWLoadMsgsDedupper",["MAWDbMsgUtil","WAMsg"],(function(a,b,c,d,e,f,g){"use strict";function a(){var a=new Set();return function(b){b=d("MAWDbMsgUtil").getProtocolMsgIdFromDbMsg(b);if(b==null)return!0;b=d("WAMsg").craftWAMsgIdString(b);if(b!=null){if(a.has(b))return!1;a.add(b)}return!0}}g["default"]=a}),98);
__d("MAWLoadMsgsTxnsV2",["FBLogger","MAWBridgeMsg","MAWBridgeMsgCountdown","MAWBridgeReceiverFetchInfo","MAWBridgeTypesCreators","MAWBridgeXMA","MAWDbChunkTxns","MAWDbEditMsgHistoryTxns","MAWDbMediaTxns","MAWDbReactionsTxns","MAWDbReceiverFetchTxns","MAWDbXMATxns","MAWDexieTable","MAWLoadMsgsDedupper","MAWLoadReplyMediaTxns","MAWLoggerUtils","MAWMediaUtils","MAWODSProxy","MAWRavenUtils","MAWXMAUtils","WALogger","WAMsgType","WAOdsEnums","WATagsLogger","WATimeUtils","gkx"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["LoadMsgsByExternalId: From: externalId:",". ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["LoadMoreMsgs: From:"," orignalMsgId:",". ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["LoadMsgs: Point direction requires sortOrderMs"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["EphemeralCounter: Showing UI counter for ",""]);k=function(){return a};return a}function l(a,b,e,f,g,h,i){var j=0,k=!1,l=0;switch(e){case"before":return m();case"after":return n().then(function(a){return a.reverse()});default:e;return d("MAWDexieTable").dexieAll([m(),n()]).then(function(a){var b=a[0];a=a[1];return o(b,a)})}function m(){var d=c("MAWLoadMsgsDedupper")();return a.messages.where(["threadJid","sortOrderMs"]).between([b,0],[b,g],!0,!0).reverse().filter(i).filter(d).until(p,!0).toArray()}function n(){var d=c("MAWLoadMsgsDedupper")();return a.messages.where(["threadJid","sortOrderMs"]).between([b,g],[b,Number.MAX_SAFE_INTEGER],!0,!0).filter(i).filter(d).until(p,!0).toArray()}function o(a,b){var c=new Map();b.reverse().forEach(function(a){return c.set(a.msgId,a)});a.forEach(function(a){return c.set(a.msgId,a)});return Array.from(c.values())}function p(a){j++;if(j>f&&a.sortOrderMs!==g)return!0;a.msgId===h&&(k=!0);k&&l++;return l>f?!0:!1}}function m(a,b){return d("MAWDbReactionsTxns").getReactionsFromMessages(a,b).then(function(a){return a.map(function(a){var b=a.author,c=a.reaction,e=a.reactToMsgId,f=a.threadJid;a=a.ts;if(e==null)return;return c==null?{reaction:d("MAWBridgeTypesCreators").createBridgeDeleteReaction({author:b,chatJid:f,reactToMsgId:e}),type:"delete"}:{reaction:d("MAWBridgeTypesCreators").createBridgeUpsertReaction({author:b,chatJid:f,reaction:c||"",reactToMsgId:e,ts:a}),type:"upsert"}}).filter(Boolean)})}function n(a,b){return d("MAWDbMediaTxns").getMsgMediaPairFromMsgs(a,b).then(function(b){return d("MAWDexieTable").dexieAll(b.map(function(b){var c=b[0],e=b[1];return d("MAWDbChunkTxns").hasMediaChunk(a,e.hashedPlaintextHash).then(function(b){return o(a,c.threadJid,e).then(function(f){var g=f.map(function(a){return a.msgId});g=c.ravenEphemeralType!=null&&c.ravenEphemeralMediaState!=null?d("MAWBridgeTypesCreators").createBridgeMedia({chatJid:c.threadJid,filteredMsgIds:g,hasMediaForUI:b,media:e,ravenSettings:d("MAWRavenUtils").deriveRavenSettings(c.ravenEphemeralType,c.ravenEphemeralMediaState),sortOrderMs:c.sortOrderMs}):d("MAWBridgeTypesCreators").createBridgeMedia({chatJid:c.threadJid,filteredMsgIds:g,hasMediaForUI:b,media:e,sortOrderMs:c.sortOrderMs});return d("MAWMediaUtils").getBridgeMediaAnnotatedForDisplay(a,g,f)})})}))})}function o(a,b,c){return a.messages.where("msgId").anyOf(c.msgIds).toArray().then(function(a){return a.filter(function(a){return a.threadJid===b})})}function p(a,b){return d("MAWDbXMATxns").getXMAFromMsgs(a,b).then(function(b){return d("MAWDexieTable").dexieAll(b.map(function(b){return d("MAWXMAUtils").isXMAStoryReply(b.targetType)?d("MAWDexieTable").dexieResolve(null):d("MAWDbMediaTxns").maybeGetMediaFromMediaId(a,b.defaultPreviewMediaId).then(function(e){if(c("gkx")("821"))return e==null?d("MAWBridgeXMA").createBridgeXMA(e,b,!1):d("MAWDexieTable").dexieAll([e,d("MAWDbChunkTxns").hasMediaChunk(a,e==null?void 0:e.hashedPlaintextHash)]).then(function(a){var c=a[0];a=a[1];return d("MAWBridgeXMA").createBridgeXMA(c,b,a)});else return d("MAWBridgeXMA").createBridgeXMA(e,b,!1)})}))}).then(function(a){return a.filter(Boolean)})}function q(a,b){return d("MAWDexieTable").dexieAll(b.map(function(b){return b.receiverFetchId==null?d("MAWDexieTable").dexieResolve(null):d("MAWDbReceiverFetchTxns").maybeGetReceiverFetchInfoFromReceiverFetchId(a,b.receiverFetchId).then(function(a){return a==null?d("MAWDexieTable").dexieResolve(null):d("MAWBridgeReceiverFetchInfo").createBridgeReceiverFetchInfoPayloadFromDbInfo(b,a)})})).then(function(a){return a.filter(Boolean)})}function r(a,b,c,e,f,g,h){h===void 0&&(h=function(){return!0});var i=d("WATimeUtils").unixTime(),j=function(a){return a.messageExpirationTs==null||a.messageExpirationTs>i};return l(a,b,e,c,f,g,function(a){return h(a)&&j(a)}).then(function(b){return d("MAWDexieTable").dexieAll(b.map(function(b){return d("MAWLoadReplyMediaTxns").getReplyMediaForMsgQuote(a,b)})).then(function(a){return{msgs:b,replyMediaInfo:a}})})}function s(a,b){return a.messages.where("externalId").equals(b).toArray()}function t(a,b){return s(a,b).then(function(e){e.length>1&&c("FBLogger")("messenger_web_pinned_messages").warn("duplicate MAW msg returned for externalId",b);return d("MAWDexieTable").dexieAll(e.map(function(b){return d("MAWLoadReplyMediaTxns").getReplyMediaForMsgQuote(a,b)})).then(function(a){return{msgs:e,replyMediaInfo:a}})})}function u(a){a=a.filter(function(a){return a.ephemeralCounterStarted});if(a.length>0){d("WATagsLogger").TAGS([d("MAWLoggerUtils").Tag.Ephemeral,d("MAWLoggerUtils").Tag.Countdown,d("MAWLoggerUtils").Tag.OnLoad]).LOG(k(),a.map(function(a){return a.msgId}));return d("MAWBridgeMsgCountdown").createBridgeMsgsStartCountdown(a).msgs}return[]}function v(a,b){if(a!=null)return a;switch(b){case"before":return Number.MAX_SAFE_INTEGER;case"after":return Number.MIN_SAFE_INTEGER;default:b;d("WALogger").ERROR(j());return 0}}function a(a,b,c,e,f,g,h,j){var k=v(f,e);return r(a,b,c,e,k,h,function(a){return j.admin||a.type!==d("WAMsgType").MSG_TYPE.ADMIN}).then(function(b){var f=b.msgs,l=b.replyMediaInfo;b=f;g||(b=b.filter(function(a){return a.msgId!==h}),b.length===f.length&&f.length!==0&&d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.LOAD_MORE_NO_ORIGINAL_MSG_IN_MAW,key:"mismatch"}));var o=f.length;if(o===0||b.length===0)return{editMsgHistory:[],expiringCountdown:[],hasMoreAfter:x(o,c,e),hasMoreBefore:w(o,c,e),medias:[],msgs:[],reactions:[],receiverFetchInfoPayloads:[],xmas:[]};var r=b.map(function(a,b){if(d("MAWXMAUtils").isXMAStoryReply(a.xmaMessageType))return;return d("MAWBridgeMsg").createBridgeMsg(a,void 0,(l||[])[b])}).filter(Boolean),s=u(b);d("WATagsLogger").TAGS(["MAWSecureLocalDBDataSource"]).LOG(i(),k,h,r.map(function(a){return a.msgId+":"+a.sortOrderMs}));return d("MAWDexieTable").dexieAll([j.reactions?m(a,b):d("MAWDexieTable").dexieResolve([]),j.media?n(a,b):d("MAWDexieTable").dexieResolve([]),j.xma?p(a,b):d("MAWDexieTable").dexieResolve([]),j.editMsgHistory?d("MAWDbEditMsgHistoryTxns").loadEditMsgHistory(a,b):d("MAWDexieTable").dexieResolve([]),j.receiverFetch?q(a,b):d("MAWDexieTable").dexieResolve([])]).then(function(a){var b=a[0],d=a[1],f=a[2],g=a[3];a=a[4];return{editMsgHistory:g,expiringCountdown:s,hasMoreAfter:x(o,c,e),hasMoreBefore:w(o,c,e),medias:d,msgs:r,reactions:b,receiverFetchInfoPayloads:a,xmas:f}})})}function w(a,b,c){switch(c){case"before":return a>=b;case"point":return a>1;default:c;return!0}}function x(a,b,c){switch(c){case"after":return a>=b;case"point":return a>1;default:c;return!0}}function b(a,b,c){return t(a,b).then(function(e){var f=e.msgs,g=e.replyMediaInfo;if(f.length===0)return{editMsgHistory:[],medias:[],msgs:[],reactions:[],receiverFetchInfoPayloads:[],xmas:[]};var i=f.map(function(a,b){if(d("MAWXMAUtils").isXMAStoryReply(a.xmaMessageType))return;return d("MAWBridgeMsg").createBridgeMsg(a,void 0,(g||[])[b])}).filter(Boolean);d("WATagsLogger").TAGS(["MAWFetchMessageByPinnedExternalId"]).LOG(h(),b,i.map(function(a){return""+a.msgId}));return d("MAWDexieTable").dexieAll([c.reactions?m(a,f):d("MAWDexieTable").dexieResolve([]),c.media?n(a,f):d("MAWDexieTable").dexieResolve([]),c.xma?p(a,f):d("MAWDexieTable").dexieResolve([]),c.editMsgHistory?d("MAWDbEditMsgHistoryTxns").loadEditMsgHistory(a,f):d("MAWDexieTable").dexieResolve([]),c.receiverFetch?q(a,f):d("MAWDexieTable").dexieResolve([])]).then(function(a){var b=a[0],c=a[1],d=a[2],e=a[3];a=a[4];return{editMsgHistory:e,medias:c,msgs:i,reactions:b,receiverFetchInfoPayloads:a,xmas:d}})})}g.loadMoreMsgsAndMediaFromTs=a;g.loadMsgsAndMediaByExternalId=b}),98);
__d("MAWLoadMsgsApi",["MAWIndexedDb","MAWLoadMsgsTxns","MAWLoadMsgsTxnsV2","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";b=d("MAWIndexedDb").makeMsgrTransactor({chunk:(a=d("MAWTransactionMode")).READONLY,editMsgHistory:a.READONLY,media:a.READONLY,messages:a.READONLY,reactions:a.READONLY,receiverFetchInfo:a.READONLY,threads:a.READONLY,xma:a.READONLY},"loadMsgsFromTs",function(a){return function(b,c,e,f,g,h,i){return d("MAWLoadMsgsTxnsV2").loadMoreMsgsAndMediaFromTs(a,b,c,e,f,g,h,i)}});c=d("MAWIndexedDb").makeMsgrTransactor({chunk:a.READONLY,editMsgHistory:a.READONLY,media:a.READONLY,messages:a.READONLY,reactions:a.READONLY,receiverFetchInfo:a.READONLY,threads:a.READONLY,xma:a.READONLY},"loadMsgs",function(a){return function(b,c,e,f){return d("MAWLoadMsgsTxns").loadMsgsAndMediaFromOffset(a,b,c,e,!0,(b=f)!=null?b:"before").then(function(a){var b=a.hasMoreAfter;a=a.hasMoreBefore;return{hasMoreAfter:b,hasMoreBefore:a}})}});e=d("MAWIndexedDb").makeMsgrTransactor({chunk:a.READONLY,editMsgHistory:a.READONLY,media:a.READONLY,messages:a.READONLY,reactions:a.READONLY,receiverFetchInfo:a.READONLY,threads:a.READONLY,xma:a.READONLY},"loadMsgsByExternalId",function(a){return function(b,c){return d("MAWLoadMsgsTxnsV2").loadMsgsAndMediaByExternalId(a,b,c)}});g.loadMsgsFromTs=b;g.loadMsgs=c;g.loadMsgsByExternalId=e}),98);
__d("MAWDebugMsg",["MAWBridgeMsg","MAWDbMsg","MAWDbMsgTxns","MAWDbThreadTxns","MAWDexieTable","MAWIndexedDb","MAWLocalizationType","MAWLocalizationUtils","MAWMsgType","MAWTransactionMode","MAWTransactor","WATimeUtils","gkx"],(function(a,b,c,d,e,f,g){"use strict";b=d("MAWTransactor").makeMsgrTransactor({chunk:(a=d("MAWTransactionMode")).READONLY,groupInfo:a.READONLY,media:a.READONLY,messages:a.READWRITE,participants:a.READONLY,threads:a.READWRITE},"writeDebugMsg",function(a){return function(b,e,f){return!c("gkx")("23958")?d("MAWDexieTable").dexieResolve():d("MAWDbThreadTxns").getThread(a,b).then(function(b){if(!b.success)return;var c=b.value;return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").getThreadNewestMessageBySortOrder(a,c.jid),d("MAWDbMsgTxns").getThreadNewestMessageTs(a,c),(f==null?void 0:f.decryptionError)==="errDuplicateMsg"?d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,f.protocolMsgId).then(function(a){if(a==null)return", no existing message";return a.type===d("MAWMsgType").MSG_TYPE.CIPHERTEXT?", existing ciphertext message":",  existing message"}):d("MAWDexieTable").dexieResolve(""),d("MAWDbMsgTxns").getNextMsgIdNumberForThread(a,c)]).then(function(a){var b=a[0],f=a[1],g=a[2];a=a[3];a=d("MAWDbMsg").craftDebugMsgId(c.chatId,a-1);f=d("WATimeUtils").castToMillisTime(((b=(b=b==null?void 0:b.sortOrderMs)!=null?b:f)!=null?b:0)+1);b=d("MAWLocalizationUtils").buildUnstoredDbAdminMsg({adminMsgContent:["[fb-only][DEBUG]: "+(e+g)],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.DEBUG_MSG,version:0},c.jid);d("MAWIndexedDb").afterTransaction({tag:"NewMsg",value:d("MAWBridgeMsg").createBridgeMsg(babelHelpers["extends"]({},b,{msgId:a,sortOrderMs:f}))})})})}});g.writeDebugMsg=b}),98);
__d("MAWMessageSendScheduler",["WorkerScheduler"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(){h==null&&(h=d("WorkerScheduler").makeScheduler("message-send",{concurrency:5,maxConcurrency:5,maxThrottleMs:500}));return h}g.messageSendScheduler=a}),98);
__d("MAWGetAllMediaIdsForXMAMsgApi",["MAWDbXMATxns","MAWDexieTable","MAWIndexedDb","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({xma:d("MAWTransactionMode").READONLY},"getAllMediaIdsForXMAMsg",function(a){return function(b){var c=new Map();b=b.map(function(b){return d("MAWDbXMATxns").maybeGetXMAFromProtocolMsgId(a,b).then(function(a){var d,e=(d=c.get(b))!=null?d:new Set();a!=null&&(a.faviconMediaId!=null&&e.add(a.faviconMediaId),a.headerMediaId!=null&&e.add(a.headerMediaId),a.previewMediaIds!=null&&a.previewMediaIds.forEach(function(a){return e.add(a)}));c.set(b,e)})});return d("MAWDexieTable").dexieAll(b).then(function(a){return c})}});g.getAllMediaIdsForXMAMsg=a}),98);
__d("MAWAsArmadilloApplication",["MAWMsgType","MAWXMAEncodeUtils","WAArmadilloApplication.pb","WATimeUtils","err"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){switch(a.type){case d("MAWMsgType").MSG_TYPE.XMA:if((b==null?void 0:b.xma)==null)throw c("err")("XMA content should have XMA payload");return d("MAWXMAEncodeUtils").encodeXMA(a,b);case d("MAWMsgType").MSG_TYPE.RAVEN_ACTION:return h(a);default:throw c("err")(a.type+" should not be handled as ArmadilloApplication")}}function h(a){var b=a.ravenActionToMsgExternalId;if(b==null)throw c("err")("msg ravenActionToMsgExternalId is null in encodeRavenActionMessage");var e=Number(a.actionType),f;if(e===0)f=d("WAArmadilloApplication.pb").ARMADILLO_CONTENT_RAVEN_ACTION_NOTIF_MESSAGE_ACTION_TYPE.PLAYED;else if(e===1)f=d("WAArmadilloApplication.pb").ARMADILLO_CONTENT_RAVEN_ACTION_NOTIF_MESSAGE_ACTION_TYPE.SCREENSHOT;else if(e===2)f=d("WAArmadilloApplication.pb").ARMADILLO_CONTENT_RAVEN_ACTION_NOTIF_MESSAGE_ACTION_TYPE.FORCE_DISABLE;else throw c("err")("msg actionType is not in enum in encodeRavenActionMessage");e=a.actionTimestamp;e==null&&(e=d("WATimeUtils").castMilliSecondsToUnixTime(Date.now()));a={actionTimestamp:e,actionType:f,key:{id:b}};return{payload:{content:{ravenActionNotifMessage:a}}}}g.asArmadilloApplication=a}),98);
__d("MAWAsMessageApplication",["I64","LSIntEnum","LSMessageReplySourceTypeV2","MAWAsArmadilloApplication","MAWAsConsumerApplication","MAWJids","MAWMsgType","WAArmadilloApplication.pb","WAConsumerApplication.pb","WAFranking","WAGlobals","WAJids","encodeProtobuf"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a,b,c,e){var f,g;switch(a.type){case d("MAWMsgType").MSG_TYPE.RAVEN_ACTION:f=d("MAWAsArmadilloApplication").asArmadilloApplication(a);break;case d("MAWMsgType").MSG_TYPE.XMA:f=d("MAWAsArmadilloApplication").asArmadilloApplication(a,e);break;default:g=d("MAWAsConsumerApplication").asConsumerApplication(a,b,c)}var h,i;e=a.forwardingScore!=null?a.forwardingScore:0;b=a.isForwarded!=null?a.isForwarded:!1;if(a.quote!=null){c=a.quote;h={participant:c.content.author===d("WAJids").AUTHOR_ME?d("WAGlobals").getMyDeviceJid():c.content.author,stanzaId:c.content.externalId}}if(a.ephemeralSetting){c=a.ephemeralSetting;a.type===d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_CHANGE_FROM_CURRENT_DEVICE?i={ephemeralExpiration:c.ephemeralExpirationInSec,isEphemeralSettingReset:a.isEphemeralSettingReset}:i={ephemeralExpiration:c.ephemeralExpirationInSec,ephemeralSettingTimestamp:c.ephemeralLastUpdatedOrSetTimestamp*1e3}}c={metadata:{chatEphemeralSetting:i,forwardingScore:e,frankingKey:k(a.reportingMeta),frankingVersion:d("WAFranking").getFrankingVersion(),groupId:a.groupId,groupIndex:a.groupIndex,groupSize:a.groupSize,isForwarded:b,quotedMessage:h}};if(g!=null){e=d("encodeProtobuf").encodeProtobuf(d("WAConsumerApplication.pb").ConsumerApplicationSpec,g);c.payload={subProtocol:{consumerMessage:{payload:e.readBuffer(),version:1}}}}else if(f!=null){a=d("encodeProtobuf").encodeProtobuf(d("WAArmadilloApplication.pb").ArmadilloSpec,f);c.payload={subProtocol:{armadillo:{payload:a.readBuffer(),version:1}}}}return c}function b(a){var b=d("MAWAsConsumerApplication").asConsumerApplicationLSDb(a),e,f,g=a.isForwarded!=null?a.isForwarded:!1,j=g?1:0;a.replySourceTypeV2&&!(h||(h=d("I64"))).equal(a.replySourceTypeV2,(i||(i=d("LSIntEnum"))).ofNumber(c("LSMessageReplySourceTypeV2").NONE))&&a.replyToUserId!=null&&(e={participant:a.replyToUserId===d("WAJids").AUTHOR_ME?d("WAGlobals").getMyDeviceJid():d("MAWJids").toUserJid((h||(h=d("I64"))).to_string(a.replyToUserId)),stanzaId:a.messageId});j={metadata:{chatEphemeralSetting:f,forwardingScore:j,frankingKey:d("WAFranking").createFrankingKey(),frankingVersion:d("WAFranking").getFrankingVersion(),groupId:(j=a==null?void 0:a.groupId)!=null?j:void 0,groupIndex:a.groupIndex!=null?(h||(h=d("I64"))).to_float(a.groupIndex):void 0,groupSize:a.groupSize!=null?(h||(h=d("I64"))).to_float(a.groupSize):void 0,isForwarded:g,quotedMessage:e}};if(b!=null){a=d("encodeProtobuf").encodeProtobuf(d("WAConsumerApplication.pb").ConsumerApplicationSpec,b);j.payload={subProtocol:{consumerMessage:{payload:a.readBuffer(),version:1}}}}return j}function e(a){a=d("MAWAsConsumerApplication").encodeReactionMessage(a);a=d("encodeProtobuf").encodeProtobuf(d("WAConsumerApplication.pb").ConsumerApplicationSpec,a);return{metadata:{frankingKey:d("WAFranking").createFrankingKey(),frankingVersion:d("WAFranking").getFrankingVersion()},payload:{subProtocol:{consumerMessage:{payload:a.readBuffer(),version:1}}}}}function f(a){a=d("MAWAsConsumerApplication").encodeEditMessage(a);a=d("encodeProtobuf").encodeProtobuf(d("WAConsumerApplication.pb").ConsumerApplicationSpec,a);return{metadata:{frankingKey:d("WAFranking").createFrankingKey(),frankingVersion:d("WAFranking").getFrankingVersion()},payload:{subProtocol:{consumerMessage:{payload:a.readBuffer(),version:1}}}}}function j(a,b){var c;b=d("MAWAsConsumerApplication").deletedMsgAsConsumerApplicationForSpamReporting(a,b);if(b==null)return null;b=d("encodeProtobuf").encodeProtobuf(d("WAConsumerApplication.pb").ConsumerApplicationSpec,b);return{metadata:{frankingKey:k(a.reportingMeta),frankingVersion:((c=a.reportingMeta)==null?void 0:c.frankingVersion)!=null?(c=a.reportingMeta)==null?void 0:c.frankingVersion:d("WAFranking").getFrankingVersion()},payload:{subProtocol:{consumerMessage:{payload:b.readBuffer(),version:1}}}}}function k(a){if((a==null?void 0:a.frankingKey)!=null)return a.frankingKey;else return d("WAFranking").createFrankingKey()}g.asMessageApplication=a;g.asMessageApplicationLSDb=b;g.asReactionMessageApplication=e;g.asEditMessageApplication=f;g.deletedMsgAsMessageApplicationForSpamReporting=j}),98);
__d("MAWXMAEncodeUtils",["MAWAsConsumerApplication","MAWAsMessageApplication","MAWMsgType","MAWParseSubprotocolVersionConsts","MAWVault","WALogger","WAMsgApplication.pb","encodeProtobuf","validateMAWMediaAndComposeEntryForProtoMsg"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Non-text associated message for the XMA content is not supported"]);h=function(){return a};return a}function i(a,b,e){a=c("validateMAWMediaAndComposeEntryForProtoMsg")(a,b);b=a[0];a=a[1];return{payload:d("MAWAsConsumerApplication").encodeValidatedMediaToImageTransport(b,a),version:e}}function a(a,b){var c,e,f=b.associatedMessage,g=b.favicon,j=b.header,k=b.previews;b=b.xma;var l=null;if(f!=null)if(f.type!==d("MAWMsgType").MSG_TYPE.TEXT)d("WALogger").ERROR(h());else{f=d("MAWAsMessageApplication").asMessageApplication(f);f=d("encodeProtobuf").encodeProtobuf(d("WAMsgApplication.pb").MessageApplicationSpec,f);l={payload:f.readBuffer(),version:d("MAWParseSubprotocolVersionConsts").ASSOCIATED_MESSAGE_SUBPROTOCOL_VERSION}}f=j!=null?i(a.msgId,j,d("MAWParseSubprotocolVersionConsts").XMA_HEADER_SUBPROTOCOL_VERSION):null;j=g!=null?i(a.msgId,g,d("MAWParseSubprotocolVersionConsts").XMA_FAVICON_SUBPROTOCOL_VERSION):null;g=k!=null?k.map(function(b){return i(a.msgId,b,d("MAWParseSubprotocolVersionConsts").XMA_PREVIEW_SUBPROTOCOL_VERSION)}):null;k=b.defaultCTA==null?void 0:[b.defaultCTA].concat(b.ctas).filter(Boolean);c=(c=a.msgContent)==null?void 0:c.content;return{payload:{content:{extendedContentMessage:{associatedMessage:(e=l)!=null?e:void 0,ctas:k,favicon:(e=j)!=null?e:void 0,headerImage:(k=f)!=null?k:void 0,headerTitle:b.headerTitle,maxSubtitleNumOfLines:b.maxSubtitleNumOfLines,maxTitleNumOfLines:b.maxTitleNumOfLines,messageText:c==null?void 0:d("MAWVault").unvault(c),overlayDescription:b.overlayDescription,overlayIconGlyph:b.overlayIconGlyph,overlayTitle:b.overlayTitle,previews:(j=g)!=null?j:[],sentWithMessageId:l?a.externalId:void 0,subtitleText:b.subtitleText,targetExpiringAtSec:b.targetExpiringAtSec,targetId:b.targetId,targetType:b.targetType,targetUsername:b.targetUsername,titleText:b.titleText,xmaLayoutType:b.xmaLayoutType}}}}}g.encodeXMA=a}),98);
__d("MAWGetEditMsgForSending",["MAWAckLevel","MAWAsMessageApplication","MAWDbEditMsgHistoryTxns","MAWDbMsgTxns","MAWDbThreadTxns","MAWDexieTable","MAWIndexedDb","MAWJidUtils","MAWTransactionMode","WAJids","WALogger","WAResultOrError","err"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[SendEditMsg] Failed to get originalMsg"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[SendEditMsg] Failed to get thread (success:",")"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[SendEditMsg] Failed to get originalMsgProtocolMsgId"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[SendEditMsg] Failed to get edit history"]);k=function(){return a};return a}b=d("MAWIndexedDb").makeMsgrTransactor({editMsgHistory:(a=d("MAWTransactionMode")).READONLY,messages:a.READONLY,participants:a.READONLY,reactions:a.READONLY,threads:a.READONLY},"getEditMsgForSending",function(a){return function(b,e){return l(a,b,e).then(function(a){if(!a.success)return{type:a.error};a=a.value.msg;var e=d("MAWAsMessageApplication").asEditMessageApplication(a);if(d("WAJids").isAuthorSystem(a.author))throw c("err")("This cannot happen because there are no system edit");return{dbMsg:a,editOriginalExternalId:a.originalMsgExternalId,messageApplication:e,messageType:{isRevoked:!1,type:"text"},protocolMsgId:b,type:"unsent"}})}});function l(a,b,c){return d("MAWDbEditMsgHistoryTxns").getEditHistoryMsgByEditedProtocolMsgId(a,b,c).then(function(b){if(b==null){d("WALogger").ERROR(k());return d("WAResultOrError").makeError("missing_history")}else if(b.sendStatus!=null&&b.sendStatus>d("MAWAckLevel").ACK.clock)return d("WAResultOrError").makeError("sent");var c=d("MAWJidUtils").maybeToProtocolMsgId(b.author,b.threadJid,b.originalMsgExternalId);if(c==null){d("WALogger").ERROR(j());return d("WAResultOrError").makeError("missing_msg")}return d("MAWDexieTable").dexieAll([d("MAWDbThreadTxns").getThread(a,b.threadJid),d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,c)]).then(function(a){var c=a[0];a=a[1];if(!c.success){d("WALogger").ERROR(i(),c.success);return d("WAResultOrError").makeError("missing_thread")}if(a==null){d("WALogger").ERROR(h());return d("WAResultOrError").makeError("missing_msg")}return a.ack>d("MAWAckLevel").ACK.clock?d("WAResultOrError").makeError("sent"):d("WAResultOrError").makeResult({msg:b,thread:c.value})})})}g.getEditMsgForSending=b}),98);
__d("MAWMediaType",["WAServerMediaType"],(function(a,b,c,d,e,f,g){"use strict";function a(a){switch(a){case"XMA":return"xma-image";case"EphemeralScreenshotAction":case"Raven":case"RavenAction":case"EditAction":case"BumpExistingMessage":return null;default:return d("WAServerMediaType").getMediaType(a)}}g.getMediaType=a}),98);
__d("MAWSendMsgUtil",["MAWMediaType","WAMsgType"],(function(a,b,c,d,e,f,g){"use strict";var h={};function i(a){var b=d("MAWMediaType").getMediaType(a),c=a===d("WAMsgType").MSG_TYPE.REVOKED;if(b!=null)return{mediaType:b,type:"media"};else if(a===d("WAMsgType").MSG_TYPE.SK_DISTRIBUTION)return{isInvisible:!0,isRevoked:!1,type:"text"};else return{isRevoked:c,type:"text"}}function a(a){var b=d("MAWMediaType").getMediaType(a);if(b!=null)return{mediaType:b,type:"media"};switch(a){case"XMA":case"Raven":case"RavenAction":case"EphemeralScreenshotAction":case"EditAction":case"BumpExistingMessage":return{isRevoked:!1,type:"text"};default:return i(a)}}function b(a){return h[a]}function c(a){h[a]=!0}function e(a){delete h[a]}g.waGetMessageTypeFromMsg=i;g.getMessageTypeFromMsg=a;g.checkS2SInstanceKeyExist=b;g.addS2SInstanceKey=c;g.removeS2SInstanceKey=e}),98);
__d("MAWGetMsgForSendingApi",["MAWAckLevel","MAWAsMessageApplication","MAWDbGroupInviteTxns","MAWDbMediaTxns","MAWDbMsg","MAWDbMsgTxns","MAWDbParticipantTxns","MAWDbThreadTxns","MAWDbUnrenderedMsgTxns","MAWDbXMATxns","MAWDexieTable","MAWIndexedDb","MAWMsgType","MAWSendMsgUtil","MAWTransactionMode","MAWXMAUtils","WAJids","WALogger","WAResultOrError","err"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[SendMsg] Failed to get XMA: isXma: ",", type: "," "]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[SendMsg] Failed to get thread (success:",")"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[SendMsg] Failed to get message"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg "," -- MAWGetMsgForSendingAPI -- Done"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg "," -- MAWGetMsgForSendingAPI -- Unrecognized type ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg "," -- MAWGetMsgForSendingAPI -- Error: ",""]);m=function(){return a};return a}b=d("MAWIndexedDb").makeMsgrTransactor({groupInvites:(a=d("MAWTransactionMode")).READONLY,media:a.READONLY,messages:a.READONLY,participants:a.READONLY,reactions:a.READONLY,threads:a.READONLY,unrenderedMessages:a.READONLY,xma:a.READONLY},"getMsgForSending",function(a){return function(b){return n(a,b).then(function(a){if(!a.success){d("WALogger").LOG(m(),b,a.error);return{type:a.error}}a=a.value;var e=a.contactsInThread,f=a.groupInvite,g=a.isReplyMsg,h=a.media,i=a.msg,j=a.thread;a=a.xmaPayload;if(!d("MAWDbMsg").NO_CONTENT_MESSAGE_TYPES_ALLOWLIST.includes(i.type)&&!d("MAWDbMsg").isContentMsg(i)){d("WALogger").LOG(l(),b,i.type);throw c("err")("We do not support message sending with "+i.type+" type")}var n=d("MAWAsMessageApplication").asMessageApplication(i,h,f,a),o=null;i.type===d("MAWMsgType").MSG_TYPE.GROUP_INVITE&&f?o={invitedParticipantUserJid:f.inviteeJid,isRevoked:!1,type:"text"}:o=d("MAWSendMsgUtil").getMessageTypeFromMsg(i.type);if(d("WAJids").isAuthorSystem(i.author))throw c("err")("A system message cannot be sent");d("WALogger").LOG(k(),b);return{contactsInThread:e,dbMsg:i,isReplyMsg:g,isXMAMsg:a!=null,media:h,messageApplication:n,messageType:o,protocolMsgId:{author:i.author,chat:j.jid,externalId:a!=null&&a.associatedMessage!=null?a.associatedMessage.externalId:i.externalId},type:"unsent"}})}});function n(a,b){return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,b),d("MAWDbUnrenderedMsgTxns").maybeGetUnrenderedMsgByProtocolMsgId(a,b)]).then(function(c){var e=c[0];c=c[1];var f=c.value,g=e||f;if(g==null){d("WALogger").ERROR(j());return d("WAResultOrError").makeError("missing_msg")}else if(g.ack>d("MAWAckLevel").ACK.clock)return d("WAResultOrError").makeError("sent");var k=d("MAWXMAUtils").maybeXMAMessage(e),l=g.quote!=null;return d("MAWDexieTable").dexieAll([d("MAWDbThreadTxns").getThread(a,g.threadJid),e?d("MAWDbMediaTxns").getAndCheckMediaFromMsg(a,e):d("MAWDexieTable").dexieResolve(d("WAResultOrError").makeResult()),c.success?d("MAWDbGroupInviteTxns").getAndCheckGroupInviteFromMsg(a,c.value):d("MAWDexieTable").dexieResolve(),k?d("MAWDbXMATxns").maybeGetXMAPayloadFromProtocolMsgId(a,b):null,d("MAWDbParticipantTxns").getParticipantsInThread(a,g.threadJid).then(function(a){return a.map(function(a){return a.userJid})})]).then(function(a){var b=a[0],c=a[1],e=a[2],f=a[3];a=a[4];if(!c.success)return c;if(!b.success){d("WALogger").ERROR(i(),b.success);return d("WAResultOrError").makeError("missing_thread")}if(f!=null&&!f.success){d("WALogger").ERROR(h(),k,g.type);return d("WAResultOrError").makeError("missing_xma")}c=c.value;b=b.value;return d("WAResultOrError").makeResult({contactsInThread:a,groupInvite:e,isReplyMsg:l,media:c,msg:g,thread:b,xmaPayload:f!=null?f.value:null})})})}g.getMsgForSending=b}),98);
__d("MAWGetReactionForSending",["MAWAckLevel","MAWAsMessageApplication","MAWDbReactionsTxns","MAWDbThreadTxns","MAWIndexedDb","MAWTransactionMode","WAJids","WAResultOrError","err"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b){return d("MAWDbReactionsTxns").getReaction(a,b).then(function(b){if(b==null)return d("WAResultOrError").makeError("missing");else if(b.ack>d("MAWAckLevel").ACK.clock)return d("WAResultOrError").makeError("sent");return d("MAWDbThreadTxns").getThread(a,b.threadJid).then(function(a){return!a.success?d("WAResultOrError").makeError(a.error):d("WAResultOrError").makeResult({msg:b})})})}a=d("MAWIndexedDb").makeMsgrTransactor({reactions:d("MAWTransactionMode").READONLY,threads:d("MAWTransactionMode").READONLY},"getReactionForSending",function(a){return function(b){return h(a,b).then(function(a){if(!a.success)return{type:a.error};a=a.value.msg;var b=d("MAWAsMessageApplication").asReactionMessageApplication(a);if(d("WAJids").isAuthorSystem(a.author))throw c("err")("This cannot happen because there are no system reactions");return{chat:a.threadJid,dbMsg:a,externalId:a.externalId,messageApplication:b,messageType:{isInvisible:!0,type:"reaction"},protocolMsgId:{author:a.author,chat:a.threadJid,externalId:a.externalId},type:"unsent"}})}});g.getReactionForSending=a}),98);
__d("MAWLoadThreadParticipantsApi",["MAWDbParticipantTxns","MAWIndexedDb","MAWTransactionMode","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["MAWLoadThreadParticipantsApi -- loadThreadParticipants -- there is no thread in db"]);h=function(){return a};return a}a=d("MAWIndexedDb").makeMsgrTransactor({participants:d("MAWTransactionMode").READONLY,threads:d("MAWTransactionMode").READONLY},"loadThreadParticipants",function(a){return function(b){return a.threads.get({jid:b}).then(function(b){if(b==null){d("WALogger").ERROR(h());return[]}return d("MAWDbParticipantTxns").getParticipantsInThread(a,b.jid).then(function(a){return a.map(function(a){return a.userJid})})})}});g.loadThreadParticipants=a}),98);
__d("MAWMarkEditMsgDroppedApi",["FBLogger","MAWAckLevel","MAWBridgeMsg","MAWBridgeTypesCreators","MAWDbEditMsgHistoryTxns","MAWDbMessageHandler","MAWDbMsgTxns","MAWDexieTable","MAWIndexedDb","MAWJidUtils","MAWThreadSnippetForTextMsg","MAWTransactionMode","WAGlobals","WAJids","WALogger","WAMsgType","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgDropped] editMsgHistory updated"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgDropped] originalMsg is not a text message"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgDropped] thread is null"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgDropped] newestEditedMsg is not the newest edit"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgDropped] previousEditedMsg is null"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgDropped] newestEditedMsg is null"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgDropped] originalMsg is null"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgDropped] originalProtocolMsgId is null"]);o=function(){return a};return a}a=d("MAWIndexedDb").makeMsgrTransactor({editMsgHistory:d("MAWTransactionMode").READWRITE,messages:d("MAWTransactionMode").READWRITE,threads:d("MAWTransactionMode").READWRITE},"markEditMsgDropped",function(a){return function(b,e){var f=d("MAWJidUtils").maybeToProtocolMsgId(b.author,b.chat,e);if(f==null){d("WALogger").ERROR(o());return d("MAWDexieTable").dexieResolve(d("WAResultOrError").makeError("missing_original_protocol_msg_id"))}return d("MAWDexieTable").dexieAll([a.threads.get({jid:b.chat}),d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,f),d("MAWDbEditMsgHistoryTxns").maybeGetEditMsgHistoryFromProtocolMsgId(a,f)]).then(function(f){var g=f[0],o=f[1],p=f[2];f=p.sort(function(a,b){return b.editTs-a.editTs});var q=p.find(function(a){return a.editExternalId===b.externalId}),r=f[1];if(o==null){d("WALogger").ERROR(n());return d("WAResultOrError").makeError("missing_original_msg")}if(q==null){d("WALogger").ERROR(m());return d("WAResultOrError").makeError("missing_newest_edited_msg")}if(r==null){d("WALogger").ERROR(l());return d("WAResultOrError").makeError("missing_previous_edited_msg")}if(q.editExternalId!==f[0].editExternalId){d("WALogger").ERROR(k());return d("WAResultOrError").makeError("invalid_newest_edited_msg")}if(g==null){d("WALogger").ERROR(j());return d("WAResultOrError").makeError("missing_thread")}if(o.type!==d("WAMsgType").MSG_TYPE.TEXT){d("WALogger").ERROR(i());return d("WAResultOrError").makeError("invalid_original_msg")}return d("MAWDexieTable").dexieAll([a.messages.where("quoteExternalId").equals(e).toArray(),d("MAWDbMsgTxns").getThreadNewestMessageId(a,g.jid)]).then(function(e){var f=e[0],i=e[1],j=babelHelpers["extends"]({},o,{ack:d("MAWAckLevel").ACK.sent,editCount:((e=o.editCount)!=null?e:0)-1,msgContent:r.msgContent}),k=d("WAGlobals").getMyUserJid(),l=[];e=f.find(function(a){var c;return(((c=a.quote)==null?void 0:c.content.author)===d("WAJids").AUTHOR_ME||((c=a.quote)==null?void 0:c.content.author)===k)&&a.threadJid===b.chat});if(e!=null){f=e.quote;var m=e.quoteExternalId;if(f==null)c("FBLogger")("messenger_e2ee_web").warn("[markEditMsgDropped] Failed to get the quoted content for a msg that has been quoted.",m);else{m=babelHelpers["extends"]({},e,{quote:babelHelpers["extends"]({},f,{content:babelHelpers["extends"]({},f.content,{msgContent:babelHelpers["extends"]({},j.msgContent)})})});l.push(m)}}e=[];o.editCount===1&&p.length===2&&e.push(r.editMsgHistoryId);e.push(q.editMsgHistoryId);return d("MAWDexieTable").dexieAll([a.messages.put(j),a.editMsgHistory.bulkDelete(e)]).then(function(){d("WALogger").LOG(h());d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(j)});l.forEach(function(a){d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(a)})});if(i===o.msgId&&!d("MAWDbMessageHandler").isThreadUpdateEnabledViaMiddlewareForMsgType(j.type)){var a=d("WAJids").userIdFromJid(d("WAGlobals").getMyUserJid()),b=c("MAWThreadSnippetForTextMsg")(j,a,d("WAJids").interpretAsGroupJid(g.jid)!=null),e=b.snippetParams;b=b.snippetType;d("MAWIndexedDb").afterTransaction({tag:"ThreadUpdated",value:d("MAWBridgeTypesCreators").createBridgeUpdatedThread({snippetParams:e,snippetSenderContactId:a,snippetType:b,threadJid:g.jid})})}return d("WAResultOrError").makeResult()})})})}});g.markEditMsgDropped=a}),98);
__d("MAWMarkEditMsgSentApi",["ArmadilloDataTraceType","MAWAckLevel","MAWBridgeMsg","MAWBridgeTrace","MAWBridgeTraceEvent","MAWDbEditMsgHistory","MAWDbEditMsgHistoryTxns","MAWDbMsgTxns","MAWDexieTable","MAWFTSTxns","MAWIndexedDb","MAWJidUtils","MAWLoadReplyMediaTxns","MAWTransactionMode","WAJids","WALogger","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgSent] editMsgHistory updated"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgSent] on incoming message"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgSent] editMsgHistory has already been sent"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgSent] editedMsg?.editExternalId is null"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgSent] originalMsgHistory is null"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgSent] originalMsg is null"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgSent] originalProtocolMsgId is null"]);n=function(){return a};return a}b=d("MAWIndexedDb").makeMsgrTransactor({chunk:(a=d("MAWTransactionMode")).READONLY,editMsgHistory:a.READWRITE,ftsBackloggedMessages:a.READWRITE,media:a.READONLY,messages:a.READWRITE,receiverFetchInfo:a.READONLY,xma:a.READONLY},"markMsgSent",function(a){return function(b,e,f,g){var o=d("MAWJidUtils").maybeToProtocolMsgId(b.author,b.chat,e);if(o==null){d("WALogger").ERROR(n());return d("MAWDexieTable").dexieResolve(d("WAResultOrError").makeError("missing_original_protocol_msg_id"))}return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,o),d("MAWDbEditMsgHistoryTxns").maybeGetEditMsgHistoryFromProtocolMsgId(a,o),d("MAWFTSTxns").maybePutMessageToBacklog(a,e)]).then(function(n){var o=n[0];n=n[1];var p=n.find(function(a){return a.editExternalId===e}),q=n.find(function(a){return a.editExternalId===b.externalId});if(o==null){d("WALogger").ERROR(m());return d("WAResultOrError").makeError("missing_original_msg")}if(p==null){d("WALogger").ERROR(l());return d("WAResultOrError").makeError("missing_original_msg_edit_history")}if((q==null?void 0:q.editExternalId)==null){d("WALogger").ERROR(k());return d("WAResultOrError").makeError("missing_edit_external_id")}if(q.sendStatus!=null&&q.sendStatus>d("MAWAckLevel").ACK.clock&&o.ack>d("MAWAckLevel").ACK.clock){d("WALogger").LOG(j());return d("WAResultOrError").makeError("already_sent")}if(q.author!==d("WAJids").AUTHOR_ME){d("WALogger").ERROR(i());return d("WAResultOrError").makeError("not_author")}d("MAWIndexedDb").afterTransaction({tag:"UpdateTrace",value:d("MAWBridgeTrace").createBridgeUpdateTraceData([q.editExternalId],c("MAWBridgeTraceEvent").ReceivedSent,d("ArmadilloDataTraceType").armadilloMessageSend)});var r=[];if(n.length===2&&o.editCount===1){n=babelHelpers["extends"]({},p,{sendStatus:d("MAWAckLevel").ACK.sent});r.push(n)}p=babelHelpers["extends"]({},q,{editTs:f,sendStatus:d("MAWAckLevel").ACK.sent});r.push(p);var s=r.map(function(a){return babelHelpers["extends"]({},a,{editMsgHistoryId:d("MAWDbEditMsgHistory").convertToEditMsgHistoryId64(a.editMsgHistoryId),originalMsgId:o.msgId})}),t=babelHelpers["extends"]({},o,{ack:d("MAWAckLevel").ACK.sent});g!=null&&(t.reportingMeta=g);return d("MAWDexieTable").dexieAll([a.editMsgHistory.bulkPut(r),a.messages.put(t),d("MAWLoadReplyMediaTxns").getReplyMediaForMsgQuote(a,t)]).then(function(a){a[0];a=a[2];d("WALogger").LOG(h());d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(t,void 0,a)});d("MAWIndexedDb").afterTransaction({tag:"EditMsgHistoryAdded",value:s});return d("WAResultOrError").makeResult()})})}});g.markEditMsgSent=b}),98);
__d("MAWMarkMsgDroppedApi",["MAWAckLevel","MAWDbMsgTxns","MAWDbReactionsTxns","MAWDexieTable","MAWIndexedDb","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";b=d("MAWIndexedDb").makeMsgrTransactor({chunk:(a=d("MAWTransactionMode")).READONLY,media:a.READONLY,messages:a.READWRITE,reactions:a.READWRITE,receiverFetchInfo:a.READONLY,threads:a.READWRITE,xma:a.READONLY},"markMsgDropped",function(a){return function(b){return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,b),d("MAWDbReactionsTxns").maybeGetReactionByProtocolMsgId(a,b)]).then(function(b){var c=b[0];b=b[1];if(c!=null)return d("MAWDbMsgTxns").updateSystemAck(a,c.msgId,d("MAWAckLevel").ACK.expired).then(function(a){return a==null?"missing":a.ack<=d("MAWAckLevel").ACK.clock?"dropped":"sent"});return b!=null?d("MAWDbReactionsTxns").deleteReaction(a,b).then(function(){return"dropped"}):"missing"})}});g.markMsgDropped=b}),98);
__d("MAWMarkMsgSentApi",["ArmadilloDataTraceType","I64","MAWAckLevel","MAWBridgeTrace","MAWBridgeTraceEvent","MAWBridgeTypesCreators","MAWCalculateBumpTimestampMs","MAWDbMessageHandler","MAWDbMsg","MAWDbMsgTxns","MAWDbThread","MAWDbThreadTxns","MAWDbUnrenderedMsgTxns","MAWDexieTable","MAWEphemeralMsgTxns","MAWEphemeralSettingsTxns","MAWIndexedDb","MAWMsgType","MAWThreadSnippetBuildTxns","MAWTransactionMode","WALogger","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Thread missing from DB"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Found both regular and unrendered message with the same protocol msg ID"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Msg missing from DB"]);k=function(){return a};return a}b=d("MAWIndexedDb").makeMsgrTransactor({chunk:(a=d("MAWTransactionMode")).READONLY,ephemeralSettings:a.READWRITE,groupInfo:a.READONLY,media:a.READONLY,messages:a.READWRITE,receiverFetchInfo:a.READONLY,threads:a.READWRITE,unrenderedMessages:a.READWRITE,xma:a.READONLY},"markMsgSent",function(a){return function(b,e,f,g){return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,b),d("MAWDbUnrenderedMsgTxns").maybeGetUnrenderedMsgByProtocolMsgId(a,b)]).then(function(l){var m=l[0];l=l[1];if(m==null&&!l.success){d("WALogger").LOG(k());return}else if(m!=null){d("MAWIndexedDb").afterTransaction({tag:"UpdateTrace",value:d("MAWBridgeTrace").createBridgeUpdateTraceData([m.externalId],c("MAWBridgeTraceEvent").ReceivedSent,d("ArmadilloDataTraceType").armadilloMessageSend)});l.success&&d("WALogger").ERROR(j());var n=m.ack<d("MAWAckLevel").ACK.sent;return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").updateSystemAck(a,m.msgId,d("MAWAckLevel").ACK.sent,e,f,g),d("MAWDbThreadTxns").getThread(a,m.threadJid)]).then(function(b){var c=b[0];b=b[1];if(!b.success){d("WALogger").ERROR(i());return}var f=b.value,g=d("WATimeUtils").castUnixTimeToMillisTime(e);b=babelHelpers["extends"]({},f,{lastReadMsgTs:g,newestMsgTs:g,threadOrder:d("MAWDbThread").craftThreadOrder(g,f.jid)});b=n?d("MAWDbThreadTxns").updateThread(a,b):d("MAWDexieTable").dexieResolve();return d("MAWDexieTable").dexieAll([d("MAWEphemeralMsgTxns").markEphemeralMessageAsSent(a,c),b]).then(function(){if(m.altIndex!==d("MAWDbMsg").SPAM_ALT_INDEX&&m.altIndex!==d("MAWDbMsg").FUTUREPROOF_SPAM_ALT_INDEX&&!d("MAWDbMessageHandler").isThreadUpdateEnabledViaMiddlewareForMsgType(m.type)&&n)return d("MAWThreadSnippetBuildTxns").buildThreadSnippet(a,m).then(function(a){var b=a.snippetParams,c=a.snippetSenderContactId;a=a.snippetType;if(m.type===d("MAWMsgType").MSG_TYPE.REVOKED)d("MAWIndexedDb").afterTransaction({tag:"ThreadUpdated",value:d("MAWBridgeTypesCreators").createBridgeUpdatedThread({snippetParams:b,snippetSenderContactId:c,snippetType:a,threadJid:f.jid})});else if(!d("MAWDbMessageHandler").isThreadUpdateEnabledViaMiddlewareForMsgType(m.type)){var e=m.externalId!==void 0?(h||(h=d("I64"))).of_string_opt(m.externalId):void 0;e=d("MAWCalculateBumpTimestampMs").calculateBumpTimestampMs(g,e);d("MAWIndexedDb").afterTransaction({tag:"ThreadBumpedV2",value:d("MAWBridgeTypesCreators").createBridgeBumpedThreadV2({bumpTimestampMs:e,description:"markMsgSent",isMessageAuthorMe:!0,snippetData:{params:b,senderContactId:c,type:a},threadJid:f.jid})})}})})})}else if(l.success){var o=l.value;return d("MAWDbUnrenderedMsgTxns").updateSystemAckForUnrenderedMsg(a,o.msgId,d("MAWAckLevel").ACK.sent).then(function(){if(o.type===d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_CHANGE_FROM_CURRENT_DEVICE)return d("MAWEphemeralSettingsTxns").updateContactWhenEphemeralSettingChangeMarkedSent(a,b.chat,e)})}}).then(function(){})}});g.markMsgSent=b}),98);
__d("MawGetMediaAttachmentTypeFromMediaType",["EchoMessageMediaFieldUtils","MAWDbMedia","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Not a valid EchoMessageActMediaAttachmentType: ",""]);h=function(){return a};return a}function a(a){switch(a){case d("MAWDbMedia").MEDIA_TYPE.IMAGE:return d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.IMAGE;case d("MAWDbMedia").MEDIA_TYPE.VIDEO:return d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.VIDEO;case d("MAWDbMedia").MEDIA_TYPE.PTT:return d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.PTT;case d("MAWDbMedia").MEDIA_TYPE.GIF:return d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.GIF;case d("MAWDbMedia").MEDIA_TYPE.STICKER:return d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.STICKER;case d("MAWDbMedia").MEDIA_TYPE.DOCUMENT_FILE:return d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.DOCUMENT;default:d("WALogger").ERROR(h(),a);return d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.INVALID}}g.getMediaAttachmentTypeForMediaType=a}),98);
__d("MessageBackupDirectiveGenerator",["I64","MAWMsgType","MessageBackupSupplementalKeyGenerator","WAGlobals","WAJids"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a,b){return{actionType:2,originalMsgProtocolId:a,supplementalKey:d("MessageBackupSupplementalKeyGenerator").createMessageSupplementalKey(d("MessageBackupSupplementalKeyGenerator").SupplementalKeyPrefix.REACTION,(h||(h=d("I64"))).to_string(b))}}function j(a,b){return{actionType:2,originalMsgProtocolId:a,supplementalKey:d("MessageBackupSupplementalKeyGenerator").createMessageSupplementalKey(d("MessageBackupSupplementalKeyGenerator").SupplementalKeyPrefix.EDIT,(h||(h=d("I64"))).to_string(b))}}function k(a){if(d("WAJids").isAuthorSystem(a.author))return null;if(a.reactToExternalId!=null)return{author:a.reactToAuthor===d("WAGlobals").getMyUserJid()?"@me":a.reactToAuthor,chat:a.threadJid,externalId:a.reactToExternalId};else if(a.originalMsgExternalId!=null)return{author:a.author,chat:a.threadJid,externalId:a.originalMsgExternalId};else if(a.revokedExternalId!=null)return{author:a.author,chat:a.threadJid,externalId:a.revokedExternalId};return a.externalId==null?null:{author:a.author,chat:a.threadJid,externalId:a.externalId}}function a(a){var b=(h||(h=d("I64"))).of_string(d("WAJids").authorToUserId(a.author,d("WAJids").extractUserId(d("WAGlobals").getMyUserJid()))),c=k(a);if(c==null)return null;if(a.originalMsgExternalId!=null)return j(c,b);return a.reactToExternalId!=null?i(c,b):l(c,b,a.type)}function l(a,b,c){switch(c){case d("MAWMsgType").MSG_TYPE.TEXT:case d("MAWMsgType").MSG_TYPE.IMAGE:case d("MAWMsgType").MSG_TYPE.PTT:case d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:case d("MAWMsgType").MSG_TYPE.VIDEO:case d("MAWMsgType").MSG_TYPE.GIF:case d("MAWMsgType").MSG_TYPE.XMA:case d("MAWMsgType").MSG_TYPE.STICKER:case d("MAWMsgType").MSG_TYPE.RECEIVER_FETCH:return{actionType:1,originalMsgProtocolId:a};case d("MAWMsgType").MSG_TYPE.REACTION:return i(a,b);case d("MAWMsgType").MSG_TYPE.EDIT_ACTION:return j(a,b);case d("MAWMsgType").MSG_TYPE.REVOKED:return{actionType:4,originalMsgProtocolId:a};case d("MAWMsgType").MSG_TYPE.DELETE_FOR_ME:return{actionType:3,originalMsgProtocolId:a};default:return{actionType:0,originalMsgProtocolId:a}}}g.createMessageBackupDirectiveFromDbMsg=a;g.createMessageBackupDirective=l}),98);
__d("MAWSendWrittenMsg",["EchoMessageMediaFieldUtils","EncryptedBackupsUploadQueue","FBLogger","I64","MAWBridge","MAWDbMediaTxns","MAWDebugMsg","MAWEBUploadMessageUtils","MAWEBUploadTrackingUtils","MAWGetAllMediaIdsForXMAMsgApi","MAWGetEditMsgForSending","MAWGetMsgForSendingApi","MAWGetReactionForSending","MAWIndexedDb","MAWJobManager","MAWLoadThreadParticipantsApi","MAWMarkEditMsgDroppedApi","MAWMarkEditMsgSentApi","MAWMarkMsgDroppedApi","MAWMarkMsgSentApi","MAWMsgType","MAWSendMsgUtil","MAWTransactionMode","MawGetMediaAttachmentTypeFromMediaType","MessageBackupDirectiveGenerator","WAAPI","WAAsMessageApplication","WAFrankingTypes","WAGenReportingMeta","WAGlobals","WAJids","WALogger","WAMediaUtils","WAMsgApplication.pb","WAPREList","WAPREMetrics","WAPersistedJobManager","WAResultOrError","WATimeUtils","asyncToGeneratorRuntime","encodeProtobuf","err","gkx","justknobx","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg adding message "," attachments to EB upload queue"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg END ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg END ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg not sending message: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg(","): drop result: ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg(","): too old, dropping"]);o=function(){return a};return a}e=24*60*60;var p=10001;function q(a,b){return r.apply(this,arguments)}function r(){r=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var e;d("WALogger").LOG(m(),a.protocolMsgId);var f=null;b.addPoint("get_msg_for_sending",{string:{type:a.type}});if(a.type==="message"||a.type==="revoke")f=(yield d("MAWGetMsgForSendingApi").getMsgForSending(a.protocolMsgId));else if(a.type==="reaction")f=(yield d("MAWGetReactionForSending").getReactionForSending(a.protocolMsgId));else if(a.type==="edit")f=(yield d("MAWGetEditMsgForSending").getEditMsgForSending(a.protocolMsgId,a.referencedOriginalExternalId));else{a.type;throw c("err")("This cannot happen because type has `message` as default argument but flow does not know that")}if(f.type!=="unsent"){d("WALogger").LOG(l(),f.type);b.endFail(f.type);return d("WAResultOrError").makeError({type:"unknown-error"})}f=f;var g=f.dbMsg,n=f.editOriginalExternalId,o=f.isReplyMsg,q=f.isXMAMsg,r=f.media,s=f.messageApplication,u=f.messageType;f=f.protocolMsgId;b.addPoint("message-fetched-from-db",{bool:{isEditMsg:n!=null,isReplyMsg:o,isXMAMsg:q},string:{msgType:u.type}});o={bytes:d("WAAsMessageApplication").castToMessageApplicationBytes(d("encodeProtobuf").encodeProtobuf(d("WAMsgApplication.pb").MessageApplicationSpec,s).readByteArray()),version:"v3"};e=(yield c("WAAPI").sendChatMessage({loadThreadParticipants:d("MAWLoadThreadParticipantsApi").loadThreadParticipants,messagePayload:{frankingKey:((e=s.metadata)==null?void 0:e.frankingKey)?d("WAFrankingTypes").castToFrankingKey(new Uint8Array((e=s.metadata)==null?void 0:e.frankingKey)):null,frankingVersion:(e=s.metadata)==null?void 0:e.frankingVersion,messageBytes:o,messageType:u,protocolMsgId:f}},b));e.success===!1&&(b==null?void 0:b.addPoint("send-msg-v2-failed",{string:{errorType:e.error.type,msgType:g.type}}));if(e.success===!1)b.endFail(e.error.type),n!=null?yield d("MAWMarkEditMsgDroppedApi").markEditMsgDropped(f,n):yield d("MAWMarkMsgDroppedApi").markMsgDropped(f),d("WALogger").ERROR(k(),e.error);else{e.success;((u=e.value.meta)==null?void 0:u.pOrDhashMismatch)&&c("promiseDone")(d("MAWDebugMsg").writeDebugMsg(f.chat,"Outgoing msg "+f.externalId+" got a phash mismatch"));n!=null?yield x({editOriginalExternalId:n,protocolMsgId:f,reportingMeta:e.value.reportingMeta,serverTs:e.value.serverTs},b):yield y({protocolMsgId:f,reportingMeta:e.value.reportingMeta,serverTs:e.value.serverTs},b);c("justknobx")._("1837")&&(b.endSuccess(),d("WALogger").LOG(j(),e.success));try{if(g!=null&&!d("WAJids").isAuthorSystem(g.author)){u=v(g);if(u!=null){n=s==null?void 0:s.metadata;b=d("MessageBackupDirectiveGenerator").createMessageBackupDirectiveFromDbMsg(g);if(b!=null){s=[];var w=g.msgId!=null?r==null?void 0:r.mediaEntries.get(g.msgId):null;w=w!=null?d("WAMediaUtils").decodeMediaEntryData(w):null;if(q===!0){q=(yield t(a.protocolMsgId,g));s=q.filter(Boolean)}else if(r!=null&&w!=null&&(w.objectId!=null&&r.mediaType!=null)){s.push({mediaObjectId:w.objectId,mediaType:d("MawGetMediaAttachmentTypeFromMediaType").getMediaAttachmentTypeForMediaType(r.mediaType)});if(g.msgId!=null){a=w.downloadableThumbnail;(a==null?void 0:a.objectId)!=null&&s.push({isPreview:!0,mediaObjectId:d("WAMediaUtils").stringToDeliveryObjectId(a.objectId),mediaType:d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.MESSENGER_PREVIEW})}}d("WALogger").LOG(i(),(q=s)==null?void 0:q.length);d("MAWEBUploadTrackingUtils").maybeStartTrackingForUploadQueue(f,"send",u);r=e.value.serverTs;yield d("EncryptedBackupsUploadQueue").putMsgsToEbUpload([{attachmentContext:s,backupDirective:b,messageApplication:o.bytes,msgId:f,originalMsgProtocolId:b.originalMsgProtocolId.externalId!==f.externalId?b.originalMsgProtocolId:f,reportingMeta:yield d("WAGenReportingMeta").genReportingMeta(o.bytes,(n==null?void 0:n.frankingKey)?d("WAFrankingTypes").castToFrankingKey(new Uint8Array(n==null?void 0:n.frankingKey)):null,n==null?void 0:n.frankingVersion),senderId:(h||(h=d("I64"))).of_string(d("WAJids").authorToUserId(f.author,d("WAJids").extractUserId(d("WAGlobals").getMyUserJid()))),serverTs:r,sortOrderMs:d("WATimeUtils").castToMillisTime(d("MAWEBUploadMessageUtils").echoOverrideMessageSortOrder({externalId:f.externalId,serverTs:r,ts:r}))}])}}}}catch(a){c("FBLogger")("labyrinth_web").mustfix("Failed to decode message application and add to EB upload queue")}}w=c("gkx")("794");if(e.success===!1)switch(e.error.type){case"non-retryable-error":if(w&&e.error.applicationErrorCode!=null&&e.error.applicationErrorCode===p)try{d("MAWBridge").getBridge().fireAndForget("event","uiUpdate",{events:[{tag:"RefreshContact",value:(h||(h=d("I64"))).of_string(d("WAJids").threadIdForChatJid(g.threadJid))}]})}catch(a){c("FBLogger")("labyrinth_web").catching(a).mustfix("Failed to call bridge handler RefreshContact for JID %s and mediaType %s",g.threadJid,g.type)}throw new(d("WAPersistedJobManager").NonRetryableError)();case"retryable-error":if(e.error.backoff!=null)throw new(d("WAPersistedJobManager").RetryOnBackoff)({algo:{delay:e.error.backoff,type:"constant"}});throw c("err")("sendWrittenMsg error");default:throw c("err")("sendWrittenMsg error")}return e});return r.apply(this,arguments)}var s=d("MAWIndexedDb").makeMsgrTransactor({media:d("MAWTransactionMode").READONLY},"bulkGetRetroactiveMedia",function(a){return function(){for(var b=arguments.length,c=new Array(b),e=0;e<b;e++)c[e]=arguments[e];return d("MAWDbMediaTxns").bulkGetMedias.apply(void 0,[a].concat(c))}});function t(a,b){return u.apply(this,arguments)}function u(){u=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=(yield d("MAWGetAllMediaIdsForXMAMsgApi").getAllMediaIdsForXMAMsg([a]).then(function(b){b=b.get(a);return b!=null?s(Array.from(b)):[]}));return c.filter(Boolean).flatMap(function(a){var c=b.msgId!=null?a==null?void 0:a.mediaEntries.get(b.msgId):null;c=c!=null?d("WAMediaUtils").decodeMediaEntryData(c):null;var e=[];(c==null?void 0:c.objectId)!=null&&a.mediaType!=null&&e.push({mediaObjectId:c.objectId,mediaType:a.mediaType});c=c==null?void 0:(a=c.downloadableThumbnail)==null?void 0:a.objectId;c!=null&&e.push({isPreview:!0,mediaObjectId:d("WAMediaUtils").stringToDeliveryObjectId(c),mediaType:d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.MESSENGER_PREVIEW});return e})});return u.apply(this,arguments)}function v(a){if(a.reactToExternalId!=null)return d("MAWMsgType").MSG_TYPE.REACTION;else if(a.editMsgHistoryId!=null)return d("MAWMsgType").MSG_TYPE.EDIT_ACTION;else if(a.type==null)return null;else return d("MAWMsgType").isEBSupportedMsgType(a.type)?a.type:null}function w(a,b){b===void 0&&(b=!1);a.s2sInstanceKey!=null&&d("MAWSendMsgUtil").addS2SInstanceKey(a.s2sInstanceKey);b=d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.SEND_MESSAGE,{bool:{afterCrash:b,isSenderKeyPredistriubtionEnabled:d("WAGlobals").getConfig().isSenderKeyPredistributionEnabled()},string:{jid:a.protocolMsgId.chat}},a.s2sInstanceKey);b.addAnnotations({bool:{is_secure:!0}});return q(a,b)}f=d("MAWJobManager").getPersistedJobsApi().definePersistedJob().finalStep("encryptAndSend",{code:function(a,b,c){return w(a,c.afterCrash)},stopRetryIf:{onStopRetry:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a.protocolMsgId;d("WALogger").LOG(o(),a);var b=(yield d("MAWMarkMsgDroppedApi").markMsgDropped(a));d("WALogger").LOG(n(),a,b);return d("WAResultOrError").makeError({type:"too-many-retries"})});function c(b){return a.apply(this,arguments)}return c}(),timePassedSeconds:e}}).end();function a(a){if(a.reactToExternalId!=null)return a.reactToExternalId;if(a.originalMsgExternalId!=null)return a.originalMsgExternalId;switch(a.type){case d("MAWMsgType").MSG_TYPE.EDIT_ACTION:return a.originalMsgExternalId;case d("MAWMsgType").MSG_TYPE.REACTION:return a.reactToExternalId;default:return null}}function x(a,b){var c=a.editOriginalExternalId,e=a.protocolMsgId,f=a.reportingMeta;a=a.serverTs;return d("MAWMarkEditMsgSentApi").markEditMsgSent(e,c,a,f).then(function(){b==null?void 0:b.addPoint("mark_edit_msg_sent")})}function y(a,b){var c=a.protocolMsgId,e=a.reportingMeta;a=a.serverTs;return d("MAWMarkMsgSentApi").markMsgSent(c,a,e,b).then(function(){b==null?void 0:b.addPoint("mark_msg_sent")})}g.sendWrittenMsgExternal=w;g.sendWrittenMsg=f;g.getTopLevelOfflineThreadingId=a}),98);
__d("MAWBuildNewMsgPayload",["MAWAuthor","MAWDbMsg","MAWMsgType","WAArmadilloXMA.pb","WAAssertUnreachable","WAJids","WALogger","WAStanzaUtils","err"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["msgToQuotedMsg: Unsupported message type ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["BumpExistingMessage does not have quote content when replying"]);i=function(){return a};return a}function a(a,b,e,f){if(d("MAWDbMsg").isUnrenderedMsgType(a))throw c("err")("getNewMsg called for wrong message type "+a);var g,h;if(e.quote!=null&&(f==null?void 0:f.content)!=null){var i;h=f==null?void 0:(i=f.content)==null?void 0:i.externalId;g={content:f==null?void 0:f.content,remoteJid:(i=f==null?void 0:f.remoteJid)!=null?i:void 0}}f=babelHelpers["extends"]({},b,{quote:g,quoteExternalId:h});i=e.mediaGroupMetadata;switch(a){case"Text":return babelHelpers["extends"]({},f,{msgContent:{content:e.content!=null?e.content:"",mentionedJids:e.mentionedJids},type:d("MAWMsgType").MSG_TYPE.TEXT});case"Image":return babelHelpers["extends"]({},f,{type:d("MAWMsgType").MSG_TYPE.IMAGE},i);case"Video":return babelHelpers["extends"]({},f,{type:d("MAWMsgType").MSG_TYPE.VIDEO});case"Ptt":return babelHelpers["extends"]({},f,{type:d("MAWMsgType").MSG_TYPE.PTT});case"Gif":return babelHelpers["extends"]({},f,{type:d("MAWMsgType").MSG_TYPE.GIF});case"Sticker":return babelHelpers["extends"]({},f,{type:d("MAWMsgType").MSG_TYPE.STICKER});case"DocumentFile":return babelHelpers["extends"]({},f,{type:d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE});case"XMA":if(e.xmaMessageType==null)throw c("err")("XMA Message Missing xmaMessageType");b=e.content!=null&&e.xmaMessageType===d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_EXTERNAL_LINK_SHARE?e.content:"";return babelHelpers["extends"]({},f,{msgContent:{content:b},type:d("MAWMsgType").MSG_TYPE.XMA,xmaMessageType:e.xmaMessageType});case"EditAction":throw c("err")("EditAction is not supported yet");case"BumpExistingMessage":throw c("err")("BumpExistingMessage is not supported yet");case"ReceiverFetch":throw c("err")("ReceiverFetch is not supported yet");case"Revoked":case"DeleteForMe":case"Ciphertext":case"Futureproof":case"Unavailable":case"Admin":case"ExpiredEphemeral":case"EphemeralSettingAdmin":case"EphemeralScreenshotAction":case"AlertICDC":case"GroupInvite":case"Reaction":case"Raven":case"RavenAction":throw c("err")("Should not be writing ciphertext, futureproof, unsent, admin,\n        ephemeral setting messages, ephemeral screenshot action, group invite messages");default:throw c("WAAssertUnreachable")(a)}}function b(a,b,e,f){if(!d("MAWDbMsg").isUnrenderedMsgType(a))throw c("err")("getNewUnrenderedMsg called for wrong message type "+a);switch(a){case"EphemeralSyncResponse":if(e.ephemeralSetting==null)throw c("err")("Ephemeral Sync Response without ephemeral settings");return babelHelpers["extends"]({},b,{ephemeralSetting:e.ephemeralSetting,type:d("MAWMsgType").MSG_TYPE.EPHEMERAL_SYNC_RESPONSE});case"EphemeralSettingChangeFromCurrentDevice":var g;if(e.ephemeralSetting==null)throw c("err")("Ephemeral Setting Change without ephemeral settings");return babelHelpers["extends"]({},b,{ephemeralSetting:e.ephemeralSetting,isEphemeralSettingReset:(g=e.isEphemeralSettingReset)!=null?g:!1,type:d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_CHANGE_FROM_CURRENT_DEVICE});case"GroupInvite":g=d("WAJids").interpretAsGroupJid(b.threadJid);if(g==null)throw c("err")("Group Invite without valid group jid");if(e.invitedParticipantUserJid==null)throw c("err")("Group Invite without invited user jid");return babelHelpers["extends"]({},b,{groupName:e.groupName==null?void 0:e.groupName,invitedParticipantUserJid:e.invitedParticipantUserJid,type:d("MAWMsgType").MSG_TYPE.GROUP_INVITE});case"SenderKeyDistribution":return babelHelpers["extends"]({},b,{type:d("MAWMsgType").MSG_TYPE.SK_DISTRIBUTION});case"RavenAction":if(f==null)throw c("err")("Raven Action without Raven Message External Id");if(e.actionType==null)throw c("err")("Raven Action without Action Type");return babelHelpers["extends"]({},b,{actionType:e.actionType,ravenActionToMsgExternalId:d("WAStanzaUtils").toStanzaId(f),type:d("MAWMsgType").MSG_TYPE.RAVEN_ACTION});case"EditAction":throw c("err")("Edit action not implemented yet");default:throw c("WAAssertUnreachable")(a)}}function e(a){var b,e={author:d("MAWAuthor").getAuthorUserJid(a.author)||d("WAJids").AUTHOR_ME,externalId:a.externalId,mediaId:a.mediaId,msgId:a.msgId,plaintextHash:a.plaintextHash,specialTextSize:a.specialTextSize,ts:a.ts,xmaMessageType:a.xmaMessageType};switch(a.type){case d("MAWMsgType").MSG_TYPE.IMAGE:return babelHelpers["extends"]({},e,{msgContent:a.msgContent,type:d("MAWMsgType").MSG_TYPE.IMAGE});case d("MAWMsgType").MSG_TYPE.VIDEO:return babelHelpers["extends"]({},e,{msgContent:a.msgContent,type:d("MAWMsgType").MSG_TYPE.VIDEO});case d("MAWMsgType").MSG_TYPE.PTT:return babelHelpers["extends"]({},e,{msgContent:a.msgContent,type:d("MAWMsgType").MSG_TYPE.PTT});case d("MAWMsgType").MSG_TYPE.TEXT:return babelHelpers["extends"]({},e,{msgContent:a.msgContent,type:d("MAWMsgType").MSG_TYPE.TEXT});case d("MAWMsgType").MSG_TYPE.STICKER:return babelHelpers["extends"]({},e,{msgContent:a.msgContent,type:d("MAWMsgType").MSG_TYPE.STICKER});case d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:return babelHelpers["extends"]({},e,{msgContent:a.msgContent,type:d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE});case d("MAWMsgType").MSG_TYPE.GIF:return babelHelpers["extends"]({},e,{msgContent:a.msgContent,type:d("MAWMsgType").MSG_TYPE.GIF});case d("MAWMsgType").MSG_TYPE.XMA:return babelHelpers["extends"]({},e,{msgContent:a.msgContent,type:d("MAWMsgType").MSG_TYPE.XMA,xmaMessageType:a.xmaMessageType});case d("MAWMsgType").MSG_TYPE.REVOKED:return babelHelpers["extends"]({},e,{msgContent:a.msgContent,type:d("MAWMsgType").MSG_TYPE.UNAVAILABLE});case d("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE:if(((b=a.quote)==null?void 0:b.content)==null){d("WALogger").ERROR(i());return null}return babelHelpers["extends"]({},a.quote.content,{author:d("MAWAuthor").getAuthorUserJid(a.quote.content.author)||d("WAJids").AUTHOR_ME});case d("MAWMsgType").MSG_TYPE.RECEIVER_FETCH:return babelHelpers["extends"]({},e,{msgContent:a.msgContent,type:d("MAWMsgType").MSG_TYPE.RECEIVER_FETCH});case d("MAWMsgType").MSG_TYPE.RAVEN:return babelHelpers["extends"]({},e,{ravenEphemeralMediaState:a.ravenEphemeralMediaState,ravenEphemeralType:a.ravenEphemeralType,ravenMediaType:a.ravenMediaType,type:d("MAWMsgType").MSG_TYPE.RAVEN});default:d("WALogger").ERROR(h(),a.type);throw c("err")("Trying to reply to a message type that does not support replies")}}g.buildNewMsg=a;g.getNewUnrenderedMsg=b;g.msgToQuotedMsg=e}),98);
__d("MAWWriteOutgoingMsgApi",["MAWAckLevel","MAWBuildNewMsgPayload","MAWDbMsg","MAWDbMsgTxns","MAWDbRavenActionTxns","MAWDexieTable","MAWIndexedDb","MAWLoadReplyMediaTxns","MAWMsgType","MAWQplProxy","MAWTransactionMode","MAWVault","MAWWriteMsgTxns","WAJids","WALogger","WATimeUtils","nullthrows","qpl"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["writeOutgoingMsg: "," is not identical for partial optimistic upsert: "," vs ",""]);h=function(){return a};return a}var i=function(a,b,e){b!=null&&d("MAWQplProxy").sendQplPointThroughBridge(c("qpl")._(25313175,"1551"),a,{annotations:e,instanceKey:b})};function j(a,b,c){if(b===c)return;d("WALogger").WARN(h(),a,b,c)}b=d("MAWIndexedDb").makeMsgrTransactor({chunk:(a=d("MAWTransactionMode")).READONLY,ephemeralSettings:a.READWRITE,ftsBackloggedMessages:a.READWRITE,groupInfo:a.READONLY,media:a.READONLY,messages:a.READWRITE,participants:a.READONLY,receiverFetchInfo:a.READONLY,threads:a.READWRITE,unrenderedMessages:a.READWRITE,xma:a.READONLY},"writeOutgoingMsg",function(a){return function(b,e,f,g,h){g.content!=null&&(g.content=d("MAWVault").vault(g.content));i("write_outgoing_msg_start",g.s2sInstanceKey);return d("MAWDexieTable").dexieAll([a.threads.get({jid:e}),a.messages.where("externalId").equals(b).toArray(),k(a,g.quote,e),d("MAWDbRavenActionTxns").maybeGetRavenMsgQueryByProtocolMsgId(a,g.ravenProtocolMsgId,h)]).then(function(e){var k=e[0],m=e[1],n=e[2];e=e[3];i("write_outgoing_msg_data_fetched",g.s2sInstanceKey,{bool:{isUnrenderedMsgType:d("MAWDbMsg").isUnrenderedMsgType(h)}});if(k==null)return{type:"missing_thread"};var o=m.find(function(a){return a.threadJid===k.jid&&a.author===d("WAJids").AUTHOR_ME});if(o!=null&&o.ack!==d("MAWAckLevel").ACK.partialOptimistic)return o.ack>=d("MAWAckLevel").ACK.sent?{msgId:o.msgId,protocolMsgId:{author:d("WAJids").AUTHOR_ME,chat:k.jid,externalId:o.externalId},type:"already_sent"}:{msgId:o.msgId,protocolMsgId:{author:d("WAJids").AUTHOR_ME,chat:k.jid,externalId:o.externalId},type:"not_sent"};else{var p=o==null?void 0:o.rowId;o&&(j("ts",o.ts,f),j("threadJid",o.threadJid,k.jid));if(!d("MAWDbMsg").isUnrenderedMsgType(h)){m={ack:d("MAWAckLevel").ACK.clock,altIndex:void 0,author:d("WAJids").AUTHOR_ME,ephemeralSetting:g.ephemeralSetting,externalId:b,isForwarded:g.isForwarded,specialTextSize:g.specialTextSize,threadJid:k.jid,ts:f};var q=d("MAWBuildNewMsgPayload").buildNewMsg(h,m,g,n),r=g.isFirstMsg,s=g.openMessageOtid,t=g.openMessageParticipantCount,u=g.optimisticMsg,v=g.participantCount;m=d("MAWLoadReplyMediaTxns").getReplyMediaForMsgQuote(a,q).then(function(b){return d("MAWWriteMsgTxns").writeMsg(a,q,k,{isCurrentDeviceSendingMsg:!0,isFirstMsg:r,isOutgoing:!0,openMessageOtid:s,openMessageParticipantCount:t,optimisticMsg:u,participantCount:v,quotedReplyAttachmentMeta:b,upsertRowData:p!=null?{msgId:c("nullthrows")(o==null?void 0:o.msgId),rowId:p}:void 0})})}else{n={ack:d("MAWAckLevel").ACK.clock,author:d("WAJids").AUTHOR_ME,externalId:b,threadJid:k.jid,ts:f};n=d("MAWBuildNewMsgPayload").getNewUnrenderedMsg(h,n,g,e==null?void 0:e.externalId);m=d("MAWWriteMsgTxns").writeUnrenderedMsg(a,n,k)}return m.then(function(c){i("write_outgoing_msg_promise_resolved",g.s2sInstanceKey);return l(a,h,k.jid,f).then(function(){return{msgId:c.msgId,protocolMsgId:{author:d("WAJids").AUTHOR_ME,chat:k.jid,externalId:b},type:"not_sent"}})})}})}});function k(a,b,c){return b==null?d("MAWDexieTable").dexieResolve(null):d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,b).then(function(b){return b==null?null:a.threads.get({jid:b.threadJid}).then(function(a){var e=d("MAWBuildNewMsgPayload").msgToQuotedMsg(b);if(e==null)return null;b.messageExpirationTs!=null&&b.messageExpirationTs<d("WATimeUtils").unixTime()&&(e=babelHelpers["extends"]({},e,{mediaId:void 0,msgContent:void 0,type:d("MAWMsgType").MSG_TYPE.EXPIRED_EPHEMERAL,xmaMessageType:void 0}));if(a==null||a.jid===c)return{content:e,remoteJid:null};a=d("WAJids").interpretAndValidateJid(a.jid);a=a.jidType==="group"?a.groupJid:null;return{content:e,remoteJid:a}})})}function l(a,b,c,e){if(b===d("MAWMsgType").MSG_TYPE.EPHEMERAL_SYNC_RESPONSE)return d("WAJids").switchOnMsgrChatJidType(c,{group:function(){return d("MAWDexieTable").dexieResolve()},user:function(b){return a.ephemeralSettings.get({userJid:b}).then(function(b){var c;if(b==null)return d("MAWDexieTable").dexieResolve();b.ephemeralSyncResponseBackoffInfo={syncResponseRetries:((c=(c=b.ephemeralSyncResponseBackoffInfo)==null?void 0:c.syncResponseRetries)!=null?c:0)+1,syncResponseSentTs:e};return a.ephemeralSettings.put(b)}).then(function(){})}});return b===d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_CHANGE_FROM_CURRENT_DEVICE?d("WAJids").switchOnMsgrChatJidType(c,{group:function(){return d("MAWDexieTable").dexieResolve()},user:function(b){return a.ephemeralSettings.get({userJid:b}).then(function(b){if(b==null||b.ephemeralSyncResponseBackoffInfo==null)return d("MAWDexieTable").dexieResolve();b.ephemeralSyncResponseBackoffInfo=void 0;return a.ephemeralSettings.put(b).then(function(){})})}}):d("MAWDexieTable").dexieResolve()}g.writeOutgoingMsg=b;g.getQuoteInfo=k}),98);
__d("MAWSendSenderKeyDistributionMsg",["MAWDebugMsg","MAWExternalId","MAWJobDefinitions","MAWJobManager","MAWMessageSendScheduler","MAWMsgType","MAWSendWrittenMsg","MAWWriteOutgoingMsgApi","Promise","WAAPI","WAJobOrchestratorTypes","WAResultOrError","WATimeUtils","WorkerScheduler","asyncToGeneratorRuntime","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h,i=new Set();function j(a,b){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e){if(i.has(a))return(h||(h=b("Promise"))).resolve(d("WAResultOrError").makeResult());yield d("MAWDebugMsg").writeDebugMsg(a,"Sending key distribution msg");e=(yield d("MAWWriteOutgoingMsgApi").writeOutgoingMsg(e,a,d("WATimeUtils").unixTime(),{},d("MAWMsgType").MSG_TYPE.SK_DISTRIBUTION));if(e.type==="already_sent")return d("WAResultOrError").makeError("already_sent");else if(e.type==="missing_thread")return d("WAResultOrError").makeError("missing_thread");c("gkx")("5800")?yield d("MAWSendWrittenMsg").sendWrittenMsgExternal({protocolMsgId:e.protocolMsgId,type:"message"},!1):yield d("MAWJobManager").getJobManager().waitUntilPersisted(d("MAWJobDefinitions").createStartJobInfo("sendWrittenMsg",{protocolMsgId:e.protocolMsgId,scheduleConfig:{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION},type:"message"}));i.add(a);return d("WAResultOrError").makeResult()});return k.apply(this,arguments)}var l=10,m=new Set();function a(a,b){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e){if(c("gkx")("5801")){if(m.has(a))return(h||(h=b("Promise"))).resolve();if(e.length<l)return(h||(h=b("Promise"))).resolve();m.add(a);return d("MAWMessageSendScheduler").messageSendScheduler().run({fn:function(){var f=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield c("WAAPI").preEstablishSession({groupJid:a,userJids:e}),yield j(a,d("MAWExternalId").generateExternalId())});function g(){return f.apply(this,arguments)}return g}(),name:"sks",priority:d("WorkerScheduler").BACKGROUND_PRIORITY}).promise["finally"](function(){m["delete"](a)})}else{if(e.length<l)return(h||(h=b("Promise"))).resolve();yield c("WAAPI").preEstablishSession({groupJid:a,userJids:e});yield j(a,d("MAWExternalId").generateExternalId())}});return n.apply(this,arguments)}g.sendSenderKeyDistributionMsg=j;g.maybePreEstablishSessionsAndSendSenderKeyDistributionMsg=a}),98);
__d("WAAbPropConverters",[],(function(a,b,c,d,e,f){"use strict";function a(a){if(!a)return{};var b={};Object.keys(a).forEach(function(c){var d=a[c];d!=null&&(b[c]=d)});return b}f.convertAbPropsToPlainObject=a}),66);
__d("WAAbPropsCache",["WAAbPropConverters"],(function(a,b,c,d,e,f,g){"use strict";var h=86400;a=function(){function a(a){var b=a.abKey,c=a.abHash,d=a.lastSyncTime,e=a.expoKeyStr,f=a.refresh,g=a.internalExpoKeys,h=a.propExpoKeys,i=a.propValues;a=a.overridePropValues;this.$1=a!=null?a:{};this.$2=i;this.$4=c;this.$3=b;this.$5=d;this.$7=f;this.$6=e;this.$8=g;this.$9=h}var b=a.prototype;b.getAbProp=function(a){var b;return this.$1[a]!=null?this.$1[a]:(b=this.$2)==null?void 0:b[a]};b.getHash=function(){return this.$4};b.getRefreshSecs=function(){var a;return(a=this.$7)!=null?a:h};b.overrideAbProp=function(a,b){this.$1[a]=b};b.readAll=function(){var a={abKey:this.$3,hash:this.getHash(),refresh:this.getRefreshSecs(),lastSyncTime:this.$5||0};this.$9!=null&&(a.propExpoKeys=this.$9);this.$8!=null&&(a.internalExpoKeys=this.$8);this.$6!=null&&(a.expoKeyStr=this.$6);if(this.$2!=null){var b=this.$2;b!=null&&(a.propValues=d("WAAbPropConverters").convertAbPropsToPlainObject(b),this.$1!=null&&(a.propValues=babelHelpers["extends"]({},a.propValues,d("WAAbPropConverters").convertAbPropsToPlainObject(this.$1))))}return a};b.rewrite=function(a){var b=a.abKey,c=a.abHash,d=a.lastSyncTime,e=a.expoKeyStr,f=a.refresh,g=a.internalExpoKeys,h=a.propExpoKeys;a=a.propValues;this.$2=a;this.$4=c;this.$3=b;this.$5=d;this.$7=f;this.$6=e;this.$8=g;this.$9=h};return a}();g.AbPropsCache=a}),98);
__d("WAAbPropsConverters",["WAAbPropsTypes","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["convertDbAbPropsToParsed: unsure how to read ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["convertAbPropsParsedToDbEntity: unsure how to read ",""]);i=function(){return a};return a}function a(a){var b={expoKeyStr:a.expoKeyStr,internalExpoKeys:a.internalExpoKeys?Array.from(a.internalExpoKeys):[],lastSyncTime:a.lastSyncTime,refresh:a.refresh};a.abHash!=null&&(b.abHash=a.abHash);a.abKey!=null&&(b.abKey=a.abKey);if(a.propExpoKeys){var c=a.propExpoKeys,e=[];Object.keys(c).forEach(function(a){a=Number(a);var b={expoKey:a};c[a]!=null&&(b.value=c[a]);e.push(b)});b.propExpoKeys=e}if(a.propValues){var f=a.propValues,g=[];Object.keys(f).forEach(function(a){var b={name:a,value:{}};switch(typeof f[a]){case"boolean":b.value.boolValue=f[a];break;case"number":b.value.intValue=f[a];break;case"string":b.value.strValue=f[a];break;default:d("WALogger").WARN(i(),f[a]);return}g.push(b)});b.propValues=g}return b}function b(a){var b={expoKeyStr:a.expoKeyStr,internalExpoKeys:a.internalExpoKeys,lastSyncTime:a.lastSyncTime,propExpoKeys:a.propExpoKeys,refresh:a.refresh};a.hash!=null&&(b.abHash=a.hash);a.abKey!=null&&(b.abKey=a.abKey);if(a.propValues){var c=a.propValues,d={};Object.keys(c).forEach(function(a){c[a]!=null&&(d[a]=c[a])});b.propValues=d}return b}function c(a){var b=a.abHash,c=a.abKey,e=a.expoKeyStr,f=a.internalExpoKeys,g=a.lastSyncTime,i=a.propExpoKeys,j=a.propValues;a=a.refresh;b={abHash:b,abKey:c,expoKeyStr:e,lastSyncTime:g,refresh:a};f!=null&&(b.internalExpoKeys=new Set(f));if(i!=null){var k={};i.forEach(function(a){a.expoKey!=null&&(k[a.expoKey]=a.value)});b.propExpoKeys=k}if(j!=null){var l={};j.forEach(function(a){var b=a.name,c=d("WAAbPropsTypes").ABPropConfigs[b];if(c==null||c.length<3)return;c=c[2];switch(typeof c){case"boolean":l[b]=a.value.boolValue;return;case"number":l[b]=a.value.intValue;return;case"string":l[b]=a.value.strValue;return;default:d("WALogger").WARN(h(),c);return}});b.propValues=l}return b}g.convertAbPropsParsedToDbEntity=a;g.convertAbPropsDataToParsed=b;g.convertDbAbPropsToParsed=c}),98);
__d("WAGetAbPropsApi",["WAGetMetaApi"],(function(a,b,c,d,e,f,g){"use strict";a=function(){return d("WAGetMetaApi").getMeta().then(function(a){a=a.abProps;return a})};g.getAbProps=a}),98);
__d("WASetAbPropsApi",["WASetMetaApi"],(function(a,b,c,d,e,f,g){"use strict";a=function(a){return d("WASetMetaApi").setMeta({abProps:a})};g.setAbProps=a}),98);
__d("WAAbPropsInit",["Promise","WAAbProps","WAAbPropsCache","WAAbPropsConverters","WAAbPropsToUI","WAAbPropsTypes","WABridge","WAErr","WAGetAbPropsApi","WALogger","WASetAbPropsApi","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["ABProps inited"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Starting ABProps store"]);j=function(){return a};return a}var k;function a(){if(!k)throw c("WAErr")("Trying to get hash before AbProps gets initialized");return(h||(h=b("Promise"))).resolve(k.getHash())}function e(){if(!k)throw c("WAErr")("Trying to get refresh secs before AbProps gets initialized");return(h||(h=b("Promise"))).resolve(k.getRefreshSecs())}var l={getAbProps:function(){if(!k)throw c("WAErr")("Trying to read ABProps before they gets initialized");return(h||(h=b("Promise"))).resolve(k.readAll())},getHash:a,getRefreshSecs:e,setAbProps:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b;a=d("WAAbPropsConverters").convertAbPropsDataToParsed(a);(b=k)==null?void 0:b.rewrite(a);yield d("WASetAbPropsApi").setAbProps(d("WAAbPropsConverters").convertAbPropsParsedToDbEntity(a));m(a)});function c(b){return a.apply(this,arguments)}return c}()};function m(a){if(!a.propValues)return;a=d("WAAbPropsToUI").prepareAbPropsForUI(a.propValues);d("WABridge").getBridge().fireAndForget("event","abPropsUpdated",{abProps:a})}function f(){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){d("WALogger").LOG(j());var a=(yield d("WAGetAbPropsApi").getAbProps()),b={};a&&(b=d("WAAbPropsConverters").convertDbAbPropsToParsed(a));k=new(d("WAAbPropsCache").AbPropsCache)(b);d("WAAbProps").startAbProps(l,d("WAAbPropsTypes").ABPropConfigs);m(b);d("WALogger").LOG(i())});return n.apply(this,arguments)}function o(a,b){if(k==null)throw c("WAErr")("Trying to override ABProp before they get initialized");var e=k;e.overrideAbProp(a,b);m(d("WAAbPropsConverters").convertAbPropsDataToParsed(e.readAll()))}function p(a){return d("WAAbPropsTypes").ABPropConfigs[a][2]}function q(){if(!k)throw c("WAErr")("Trying to read ABProps before they get initialized");return k.readAll()}function r(a){if(!k)throw c("WAErr")("Trying to read ABProp "+a+" before AbProps gets initialized");var b=k.getAbProp(a);return b!=null?b:p(a)}g.getHash=a;g.getRefreshSecs=e;g.initAbProps=f;g.overrideAbProp=o;g.getAbDefault=p;g.getAbProps=q;g.getAbProp=r}),98);
__d("WADbContactsTxns",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){return a.contacts.where("contactJid").anyOf(b).toArray()}function b(a,b){return a.contacts.get({contactJid:b})}f.getContacts=a;f.getContact=b}),66);
__d("WAGetContactAndIdentitiesApi",["MAWDexieTable","MAWTransactionMode","WADbContactsTxns","WADbIdentityTxns","WADbTransactor","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";a=d("WADbTransactor").makeSignalTransactor({contacts:d("MAWTransactionMode").READONLY,identity:d("MAWTransactionMode").READONLY},"getContactAndIdentitiesForUser",function(a){return function(b){return d("MAWDexieTable").dexieAll([d("WADbContactsTxns").getContact(a,b),d("WADbIdentityTxns").getIdentitiesForUser(a,b)]).then(function(a){var b=a[0];a=a[1];if(b==null)return d("WAResultOrError").makeError("missing_contact");else{b={contact:{dhash:b.dhash,icdcInfo:b.icdcInfo},identities:a.map(function(a){return{deviceJid:a.deviceJid,identity:a.identity}})};return d("WAResultOrError").makeResult(b)}})}});g.getContactAndIdentitiesForUser=a}),98);
/**
 * License: https://www.facebook.com/legal/license/MDzNl_j9yvg/
 */
__d("fflate-0.6.10",[],(function(a,b,c,d,e,f){"use strict";var g={},h={exports:g};function i(){var a,b="";try{a={}.Worker}catch(a){}g["default"]=a?function(c,d,e,f,g){var h=!1,i=new a(c+b,{eval:!0}).on("error",function(a){return g(a,null)}).on("message",function(a){return g(null,a)}).on("exit",function(a){a&&!h&&g(new Error("exited with code "+a),null)});i.postMessage(e,f);i.terminate=function(){h=!0;return a.prototype.terminate.call(i)};return i}:function(a,b,c,d,e){setImmediate(function(){return e(new Error("async operations unsupported - update to Node 12+ (or Node 10-11 with the --experimental-worker CLI flag)"),null)});a=function(){};return{terminate:a,postMessage:a}}}var j=!1;function k(){j||(j=!0,i());return h.exports}var l={},m={exports:l};function n(){var a=k(),b=Uint8Array,c=Uint16Array,d=Uint32Array,e=new b([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),f=new b([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),g=new b([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),h=function(a,b){var e=new c(31);for(var f=0;f<31;++f)e[f]=b+=1<<a[f-1];a=new d(e[30]);for(var f=1;f<30;++f)for(b=e[f];b<e[f+1];++b)a[b]=b-e[f]<<5|f;return[e,a]},i=h(e,2),j=i[0],m=i[1];j[28]=258,m[258]=28;i=h(f,0);var n=i[0],o=i[1],p=new c(32768);for(h=0;h<32768;++h){i=(h&43690)>>>1|(h&21845)<<1;i=(i&52428)>>>2|(i&13107)<<2;i=(i&61680)>>>4|(i&3855)<<4;p[h]=((i&65280)>>>8|(i&255)<<8)>>>1}var q=function(a,b,d){var e=a.length,f=0,g=new c(b);for(;f<e;++f)++g[a[f]-1];var h=new c(b);for(f=0;f<b;++f)h[f]=h[f-1]+g[f-1]<<1;if(d){g=new c(1<<b);d=15-b;for(f=0;f<e;++f)if(a[f]){var i=f<<4|a[f],j=b-a[f],k=h[a[f]-1]++<<j;for(j=k|(1<<j)-1;k<=j;++k)g[p[k]>>>d]=i}}else{g=new c(e);for(f=0;f<e;++f)a[f]&&(g[f]=p[h[a[f]-1]++]>>>15-a[f])}return g},r=new b(288);for(h=0;h<144;++h)r[h]=8;for(h=144;h<256;++h)r[h]=9;for(h=256;h<280;++h)r[h]=7;for(h=280;h<288;++h)r[h]=8;var s=new b(32);for(h=0;h<32;++h)s[h]=5;var t=q(r,9,0),u=q(r,9,1),v=q(s,5,0),w=q(s,5,1),x=function(a){var b=a[0];for(var c=1;c<a.length;++c)a[c]>b&&(b=a[c]);return b},y=function(a,b,c){var d=b/8|0;return(a[d]|a[d+1]<<8)>>(b&7)&c},z=function(a,b){var c=b/8|0;return(a[c]|a[c+1]<<8|a[c+2]<<16)>>(b&7)},aa=function(a){return(a/8|0)+(a&7&&1)},A=function(a,e,f){(e==null||e<0)&&(e=0);(f==null||f>a.length)&&(f=a.length);var g=new(a instanceof c?c:a instanceof d?d:b)(f-e);g.set(a.subarray(e,f));return g},B=function(a,c,d){var h=a.length;if(!h||d&&!d.l&&h<5)return c||new b(0);var i=!c||d,k=!d||d.i;d||(d={});c||(c=new b(h*3));var l=function(a){var d=c.length;if(a>d){d=new b(Math.max(d*2,a));d.set(c);c=d}},m=d.f||0,o=d.p||0,p=d.b||0,r=d.l,s=d.d,t=d.m,v=d.n,B=h*8;do{if(!r){d.f=m=y(a,o,1);var C=y(a,o+1,3);o+=3;if(!C){var D=aa(o)+4,E=a[D-4]|a[D-3]<<8,F=D+E;if(F>h){if(k)throw"unexpected EOF";break}i&&l(p+E);c.set(a.subarray(D,F),p);d.b=p+=E,d.p=o=F*8;continue}else if(C==1)r=u,s=w,t=9,v=5;else if(C==2){E=y(a,o,31)+257;F=y(a,o+10,15)+4;C=E+y(a,o+5,31)+1;o+=14;var G=new b(C),H=new b(19);for(var I=0;I<F;++I)H[g[I]]=y(a,o+I*3,7);o+=F*3;F=x(H);var J=(1<<F)-1;H=q(H,F,1);for(var I=0;I<C;){F=H[y(a,o,J)];o+=F&15;var D=F>>>4;if(D<16)G[I++]=D;else{F=0;var K=0;D==16?(K=3+y(a,o,3),o+=2,F=G[I-1]):D==17?(K=3+y(a,o,7),o+=3):D==18&&(K=11+y(a,o,127),o+=7);while(K--)G[I++]=F}}D=G.subarray(0,E);K=G.subarray(E);t=x(D);v=x(K);r=q(D,t,1);s=q(K,v,1)}else throw"invalid block type";if(o>B){if(k)throw"unexpected EOF";break}}i&&l(p+131072);J=(1<<t)-1;H=(1<<v)-1;C=o;for(;;C=o){F=r[z(a,o)&J];G=F>>>4;o+=F&15;if(o>B){if(k)throw"unexpected EOF";break}if(!F)throw"invalid length/literal";if(G<256)c[p++]=G;else if(G==256){C=o,r=null;break}else{E=G-254;if(G>264){var I=G-257;D=e[I];E=y(a,o,(1<<D)-1)+j[I];o+=D}F=s[z(a,o)&H];G=F>>>4;if(!F)throw"invalid distance";o+=F&15;K=n[G];if(G>3){D=f[G];K+=z(a,o)&(1<<D)-1,o+=D}if(o>B){if(k)throw"unexpected EOF";break}i&&l(p+131072);F=p+E;for(;p<F;p+=4)c[p]=c[p-K],c[p+1]=c[p+1-K],c[p+2]=c[p+2-K],c[p+3]=c[p+3-K];p=F}}d.l=r,d.p=C,d.b=p;r&&(m=1,d.m=t,d.d=s,d.n=v)}while(!m);return p==c.length?c:A(c,0,p)},C=function(a,b,c){c<<=b&7;b=b/8|0;a[b]|=c;a[b+1]|=c>>>8},D=function(a,b,c){c<<=b&7;b=b/8|0;a[b]|=c;a[b+1]|=c>>>8;a[b+2]|=c>>>16},E=function(a,d){var e=[];for(var f=0;f<a.length;++f)a[f]&&e.push({s:f,f:a[f]});a=e.length;var g=e.slice();if(!a)return[L,0];if(a==1){var h=new b(e[0].s+1);h[e[0].s]=1;return[h,1]}e.sort(function(a,b){return a.f-b.f});e.push({s:-1,f:25001});h=e[0];var i=e[1],j=0,k=1,l=2;e[0]={s:-1,f:h.f+i.f,l:h,r:i};while(k!=a-1)h=e[e[j].f<e[l].f?j++:l++],i=e[j!=k&&e[j].f<e[l].f?j++:l++],e[k++]={s:-1,f:h.f+i.f,l:h,r:i};h=g[0].s;for(var f=1;f<a;++f)g[f].s>h&&(h=g[f].s);var m=new c(h+1);i=F(e[k-1],m,0);if(i>d){var f=0;j=0;l=i-d;h=1<<l;g.sort(function(a,b){return m[b.s]-m[a.s]||a.f-b.f});for(;f<a;++f){e=g[f].s;if(m[e]>d)j+=h-(1<<i-m[e]),m[e]=d;else break}j>>>=l;while(j>0){k=g[f].s;m[k]<d?j-=1<<d-m[k]++-1:++f}for(;f>=0&&j;--f){e=g[f].s;m[e]==d&&(--m[e],++j)}i=d}return[new b(m),i]},F=function(a,b,c){return a.s==-1?Math.max(F(a.l,b,c+1),F(a.r,b,c+1)):b[a.s]=c},G=function(a){var b=a.length;while(b&&!a[--b]);var d=new c(++b),e=0,f=a[0],g=1,h=function(a){d[e++]=a};for(var i=1;i<=b;++i)if(a[i]==f&&i!=b)++g;else{if(!f&&g>2){for(;g>138;g-=138)h(32754);g>2&&(h(g>10?g-11<<5|28690:g-3<<5|12305),g=0)}else if(g>3){h(f),--g;for(;g>6;g-=6)h(8304);g>2&&(h(g-3<<5|8208),g=0)}while(g--)h(f);g=1;f=a[i]}return[d.subarray(0,e),b]},H=function(a,b){var c=0;for(var d=0;d<b.length;++d)c+=a[d]*b[d];return c},I=function(a,b,c){var d=c.length;b=aa(b+2);a[b]=d&255;a[b+1]=d>>>8;a[b+2]=a[b]^255;a[b+3]=a[b+1]^255;for(var e=0;e<d;++e)a[b+e+4]=c[e];return(b+4+d)*8},J=function(a,b,d,h,i,j,k,l,m,n,o){C(b,o++,d);++i[256];d=E(i,15);var p=d[0];d=d[1];var u=E(j,15),w=u[0];u=u[1];var x=G(p),y=x[0];x=x[1];var z=G(w),aa=z[0];z=z[1];var A=new c(19);for(var B=0;B<y.length;++B)A[y[B]&31]++;for(var B=0;B<aa.length;++B)A[aa[B]&31]++;var F=E(A,7),J=F[0];F=F[1];var K=19;for(;K>4&&!J[g[K-1]];--K);var L=n+5<<3,M=H(i,r)+H(j,s)+k;i=H(i,p)+H(j,w)+k+14+3*K+H(A,J)+(2*A[16]+3*A[17]+7*A[18]);if(L<=M&&L<=i)return I(b,o,a.subarray(m,m+n));C(b,o,1+(i<M)),o+=2;if(i<M){j=q(p,d,0),k=p,A=q(w,u,0),L=w;a=q(J,F,0);C(b,o,x-257);C(b,o+5,z-1);C(b,o+10,K-4);o+=14;for(var B=0;B<K;++B)C(b,o+3*B,J[g[B]]);o+=3*K;m=[y,aa];for(n=0;n<2;++n){i=m[n];for(var B=0;B<i.length;++B){M=i[B]&31;C(b,o,a[M]),o+=J[M];M>15&&(C(b,o,i[B]>>>5&127),o+=i[B]>>>12)}}}else j=t,k=r,A=v,L=s;for(var B=0;B<l;++B)if(h[B]>255){M=h[B]>>>18&31;D(b,o,j[M+257]),o+=k[M+257];M>7&&(C(b,o,h[B]>>>23&31),o+=e[M]);d=h[B]&31;D(b,o,A[d]),o+=L[d];d>3&&(D(b,o,h[B]>>>5&8191),o+=f[d])}else D(b,o,j[h[B]]),o+=k[h[B]];D(b,o,j[256]);return o+k[256]},K=new d([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),L=new b(0),M=function(a,g,h,i,j,k){var l=a.length,n=new b(i+l+5*(1+Math.ceil(l/7e3))+j),p=n.subarray(i,n.length-j),q=0;if(!g||l<8)for(var r=0;r<=l;r+=65535){var s=r+65535;s<l?q=I(p,q,a.subarray(r,s)):(p[r]=k,q=I(p,q,a.subarray(r,l)))}else{s=K[g-1];g=s>>>13;s=s&8191;var t=(1<<h)-1,u=new c(32768),v=new c(t+1),w=Math.ceil(h/3),x=2*w;h=function(b){return(a[b]^a[b+1]<<w^a[b+2]<<x)&t};var y=new d(25e3),z=new c(288),B=new c(32),C=0,D=0,r=0,E=0,F=0,G=0;for(;r<l;++r){var H=h(r),M=r&32767,N=v[H];u[M]=N;v[H]=M;if(F<=r){var O=l-r;if((C>7e3||E>24576)&&O>423){q=J(a,p,0,y,z,B,D,E,G,r-G,q);E=C=D=0,G=r;for(var P=0;P<286;++P)z[P]=0;for(var P=0;P<30;++P)B[P]=0}var Q=2,R=0,ba=s,S=M-N&32767;if(O>2&&H==h(r-S)){H=Math.min(g,O)-1;var ca=Math.min(32767,r);O=Math.min(258,O);while(S<=ca&&--ba&&M!=N){if(a[r+Q]==a[r+Q-S]){var T=0;for(;T<O&&a[r+T]==a[r+T-S];++T);if(T>Q){Q=T,R=S;if(T>H)break;T=Math.min(S,T-2);var da=0;for(var P=0;P<T;++P){var U=r-S+P+32768&32767,V=u[U];V=U-V+32768&32767;V>da&&(da=V,N=U)}}}M=N,N=u[M];S+=M-N+32768&32767}}if(R){y[E++]=268435456|m[Q]<<18|o[R];V=m[Q]&31;U=o[R]&31;D+=e[V]+f[U];++z[257+V];++B[U];F=r+Q;++C}else y[E++]=a[r],++z[a[r]]}}q=J(a,p,k,y,z,B,D,E,G,r-G,q);!k&&q&7&&(q=I(p,q+1,L))}return A(n,0,i+aa(q)+j)},N=function(){var a=new Int32Array(256);for(var b=0;b<256;++b){var c=b,d=9;while(--d)c=(c&1&&-306674912)^c>>>1;a[b]=c}return a}(),O=function(){var a=-1;return{p:function(b){var c=a;for(var d=0;d<b.length;++d)c=N[c&255^b[d]]^c>>>8;a=c},d:function(){return~a}}},P=function(){var a=1,b=0;return{p:function(c){var d=a,e=b,f=c.length;for(var g=0;g!=f;){var h=Math.min(g+2655,f);for(;g<h;++g)e+=d+=c[g];d=(d&65535)+15*(d>>16),e=(e&65535)+15*(e>>16)}a=d,b=e},d:function(){a%=65521,b%=65521;return(a&255)<<24|a>>>8<<16|(b&255)<<8|b>>>8}}},Q=function(a,b,c,d,e){return M(a,b.level==null?6:b.level,b.mem==null?Math.ceil(Math.max(8,Math.min(13,Math.log(a.length)))*1.5):12+b.mem,c,d,!e)},R=function(a,b){var c={};for(var d in a)c[d]=a[d];for(var d in b)c[d]=b[d];return c},ba=function(b,c,a){var d=b();b=b.toString();b=b.slice(b.indexOf("[")+1,b.lastIndexOf("]")).replace(/ /g,"").split(",");for(var e=0;e<d.length;++e){var f=d[e],g=b[e];if(typeof f=="function"){c+=";"+g+"=";var h=f.toString();if(f.prototype)if(h.indexOf("[native code]")!=-1){var i=h.indexOf(" ",8)+1;c+=h.slice(i,h.indexOf("(",i))}else{c+=h;for(i in f.prototype)c+=";"+g+".prototype."+i+"="+f.prototype[i].toString()}else c+=h}else a[g]=f}return[c,a]},S=[],ca=function(a){var e=[];for(var f in a)(a[f]instanceof b||a[f]instanceof c||a[f]instanceof d)&&e.push((a[f]=new a[f].constructor(a[f])).buffer);return e},T=function(c,d,e,f){var b;if(!S[e]){var g="",h={},i=c.length-1;for(var j=0;j<i;++j)b=ba(c[j],g,h),g=b[0],h=b[1];S[e]=ba(c[i],g,h)}b=R({},S[e][1]);return a["default"](S[e][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+d.toString()+"}",e,b,ca(b),f)},da=function(){return[b,c,d,e,f,g,j,n,u,w,p,q,x,y,z,aa,A,B,za,ha,ia]},U=function(){return[b,c,d,e,f,g,m,o,t,r,v,s,p,K,L,q,C,D,E,F,G,H,I,J,aa,A,M,Q,wa,ha]},V=function(){return[ma,pa,Z,O,N]},ea=function(){return[na,oa]},fa=function(){return[qa,Z,P]},ga=function(){return[ra]},ha=function(a){return postMessage(a,[a.buffer])},ia=function(a){return a&&a.size&&new b(a.size)},ja=function(a,b,c,d,e,f){var g=T(c,d,e,function(b,a){g.terminate(),f(b,a)});g.postMessage([a,b],b.consume?[a.buffer]:[]);return function(){g.terminate()}},W=function(a){a.ondata=function(a,b){return postMessage([a,b],[a.buffer])};return function(b){return a.push(b.data[0],b.data[1])}},ka=function(a,b,c,d,e){var f,g=T(a,d,e,function(a,c){a?(g.terminate(),b.ondata.call(b,a)):(c[1]&&g.terminate(),b.ondata.call(b,a,c[0],c[1]))});g.postMessage(c);b.push=function(a,c){if(f)throw"stream finished";if(!b.ondata)throw"no stream handler";g.postMessage([a,f=c],[a.buffer])};b.terminate=function(){g.terminate()}},X=function(a,b){return a[b]|a[b+1]<<8},Y=function(a,b){return(a[b]|a[b+1]<<8|a[b+2]<<16|a[b+3]<<24)>>>0},la=function(a,b){return Y(a,b)+Y(a,b+4)*4294967296},Z=function(a,b,c){for(;c;++b)a[b]=c,c>>>=8},ma=function(a,b){var c=b.filename;a[0]=31,a[1]=139,a[2]=8,a[8]=b.level<2?4:b.level==9?2:0,a[9]=3;b.mtime!=0&&Z(a,4,Math.floor(new Date(b.mtime||Date.now())/1e3));if(c){a[3]=8;for(b=0;b<=c.length;++b)a[b+10]=c.charCodeAt(b)}},na=function(a){if(a[0]!=31||a[1]!=139||a[2]!=8)throw"invalid gzip data";var b=a[3],c=10;b&4&&(c+=a[10]|(a[11]<<8)+2);for(var d=(b>>3&1)+(b>>4&1);d>0;d-=!a[c++]);return c+(b&2)},oa=function(a){var b=a.length;return(a[b-4]|a[b-3]<<8|a[b-2]<<16|a[b-1]<<24)>>>0},pa=function(a){return 10+(a.filename&&a.filename.length+1||0)},qa=function(a,b){b=b.level;b=b==0?0:b<6?1:b==9?3:2;a[0]=120,a[1]=b<<6|(b?32-2*b:1)},ra=function(a){if((a[0]&15)!=8||a[0]>>>4>7||(a[0]<<8|a[1])%31)throw"invalid zlib data";if(a[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function sa(a,b){!b&&typeof a=="function"&&(b=a,a={});this.ondata=b;return a}var ta=function(){function a(a,b){!b&&typeof a=="function"&&(b=a,a={}),this.ondata=b,this.o=a||{}}a.prototype.p=function(a,b){this.ondata(Q(a,this.o,0,0,!b),b)};a.prototype.push=function(a,b){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";this.d=b;this.p(a,b||!1)};return a}();l.Deflate=ta;var ua=function(){function a(a,b){ka([U,function(){return[W,ta]}],this,sa.call(this,a,b),function(a){a=new ta(a.data);onmessage=W(a)},6)}return a}();l.AsyncDeflate=ua;function va(a,b,c){c||(c=b,b={});if(typeof c!="function")throw"no callback";return ja(a,b,[U],function(a){return ha(wa(a.data[0],a.data[1]))},0,c)}l.deflate=va;function wa(a,b){return Q(a,b||{},0,0)}l.deflateSync=wa;var $=function(){function a(a){this.s={},this.p=new b(0),this.ondata=a}a.prototype.e=function(a){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";var c=this.p.length,d=new b(c+a.length);d.set(this.p),d.set(a,c),this.p=d};a.prototype.c=function(a){this.d=this.s.i=a||!1;a=this.s.b;var b=B(this.p,this.o,this.s);this.ondata(A(b,a,this.s.b),this.d);this.o=A(b,this.s.b-32768),this.s.b=this.o.length;this.p=A(this.p,this.s.p/8|0),this.s.p&=7};a.prototype.push=function(a,b){this.e(a),this.c(b)};return a}();l.Inflate=$;var xa=function(){function a(a){this.ondata=a,ka([da,function(){return[W,$]}],this,0,function(){var a=new $();onmessage=W(a)},7)}return a}();l.AsyncInflate=xa;function ya(a,b,c){c||(c=b,b={});if(typeof c!="function")throw"no callback";return ja(a,b,[da],function(a){return ha(za(a.data[0],ia(a.data[1])))},1,c)}l.inflate=ya;function za(a,b){return B(a,b)}l.inflateSync=za;var Aa=function(){function a(a,b){this.c=O(),this.l=0,this.v=1,ta.call(this,a,b)}a.prototype.push=function(a,b){ta.prototype.push.call(this,a,b)};a.prototype.p=function(a,b){this.c.p(a);this.l+=a.length;a=Q(a,this.o,this.v&&pa(this.o),b&&8,!b);this.v&&(ma(a,this.o),this.v=0);b&&(Z(a,a.length-8,this.c.d()),Z(a,a.length-4,this.l));this.ondata(a,b)};return a}();l.Gzip=Aa;l.Compress=Aa;i=function(){function a(a,b){ka([U,V,function(){return[W,ta,Aa]}],this,sa.call(this,a,b),function(a){a=new Aa(a.data);onmessage=W(a)},8)}return a}();l.AsyncGzip=i;l.AsyncCompress=i;function Ba(a,b,c){c||(c=b,b={});if(typeof c!="function")throw"no callback";return ja(a,b,[U,V,function(){return[Ca]}],function(a){return ha(Ca(a.data[0],a.data[1]))},2,c)}l.gzip=Ba;l.compress=Ba;function Ca(a,b){b||(b={});var c=O(),d=a.length;c.p(a);a=Q(a,b,pa(b),8);var e=a.length;return ma(a,b),Z(a,e-8,c.d()),Z(a,e-4,d),a}l.gzipSync=Ca;l.compressSync=Ca;var Da=function(){function a(a){this.v=1,$.call(this,a)}a.prototype.push=function(a,b){$.prototype.e.call(this,a);if(this.v){a=this.p.length>3?na(this.p):4;if(a>=this.p.length&&!b)return;this.p=this.p.subarray(a),this.v=0}if(b){if(this.p.length<8)throw"invalid gzip stream";this.p=this.p.subarray(0,-8)}$.prototype.c.call(this,b)};return a}();l.Gunzip=Da;var Ea=function(){function a(a){this.ondata=a,ka([da,ea,function(){return[W,$,Da]}],this,0,function(){var a=new Da();onmessage=W(a)},9)}return a}();l.AsyncGunzip=Ea;function Fa(a,b,c){c||(c=b,b={});if(typeof c!="function")throw"no callback";return ja(a,b,[da,ea,function(){return[Ga]}],function(a){return ha(Ga(a.data[0]))},3,c)}l.gunzip=Fa;function Ga(a,c){return B(a.subarray(na(a),-8),c||new b(oa(a)))}l.gunzipSync=Ga;var Ha=function(){function a(a,b){this.c=P(),this.v=1,ta.call(this,a,b)}a.prototype.push=function(a,b){ta.prototype.push.call(this,a,b)};a.prototype.p=function(a,b){this.c.p(a);a=Q(a,this.o,this.v&&2,b&&4,!b);this.v&&(qa(a,this.o),this.v=0);b&&Z(a,a.length-4,this.c.d());this.ondata(a,b)};return a}();l.Zlib=Ha;h=function(){function a(a,b){ka([U,fa,function(){return[W,ta,Ha]}],this,sa.call(this,a,b),function(a){a=new Ha(a.data);onmessage=W(a)},10)}return a}();l.AsyncZlib=h;function Ia(a,b,c){c||(c=b,b={});if(typeof c!="function")throw"no callback";return ja(a,b,[U,fa,function(){return[Ja]}],function(a){return ha(Ja(a.data[0],a.data[1]))},4,c)}l.zlib=Ia;function Ja(a,b){b||(b={});var c=P();c.p(a);a=Q(a,b,2,4);return qa(a,b),Z(a,a.length-4,c.d()),a}l.zlibSync=Ja;var Ka=function(){function a(a){this.v=1,$.call(this,a)}a.prototype.push=function(a,b){$.prototype.e.call(this,a);if(this.v){if(this.p.length<2&&!b)return;this.p=this.p.subarray(2),this.v=0}if(b){if(this.p.length<4)throw"invalid zlib stream";this.p=this.p.subarray(0,-4)}$.prototype.c.call(this,b)};return a}();l.Unzlib=Ka;var La=function(){function a(a){this.ondata=a,ka([da,ga,function(){return[W,$,Ka]}],this,0,function(){var a=new Ka();onmessage=W(a)},11)}return a}();l.AsyncUnzlib=La;function Ma(a,b,c){c||(c=b,b={});if(typeof c!="function")throw"no callback";return ja(a,b,[da,ga,function(){return[Na]}],function(a){return ha(Na(a.data[0],ia(a.data[1])))},5,c)}l.unzlib=Ma;function Na(a,b){return B((ra(a),a.subarray(2,-4)),b)}l.unzlibSync=Na;var Oa=function(){function a(a){this.G=Da,this.I=$,this.Z=Ka,this.ondata=a}a.prototype.push=function(a,c){if(!this.ondata)throw"no stream handler";if(!this.s){if(this.p&&this.p.length){var d=new b(this.p.length+a.length);d.set(this.p),d.set(a,this.p.length)}else this.p=a;if(this.p.length>2){var e=this;d=function(){e.ondata.apply(e,arguments)};this.s=this.p[0]==31&&this.p[1]==139&&this.p[2]==8?new this.G(d):(this.p[0]&15)!=8||this.p[0]>>4>7||(this.p[0]<<8|this.p[1])%31?new this.I(d):new this.Z(d);this.s.push(this.p,c);this.p=null}}else this.s.push(a,c)};return a}();l.Decompress=Oa;i=function(){function a(a){this.G=Ea,this.I=xa,this.Z=La,this.ondata=a}a.prototype.push=function(a,b){Oa.prototype.push.call(this,a,b)};return a}();l.AsyncDecompress=i;function Pa(a,b,c){c||(c=b,b={});if(typeof c!="function")throw"no callback";return a[0]==31&&a[1]==139&&a[2]==8?Fa(a,b,c):(a[0]&15)!=8||a[0]>>4>7||(a[0]<<8|a[1])%31?ya(a,b,c):Ma(a,b,c)}l.decompress=Pa;function Qa(a,b){return a[0]==31&&a[1]==139&&a[2]==8?Ga(a,b):(a[0]&15)!=8||a[0]>>4>7||(a[0]<<8|a[1])%31?za(a,b):Na(a,b)}l.decompressSync=Qa;var Ra=function(a,c,d,e){for(var f in a){var g=a[f],h=c+f;g instanceof b?d[h]=[g,e]:Array.isArray(g)?d[h]=[g[0],R(e,g[1])]:Ra(g,h+"/",d,e)}},Sa=typeof TextEncoder!="undefined"&&new TextEncoder(),Ta=typeof TextDecoder!="undefined"&&new TextDecoder(),Ua=0;try{Ta.decode(L,{stream:!0}),Ua=1}catch(a){}var Va=function(a){for(var b="",c=0;;){var d=a[c++],e=(d>127)+(d>223)+(d>239);if(c+e>a.length)return[b,A(a,c-1)];!e?b+=String.fromCharCode(d):e==3?(d=((d&15)<<18|(a[c++]&63)<<12|(a[c++]&63)<<6|a[c++]&63)-65536,b+=String.fromCharCode(55296|d>>10,56320|d&1023)):e&1?b+=String.fromCharCode((d&31)<<6|a[c++]&63):b+=String.fromCharCode((d&15)<<12|(a[c++]&63)<<6|a[c++]&63)}};Ba=function(){function a(a){this.ondata=a,Ua?this.t=new TextDecoder():this.p=L}a.prototype.push=function(a,c){if(!this.ondata)throw"no callback";c=!!c;if(this.t){this.ondata(this.t.decode(a,{stream:!0}),c);if(c){if(this.t.decode().length)throw"invalid utf-8 data";this.t=null}return}if(!this.p)throw"stream finished";var d=new b(this.p.length+a.length);d.set(this.p);d.set(a,this.p.length);a=Va(d);d=a[0];a=a[1];if(c){if(a.length)throw"invalid utf-8 data";this.p=null}else this.p=a;this.ondata(d,c)};return a}();l.DecodeUTF8=Ba;h=function(){function a(a){this.ondata=a}a.prototype.push=function(a,b){if(!this.ondata)throw"no callback";if(this.d)throw"stream finished";this.ondata(Wa(a),this.d=b||!1)};return a}();l.EncodeUTF8=h;function Wa(a,c){if(c){var d=new b(a.length);for(var e=0;e<a.length;++e)d[e]=a.charCodeAt(e);return d}if(Sa)return Sa.encode(a);d=a.length;var f=new b(a.length+(a.length>>1)),g=0,h=function(a){f[g++]=a};for(var e=0;e<d;++e){if(g+5>f.length){var i=new b(g+8+(d-e<<1));i.set(f);f=i}i=a.charCodeAt(e);i<128||c?h(i):i<2048?(h(192|i>>6),h(128|i&63)):i>55295&&i<57344?(i=65536+(i&1023<<10)|a.charCodeAt(++e)&1023,h(240|i>>18),h(128|i>>12&63),h(128|i>>6&63),h(128|i&63)):(h(224|i>>12),h(128|i>>6&63),h(128|i&63))}return A(f,0,g)}l.strToU8=Wa;function Xa(a,b){if(b){b="";for(var c=0;c<a.length;c+=16384)b+=String.fromCharCode.apply(null,a.subarray(c,c+16384));return b}else if(Ta)return Ta.decode(a);else{c=Va(a);b=c[0];a=c[1];if(a.length)throw"invalid utf-8 data";return b}}l.strFromU8=Xa;var Ya=function(a){return a==1?3:a<6?2:a==9?1:0},Za=function(a,b){return b+30+X(a,b+26)+X(a,b+28)},$a=function(a,b,c){var d=X(a,b+28),e=Xa(a.subarray(b+46,b+46+d),!(X(a,b+8)&2048));d=b+46+d;var f=Y(a,b+20);c=c&&f==4294967295?ab(a,d):[f,Y(a,b+24),Y(a,b+42)];f=c[0];var g=c[1];c=c[2];return[X(a,b+10),f,g,e,d+X(a,b+30)+X(a,b+32),c]},ab=function(a,b){for(;X(a,b)!=1;b+=4+X(a,b+2));return[la(a,b+12),la(a,b+4),la(a,b+20)]},bb=function(a){var b=0;if(a)for(var c in a){var d=a[c].length;if(d>65535)throw"extra field too long";b+=d+4}return b},cb=function(b,c,d,e,f,g,h,i){var a=e.length,j=d.extra,k=i&&i.length,l=bb(j);Z(b,c,h!=null?33639248:67324752),c+=4;h!=null&&(b[c++]=20,b[c++]=d.os);b[c]=20,c+=2;b[c++]=d.flag<<1|(g==null&&8),b[c++]=f&&8;b[c++]=d.compression&255,b[c++]=d.compression>>8;f=new Date(d.mtime==null?Date.now():d.mtime);var m=f.getFullYear()-1980;if(m<0||m>119)throw"date not in range 1980-2099";Z(b,c,m<<25|f.getMonth()+1<<21|f.getDate()<<16|f.getHours()<<11|f.getMinutes()<<5|f.getSeconds()>>>1),c+=4;g!=null&&(Z(b,c,d.crc),Z(b,c+4,g),Z(b,c+8,d.size));Z(b,c+12,a);Z(b,c+14,l),c+=16;h!=null&&(Z(b,c,k),Z(b,c+6,d.attrs),(Z(b,c+10,h),c+=14));b.set(e,c);c+=a;if(l)for(m in j){f=j[m];g=f.length;Z(b,c,+m);Z(b,c+2,g);b.set(f,c+4),c+=4+g}k&&(b.set(i,c),c+=k);return c},db=function(a,b,c,d,e){Z(a,b,101010256),Z(a,b+8,c),Z(a,b+10,c),Z(a,b+12,d),Z(a,b+16,e)},eb=function(){function a(a){this.filename=a,this.c=O(),this.size=0,this.compression=0}a.prototype.process=function(a,b){this.ondata(null,a,b)};a.prototype.push=function(a,b){if(!this.ondata)throw"no callback - add to ZIP archive before pushing";this.c.p(a);this.size+=a.length;b&&(this.crc=this.c.d());this.process(a,b||!1)};return a}();l.ZipPassThrough=eb;Ia=function(){function a(a,b){var c=this;b||(b={});eb.call(this,a);this.d=new ta(b,function(a,b){c.ondata(null,a,b)});this.compression=8;this.flag=Ya(b.level)}a.prototype.process=function(a,b){try{this.d.push(a,b)}catch(a){this.ondata(a,null,b)}};a.prototype.push=function(a,b){eb.prototype.push.call(this,a,b)};return a}();l.ZipDeflate=Ia;i=function(){function a(a,b){var c=this;b||(b={});eb.call(this,a);this.d=new ua(b,function(a,b,d){c.ondata(a,b,d)});this.compression=8;this.flag=Ya(b.level);this.terminate=this.d.terminate}a.prototype.process=function(a,b){this.d.push(a,b)};a.prototype.push=function(a,b){eb.prototype.push.call(this,a,b)};return a}();l.AsyncZipDeflate=i;Pa=function(){function a(a){this.ondata=a,this.u=[],this.d=1}a.prototype.add=function(c){var d=this;if(this.d&2)throw"stream finished";var e=Wa(c.filename),a=e.length,f=c.comment,g=f&&Wa(f);f=a!=c.filename.length||g&&f.length!=g.length;var h=a+bb(c.extra)+30;if(a>65535)throw"filename too long";a=new b(h);cb(a,0,c,e,f);var i=[a],j=function(){for(var a=0,b=i;a<b.length;a++){var c=b[a];d.ondata(null,c,!1)}i=[]},k=this.d;this.d=0;var l=this.u.length,m=R(c,{f:e,u:f,o:g,t:function(){c.terminate&&c.terminate()},r:function(){j();if(k){var a=d.u[l+1];a?a.r():d.d=1}k=1}}),n=0;c.ondata=function(a,e,f){if(a)d.ondata(a,e,f),d.terminate();else{n+=e.length;i.push(e);if(f){a=new b(16);Z(a,0,134695760);Z(a,4,c.crc);Z(a,8,n);Z(a,12,c.size);i.push(a);m.c=n,m.b=h+n+16,m.crc=c.crc,m.size=c.size;k&&m.r();k=1}else k&&j()}};this.u.push(m)};a.prototype.end=function(){var a=this;if(this.d&2){if(this.d&1)throw"stream finishing";throw"stream finished"}this.d?this.e():this.u.push({r:function(){if(!(a.d&1))return;a.u.splice(-1,1);a.e()},t:function(){}});this.d=3};a.prototype.e=function(){var c=0,d=0,e=0;for(var f=0,a=this.u;f<a.length;f++){var g=a[f];e+=46+g.f.length+bb(g.extra)+(g.o?g.o.length:0)}a=new b(e+22);for(var f=0,h=this.u;f<h.length;f++){var g=h[f];cb(a,c,g,g.f,g.u,g.c,d,g.o);c+=46+g.f.length+bb(g.extra)+(g.o?g.o.length:0),d+=g.b}db(a,c,this.u.length,e,d);this.ondata(null,a,!0);this.d=2};a.prototype.terminate=function(){for(var b=0,a=this.u;b<a.length;b++){var c=a[b];c.t()}this.d=2};return a}();l.Zip=Pa;function fb(a,c,d){d||(d=c,c={});if(typeof d!="function")throw"no callback";var e={};Ra(a,"",e,c);var f=Object.keys(e),g=f.length,h=0,i=0,j=g,k=new Array(g),l=[],m=function(){for(var a=0;a<l.length;++a)l[a]()},n=function(){var a=new b(i+22),c=h,e=i-h;i=0;for(var f=0;f<j;++f){var g=k[f];try{var l=g.c.length;cb(a,i,g,g.f,g.u,l);var m=30+g.f.length+bb(g.extra),n=i+m;a.set(g.c,n);cb(a,h,g,g.f,g.u,l,i,g.m),h+=16+m+(g.m?g.m.length:0),i=n+l}catch(a){return d(a,null)}}db(a,h,k.length,e,c);d(null,a)};g||n();a=function(b){var c=f[b],a=e[c],j=a[0],o=a[1],p=O(),q=j.length;p.p(j);var r=Wa(c),s=r.length,t=o.comment,u=t&&Wa(t),v=u&&u.length,w=bb(o.extra),x=o.level==0?0:8;a=function(a,e){if(a)m(),d(a,null);else{a=e.length;k[b]=R(o,{size:q,crc:p.d(),c:e,f:r,m:u,u:s!=c.length||u&&t.length!=v,compression:x});h+=30+s+w+a;i+=76+2*(s+w)+(v||0)+a;--g||n()}};s>65535&&a("filename too long",null);if(!x)a(null,j);else if(q<16e4)try{a(null,wa(j,o))}catch(b){a(b,null)}else l.push(va(j,o,a))};for(c=0;c<j;++c)a(c);return m}l.zip=fb;function gb(c,d){d||(d={});var e={},f=[];Ra(c,"",e,d);c=0;d=0;for(var g in e){var a=e[g],h=a[0];a=a[1];var i=a.level==0?0:8,j=Wa(g),k=j.length,l=a.comment,m=l&&Wa(l),n=m&&m.length,o=bb(a.extra);if(k>65535)throw"filename too long";var p=i?wa(h,a):h,q=p.length,r=O();r.p(h);f.push(R(a,{size:h.length,crc:r.d(),c:p,f:j,m:m,u:k!=g.length||m&&l.length!=n,o:c,compression:i}));c+=30+k+o+q;d+=76+2*(k+o)+(n||0)+q}a=new b(d+22);h=c;r=d-c;for(p=0;p<f.length;++p){var j=f[p];cb(a,j.o,j,j.f,j.u,j.c.length);m=30+j.f.length+bb(j.extra);a.set(j.c,j.o+m);cb(a,c,j,j.f,j.u,j.c.length,j.o,j.m),c+=16+m+(j.m?j.m.length:0)}db(a,c,f.length,r,h);return a}l.zipSync=gb;var hb=function(){function a(){}a.prototype.push=function(a,b){this.ondata(null,a,b)};a.compression=0;return a}();l.UnzipPassThrough=hb;Qa=function(){function a(){var a=this;this.i=new $(function(b,c){a.ondata(null,b,c)})}a.prototype.push=function(a,b){try{this.i.push(a,b)}catch(c){this.ondata(c,a,b)}};a.compression=8;return a}();l.UnzipInflate=Qa;Ba=function(){function a(a,b){var c=this;b<32e4?this.i=new $(function(a,b){c.ondata(null,a,b)}):(this.i=new xa(function(a,b,d){c.ondata(a,b,d)}),this.terminate=this.i.terminate)}a.prototype.push=function(a,b){this.i.terminate&&(a=A(a,0)),this.i.push(a,b)};a.compression=8;return a}();l.AsyncUnzipInflate=Ba;h=function(){function a(a){this.onfile=a,this.k=[],this.o={0:hb},this.p=L}a.prototype.push=function(a,c){var d=this;if(!this.onfile)throw"no callback";if(!this.p)throw"stream finished";if(this.c>0){var e=Math.min(this.c,a.length),f=a.subarray(0,e);this.c-=e;this.d?this.d.push(f,!this.c):this.k[0].push(f);a=a.subarray(e);if(a.length)return this.push(a,c)}else{f=0;var g=0;e=void 0;var h=void 0;!this.p.length?h=a:!a.length?h=this.p:(h=new b(this.p.length+a.length),(h.set(this.p),h.set(a,this.p.length)));var i=h.length,j=this.c;a=j&&this.d;var k=function(){var a=Y(h,g);if(a==67324752){f=1,e=g;l.d=null;l.c=0;var b=X(h,g+6),c=X(h,g+8),k=b&2048;b=b&8;var m=X(h,g+26),n=X(h,g+28);if(i>g+30+m+n){var o=[];l.k.unshift(o);f=2;var p=Y(h,g+18),q=Y(h,g+22),r=Xa(h.subarray(g+30,g+=30+m),!k);p==4294967295?(m=b?[-2]:ab(h,g),p=m[0],q=m[1]):b&&(p=-1);g+=n;l.c=p;var s,t={name:r,compression:c,start:function(){if(!t.ondata)throw"no callback";if(!p)t.ondata(null,L,!0);else{var a=d.o[c];if(!a)throw"unknown compression type "+c;s=p<0?new a(r):new a(r,p,q);s.ondata=function(c,b,a){t.ondata(c,b,a)};for(var a=0,b=o;a<b.length;a++){var e=b[a];s.push(e,!1)}d.k[0]==o&&d.c?d.d=s:s.push(L,!0)}},terminate:function(){s&&s.terminate&&s.terminate()}};p>=0&&(t.size=p,t.originalSize=q);l.onfile(t)}return"break"}else if(j)if(a==134695760){e=g+=12+(j==-2&&8),f=3,l.c=0;return"break"}else if(a==33639248){e=g-=4,f=3,l.c=0;return"break"}},l=this;for(;g<i-4;++g){var m=k();if(m==="break")break}this.p=L;if(j<0){m=f?h.subarray(0,e-12-(j==-2&&8)-(Y(h,e-16)==134695760&&4)):h.subarray(0,g);a?a.push(m,!!f):this.k[+(f==2)].push(m)}if(f&2)return this.push(h.subarray(g),c);this.p=h.subarray(g)}if(c){if(this.c)throw"invalid zip file";this.p=null}};a.prototype.register=function(a){this.o[a.compression]=a};return a}();l.Unzip=h;function ib(a,c){if(typeof c!="function")throw"no callback";var d=[],e=function(){for(var a=0;a<d.length;++a)d[a]()},f={},g=a.length-22;for(;Y(a,g)!=101010256;--g)if(!g||a.length-g>65558){c("invalid zip file",null);return}var h=X(a,g+8);h||c(null,{});var i=h,j=Y(a,g+16),k=j==4294967295;if(k){g=Y(a,g-12);if(Y(a,g)!=101075792){c("invalid zip file",null);return}i=h=Y(a,g+32);j=Y(a,g+48)}g=function(g){g=$a(a,j,k);var i=g[0],l=g[1],m=g[2],n=g[3],o=g[4];g=g[5];g=Za(a,g);j=o;o=function(a,b){a?(e(),c(a,null)):(f[n]=b,--h||c(null,f))};if(!i)o(null,A(a,g,g+l));else if(i==8){g=a.subarray(g,g+l);if(l<32e4)try{o(null,za(g,new b(m)))}catch(a){o(a,null)}else d.push(ya(g,{size:m},o))}else o("unknown compression type "+i,null)};for(var l=0;l<i;++l)g(l);return e}l.unzip=ib;function jb(c){var d={},e=c.length-22;for(;Y(c,e)!=101010256;--e)if(!e||c.length-e>65558)throw"invalid zip file";var f=X(c,e+8);if(!f)return{};var g=Y(c,e+16),h=g==4294967295;if(h){e=Y(c,e-12);if(Y(c,e)!=101075792)throw"invalid zip file";f=Y(c,e+32);g=Y(c,e+48)}for(e=0;e<f;++e){var a=$a(c,g,h),i=a[0],j=a[1],k=a[2],l=a[3],m=a[4];a=a[5];a=Za(c,a);g=m;if(!i)d[l]=A(c,a,a+j);else if(i==8)d[l]=za(c.subarray(a,a+j),new b(k));else throw"unknown compression type "+i}return d}l.unzipSync=jb}var o=!1;function p(){o||(o=!0,n());return m.exports}function a(a){switch(a){case void 0:return p()}}e.exports=a}),null);
__d("fflate",["fflate-0.6.10"],(function(a,b,c,d,e,f){e.exports=b("fflate-0.6.10")()}),null);
__d("WAGzip",["Promise","WAErr","fflate"],(function(a,b,c,d,e,f,g){"use strict";var h,i=function(b){babelHelpers.inheritsLoose(a,b);function a(a){var c;c=b.call(this,a)||this;c.$GzipWrapper2=[];c.ondata=function(a,b){c.$GzipWrapper2.push(a);if(!b)return;var d=0;c.$GzipWrapper2.forEach(function(a){d+=a.length});var e=new Uint8Array(d),f=0;c.$GzipWrapper2.forEach(function(a){e.set(a,f),f+=a.length});c.$GzipWrapper1=e};return c}var e=a.prototype;e.push=function(a,e){if(this.$GzipWrapper1!=null)throw c("WAErr")("Tried to push chunk to compressor after final block");a instanceof Uint8Array?b.prototype.push.call(this,a,e):a instanceof ArrayBuffer?b.prototype.push.call(this,new Uint8Array(a),e):b.prototype.push.call(this,d("fflate").strToU8(a),e)};e.result=function(){if(this.$GzipWrapper1==null)throw c("WAErr")("Tried to access result before adding final block");return this.$GzipWrapper1};return a}(d("fflate").Gzip);function a(a){a===void 0&&(a={});return new i(a)}function j(a){return d("fflate").decompressSync(a)}function e(a){return(h||(h=b("Promise"))).resolve(j(a))}g.GzipWrapper=i;g.createDeflate=a;g.inflate=j;g.gzipInflate=e}),98);
__d("MAWDebug",["MAWAdminWriteCutoverThreadMsgTxn","MAWBridge","MAWBulkHandleIncomingMsgApi","MAWConfig","MAWCreateThreadThroughMI","MAWDbAddDeviceChangeAlertsTxn","MAWDbAppDataTxns","MAWDbChunkTxns","MAWDbEditMsgHistoryTxns","MAWDbGetDeviceChangeAlertsByOptionsTxn","MAWDbGetDeviceChangeAlertsTxn","MAWDbGetUnArchivedDeviceChangeAlertsCountTxn","MAWDbGroupInfoTxns","MAWDbGroupInviteTxns","MAWDbMediaTxns","MAWDbMsgTxns","MAWDbMsgTypeVersionTxns","MAWDbObjDecode","MAWDbObjEncode","MAWDbParticipantTxns","MAWDbPendingReceiptTxns","MAWDbReactionsTxns","MAWDbThreadTxns","MAWDbUnrenderedMsgTxns","MAWDbUpdateDeviceChangeAlertsLogInStatusTxn","MAWDbUpdateDeviceChangeAlertsTxn","MAWDbVersion","MAWDbXMATxns","MAWDebugHydrateOfflineQueue","MAWDebugSendMultipleMsgs","MAWEncryptedBackupCacheManager","MAWEphemeralCleaner","MAWEphemeralSettingsTxns","MAWExternalId","MAWHandleEchoMsgsRestoreApiV2","MAWJobDefinitions","MAWJobManager","MAWKeychainCrypto","MAWKeychainNaClCrypto","MAWLoadMsgsApi","MAWMediaUtils","MAWSendSenderKeyDistributionMsg","MAWTransactionMode","MAWTransactor","MAWVault","MWEARKeychainV3","OfflineThreadingId","Promise","WAAPI","WAAbPropsInit","WAArmadilloXMA.pb","WACompareIdentity","WADbContactsTxns","WADbIdentityTxns","WADbMetaTxns","WADbPersonalSenderKeyStatusTxns","WADbPrekeyTxns","WADbSenderKeySessionTxns","WADbSessionTxns","WADbSignal","WADbSignedPrekeyTxns","WADbTransactor","WADevicesState","WAExceededStorageQuota","WAGatherMediaInfo","WAGetContactAndIdentitiesApi","WAGlobals","WAGzip","WAHandleFailureUtils","WAJids","WAJobOrchestratorTypes","WALogger","WAMediaUtils","WAPREList","WAPREMetrics","WAProtocolQueue","WARotateSignedPreKey","WASignalKeys","WASignalOther","WATimeUtils","WebStorageEstimator","asyncToGeneratorRuntime","err","gkx","promiseDone","unrecoverableViolation"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["",""]);i=function(){return a};return a}var j={UNSAFE_changeMyIdentity:function(){void m({meta:d("MAWTransactionMode").READWRITE})(function(a){return a.meta.put({key:d("WADbSignal").MetaKeysEnum.identityKeyPair,value:{identityKeyPair:d("WASignalKeys").makeKeyPair()}}).then(function(){})})()},addBadProtocolQueueInstruction:function(){var a={instruction:"bad",type:"instruction"};return d("WAProtocolQueue").protocolQueue().addAndCommit([a])},addDeviceChangeAlerts:function(a){return k(l({deviceChangeAlerts:d("MAWTransactionMode").READWRITE})(d("MAWDbAddDeviceChangeAlertsTxn").addDeviceChangeAlertsTxn)(a))},addGroupParticipants:function(a,b){return d("MAWJobManager").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.addGroupParticipants(a,b))},addICDCAlert:function(a){return d("WAGlobals").getWaOneQueue().enqueue(function(){void d("WAProtocolQueue").protocolQueue().addPending({instruction:"icdcError",jid:a,notificationTs:d("WATimeUtils").unixTime(),priority:d("WAProtocolQueue").WAProtocolQueuePriorityLow,type:"instruction"});return(h||(h=b("Promise"))).resolve()},{flush:!0,operationType:"debug_operation"}).then(function(){})},checkStorageQuota:function(){return d("WAExceededStorageQuota").checkStorageQuota()},clearICDCInfo:function(a){return k(m({contacts:d("MAWTransactionMode").READWRITE})(function(b){return b.contacts.get(a).then(function(a){if(a!=null){a.icdcInfo=void 0;a.icdcFails=void 0;a.lastSyncTs=d("WATimeUtils").unixTime();return b.contacts.put(a).then(function(){return"contact-updated"})}return"contact-missing"})})())},compareIdentity:function(){return k(m({identity:d("MAWTransactionMode").READONLY,meta:d("MAWTransactionMode").READONLY})(d("WACompareIdentity").compareIdentityDexie)())},createGroup:function(a,b,c){return d("MAWJobManager").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").createStartJobInfo("createGroup",{extras:{clientThreadKey:c,platform:"msgr"},key:c,subject:a,users:b}))},createThread:function(a){return d("MAWBridge").getBridge().sendAndReceive("backend","createThread",{contactFbid:a,description:"MAWDebug",threadKey:d("OfflineThreadingId").createOfflineThreadingID()})},createThreadThroughMI:function(a,b,c,e){return d("MAWCreateThreadThroughMI").createThreadThroughMI({authoritativeThreadKey:a,chatJid:b,description:"MAWDebug",lastActivityTimestampMs:c,lastReadWatermarkTimestampMs:e,numOfMsgsToLoad:1}).then(function(){})},decodeEAR:function(a,b){return d("MAWDbObjDecode").decodeDbObj(a,b)},decryptEARTweetNaCl:function(a,b){return d("MAWKeychainNaClCrypto").decryptTweetNaCl(a,b)},decryptWithKeyVersion:function(a,b){var c=d("MWEARKeychainV3").getDbEncryptionKey(a);c=c.key;return d("MAWKeychainNaClCrypto").decrypt(c,b,a)},deflate:function(a){var b=d("WAGzip").createDeflate();b.push(a,!0);return b.result()},deleteGroupInvitesByThreadAndInvitedParticipant:function(a,b){return k(l({groupInvites:d("MAWTransactionMode").READWRITE})(d("MAWDbGroupInviteTxns").deleteGroupInvitesByThreadAndInvitedParticipant)(a,b))},demoteGroupParticipants:function(a,b){return d("MAWJobManager").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.demoteGroupParticipants(a,b))},deregisterPhone:function(){c("promiseDone")(d("WAHandleFailureUtils").deregisterPhone())},dropExpiredMessagesFromDB:function(){var a=d("MAWEphemeralCleaner").getEphemeralCleaner_FOR_TESTING_ONLY();if(a)a.backend.update(d("WATimeUtils").futureUnixTime(5));else throw c("err")("Cannot delete expired msgs as cleaner is not initialized!")},dropExpiredMessagesFromUI:function(){var a=d("MAWEphemeralCleaner").getEphemeralCleaner_FOR_TESTING_ONLY();if(a)a.ui.update(d("WATimeUtils").futureUnixTime(5));else throw c("err")("Cannot delete expired msgs as cleaner is not initialized!")},encodeEAR:function(a,b){return d("MAWDbObjEncode").encodeDbObj(a,b)},encryptEARTweetNaCl:function(a,b,c){return d("MAWKeychainNaClCrypto").encryptTweetNaCl(a,b,c)},establishOutgoingSession:function(a,b){return c("WAAPI").preEstablishSession({groupJid:a,userJids:b})},estimateStorage:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("WebStorageEstimator").estimateStorage());return a});function c(){return a.apply(this,arguments)}return c}(),executeQuery:function(a){var b=Object.keys(d("MAWDbVersion").CURRENT_MAW_STORES).filter(function(a){return d("MAWDbVersion").CURRENT_MAW_STORES[a]!=null}).reduce(function(a,b){return babelHelpers["extends"]({},a,(a={},a[b+""]=d("MAWTransactionMode").READWRITE,a))},{});return l(b)(a)()},forwardMsg:function(a,b){return d("MAWJobManager").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").createStartJobInfo("forwardMsg",{chatJid:a,externalId:d("MAWExternalId").generateExternalId(),protocolMsgId:b}))},fromUnixTime:function(a){return d("WATimeUtils").toDate(a)},gatherMediaInfo:function(){c("promiseDone")(d("WAGatherMediaInfo").gatherMediaInfo())},generateAndUploadPreKeys:function(){return c("WAAPI").generateAndUploadPreKeys({reason:"test"})},generateAndUploadPreKeysMultipleCalls:function(){return(h||(h=b("Promise"))).all([c("WAAPI").generateAndUploadPreKeys({reason:"test"}),c("WAAPI").generateAndUploadPreKeys({reason:"test"}),c("WAAPI").generateAndUploadPreKeys({reason:"test"})])},generateMessagesForChat:function(a,b){return d("MAWBulkHandleIncomingMsgApi").bulkHandleIncomingMsgs(Array.from({length:b}).map(function(b,c){b=d("WATimeUtils").castMilliSecondsToUnixTime(Date.now());var e=d("MAWExternalId").generateExternalId();c={ack:2,altIndex:void 0,author:"@me",externalId:e,msgContent:{content:"Stub message #"+c},serverTs:b,ts:b,type:"Text"};return{msgData:{device:{id:d("WAJids").extractDeviceId(d("WAGlobals").getMyDeviceJid()),identity:null},folder:null,id:{author:"@me",chat:a,externalId:e},msg:{encoded:new Uint8Array(0),version:"v2"},recipientsCount:null,reportingMeta:null,ts:b,type:"IncomingMsg"},receiveFlow:d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.RECEIVE_MESSAGE,{}),unstoredContent:{unstoredDbMedia:null,unstoredDbMsg:c,unstoredDbReaction:null,unstoredDbReceiverFetchInfo:null}}})).then(function(){})},getAbProp:function(a){return d("WAAbPropsInit").getAbProp(a)},getAbProps:function(){return d("WAAbPropsInit").getAbProps()},getAllMessageIdsAndRangesForThread:function(a,b){return d("MAWBridge").getBridge().sendAndReceive("backend","getAllMessageIdsAndRangesForThread",{chatJid:a,limit:b})},getAppDatas:function(a){return k(l({appData:d("MAWTransactionMode").READONLY})(d("MAWDbAppDataTxns").bulkGetAppData)(a))},getAppMetaByKey:function(a){return k(l({appMeta:d("MAWTransactionMode").READONLY})(d("MAWDbMsgTypeVersionTxns").getAppMetaValue)(a))},getChunksByChunkId:function(a){return k(l({chunk:d("MAWTransactionMode").READONLY})(d("MAWDbChunkTxns").bulkGetChunks)(a))},getConfig:function(){return Object.fromEntries(Object.entries(d("MAWConfig").getConfig()).map(function(a){var b=a[0];a=a[1];var c;a;try{c=a()}catch(b){c=a}return[b,c]}))},getContacts:function(a){return k(m({contacts:d("MAWTransactionMode").READONLY})(d("WADbContactsTxns").getContacts)(a))},getCurrentUserDeviceList:function(){return c("WAAPI").getCurrentUserDeviceList()},getDeviceChangeAlerts:function(a){return k(l({deviceChangeAlerts:d("MAWTransactionMode").READWRITE})(d("MAWDbGetDeviceChangeAlertsTxn").getDeviceChangeAlertsTxn)(a))},getDeviceChangeAlertsByOptions:function(a){return k(l({deviceChangeAlerts:d("MAWTransactionMode").READWRITE})(d("MAWDbGetDeviceChangeAlertsByOptionsTxn").getDeviceChangeAlertsByOptionsTxn)(a))},getDeviceChangeAlertsByOptionsLLA:function(a){return d("MAWBridge").getBridge().sendAndReceive("backend","getDeviceChangeAlertsByOptions",{options:a})},getDevices:function(a,b){return c("WAAPI").getDevices({ignoreDhash:b,reason:"debug",users:new Set(a)})},getDevicesState:function(){return d("WADevicesState").getDevicesState()},getEAREncryptKeyVersion:function(a){return d("MAWKeychainCrypto").getKeyVersionFromCipherDataString(a)},getEBRestoreCache:function(){return d("MAWEncryptedBackupCacheManager").restoredCache},getEditMsgHistoryByEditMsgHistoryId:function(a){return k(l({editMsgHistory:d("MAWTransactionMode").READONLY})(d("MAWDbEditMsgHistoryTxns").bulkGetEditMsgHistorys)(a))},getEditMsgHistoryByProtocolMsgId:function(a){return k(l({editMsgHistory:d("MAWTransactionMode").READONLY})(d("MAWDbEditMsgHistoryTxns").maybeGetEditMsgHistoryFromProtocolMsgId)(a))},getGroupInfosByGroupJid:function(a){return k(l({groupInfo:d("MAWTransactionMode").READONLY})(d("MAWDbGroupInfoTxns").getGroupInfos)(a))},getGroupInvite:function(a,b){return k(l({groupInvites:d("MAWTransactionMode").READONLY})(d("MAWDbGroupInviteTxns").maybeGetGroupInvite)(a,b))},getGroupInvitesByThreadAndInvitedParticipant:function(a,b){return k(l({groupInvites:d("MAWTransactionMode").READONLY})(d("MAWDbGroupInviteTxns").getGroupInvitesByThreadAndInvitedParticipant)(a,b))},getHmacKeyFromGlobals:function(){return d("WAGlobals").getHMACKey()},getIdentityByDeviceJid:function(a){return k(m({identity:d("MAWTransactionMode").READONLY})(d("WADbIdentityTxns").bulkGetIdentityRows)(a))},getMediaBackupForObjectId:function(a){return k(l({mediaBackup:d("MAWTransactionMode").READONLY})(d("MAWDbMediaTxns").maybeGetMediaBackupRowFromObjectId)(a))},getMediaByIdWithDecodedMediaEntries:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield l({media:d("MAWTransactionMode").READONLY})(d("MAWDbMediaTxns").bulkGetMedias)(a));a.forEach(function(a){if(!(a==null?void 0:a.mediaEntries))return;a.mediaEntries=new Map(Array.from(a.mediaEntries,function(a){var b=a[0];a=a[1];return[b,d("WAMediaUtils").decodeMediaEntryData(a)]}))});return k((h||(h=b("Promise"))).resolve(a))});function c(b){return a.apply(this,arguments)}return c}(),getMediaByMediaId:function(a){return k(l({media:d("MAWTransactionMode").READONLY})(d("MAWDbMediaTxns").bulkGetMedias)(a))},getMessagesByMsgIds:function(a){return k(l({messages:d("MAWTransactionMode").READONLY})(function(b){return b.messages.where("msgId").anyOf(a).toArray().then(function(a){return a.filter(Boolean)})})(a))},getMeta:function(){return k(m({meta:d("MAWTransactionMode").READONLY})(d("WADbMetaTxns").getAllMeta)())},getMsgsByChat:function(a){return k(l({messages:d("MAWTransactionMode").READONLY})(function(b){return b.messages.where("threadJid").equals(a).toArray()})())},getMsgsByMsgId:function(a){return k(l({messages:d("MAWTransactionMode").READONLY})(d("MAWDbMsgTxns").getMsgsByMsgIds)(a))},getMsgsByProtocolMsgId:function(a){return k(l({messages:d("MAWTransactionMode").READONLY})(d("MAWDbMsgTxns").getMsgsByProtocolMsgId)(a))},getParticipantsByParticipantKeys:function(a){return k(l({participants:d("MAWTransactionMode").READONLY})(d("MAWDbParticipantTxns").bulkGetParticipants)(a))},getPendingReceipts:function(a){return k(l({pendingReceipts:d("MAWTransactionMode").READONLY})(d("MAWDbPendingReceiptTxns").getPendingReceipts)(a))},getPersonalSenderKeyStatusesByGroupJid:function(a){return k(m({personalSenderKeyStatuses:d("MAWTransactionMode").READONLY})(d("WADbPersonalSenderKeyStatusTxns").bulkGetPersonalSenderKeyStatuses)(a))},getPrekeyByPrekeyId:function(a){return k(m({prekey:d("MAWTransactionMode").READONLY})(d("WADbPrekeyTxns").getPrekeys)(a))},getPrekeyGenerationByGenerationId:function(a){return k(m({prekeyGeneration:d("MAWTransactionMode").READONLY})(d("WADbPrekeyTxns").getPrekeyGenerations)(a))},getProtocolMsgId:function(a){return d("MAWBridge").getBridge().sendAndReceive("backend","getProtocolMsgIdByMsgId",{msgId:a})},getReactionByReactToMsgId:function(a){return k(l({messages:d("MAWTransactionMode").READONLY,reactions:d("MAWTransactionMode").READONLY})(function(b){return b.messages.where("msgId").anyOf(a).toArray().then(function(a){return d("MAWDbReactionsTxns").getReactionsFromMessages(b,a)})})(a))},getReceiptByWAMsgId:function(a){return k(m({receipts:d("MAWTransactionMode").READONLY})(function(a,b){return a.receipts.get({waMsgId:b})})(a))},getSenderKeySessionsBySenderKeySessionId:function(a){return k(m({senderKeySessions:d("MAWTransactionMode").READWRITE})(d("WADbSenderKeySessionTxns").getSenderKeySessionsBySenderKeySessionId)(a))},getSessionsByDeviceJid:function(a){return k(m({session:d("MAWTransactionMode").READONLY})(d("WADbSessionTxns").bulkGetSessions)(a))},getSignedPrekesByPrekeyId:function(a){return k(m({signedPrekey:d("MAWTransactionMode").READONLY})(d("WADbSignedPrekeyTxns").getSignedPrekeys)(a))},getThreadsByChatJids:function(a){return k(l({threads:d("MAWTransactionMode").READONLY})(d("MAWDbThreadTxns").getThreads)(a))},getUnArchivedDeviceChangeAlertsCount:function(){return k(l({deviceChangeAlerts:d("MAWTransactionMode").READWRITE})(d("MAWDbGetUnArchivedDeviceChangeAlertsCountTxn").getUnArchivedDeviceChangeAlertsCountTxn)())},getUnrenderedMsgsByMsgId:function(a){return k(l({unrenderedMessages:d("MAWTransactionMode").READONLY})(d("MAWDbUnrenderedMsgTxns").getUnrenderedMsgsByMsgIds)(a))},getXMAByXMAId:function(a){return k(l({xma:d("MAWTransactionMode").READONLY})(d("MAWDbXMATxns").bulkGetXMAs)(a))},handleEchoMsgsBulkRestore:function(a,b,c,e,f,g,h,i){return k(d("MAWHandleEchoMsgsRestoreApiV2").handleEchoMsgsBulkRestore(a,b,c,e,f,g,h,i,void 0,void 0,void 0,void 0,void 0,!1))},hmacPlaintextHash:function(a){return d("MAWMediaUtils").genHMACPlaintextHash(a)},hydrateOfflineQueue:d("MAWDebugHydrateOfflineQueue").hydrateOfflineQueue.execute,inflate:function(a){return d("WAGzip").inflate(a)},leaveGroups:function(a){return d("MAWJobManager").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.leaveGroups(a))},loadMsgs:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b;b=(yield d("MAWLoadMsgsApi").loadMsgsFromTs(a.chatJid,(b=a.numMsgs)!=null?b:10,a.direction,a.sortOrderMs,a.loadOriginalMsg,a.msgId,{admin:!0,editMsgHistory:!0,media:!0,reactions:!0,receiverFetch:!0,xma:!0}));return babelHelpers["extends"]({},b,{msgs:b.msgs.map(function(a){return babelHelpers["extends"]({},a,{content:a.content!=null?d("MAWVault").unvault(a.content):""})})})});function c(b){return a.apply(this,arguments)}return c}(),makeError:function(a){throw c("unrecoverableViolation")(a,"messenger_web_devx",{error:c("err")(a)})},makeWAError:function(a){d("WALogger").ERROR(i(),a)},markThreadAsRead:function(a,b,c){return d("MAWJobManager").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.markThreadAsRead(a,null,!1,!1,b,c,{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION}))},notifyDeviceChange:function(a){return c("WAAPI").notifyDeviceChange({users:a})},overrideAbProp:function(a,b){d("WAAbPropsInit").overrideAbProp(a,b)},promoteGroupParticipants:function(a,b){return d("MAWJobManager").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.promoteGroupParticipants(a,b))},protocolQueue:function(){return d("WAProtocolQueue").protocolQueue()},putGroupInvite:function(a){return k(l({groupInvites:d("MAWTransactionMode").READWRITE})(d("MAWDbGroupInviteTxns").putGroupInvite)(a))},putNewPersonalSenderKeyStatus:function(a){return m({personalSenderKeyStatuses:d("MAWTransactionMode").READWRITE})(d("WADbPersonalSenderKeyStatusTxns").putNewPersonalSenderKeyStatus)(a)},queryAllGroups:function(){return c("WAAPI").queryGroups({type:"all"}).then(function(){})},readProtocolQueue:function(){return d("WAProtocolQueue").protocolQueue().read()},removeDevice:function(a,b){return c("WAAPI").removeDevice({deviceId:a,identity:b})},removeGroupParticipants:function(a,b){return d("MAWJobManager").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.removeGroupParticipants(a,b))},reportUserSpam:function(a,b){return d("MAWJobManager").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.reportUserSpam(a,"frx",b,!1,["harassment"],"fake debug context"))},reregisterPhone:function(){return d("WAHandleFailureUtils").reregisterPhone()},restoreMessagesFromEncryptedBackups:function(a,b,c,e,f,g,h,i,j,l){return k(d("MAWJobManager").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.restoreMessagesFromEncryptedBackups(a,b,c,e,f,g,h,i,j,l)))},revokeMsg:function(a){return d("MAWJobManager").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.revokeMsgs({msgIds:[a]}))},rotateSignedPreKey:function(){return d("WARotateSignedPreKey").rotateSignedPreKey()},sendAppData:function(a,b){return d("MAWJobManager").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.sendAppData({contents:a,deviceJids:b}))},sendEditMsg:function(a,b){return d("MAWJobManager").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.sendEditMsg(a,b))},sendEphemeralSettingMsg:function(a,b){return d("MAWJobManager").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.sendEphemeralSettingMsg(a,b))},sendInvisibleMsg:function(a){return d("MAWSendSenderKeyDistributionMsg").sendSenderKeyDistributionMsg(a,d("MAWExternalId").generateExternalId())},sendInvisibleMsgToAllExistingGroups:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield l({groupInfo:d("MAWTransactionMode").READONLY})(function(a){return a.groupInfo.toArray()})()),b=[];for(a of a)b.push(d("MAWSendSenderKeyDistributionMsg").sendSenderKeyDistributionMsg(a.groupJid,d("MAWExternalId").generateExternalId()));return b});function c(){return a.apply(this,arguments)}return c}(),sendMessageTooAllExistingGroups:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield l({groupInfo:d("MAWTransactionMode").READONLY})(function(a){return a.groupInfo.toArray()})()),b=[];for(a of a)b.push(j.sendMsg(a.groupJid,{content:"message to "+a.groupJid+" at "+new Date().getTime()}));return b});function c(){return a.apply(this,arguments)}return c}(),sendMsg:function(a,b){return d("MAWJobManager").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.sendMsg(a,b))},sendMultipleMsgs:d("MAWDebugSendMultipleMsgs").sendMultipleMsgs.execute,sendRavenActionMsg:function(a,b){return d("MAWJobManager").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.sendRavenActionMsg(a,b))},sendReaction:function(a,b,c,e){return d("MAWJobManager").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.sendReactionMsg(a,b,c,e))},sendXMAShareMsg:function(a,b,c,e){var f=new File(["Hello"],"aaa",{type:"image/jpeg"});return d("MAWJobManager").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.sendXMAShareMsg(a,{file:f,height:0,width:0},void 0,void 0,(a=c)!=null?a:"hey",babelHelpers["extends"]({},b,{xmaMessageType:d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_REPLY}),void 0,void 0,e))},setEphemeralSettingWithoutUpdate:function(a,b,c,e){c=c==null?d("WATimeUtils").unixTime():d("WATimeUtils").futureUnixTime(c);return k(l({ephemeralSettings:d("MAWTransactionMode").READWRITE,groupInfo:d("MAWTransactionMode").READONLY,messages:d("MAWTransactionMode").READWRITE,threads:d("MAWTransactionMode").READWRITE})(d("MAWEphemeralSettingsTxns").handleAndWriteOutgoingUserEphemeralSettingChange)(a,b,c,e))},setGroupSubject:function(a,b){return d("MAWJobManager").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.setGroupSubject(a,b))},setICDCData:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c){var e=(yield d("WAGetContactAndIdentitiesApi").getContactAndIdentitiesForUser(a));if(!e.success)return"generateICDCInfo failed with error "+e.error;else if(e.value==null)return"Could not find contact info";var f=e.value.contact,g=f.icdcInfo;if(g==null)return"Could not find contact ICDC info";var h=g.sequence;c.sequenceInc!=null&&(h=g.sequence+c.sequenceInc);var i=d("WAJids").interpretAsDeviceId(999);yield d("WAGlobals").getWaOneQueue().enqueue(function(){var f=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){b=b.cryptoManager;if(c.additionDevices==="inject"){var f=d("WASignalOther").makeBytes(33);f[0]=5;e.value.identities.push({deviceJid:d("WAJids").toDeviceJid(a,i),identity:f});yield b.storage.updateUserDevicesInfo([{devices:e.value.identities.map(function(a){var b=a.deviceJid;a=a.identity;return{id:d("WAJids").extractDeviceId(b),identity:a}}),dhash:null,icdcInfo:null,jid:a,lastSyncTs:d("WATimeUtils").unixTime(),notificationTs:null}])}else c.additionDevices==="clear"&&(yield b.storage.updateUserDevicesInfo([{devices:e.value.identities.filter(function(b){return b.deviceJid!==d("WAJids").toDeviceJid(a,i)}).map(function(a){var b=a.deviceJid;a=a.identity;return{id:d("WAJids").extractDeviceId(b),identity:a}}),dhash:null,icdcInfo:null,jid:a,lastSyncTs:d("WATimeUtils").unixTime(),notificationTs:null}]))});return function(a){return f.apply(this,arguments)}}(),{afterInit:!0,flush:!0,operationType:"debug_operation"});return k(m({contacts:d("MAWTransactionMode").READWRITE})(function(b){return b.contacts.get(a).then(function(a){if(a!=null){a.icdcInfo=babelHelpers["extends"]({},g,{sequence:h});c.resetICDCError===!0&&(a.icdcFails=void 0);a.lastSyncTs=d("WATimeUtils").unixTime();return b.contacts.put(a).then(function(){return"contact-updated"})}return"contact-missing"})})())});function c(b,c){return a.apply(this,arguments)}return c}(),syncAbProps:function(a){a=a!==!0;return c("WAAPI").syncAbProps({sendHash:a})},updateDeviceChangeAlerts:function(a){return k(l({deviceChangeAlerts:d("MAWTransactionMode").READWRITE})(d("MAWDbUpdateDeviceChangeAlertsTxn").updateDeviceChangeAlertsTxn)(a))},updateDeviceChangeAlertsLLA:function(a){return d("MAWBridge").getBridge().sendAndReceive("backend","updateDeviceChangeAlerts",{alert:a})},updateDeviceChangeAlertsLogInStatus:function(a){return k(l({deviceChangeAlerts:d("MAWTransactionMode").READWRITE})(d("MAWDbUpdateDeviceChangeAlertsLogInStatusTxn").updateDeviceChangeAlertsLogInStatusTxn)(a))},uploadRetroactiveThreadsAndMessages:function(){return k(d("MAWJobManager").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.uploadRetroactiveThreadsAndMessages()))},writeCutoverThreadAdminMsg:function(a,b){var c;return k(l({chunk:(c=d("MAWTransactionMode")).READONLY,ftsBackloggedMessages:c.READWRITE,groupInfo:c.READONLY,media:c.READONLY,messages:c.READWRITE,threads:c.READWRITE})(d("MAWAdminWriteCutoverThreadMsgTxn").writeCutoverThreadAdminMsg)(a,b))},writeRollbackCutoverThreadAdminMsg:function(a){a=l({threads:d("MAWTransactionMode").READONLY})(d("MAWDbThreadTxns").getThread)(a);return a.then(function(a){if(!a.success)return(h||(h=b("Promise"))).resolve();a=a.value;return k(l({chunk:d("MAWTransactionMode").READONLY,ftsBackloggedMessages:d("MAWTransactionMode").READWRITE,groupInfo:d("MAWTransactionMode").READONLY,media:d("MAWTransactionMode").READONLY,messages:d("MAWTransactionMode").READWRITE,threads:d("MAWTransactionMode").READWRITE})(d("MAWAdminWriteCutoverThreadMsgTxn").writeRollbackCutoverAdminMsg)(a))})}};function k(a){return a.then(function(a){return a})}c("gkx")("23903")&&(self.Debug=j,self.WAAPI=c("WAAPI"));function l(a){return function(b){return d("MAWTransactor").makeMsgrTransactor(a,"debug",function(a){return function(){for(var c=arguments.length,d=new Array(c),e=0;e<c;e++)d[e]=arguments[e];return b.apply(void 0,[a].concat(d))}})}}function m(a){return function(b){return d("WADbTransactor").makeSignalTransactor(a,"debug",function(a){return function(){for(var c=arguments.length,d=new Array(c),e=0;e<c;e++)d[e]=arguments[e];return b.apply(void 0,[a].concat(d))}})}}g.MAWDebugFuncs=j}),98);
__d("XPolarisIGXAPIDirectInstamadilloRestoreCDNUrlControllerRouteBuilder",["jsRouteBuilder"],(function(a,b,c,d,e,f,g){a=c("jsRouteBuilder")("/api/v1/direct_v2/restoration_cdn_url/",Object.freeze({}),void 0);b=a;g["default"]=b}),98);
__d("endpoints",["CSRFGuard","PolarisConfig","Promise","XHRRequest","XPolarisIGXAPIDirectInstamadilloRestoreCDNUrlControllerRouteBuilder","getAsyncParams"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){return new(h||(h=b("Promise")))(function(b,e){var f=c("getAsyncParams")("POST"),g=new(c("XHRRequest"))(c("XPolarisIGXAPIDirectInstamadilloRestoreCDNUrlControllerRouteBuilder").buildURL({}));g.setMethod("POST").setRequestHeader("X-IG-App-ID",d("PolarisConfig").getIGAppID()).setData(babelHelpers["extends"]({},f,{payload:a})).setResponseHandler(function(a){try{a=a.trim();d("CSRFGuard").exists(a)&&(a=d("CSRFGuard").clean(a));a=JSON.parse(a);b(a.payload.restoration_cdn_url)}catch(a){e(a)}}).setErrorHandler(function(a){e(a)}).send()})}g.fetchEBRestoreCDNUrl=a}),98);
__d("IGDAWDebug",["I64","IGDAWProtocolQueueInstructions","MAWDebug","MAWReStoreDb","MAWUnsafeCoerce","WAJids","WAProtocolQueue","WASignalKeys","asyncToGeneratorRuntime","cr:7711","endpoints"],(function(a,b,c,d,e,f,g){"use strict";var h;a={UNSAFE_triggerICDCErrorForIGD:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=d("WAJids").toMsgrUserJid(a);var b=d("MAWUnsafeCoerce").unsafeCoerce(Math.floor(Date.now()/1e3)),c=d("MAWUnsafeCoerce").unsafeCoerce(42);a={instruction:"icdcError",jid:a,notificationTs:b,priority:d("WAProtocolQueue").WAProtocolQueuePriorityHigh,stanzaQueueId:c,type:"instruction"};yield d("IGDAWProtocolQueueInstructions").handleInstructions([a])});function c(b){return a.apply(this,arguments)}return c}(),UNSAFE_triggerIdentityAddedForIGD:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=d("WAJids").toMsgrUserJid(a);b=d("WAJids").toMsgrDeviceJid(a,b);var c=d("MAWUnsafeCoerce").unsafeCoerce(Math.floor(Date.now()/1e3)),e=d("MAWUnsafeCoerce").unsafeCoerce(42);b={device:b,identity:d("WASignalKeys").makeSerializedKeyPair().serializedPubKey,instruction:"identityAdded",jid:a,model:"Chrome",notificationTs:c,platform:"Instagram",priority:d("WAProtocolQueue").WAProtocolQueuePriorityHigh,stanzaQueueId:e,type:"instruction"};yield d("IGDAWProtocolQueueInstructions").handleInstructions([b])});function c(b,c){return a.apply(this,arguments)}return c}(),UNSAFE_triggerIdentityChangedForIGD:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=d("WAJids").toMsgrUserJid(a);b=d("WAJids").toMsgrDeviceJid(a,b);var c=d("MAWUnsafeCoerce").unsafeCoerce(Math.floor(Date.now()/1e3)),e=d("MAWUnsafeCoerce").unsafeCoerce(42);b={device:b,identity:d("WASignalKeys").makeSerializedKeyPair().serializedPubKey,instruction:"identityChanged",jid:a,model:"Chrome",notificationTs:c,platform:"Instagram",priority:d("WAProtocolQueue").WAProtocolQueuePriorityHigh,stanzaQueueId:e,type:"instruction"};yield d("IGDAWProtocolQueueInstructions").handleInstructions([b])});function c(b,c){return a.apply(this,arguments)}return c}(),UNSAFE_triggerIdentityRemovedForIGD:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=d("WAJids").toMsgrUserJid(a);b=d("WAJids").toMsgrDeviceJid(a,b);var c=d("MAWUnsafeCoerce").unsafeCoerce(Math.floor(Date.now()/1e3)),e=d("MAWUnsafeCoerce").unsafeCoerce(42);b={device:b,instruction:"identityRemoved",jid:a,notificationTs:c,priority:d("WAProtocolQueue").WAProtocolQueuePriorityHigh,stanzaQueueId:e,type:"instruction"};yield d("IGDAWProtocolQueueInstructions").handleInstructions([b])});function c(b,c){return a.apply(this,arguments)}return c}(),fetchEBRestoreCDNUrl:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){try{a=(yield d("endpoints").fetchEBRestoreCDNUrl(a))}catch(a){}});function c(b){return a.apply(this,arguments)}return c}(),fetchInstamadilloMessage:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,e){try{var g=(yield d("MAWReStoreDb").getDB(f.id+":144"));yield b("cr:7711")==null?void 0:b("cr:7711")(g,(h||(h=d("I64"))).of_float(a),c,e)}catch(a){}});function c(b,c,d){return a.apply(this,arguments)}return c}()};Object.assign(d("MAWDebug").MAWDebugFuncs,a)}),34);
__d("MAWParseXMAIGConfig",["WAArmadilloXMA.pb"],(function(a,b,c,d,e,f,g){"use strict";b=new Set([(a=d("WAArmadilloXMA.pb")).EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_CLIPS_SHARE,a.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_MULTIPOST_SHARE,a.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_SINGLE_IMAGE_POST_SHARE,a.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_PHOTO_SHARE,a.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_VIDEO_SHARE,a.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_PHOTO_HIGHLIGHT_SHARE,a.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_VIDEO_HIGHLIGHT_SHARE,a.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_REPLY,a.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_REACTION,a.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_PHOTO_MENTION,a.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_VIDEO_MENTION]);g.IGD_SUPPORTED_TARGET_TYPES=b}),98);
__d("IGDAWMainWebWorkerConfig",["MAWGK","MAWParseXMAIGConfig","WADbDeviceRegistration","WorkerUtils","getOrchestratorVersion","gkx","justknobx"],(function(a,b,c,d,e,f,g){"use strict";var h,i=1;a={armadilloWebProcessFutureproof:function(){return c("MAWGK").armadillo_web_process_futureproof},batchSize:function(){return 500},getDevicesV2:function(){return c("gkx")("4551")},getSignalFutureMessagesMax:function(){return c("gkx")("4280")?c("justknobx")._("847"):2e3},icdcAlertTriggerFailureCounter:function(){return c("justknobx")._("1970")},icdcCooldownIntervalInMinutes:function(){return 1e4},icdcIntervalInMinutes:function(){return c("justknobx")._("1972")},ignoreReadReceipts:function(){return c("gkx")("2855")},isDocumentReceiveEnabled:function(){return!1},isEphemeralMessagesEnabled:function(){return!0},isFrankingDropOnInvalid:function(){return c("gkx")("23973")},isFrankingDropOnMissing:function(){return c("gkx")("23974")},isFrankingEnabled:function(){return c("justknobx")._("1347")},isGifEnabled:function(){return c("justknobx")._("1147")},isHttpFetchCacheEnabled:function(){return c("gkx")("5483")},isICDCErrorEnabled:function(){return c("gkx")("23975")},isMediaFallbackToAlternativeHmacSaltsEnabled:function(){return c("gkx")("23976")},isMediaStreamingForProgressiveJpegEnabled:function(){return c("gkx")("2325")},isOctetStreamAttachmentMimeTypeEnabled:function(){return c("gkx")("4644")},isPollsFallbackExperienceEnabled:function(){return!1},isPreEstablishSessionEnabled:function(){return c("gkx")("23979")},isProgressiveJpegEnabledForDownload:function(){return c("justknobx")._("2411")},isProgressiveJpegSendEnabled:function(){return c("justknobx")._("2412")},isSenderKeyPredistributionEnabled:function(){return c("gkx")("23981")},isSharedWorkerContext:function(){return(h||(h=d("WorkerUtils"))).isSharedWorkerContext()},isStickerEnabled:function(){return c("justknobx")._("2619")},isStickerReceiverFetchDualSendEnabled:function(){return!1},isStickerReceiverFetchEnabled:function(){return!1},isStoryMentionXMAEnabled:function(){return!1},isUnsupportedMessagesRedesignEnabled:function(){return!1},jpegThumbnailTargetByteSizeKB:function(){return c("justknobx")._("2338")},maxPrekeysToUpload:function(){return 200},maxUsersForNotifyDeviceChange:function(){return d("WADbDeviceRegistration").MAX_USERS_FOR_NOTIFY_DEVICE_CHANGE},mediaDownloadDeduplication:function(){return c("gkx")("33150")},mediaRejectPreviewResolvable:function(){return c("gkx")("6031")},mediaTtlOnWhatsAppInfraInDays:function(){return c("justknobx")._("2715")},oneQueueTimeoutMs:function(){return c("justknobx")._("2583")},orchestratorVersion:function(){return c("getOrchestratorVersion")()},pjpegPreviewAvoidLastScan:function(){return c("justknobx")._("67")},sessionDropIfTooOld:function(){return c("justknobx")._("2240")},shouldCommsWait:function(){return!1},shouldDeviceStateTimesout:function(){return c("justknobx")._("2592")},shouldWaitForConnection:function(){return c("gkx")("5594")},skipDownloadablePreviewForProgressiveJpeg:function(){return c("justknobx")._("2371")},skipExpiredDownload:function(){return c("gkx")("3981")},uiLayoutTriggeredMediaDownload:function(){return c("gkx")("4137")},useLongSessionDrop:function(){return c("gkx")("1244")},useProtocolMediaKey:function(){return c("gkx")("3718")},useTightenBackoff:function(){return c("gkx")("6110")},useUpdatedSenderKeySession:function(){return c("gkx")("23937")},waDanglingQueue:function(){return c("justknobx")._("1921")},workerScheduler:function(){return!1}};b={enableDocumentBackupAndRestore:function(){return c("gkx")("4805")},encryptForwardedMedia:function(){return c("gkx")("2983")},isMediaAssociatedXMAsEnabled:function(){return!1},isRavenMessagesEnabled:function(){return!0},productTypeForEBAttachments:"igd",skipPreviewUploadForImages:function(){return c("gkx")("4951")},supportedTypesVersion:function(){return c("MAWGK").armadillo_web_process_futureproof?i+1:i},supportedXMATargetTypes:function(){return d("MAWParseXMAIGConfig").IGD_SUPPORTED_TARGET_TYPES}};g.waConfig=a;g.mawConfig=b}),98);
__d("IGDBridgedAPIHandler",["JSResourceForInteraction","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["igdapi: unsupported api call ",""]);h=function(){return a};return a}function a(a){var b=a.args;a=a.type;switch(a){case"46":return c("JSResourceForInteraction")("IGDSendMessageTaskHandler").__setRef("IGDBridgedAPIHandler").load().then(function(a){a=a.handleTask;return a.apply(void 0,b)});case"33":return c("JSResourceForInteraction")("IGDUnsendMessageTaskHandler").__setRef("IGDBridgedAPIHandler").load().then(function(a){a=a.handleTask;return a.apply(void 0,b)});case"sendEditMessage":return c("JSResourceForInteraction")("IGDEditMessageTaskHandler").__setRef("IGDBridgedAPIHandler").load().then(function(a){a=a.handleTask;return a.apply(void 0,b)});case"sendMediaMessage":return c("JSResourceForInteraction")("IGDSendMediaMessageTaskHandler").__setRef("IGDBridgedAPIHandler").load().then(function(a){a=a.handleTask;return a.apply(void 0,b)});case"sendOrRemoveReaction":return c("JSResourceForInteraction")("IGDSendRemoveReactionTaskHandler").__setRef("IGDBridgedAPIHandler").load().then(function(a){a=a.handleTask;return a.apply(void 0,b)});case"sendXmaReceiverFetch":return c("JSResourceForInteraction")("IGDSendXmaReceiverFetchTaskHandler").__setRef("IGDBridgedAPIHandler").load().then(function(a){a=a.handleTask;return a.apply(void 0,b)});default:d("WALogger").DEV(h(),a).devConsole(b);return}}g.igdapi=a}),98);
__d("MAWDeletedMsgApi",["MAWIndexedDb","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({deletedMessages:d("MAWTransactionMode").READONLY},"getDeletedMsgByProtocolIdApi",function(a){return function(b){return a.deletedMessages.get(babelHelpers["extends"]({},b))}});g.getDeletedMsgByProtocolIdApi=a}),98);
__d("MAWGetMostRescentDecodedMediaEntry",["MAWDbMediaTxns","MAWIndexedDb","MAWTransactionMode","WAHashUtils","WAMediaUtils","WAResultOrError","WATagsLogger","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["No media entry"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["No existing media entry found for plaintextHash ",". Returning new MsgMap."]);i=function(){return a};return a}var j=d("WATagsLogger").TAGS(["getMostRecentDecodedMediaEntry"]),k=d("MAWIndexedDb").makeMsgrTransactor({media:d("MAWTransactionMode").READONLY},"getMediaKnownEntries",function(a){return function(b){return d("MAWDbMediaTxns").maybeGetMediaFromPlaintextHash(a,b).then(function(a){if(!a){j.LOG(i(),d("WAHashUtils").sanitisePlaintextHash(b));return d("WAResultOrError").makeError("no-media-by-plaintext-hash")}return d("WAResultOrError").makeResult(a.mediaEntries)})}});function a(a){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield k(a));if(a.success===!1)return a;a=m(a.value);return a.success===!1?a:d("WAResultOrError").makeResult(a.value[1])});return l.apply(this,arguments)}function m(a){var b=null;for(a of a){var c,e=a[0],f=a[1];f=d("WAMediaUtils").decodeMediaEntryData(f);(((c=b)==null?void 0:c[1].mediaKeyTimestamp)==null||f.mediaKeyTimestamp!=null&&f.mediaKeyTimestamp>((c=b)==null?void 0:c[1].mediaKeyTimestamp))&&(b=[e,f])}if(b!=null)return d("WAResultOrError").makeResult(b);j.ERROR(h());return d("WAResultOrError").makeError("no-media-entry")}g.getMostRecentDecodedMediaEntry=a;g.findMostRecentMediaEntry=m}),98);
__d("MAWGetMsgIdByProtocolMsgId",["MAWDbMsgTxns","MAWDbReactionsTxns","MAWDbUnrenderedMsgTxns","MAWDexieTable","MAWIndexedDb","MAWMsgType","MAWTransactionMode","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";b=d("MAWIndexedDb").makeMsgrTransactor({messages:(a=d("MAWTransactionMode")).READONLY,reactions:a.READONLY,threads:a.READONLY,unrenderedMessages:a.READONLY},"getMsgIdByProtocolMsgId",function(a){return function(b){return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").maybeGetMsgResultByProtocolMsgId(a,b),d("MAWDbReactionsTxns").maybeGetReactionByProtocolMsgId(a,b),d("MAWDbUnrenderedMsgTxns").maybeGetUnrenderedMsgByProtocolMsgId(a,b)]).then(function(a){var b=a[0],c=a[1];a=a[2];if(b.success)return d("WAResultOrError").makeResult(b.value.msgId);else if(c!=null)return d("WAResultOrError").makeResult(c.reactionId);else if(a.success&&a.value.type===d("MAWMsgType").MSG_TYPE.DELETE_FOR_ME)return d("WAResultOrError").makeResult(a.value.msgId);var e="missing_msg_in_db";b=b.error;a=a.error;if(b==="missing_msg"&&c==null&&a==="missing_unrendered_msg")e="missing_all_db_msg";else if(b==="missing_thread_msg"&&a==="missing_thread_unrendered_msg")e="missing_all_thread";else if(b==="missing_thread_msg"||a==="missing_thread_unrendered_msg"){e=b+"__"+((c=a)!=null?c:"unrenderedMsgResultNoError")}return d("WAResultOrError").makeError(e)})}});g.getMsgIdByProtocolMsgId=b}),98);
__d("WAIsMp4",[],(function(a,b,c,d,e,f){"use strict";function a(a){return a.length<8?!1:a[4]===102&&a[5]===116&&a[6]===121&&a[7]===112}f.isMp4=a}),66);
__d("WAIsWebP",[],(function(a,b,c,d,e,f){"use strict";function a(a){if(a.length<12)return!1;if(a[0]!==82||a[1]!==73||a[2]!==70||a[3]!==70)return!1;return a[8]!==87||a[9]!==69||a[10]!==66||a[11]!==80?!1:!0}f.isWebP=a}),66);
__d("WAWasmModuleCache",["WAPromiseManagement","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h=a.fetch,i=new Map();c=d("WAPromiseManagement").cacheWhilePending(function(a){return a},function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=i.get(a);if(b!=null)return b;b=(yield j(a));i.set(a,b);return b});return function(b){return a.apply(this,arguments)}}());function j(a){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=h(a);if(typeof WebAssembly.compileStreaming==="function")return WebAssembly.compileStreaming(a);a=(yield a);return WebAssembly.compile(yield a.arrayBuffer())});return k.apply(this,arguments)}g.loadWasmModule=c}),98);
__d("WAPreloadWamediaUtilsWasm",["WAWasmModuleCache","bx"],(function(a,b,c,d,e,f,g){"use strict";var h=c("bx").getURL(c("bx")("237"));a=function(){void d("WAWasmModuleCache").loadWasmModule(h)};g.preloadWamediaUtilsWasm=a}),98);
__d("WAPreloadWebpCheckWasm",["WAWasmModuleCache","bx"],(function(a,b,c,d,e,f,g){"use strict";var h=c("bx").getURL(c("bx")("6946"));a=function(){void d("WAWasmModuleCache").loadWasmModule(h)};g.preloadWebpCheckWasm=a}),98);
__d("WAPrewarmMediaValidate",["WALogger","WAPreloadWamediaUtilsWasm","WAPreloadWebpCheckWasm"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["prewarmMediaValidate: serverMediaType is null"]);h=function(){return a};return a}function a(a){if(a==null){d("WALogger").WARN(h());return}(a==="sticker"||a==="image")&&d("WAPreloadWebpCheckWasm").preloadWebpCheckWasm();(a==="video"||a==="audio")&&d("WAPreloadWamediaUtilsWasm").preloadWamediaUtilsWasm()}g.prewarmMediaValidate=a}),98);
__d("WASIContext",[],(function(a,b,c,d,e,f){"use strict";a=function(a){var b;this.fs=(b=a==null?void 0:a.fs)!=null?b:{};this.args=(b=a==null?void 0:a.args)!=null?b:[];this.env=(b=a==null?void 0:a.env)!=null?b:{};this.stdin=(b=a==null?void 0:a.stdin)!=null?b:function(){return null};this.stdout=(b=a==null?void 0:a.stdout)!=null?b:function(){};this.stderr=(b=a==null?void 0:a.stderr)!=null?b:function(){};this.debug=a==null?void 0:a.debug;this.isTTY=!!(a==null?void 0:a.isTTY)};f.WASIContext=a}),66);
__d("WASISnapshotPreview1",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";a=Object.freeze({SUCCESS:0,E2BIG:1,EACCESS:2,EADDRINUSE:3,EADDRNOTAVAIL:4,EAFNOSUPPORT:5,EAGAIN:6,EALREADY:7,EBADF:8,EBADMSG:9,EBUSY:10,ECANCELED:11,ECHILD:12,ECONNABORTED:13,ECONNREFUSED:14,ECONNRESET:15,EDEADLK:16,EDESTADDRREQ:17,EDOM:18,EDQUOT:19,EEXIST:20,EFAULT:21,EFBIG:22,EHOSTUNREACH:23,EIDRM:24,EILSEQ:25,EINPROGRESS:26,EINTR:27,EINVAL:28,EIO:29,EISCONN:30,EISDIR:31,ELOOP:32,EMFILE:33,EMLINK:34,EMSGSIZE:35,EMULTIHOP:36,ENAMETOOLONG:37,ENETDOWN:38,ENETRESET:39,ENETUNREACH:40,ENFILE:41,ENOBUFS:42,ENODEV:43,ENOENT:44,ENOEXEC:45,ENOLCK:46,ENOLINK:47,ENOMEM:48,ENOMSG:49,ENOPROTOOPT:50,ENOSPC:51,ENOSYS:52,ENOTCONN:53,ENOTDIR:54,ENOTEMPTY:55,ENOTRECOVERABLE:56,ENOTSOCK:57,ENOTSUP:58,ENOTTY:59,ENXIO:60,EOVERFLOW:61,EOWNERDEAD:62,EPERM:63,EPIPE:64,EPROTO:65,EPROTONOSUPPORT:66,EPROTOTYPE:67,ERANGE:68,EROFS:69,ESPIPE:70,ESRCH:71,ESTALE:72,ETIMEDOUT:73,ETXTBSY:74,EXDEV:75,ENOTCAPABLE:76});d=(c=b("$InternalEnum"))({REALTIME:0,MONOTONIC:1,PROCESS_CPUTIME_ID:2,THREAD_CPUTIME_ID:3});e=c({SET:0,CUR:1,END:2});b=c({UNKNOWN:0,BLOCK_DEVICE:1,CHARACTER_DEVICE:2,DIRECTORY:3,REGULAR_FILE:4,SOCKET_DGRAM:5,SOCKET_STREAM:6,SYMBOLIC_LINK:7});var g=c({DIR:0});c=c({CLOCK:0,FD_READ:1,FD_WRITE:2});var h={SYMLINK_FOLLOW:1<<0},i={CREAT:1<<0,DIRECTORY:1<<1,EXCL:1<<2,TRUNC:1<<3},j={APPEND:1<<0,DSYNC:1<<1,NONBLOCK:1<<2,RSYNC:1<<3,SYNC:1<<4},k={FD_DATASYNC:BigInt(1)<<BigInt(0),FD_READ:BigInt(1)<<BigInt(1),FD_SEEK:BigInt(1)<<BigInt(2),FD_FDSTAT_SET_FLAGS:BigInt(1)<<BigInt(3),FD_SYNC:BigInt(1)<<BigInt(4),FD_TELL:BigInt(1)<<BigInt(5),FD_WRITE:BigInt(1)<<BigInt(6),FD_ADVISE:BigInt(1)<<BigInt(7),FD_ALLOCATE:BigInt(1)<<BigInt(8),PATH_CREATE_DIRECTORY:BigInt(1)<<BigInt(9),PATH_CREATE_FILE:BigInt(1)<<BigInt(10),PATH_LINK_SOURCE:BigInt(1)<<BigInt(11),PATH_LINK_TARGET:BigInt(1)<<BigInt(12),PATH_OPEN:BigInt(1)<<BigInt(13),FD_READDIR:BigInt(1)<<BigInt(14),PATH_READLINK:BigInt(1)<<BigInt(15),PATH_RENAME_SOURCE:BigInt(1)<<BigInt(16),PATH_RENAME_TARGET:BigInt(1)<<BigInt(17),PATH_FILESTAT_GET:BigInt(1)<<BigInt(18),PATH_FILESTAT_SET_SIZE:BigInt(1)<<BigInt(19),PATH_FILESTAT_SET_TIMES:BigInt(1)<<BigInt(20),FD_FILESTAT_GET:BigInt(1)<<BigInt(21),FD_FILESTAT_SET_SIZE:BigInt(1)<<BigInt(22),FD_FILESTAT_SET_TIMES:BigInt(1)<<BigInt(23),PATH_SYMLINK:BigInt(1)<<BigInt(24),PATH_REMOVE_DIRECTORY:BigInt(1)<<BigInt(25),PATH_UNLINK_FILE:BigInt(1)<<BigInt(26),POLL_FD_READWRITE:BigInt(1)<<BigInt(27),SOCK_SHUTDOWN:BigInt(1)<<BigInt(28),SOCK_ACCEPT:BigInt(1)<<BigInt(29)},l={ATIM:1<<0,ATIM_NOW:1<<1,MTIM:1<<2,MTIM_NOW:1<<3},m={SUBSCRIPTION_CLOCK_ABSTIME:1<<0},n={FD_READWRITE_HANGUP:1<<0},o=64,p=48,q=32;f.RESULT=a;f.Clock=d;f.Whence=e;f.FileType=b;f.PreopenType=g;f.EventType=c;f.LookupFlags=h;f.OpenFlags=i;f.FileDescriptorFlags=j;f.RightsFlags=k;f.FileStatTimestampFlags=l;f.SubscriptionClockFlags=m;f.EventReadWriteFlags=n;f.FILESTAT_SIZE=o;f.SUBSCRIPTION_SIZE=p;f.EVENT_SIZE=q}),66);
__d("WASIDrive",["WASISnapshotPreview1","WATextEncoding"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(a){this.nextFD=10,this.openMap=new Map(),this.fs=babelHelpers["extends"]({},a),this.openMap.set(3,new j(this.fs,"/"))}var b=a.prototype;b.$1=function(a,b,c){a=new h(a,c);b&&(a.buffer=new Uint8Array(new ArrayBuffer(1024),0,0));c=this.nextFD;this.openMap.set(c,a);this.nextFD++;return[d("WASISnapshotPreview1").RESULT.SUCCESS,c]};b.$2=function(a,b){a=new j(a,b);b=this.nextFD;this.openMap.set(b,a);this.nextFD++;return[d("WASISnapshotPreview1").RESULT.SUCCESS,b]};b.$3=function(a,b){return b==="."?!0:a.containsDirectory(b)};b.open=function(a,b,c,e){var f,g=!!(c&(f=d("WASISnapshotPreview1")).OpenFlags.CREAT),h=!!(c&f.OpenFlags.DIRECTORY),i=!!(c&f.OpenFlags.EXCL);c=!!(c&f.OpenFlags.TRUNC);f=this.openMap.get(a);if(!(f instanceof j))return[d("WASISnapshotPreview1").RESULT.EBADF];if(f.containsFile(b)){if(h)return[d("WASISnapshotPreview1").RESULT.ENOTDIR];if(i)return[d("WASISnapshotPreview1").RESULT.EEXIST];a=f.get(b);return this.$1(a,c,e)}else if(this.$3(f,b)){if(b===".")return this.$2(this.fs,"/");var k="/"+b+"/";h=Object.entries(this.fs).filter(function(a){a=a[0];return a.startsWith(k)});return this.$2(Object.fromEntries(h),k)}else{if(g){i=f.fullPath(b);this.fs[i]={path:i,mode:"binary",content:new Uint8Array(0),timestamps:{access:new Date(),modification:new Date(),change:new Date()}};return this.$1(this.fs[i],c,e)}return[d("WASISnapshotPreview1").RESULT.ENOTCAPABLE]}};b.close=function(a){if(!this.openMap.has(a))return d("WASISnapshotPreview1").RESULT.EBADF;var b=this.openMap.get(a);b instanceof h&&b.sync();this.openMap["delete"](a);return d("WASISnapshotPreview1").RESULT.SUCCESS};b.read=function(a,b){a=this.openMap.get(a);return!a||a instanceof j?[d("WASISnapshotPreview1").RESULT.EBADF]:[d("WASISnapshotPreview1").RESULT.SUCCESS,a.read(b)]};b.pread=function(a,b,c){a=this.openMap.get(a);return!a||a instanceof j?[d("WASISnapshotPreview1").RESULT.EBADF]:[d("WASISnapshotPreview1").RESULT.SUCCESS,a.pread(b,c)]};b.write=function(a,b){a=this.openMap.get(a);if(!a||a instanceof j)return d("WASISnapshotPreview1").RESULT.EBADF;a.write(b);return d("WASISnapshotPreview1").RESULT.SUCCESS};b.pwrite=function(a,b,c){a=this.openMap.get(a);if(!a||a instanceof j)return d("WASISnapshotPreview1").RESULT.EBADF;a.pwrite(b,c);return d("WASISnapshotPreview1").RESULT.SUCCESS};b.sync=function(a){a=this.openMap.get(a);if(!a||a instanceof j)return d("WASISnapshotPreview1").RESULT.EBADF;a.sync();return d("WASISnapshotPreview1").RESULT.SUCCESS};b.seek=function(a,b,c){a=this.openMap.get(a);return!a||a instanceof j?[d("WASISnapshotPreview1").RESULT.EBADF]:[d("WASISnapshotPreview1").RESULT.SUCCESS,a.seek(b,c)]};b.tell=function(a){a=this.openMap.get(a);return!a||a instanceof j?[d("WASISnapshotPreview1").RESULT.EBADF]:[d("WASISnapshotPreview1").RESULT.SUCCESS,a.tell()]};b.renumber=function(a,b){if(!this.exists(a)||!this.exists(b))return d("WASISnapshotPreview1").RESULT.EBADF;if(a===b)return d("WASISnapshotPreview1").RESULT.SUCCESS;this.close(b);a=this.openMap.get(a);this.openMap.set(b,a);return d("WASISnapshotPreview1").RESULT.SUCCESS};b.unlink=function(a,b){a=this.openMap.get(a);if(!(a instanceof j))return d("WASISnapshotPreview1").RESULT.EBADF;if(!a.contains(b))return d("WASISnapshotPreview1").RESULT.ENOENT;var c=Object.keys(this.fs);for(var e=0;e<c.length;e++){var f=c[e];(f===a.fullPath(b)||f.startsWith(a.fullPath(b)+"/"))&&delete this.fs[f]}return d("WASISnapshotPreview1").RESULT.SUCCESS};b.rename=function(a,b,c,e){a=this.openMap.get(a);c=this.openMap.get(c);if(!(a instanceof j)||!(c instanceof j))return d("WASISnapshotPreview1").RESULT.EBADF;if(!a.contains(b))return d("WASISnapshotPreview1").RESULT.ENOENT;if(c.contains(e))return d("WASISnapshotPreview1").RESULT.EEXIST;a=a.fullPath(b);b=c.fullPath(e);c=Object.keys(this.fs);for(e=0;e<c.length;e++){var f=c[e];if(f.startsWith(a)){var g=f.replace(a,b);this.fs[g]=this.fs[f];this.fs[g].path=g;delete this.fs[f]}}return d("WASISnapshotPreview1").RESULT.SUCCESS};b.list=function(a){a=this.openMap.get(a);return!(a instanceof j)?[d("WASISnapshotPreview1").RESULT.EBADF]:[d("WASISnapshotPreview1").RESULT.SUCCESS,a.list()]};b.stat=function(a){a=this.openMap.get(a);return!(a instanceof h)?[d("WASISnapshotPreview1").RESULT.EBADF]:[d("WASISnapshotPreview1").RESULT.SUCCESS,a.stat()]};b.pathStat=function(a,b){a=this.openMap.get(a);if(!(a instanceof j))return[d("WASISnapshotPreview1").RESULT.EBADF];if(a.containsFile(b)){var c=a.fullPath(b);c=new h(this.fs[c],0).stat();return[d("WASISnapshotPreview1").RESULT.SUCCESS,c]}else if(this.$3(a,b)){if(b===".")return[d("WASISnapshotPreview1").RESULT.SUCCESS,new j(this.fs,"/").stat()];var e="/"+b+"/";c=Object.entries(this.fs).filter(function(a){a=a[0];return a.startsWith(e)});a=new j(Object.fromEntries(c),e).stat();return[d("WASISnapshotPreview1").RESULT.SUCCESS,a]}else return[d("WASISnapshotPreview1").RESULT.ENOTCAPABLE]};b.setFlags=function(a,b){a=this.openMap.get(a);if(a instanceof h){a.setFlags(b);return d("WASISnapshotPreview1").RESULT.SUCCESS}else return d("WASISnapshotPreview1").RESULT.EBADF};b.setSize=function(a,b){a=this.openMap.get(a);if(a instanceof h){a.setSize(Number(b));return d("WASISnapshotPreview1").RESULT.SUCCESS}else return d("WASISnapshotPreview1").RESULT.EBADF};b.setAccessTime=function(a,b){a=this.openMap.get(a);if(a instanceof h){a.setAccessTime(b);return d("WASISnapshotPreview1").RESULT.SUCCESS}else return d("WASISnapshotPreview1").RESULT.EBADF};b.setModificationTime=function(a,b){a=this.openMap.get(a);if(a instanceof h){a.setModificationTime(b);return d("WASISnapshotPreview1").RESULT.SUCCESS}else return d("WASISnapshotPreview1").RESULT.EBADF};b.pathSetAccessTime=function(a,b,c){a=this.openMap.get(a);if(!(a instanceof j))return d("WASISnapshotPreview1").RESULT.EBADF;a=a.get(b);if(a==null)return d("WASISnapshotPreview1").RESULT.ENOTCAPABLE;b=new h(a,0);b.setAccessTime(c);b.sync();return d("WASISnapshotPreview1").RESULT.SUCCESS};b.pathSetModificationTime=function(a,b,c){a=this.openMap.get(a);if(!(a instanceof j))return d("WASISnapshotPreview1").RESULT.EBADF;a=a.get(b);if(a==null)return d("WASISnapshotPreview1").RESULT.ENOTCAPABLE;b=new h(a,0);b.setModificationTime(c);b.sync();return d("WASISnapshotPreview1").RESULT.SUCCESS};b.pathCreateDir=function(a,b){a=this.openMap.get(a);if(!(a instanceof j))return d("WASISnapshotPreview1").RESULT.EBADF;if(a.contains(b))return d("WASISnapshotPreview1").RESULT.ENOTCAPABLE;a=a.fullPath(b)+"/.runno";this.fs[a]={path:a,timestamps:{access:new Date(),modification:new Date(),change:new Date()},mode:"string",content:""};return d("WASISnapshotPreview1").RESULT.SUCCESS};b.exists=function(a){return this.openMap.has(a)};b.fileType=function(a){a=this.openMap.get(a);if(!a)return d("WASISnapshotPreview1").FileType.UNKNOWN;else if(a instanceof h)return d("WASISnapshotPreview1").FileType.REGULAR_FILE;else return d("WASISnapshotPreview1").FileType.DIRECTORY};b.fileFdflags=function(a){a=this.openMap.get(a);if(a instanceof h)return a.fdflags;else return 0};return a}();var h=function(){var b=a.prototype;b.getOffset=function(){return Number(this.$1)};function a(a,b){this.$1=BigInt(0);this.isDirty=!1;this.file=a;if(this.file.mode==="string"){a=this.file.content;var c=d("WATextEncoding").newTextEncoder();this.buffer=c.encode(a)}else this.buffer=this.file.content;this.fdflags=b;this.flagAppend=!!(b&d("WASISnapshotPreview1").FileDescriptorFlags.APPEND);this.flagDSync=!!(b&d("WASISnapshotPreview1").FileDescriptorFlags.DSYNC);this.flagNonBlock=!!(b&d("WASISnapshotPreview1").FileDescriptorFlags.NONBLOCK);this.flagRSync=!!(b&d("WASISnapshotPreview1").FileDescriptorFlags.RSYNC);this.flagSync=!!(b&d("WASISnapshotPreview1").FileDescriptorFlags.SYNC)}b.read=function(a){a=this.buffer.subarray(this.getOffset(),this.getOffset()+a);this.$1+=BigInt(a.length);return a};b.pread=function(a,b){return this.buffer.subarray(b,b+a)};b.write=function(a){this.isDirty=!0;if(this.flagAppend){var b=this.buffer.length;this.$2(b+a.byteLength);this.buffer.set(a,b)}else{b=Math.max(this.getOffset()+a.byteLength,this.buffer.byteLength);this.$2(b);this.buffer.set(a,this.getOffset());this.$1+=BigInt(a.byteLength)}(this.flagDSync||this.flagSync)&&this.sync()};b.pwrite=function(a,b){this.isDirty=!0;if(this.flagAppend){var c=this.buffer.length;this.$2(c+a.byteLength);this.buffer.set(a,c)}else{c=Math.max(b+a.byteLength,this.buffer.byteLength);this.$2(c);this.buffer.set(a,b)}(this.flagDSync||this.flagSync)&&this.sync()};b.sync=function(){if(!this.isDirty)return;this.isDirty=!1;if(this.file.mode==="binary"){this.file.content=new Uint8Array(this.buffer);return}var a=d("WATextEncoding").newTextDecoder();this.file.content=a.decode(this.buffer);return};b.seek=function(a,b){switch(b){case d("WASISnapshotPreview1").Whence.SET:this.$1=a;break;case d("WASISnapshotPreview1").Whence.CUR:this.$1+=a;break;case d("WASISnapshotPreview1").Whence.END:this.$1=BigInt(this.buffer.length)+a;break}return this.$1};b.tell=function(){return this.$1};b.stat=function(){return{path:this.file.path,timestamps:this.file.timestamps,type:d("WASISnapshotPreview1").FileType.REGULAR_FILE,byteLength:this.buffer.length}};b.setFlags=function(a){this.fdflags=a};b.setSize=function(a){this.$2(a)};b.setAccessTime=function(a){this.file.timestamps.access=a};b.setModificationTime=function(a){this.file.timestamps.modification=a};b.$2=function(a){if(a<=this.buffer.buffer.byteLength){this.buffer=new Uint8Array(this.buffer.buffer,0,a);return}var b;this.buffer.buffer.byteLength===0?b=new ArrayBuffer(a<1024?1024:a*2):a>this.buffer.buffer.byteLength*2?b=new ArrayBuffer(a*2):b=new ArrayBuffer(this.buffer.buffer.byteLength*2);b=new Uint8Array(b,0,a);b.set(this.buffer);this.buffer=b};return a}();function i(a,b){b=b.replace(/[/\-\\^$*+?.()|[\]{}]/g,"\\$&");b=new RegExp("^"+b);return a.replace(b,"")}var j=function(){function a(a,b){this.dir=a,this.prefix=b}var b=a.prototype;b.containsFile=function(a){var b=Object.keys(this.dir);for(var c=0;c<b.length;c++){var d=b[c];d=i(d,this.prefix);if(d===a)return!0}return!1};b.containsDirectory=function(a){var b=Object.keys(this.dir);for(var c=0;c<b.length;c++){var d=b[c];d=i(d,this.prefix);if(d.startsWith(a+"/"))return!0}return!1};b.contains=function(a){var b=Object.keys(this.dir);for(var c=0;c<b.length;c++){var d=b[c];d=i(d,this.prefix);if(d===a||d.startsWith(a+"/"))return!0}return!1};b.get=function(a){return this.dir[this.fullPath(a)]};b.fullPath=function(a){return""+this.prefix+a};b.list=function(){var a=[],b=new Set(),c=Object.keys(this.dir);for(var e=0;e<c.length;e++){var f=c[e];f=i(f,this.prefix);if(f.includes("/")){var g=f.split("/")[0];if(b.has(g))continue;b.add(g);a.push({name:g,type:d("WASISnapshotPreview1").FileType.DIRECTORY})}else a.push({name:f,type:d("WASISnapshotPreview1").FileType.REGULAR_FILE})}return a};b.stat=function(){return{path:this.prefix,timestamps:{access:new Date(),modification:new Date(),change:new Date()},type:d("WASISnapshotPreview1").FileType.DIRECTORY,byteLength:0}};return a}();g.WASIDrive=a}),98);
__d("WASI",["WACryptoDependencies","WAErr","WASIContext","WASIDrive","WASISnapshotPreview1","WATextEncoding"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b,e=new(d("WASIContext").WASIContext)(a),f=new(d("WASIDrive").WASIDrive)(e.fs);function g(){return Object.entries(e.env).map(function(a){var b=a[0];a=a[1];return b+"="+a})}var n={args_get:function(a,c){a=a;c=c;var f=new DataView(b.buffer);for(var g=e.args,h=Array.isArray(g),i=0,g=h?g:g[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var j;if(h){if(i>=g.length)break;j=g[i++]}else{i=g.next();if(i.done)break;j=i.value}j=j;f.setUint32(a,c,!0);a+=4;j=d("WATextEncoding").newTextEncoder().encode(j+"\0");var k=new Uint8Array(b.buffer,c,j.byteLength);k.set(j);c+=j.byteLength}return d("WASISnapshotPreview1").RESULT.SUCCESS},args_sizes_get:function(a,c){var f=e.args,g=f.reduce(function(a,b){return a+d("WATextEncoding").newTextEncoder().encode(b+"\0").byteLength},0),h=new DataView(b.buffer);h.setUint32(a,f.length,!0);h.setUint32(c,g,!0);return d("WASISnapshotPreview1").RESULT.SUCCESS},clock_res_get:function(){throw c("WAErr")("clock_res_get is not implemented")},clock_time_get:function(a,c,e){c=d("WASISnapshotPreview1").Clock.cast(a);if(c==null)return d("WASISnapshotPreview1").RESULT.EINVAL;switch(c){case d("WASISnapshotPreview1").Clock.REALTIME:case d("WASISnapshotPreview1").Clock.MONOTONIC:case d("WASISnapshotPreview1").Clock.PROCESS_CPUTIME_ID:case d("WASISnapshotPreview1").Clock.THREAD_CPUTIME_ID:a=new DataView(b.buffer);a.setBigUint64(e,m(new Date()),!0);return d("WASISnapshotPreview1").RESULT.SUCCESS}},environ_get:function(a,c){a=a;c=c;var e=new DataView(b.buffer),f=g();for(var h=0;h<f.length;h++){var i=f[h];e.setUint32(a,c,!0);a+=4;i=d("WATextEncoding").newTextEncoder().encode(i+"\0");var j=new Uint8Array(b.buffer,c,i.byteLength);j.set(i);c+=i.byteLength}return d("WASISnapshotPreview1").RESULT.SUCCESS},environ_sizes_get:function(a,c){var e=g().reduce(function(a,b){return a+d("WATextEncoding").newTextEncoder().encode(b+"\0").byteLength},0),f=new DataView(b.buffer);f.setUint32(a,g().length,!0);f.setUint32(c,e,!0);return d("WASISnapshotPreview1").RESULT.SUCCESS},fd_advise:function(){throw c("WAErr")("fd_advise is not implemented")},fd_allocate:function(){throw c("WAErr")("fd_allocate is not implemented")},fd_close:function(a){return f.close(a)},fd_datasync:function(){throw c("WAErr")("fd_datasync is not implemented")},fd_fdstat_get:function(a,c){if(a<3){if(e.isTTY){var g=i^d("WASISnapshotPreview1").RightsFlags.FD_SEEK^d("WASISnapshotPreview1").RightsFlags.FD_TELL;g=k(d("WASISnapshotPreview1").FileType.CHARACTER_DEVICE,0,g)}else g=k(d("WASISnapshotPreview1").FileType.CHARACTER_DEVICE,0);var h=new Uint8Array(b.buffer,c,g.byteLength);h.set(g);return d("WASISnapshotPreview1").RESULT.SUCCESS}if(!f.exists(a))return d("WASISnapshotPreview1").RESULT.EBADF;h=f.fileType(a);g=f.fileFdflags(a);a=k(h,g);h=new Uint8Array(b.buffer,c,a.byteLength);h.set(a);return d("WASISnapshotPreview1").RESULT.SUCCESS},fd_fdstat_set_flags:function(a,b){return f.setFlags(a,b)},fd_fdstat_set_rights:function(){return d("WASISnapshotPreview1").RESULT.SUCCESS},fd_filestat_get:function(){throw c("WAErr")("fd_filestat_get is not implemented")},fd_filestat_set_size:function(){throw c("WAErr")("fd_filestat_set_size is not implemented")},fd_filestat_set_times:function(){throw c("WAErr")("fd_filestat_set_times is not implemented")},fd_pread:function(){throw c("WAErr")("fd_pread is not implemented")},fd_prestat_dir_name:function(a,c,e){if(a!==3)return d("WASISnapshotPreview1").RESULT.EBADF;a=d("WATextEncoding").newTextEncoder().encode("/");c=new Uint8Array(b.buffer,c,e);c.set(a.subarray(0,e));return d("WASISnapshotPreview1").RESULT.SUCCESS},fd_prestat_get:function(a,c){if(a!==3)return d("WASISnapshotPreview1").RESULT.EBADF;a=d("WATextEncoding").newTextEncoder().encode(".");c=new DataView(b.buffer,c);c.setUint8(0,d("WASISnapshotPreview1").PreopenType.DIR);c.setUint32(4,a.byteLength,!0);return d("WASISnapshotPreview1").RESULT.SUCCESS},fd_pwrite:function(){throw c("WAErr")("fd_pwrite is not implemented")},fd_read:function(a,c,g,h){if(a===1||a===2)return d("WASISnapshotPreview1").RESULT.ENOTSUP;var i=new DataView(b.buffer);c=j(i,c,g);g=d("WATextEncoding").newTextEncoder();var k=0,l=d("WASISnapshotPreview1").RESULT.SUCCESS;for(var m=0;m<c.length;m++){var n=c[m],o=void 0;if(a===0){var p=e.stdin(n.byteLength);if(p==null)break;o=g.encode(p)}else{p=f.read(a,n.byteLength);if(p.length===1){l=p[0];break}else o=p[1]}p=Math.min(n.byteLength,o.byteLength);n.set(o.subarray(0,p));k+=p}i.setUint32(h,k,!0);return l},fd_readdir:function(){throw c("WAErr")("fd_readdir is not implemented")},fd_renumber:function(){throw c("WAErr")("fd_renumber is not implemented")},fd_seek:function(a,e,g,h){g=d("WASISnapshotPreview1").Whence.cast(g);if(g==null)throw c("WAErr")("fd_seek: invalid whence");a=f.seek(a,e,g);if(a.length===1)return a[0];e=a[0];g=a[1];a=new DataView(b.buffer);a.setBigUint64(h,g,!0);return e},fd_sync:function(){throw c("WAErr")("fd_sync is not implemented")},fd_tell:function(){throw c("WAErr")("fd_tell is not implemented")},fd_write:function(a,c,g,h){if(a===0)return d("WASISnapshotPreview1").RESULT.ENOTSUP;var i=new DataView(b.buffer);c=j(i,c,g);g=d("WATextEncoding").newTextDecoder();var k=0,l=d("WASISnapshotPreview1").RESULT.SUCCESS;for(var m=0;m<c.length;m++){var n=c[m];if(n.byteLength===0)continue;if(a===1||a===2){var o=a===1?e.stdout:e.stderr,p=g.decode(n);o(p)}else{l=f.write(a,n);if(l!==d("WASISnapshotPreview1").RESULT.SUCCESS)break}k+=n.byteLength}i.setUint32(h,k,!0);return l},path_create_directory:function(){throw c("WAErr")("path_create_directory is not implemented")},path_filestat_get:function(){throw c("WAErr")("path_filestat_get is not implemented")},path_filestat_set_times:function(){throw c("WAErr")("path_filestat_set_times is not implemented")},path_link:function(){throw c("WAErr")("path_link is not implemented")},path_open:function(a,c,d,e,g,h,i,j,k){c=new DataView(b.buffer);h=l(b,d,e);i=f.open(a,h,g,j);if(i.length===1)return i[0];d=i[0];e=i[1];c.setUint32(k,e,!0);return d},path_readlink:function(){throw c("WAErr")("path_readlink is not implemented")},path_remove_directory:function(){throw c("WAErr")("path_remove_directory is not implemented")},path_rename:function(){throw c("WAErr")("path_rename is not implemented")},path_symlink:function(){throw c("WAErr")("path_symlink is not implemented")},path_unlink_file:function(){throw c("WAErr")("path_unlink_file is not implemented")},poll_oneoff:function(){throw c("WAErr")("poll_oneoff is not implemented")},proc_exit:function(a){throw new h(a)},proc_raise:function(){throw c("WAErr")("proc_raise is not implemented")},random_get:function(a,c){a=new Uint8Array(b.buffer,a,c);d("WACryptoDependencies").getCrypto().getRandomValues(a);return d("WASISnapshotPreview1").RESULT.SUCCESS},sched_yield:function(){throw c("WAErr")("sched_yield is not implemented")},sock_accept:function(){throw c("WAErr")("sock_accept is not implemented")},sock_recv:function(){throw c("WAErr")("sock_recv is not implemented")},sock_send:function(){throw c("WAErr")("sock_send is not implemented")},sock_shutdown:function(){throw c("WAErr")("sock_shutdown is not implemented")}};return{getImportObject:function(){return{wasi_snapshot_preview1:n}},start:function(a){var d=a.exports.memory;if(d instanceof WebAssembly.Memory)b=d;else throw c("WAErr")("Expected memory object");d=a.exports._start;try{d()}catch(a){if(a instanceof h)return{exitCode:a.code,fs:f.fs};else if(a instanceof WebAssembly.RuntimeError)return{exitCode:134,fs:f.fs};else throw a}return{exitCode:0,fs:f.fs}}}}var h=function(b){babelHelpers.inheritsLoose(a,b);function a(a){var c;c=b.call(this)||this;c.code=a;return c}return a}(babelHelpers.wrapNativeSuper(Error)),i=(b=d("WASISnapshotPreview1")).RightsFlags.FD_DATASYNC|b.RightsFlags.FD_READ|b.RightsFlags.FD_SEEK|b.RightsFlags.FD_FDSTAT_SET_FLAGS|b.RightsFlags.FD_SYNC|b.RightsFlags.FD_TELL|b.RightsFlags.FD_WRITE|b.RightsFlags.FD_ADVISE|b.RightsFlags.FD_ALLOCATE|b.RightsFlags.PATH_CREATE_DIRECTORY|b.RightsFlags.PATH_CREATE_FILE|b.RightsFlags.PATH_LINK_SOURCE|b.RightsFlags.PATH_LINK_TARGET|b.RightsFlags.PATH_OPEN|b.RightsFlags.FD_READDIR|b.RightsFlags.PATH_READLINK|b.RightsFlags.PATH_RENAME_SOURCE|b.RightsFlags.PATH_RENAME_TARGET|b.RightsFlags.PATH_FILESTAT_GET|b.RightsFlags.PATH_FILESTAT_SET_SIZE|b.RightsFlags.PATH_FILESTAT_SET_TIMES|b.RightsFlags.FD_FILESTAT_GET|b.RightsFlags.FD_FILESTAT_SET_SIZE|b.RightsFlags.FD_FILESTAT_SET_TIMES|b.RightsFlags.PATH_SYMLINK|b.RightsFlags.PATH_REMOVE_DIRECTORY|b.RightsFlags.PATH_UNLINK_FILE|b.RightsFlags.POLL_FD_READWRITE|b.RightsFlags.SOCK_SHUTDOWN|b.RightsFlags.SOCK_ACCEPT;function j(a,b,c){var d=new Array(c);b=b;for(var e=0;e<c;e++){var f=a.getUint32(b,!0);b+=4;var g=a.getUint32(b,!0);b+=4;d[e]=new Uint8Array(a.buffer,f,g)}return d}function k(a,b,c){var d;d=(d=c)!=null?d:i;c=(c=c)!=null?c:i;var e=new Uint8Array(24),f=new DataView(e.buffer,0,24);f.setUint8(0,a);f.setUint32(2,b,!0);f.setBigUint64(8,d,!0);f.setBigUint64(16,c,!0);return e}function l(a,b,c){return d("WATextEncoding").newTextDecoder().decode(new Uint8Array(a.buffer,b,c))}function m(a){return BigInt(a.getTime())*BigInt(1e6)}g.createWasi=a}),98);
__d("WAMp4Check",["WAResultOrError","WASI","WAWasmModuleCache","asyncToGeneratorRuntime","bx"],(function(a,b,c,d,e,f,g){"use strict";var h="input",i="/"+h;function j(a){var b,c=a.input,d=a.stdout;a=a.stderr;return{args:["wamediautil","mp4check","--error-tolerance=2",h],fs:(b={},b[i]={path:i,timestamps:{access:new Date(),change:new Date(),modification:new Date()},mode:"binary",content:new Uint8Array(c)},b),stdout:d,stderr:a}}function a(a){var c=a.getWasmModule,e=a.logError,f=a.logMessage;return function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a.input;a=d("WASI").createWasi(j({input:a,stderr:e,stdout:f}));var b=a.getImportObject;a=a.start;var g=(yield c());g=(yield WebAssembly.instantiate(g,b()));b=a(g);a=b.exitCode;if(a!==0){e("mp4Check failed with exit code "+a);return d("WAResultOrError").makeError("invalid-media")}return d("WAResultOrError").makeResult()});function g(b){return a.apply(this,arguments)}return g}()}var k=c("bx").getURL(c("bx")("237"));e=function(){return d("WAWasmModuleCache").loadWasmModule(k)};g.createMp4Check=a;g.getMp4CheckWasm=e}),98);
__d("WAWebPCheck",["WAResultOrError","WASI","WAWasmModuleCache","asyncToGeneratorRuntime","bx"],(function(a,b,c,d,e,f,g){"use strict";var h="input",i="/"+h;function j(a){var b,c=a.input,d=a.stdout;a=a.stderr;return{args:["webpcheck",h],fs:(b={},b[i]={path:i,timestamps:{access:new Date(),change:new Date(),modification:new Date()},mode:"binary",content:new Uint8Array(c)},b),stdout:d,stderr:a}}function a(a){var c=a.getWasmModule,e=a.logError,f=a.logMessage;return function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a.input;a=d("WASI").createWasi(j({input:a,stderr:e,stdout:f}));var b=a.getImportObject;a=a.start;var g=(yield c());g=(yield WebAssembly.instantiate(g,b()));b=a(g);a=b.exitCode;if(a!==0){e("WebPCheck failed with exit code "+a);return d("WAResultOrError").makeError("invalid-media")}return d("WAResultOrError").makeResult()});function g(b){return a.apply(this,arguments)}return g}()}var k=c("bx").getURL(c("bx")("6946"));e=function(){return d("WAWasmModuleCache").loadWasmModule(k)};g.createWebPCheck=a;g.getWebpCheckWasm=e}),98);
__d("WAValidateMedia",["Promise","WAIsMp4","WAIsWebP","WAMp4Check","WAResultOrError","WATagsLogger","WAWebPCheck","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["checkMp4 error: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["checkWebP error: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["validateMedia threw an exception: ",""]);m=function(){return a};return a}var n=d("WATagsLogger").TAGS(["WAValidateMedia"]);function a(a,b){return o(a,b)["catch"](function(b){n.ERROR(m(),b);return d("WAResultOrError").makeResult({skipValidation:!0,validatedPlaintext:a,validationSetupFailed:!0})})}function o(a,c){c==null?void 0:c.addPoint("media_validation_start");var e=new Uint8Array(a);if(d("WAIsWebP").isWebP(e))return r(a);if(d("WAIsMp4").isMp4(e))return t(a);c==null?void 0:c.addPoint("media_validation_end");return(h||(h=b("Promise"))).resolve(d("WAResultOrError").makeResult({skipValidation:!0,validatedPlaintext:a,validationSetupFailed:!1}))}var p=function(a){n.ERROR(l(),a)},q=function(a){n.LOG(k(),a)};function r(a){return s.apply(this,arguments)}function s(){s=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=d("WAWebPCheck").createWebPCheck({getWasmModule:d("WAWebPCheck").getWebpCheckWasm,logError:p,logMessage:q});b=(yield b({input:a}));if(!b.success){n.ERROR(j(),b.error);return d("WAResultOrError").makeError("invalid-webp")}return d("WAResultOrError").makeResult({skipValidation:!1,mimeType:"image/webp",validatedPlaintext:a,validationSetupFailed:!1})});return s.apply(this,arguments)}function t(a){return u.apply(this,arguments)}function u(){u=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=d("WAMp4Check").createMp4Check({getWasmModule:d("WAMp4Check").getMp4CheckWasm,logError:p,logMessage:q});b=(yield b({input:a}));if(!b.success){n.ERROR(i(),b.error);return d("WAResultOrError").makeError("invalid-mp4")}return d("WAResultOrError").makeResult({skipValidation:!1,mimeType:"video/mp4",validatedPlaintext:a,validationSetupFailed:!1})});return u.apply(this,arguments)}g.validateMedia=a}),98);
__d("MAWDownloadAndHandleMedia",["MAWAckLevel","MAWCastToMsgrServerMediaType","MAWConfig","MAWDbDeletedMessages","MAWDbMsgTxns","MAWDeletedMsgApi","MAWEBBackendQPLUtils","MAWEBSwitch","MAWGetMediaPlaintextApi","MAWGetMostRescentDecodedMediaEntry","MAWGetMsgByProtocolIdApi","MAWGetMsgIdByProtocolMsgId","MAWHandleEchoMediaMsgsRestoreV2","MAWHandleMediaDownloadApi","MAWHandleMediaPreviewBeforeDownloadApi","MAWHandleMediaPreviewDownloadApi","MAWHandleMediaPreviewDownloadAsFailedApi","MAWIndexedDb","MAWJobDefinitions","MAWJobManager","MAWLoggerUtils","MAWMediaDownloadStatus","MAWMediaDownloadStatusForUI","MAWTraceUtils","MAWTransactionMode","MAWUpdateMediaEntryForMsgApi","WAAPI","WAGlobals","WAHashUtils","WAIsMediaExpiredError","WAIsMp4","WAIsWebP","WAJids","WAJobOrchestratorTypes","WAMediaUtils","WAPREList","WAPREMetrics","WAPrewarmMediaValidate","WAStartMediaDownloadQplFlow","WATagsLogger","WAValidateMedia","asyncToGeneratorRuntime","cr:10071","gkx"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["media validation was skipped: ",", setup_failed: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to validate media: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to validate for msg ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to download media: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to download media for msg ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["fail to resign cdn url. ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["resign cdn url sproc start. ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["resign cdn url gql error: ",". ",""]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["resign cdn url gql success. ",""]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["resign cdn url gql failed: ",". ",""]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["resign cdn url gql start. ",""]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["media key expired, resign cdn url for msgId: ","."]);s=function(){return a};return a}function t(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to prewarm media validate: ",""]);t=function(){return a};return a}function u(){var a=babelHelpers.taggedTemplateLiteralLoose(["downloadAndHandleMedia: Failed to get DecodedMediaEntry - reason: ",""]);u=function(){return a};return a}function v(){var a=babelHelpers.taggedTemplateLiteralLoose(["downloadAndHandleMedia: Missing msgId in Db - reason: "," msgType: ",""]);v=function(){return a};return a}function w(){var a=babelHelpers.taggedTemplateLiteralLoose(["DownloadAndHandleMedia: "," hash with "," msgId"]);w=function(){return a};return a}var x=d("WATagsLogger").TAGS([d("MAWLoggerUtils").Tag.MediaDownload,d("MAWLoggerUtils").Tag.MessageReceive]);a=d("MAWJobManager").getPersistedJobsApi().definePersistedJob().finalStep("downloadAndHandleMedia",function(a){var b=a.hash,c=a.msgType,e=a.protocolMsgId;a=a.qplEntryPoint;a=d("WAStartMediaDownloadQplFlow").startMediaDownloadQplFlow({downloadEntry:a,msgType:c,protocolMsgId:e});return y({hash:b,mediaDownloadFlow:a,msgType:c,protocolMsgId:e})}).end();function y(a){return z.apply(this,arguments)}function z(){z=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=a.hash,f=a.mediaDownloadFlow,g=a.msgType,y=a.protocolMsgId;d("MAWMediaDownloadStatusForUI").sendMediaDownloadStatusToUI({hash:e,status:c("MAWMediaDownloadStatus").DOWNLOADING,type:"main"});x.LOG(w(),d("WAHashUtils").sanitisePlaintextHash(e),y);f.addPoint("maw_pre_download_start");a=(yield d("MAWGetMsgIdByProtocolMsgId").getMsgIdByProtocolMsgId(y));if(!a.success){if(c("gkx")("23965")&&(yield A(y))){f.addPoint("media_deleted");f.endSuccess();d("MAWMediaDownloadStatusForUI").sendMediaDownloadStatusToUI({hash:e,status:c("MAWMediaDownloadStatus").NOT_MANUAL_RETRYABLE_FAILURE,type:"main"});return}f.addPoint("maw_pre_download_fail");f.endFail(a.error);x.ERROR(v(),a.error,g);d("MAWMediaDownloadStatusForUI").sendMediaDownloadStatusToUI({hash:e,status:c("MAWMediaDownloadStatus").NOT_MANUAL_RETRYABLE_FAILURE,type:"main"});return}var z=a.value;a=(yield d("MAWGetMostRescentDecodedMediaEntry").getMostRecentDecodedMediaEntry(e));if(!a.success){f.addPoint("maw_pre_download_fail");f.endFail(a.error);x.ERROR(u(),a.error);yield C(z);d("MAWMediaDownloadStatusForUI").sendMediaDownloadStatusToUI({hash:e,status:c("MAWMediaDownloadStatus").NOT_MANUAL_RETRYABLE_FAILURE,type:"main"});return}a=a.value;try{d("WAPrewarmMediaValidate").prewarmMediaValidate(a.serverMediaType)}catch(a){x.ERROR(t(),a)}f.addPoint("maw_pre_download_end");var B=(yield c("WAAPI").downloadMedia({downloadMediaMetric:f,getMediaPlaintext:d("MAWGetMediaPlaintextApi").getMediaPlaintext,handleMediaPreviewBeforeDownload:d("MAWHandleMediaPreviewBeforeDownloadApi").handleMediaPreviewBeforeDownload,handleMediaPreviewDownload:d("MAWHandleMediaPreviewDownloadApi").handleMediaPreviewDownload,handleMediaPreviewDownloadFailed:d("MAWHandleMediaPreviewDownloadAsFailedApi").handleMediaPreviewDownloadFailed,hash:e,mediaEntry:a,onlyIfMediaTTLIsValid:d("WAGlobals").getConfig().skipExpiredDownload(),protocolMsgId:y,updateMediaEntryForMsg:d("MAWUpdateMediaEntryForMsgApi").updateMediaEntryForMsg}));f.addPoint("maw_post_download_start");if(B.success===!1){var D=a.objectId,E=a.serverMediaType,F=d("MAWCastToMsgrServerMediaType").castToMsgrServerMediaType(E);d("WAGlobals").getConfig().uiLayoutTriggeredMediaDownload()&&c("MAWEBSwitch").isEnabled()&&d("WAIsMediaExpiredError").isMediaExpiredError(B.error)&&D!=null&&F!=null?(x.LOG(s(),z),f.addPoint("resign_cdn_url_start"),void d("MAWGetMsgByProtocolIdApi").getMsgsByProtocolMsgIdsTxn([y]).then(function(a){a=a[0]||{};a=a.sortOrderMs;if(a==null){f.addPoint("resign_cdn_url_missing_sort_order");return}var g=d("WAMediaUtils").stringToDeliveryObjectId(D),h=d("MAWTraceUtils").createTraceId(),i=d("MAWEBBackendQPLUtils").startMediaRestoreQPLFlow({externalId:y.externalId,mediaType:F,objectId:g,restoreEntry:"downloadAndHandleMedia",restoreMethod:b("cr:10071")==null?"sproc":"gql",traceId:h}),j="hash: "+d("WAHashUtils").sanitisePlaintextHash(e)+". msgId: "+z+". traceId: "+h;if(b("cr:10071")!==null)x.LOG(r(),j),void b("cr:10071").eblsResignCdnUrlWithGraphQL({chatJid:y.chat,deliveryObjectId:g,externalId:y.externalId,mediaType:F,plaintextHash:e,sortOrderMs:a}).then(function(a){if(a.success===!1){d("MAWMediaDownloadStatusForUI").sendMediaDownloadStatusToUI({hash:e,status:a.error==="no-media-in-backup"?c("MAWMediaDownloadStatus").MANUAL_RETRYABLE_FAILURE:c("MAWMediaDownloadStatus").NOT_MANUAL_RETRYABLE_FAILURE,type:"main"});x.LOG(q(),a.error,j);i.endFail(a.error);return}x.LOG(p(),j);a=d("MAWJobDefinitions").createStartJobInfo("downloadAndRestoreMedia",{deliveryObjectId:g,msgId:z,plaintextHash:e,restorationCdnUrl:a.value,scheduleConfig:{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION},traceId:h});return d("MAWJobManager").getJobManager().fireAndForget(a)})["catch"](function(a){d("MAWMediaDownloadStatusForUI").sendMediaDownloadStatusToUI({hash:e,status:c("MAWMediaDownloadStatus").MANUAL_RETRYABLE_FAILURE,type:"main"}),x.ERROR(o(),a,j),i.endFail("runtime-error",{string:{restoreError:a.toString()}})});else{x.LOG(n(),j);a={attachmentObjectId:g,mediaType:F,messageId:y.externalId,messageTimeStamp:a,msgId:z,plaintextHash:e,productType:d("MAWConfig").getConfig().productTypeForEBAttachments,threadId:d("WAJids").threadIdForChatJid(y.chat),threadJid:y.chat};void d("MAWHandleEchoMediaMsgsRestoreV2").invokeRestoreAccessCheckSprocToDownloadAttachment(y.externalId,a,h)}}).then(function(){f.addPoint("resign_cdn_url_end")})["catch"](function(a){d("MAWMediaDownloadStatusForUI").sendMediaDownloadStatusToUI({hash:e,status:c("MAWMediaDownloadStatus").MANUAL_RETRYABLE_FAILURE,type:"main"}),x.ERROR(m(),a),f.addPoint("resign_cdn_url_fail")})):d("MAWMediaDownloadStatusForUI").sendMediaDownloadStatusToUI({hash:e,status:d("MAWMediaDownloadStatusForUI").getStatusFromWAAPIDownloadMediaError(B.error),type:"main"});f.endFail("maw_post_download_fail");x.LOG(l(),z);x.ERROR(k(),B.error);yield C(z);return}B.success;E=B.value;B=E.mimeType;E=E.plaintext;var G=d("WAIsWebP").isWebP(new Uint8Array(E))||d("WAIsMp4").isMp4(new Uint8Array(E));if(G){G=d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.MEDIA_VALIDATE,{string:{downloadEntry:f.downloadEntry,mediaType:a.serverMediaType,msgType:g}},void 0,d("WAPREMetrics").QPL_DEFAULT_TIMEOUT_IN_MS);f.addPoint("validate_media_start");a=(yield d("WAValidateMedia").validateMedia(E,babelHelpers["extends"]({},G,{downloadEntry:f.downloadEntry})));if(a.success===!1){G.endFail(a.error);f.addPoint("validate_media_fail");f.endFail(a.error);x.LOG(j(),z);x.ERROR(i(),a.error);yield C(z);d("MAWMediaDownloadStatusForUI").sendMediaDownloadStatusToUI({hash:e,status:c("MAWMediaDownloadStatus").NOT_MANUAL_RETRYABLE_FAILURE,type:"main"});return}g=a.value;a=g.mimeType;var H=g.skipValidation;g.validatedPlaintext;g=g.validationSetupFailed;x.LOG(h(),H,g);G.endSuccess({bool:{is_validation_setup_failed:g,is_validation_skipped:H},string:{validated_mime_type:a}});f.addPoint("validate_media_end",{bool:{is_validation_skipped:H}})}G=E;f.addPoint("handle_media_download_start");g=(yield d("MAWHandleMediaDownloadApi").handleMediaDownload(e,B,G,y));g.success?(f.addPoint("handle_media_download_end"),d("MAWMediaDownloadStatusForUI").sendMediaDownloadStatusToUI({hash:e,status:c("MAWMediaDownloadStatus").SUCCESS,type:"main"})):(f.addPoint("maw_post_download_fail"),f.endFail("handle_media_download_fail_"+g.error),d("MAWMediaDownloadStatusForUI").sendMediaDownloadStatusToUI({hash:e,status:c("MAWMediaDownloadStatus").MANUAL_RETRYABLE_FAILURE,type:"main"}));f.addPoint("maw_post_download_end");f.endSuccess()});return z.apply(this,arguments)}function A(a){return B.apply(this,arguments)}function B(){B=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield d("MAWDeletedMsgApi").getDeletedMsgByProtocolIdApi(a));return!a?!1:a.reason===d("MAWDbDeletedMessages").DbDeletedMsgReasonEnum.ChatDelete||a.reason===d("MAWDbDeletedMessages").DbDeletedMsgReasonEnum.Revoke});return B.apply(this,arguments)}function C(a){return D.apply(this,arguments)}function D(){D=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b;yield d("MAWIndexedDb").makeMsgrTransactor({chunk:(b=d("MAWTransactionMode")).READONLY,media:b.READONLY,messages:b.READWRITE,receiverFetchInfo:b.READONLY,xma:b.READONLY},"downloadMedia",function(a){return function(b,c){return d("MAWDbMsgTxns").updateSystemAck(a,b,c)}})(a,d("MAWAckLevel").ACK.failed)});return D.apply(this,arguments)}g.downloadAndHandleMedia=a;g.downloadAndHandleMediaImpl=y}),98);
__d("MAWFTSIsMessageValidForSearch",["MAWMsgType"],(function(a,b,c,d,e,f,g){"use strict";function h(a){return a.ephemeralSetting!=null&&a.ephemeralSetting.ephemeralExpirationInSec>0}function a(a){var b=a.msgContent,c=a.sortOrderMs,e=a.type;b=b==null?void 0:b.content;if(b==null||c==null)return null;if(e!==d("MAWMsgType").MSG_TYPE.TEXT&&e!==d("MAWMsgType").MSG_TYPE.XMA)return null;return h(a)?null:{content:b,sortOrderMs:c}}g.verifyMessageValidity=a}),98);
__d("MAWBridgeSearchMsg",["MAWCurrentUser","MAWDbMsg","MAWFTSIsMessageValidForSearch","MAWVault","WAJids"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c){var e;c===void 0&&(c=!0);var f=d("MAWFTSIsMessageValidForSearch").verifyMessageValidity(a);if(f==null)return null;var g=d("MAWCurrentUser").getID(),h=a.author,i=a.externalId,j=a.msgId;e=(e=a.threadJid)!=null?e:b;if(e==null)return null;b=f.content;f=f.sortOrderMs;e={chatJid:e,externalId:i,msg:{msgId:j,sender:d("WAJids").authorToUserId(h,g),ts:d("MAWDbMsg").getCanonicalTsFromMsg(a)},sortOrderMs:f};i=b;return babelHelpers["extends"]({},e,{msg:babelHelpers["extends"]({},e.msg,{content:i!=null?d("MAWVault").isVaulted(i)?c?i:d("MAWVault").unvault(i):c?d("MAWVault").vault(i):i:void 0})})}b="message_content_search";c="non_message_content_search";g.createBridgeSearchMsg=a;g.MESSAGE_CONTENT_SEARCH=b;g.NON_MESSAGE_CONTENT_SEARCH=c}),98);
__d("WAFtsTokenizerBaseNormalizer",[],(function(a,b,c,d,e,f){"use strict";a=function(){function a(a){var b=this,c=[];this.$1=new Map();a.forEach(function(a){var d=a[0];a=a[1];b.$1.set(d,a);c.push(d)});this.$2=new RegExp(c.join("|"),"g")}var b=a.prototype;b.normalize=function(a){var b=this;a===void 0&&(a="");return a.replace(this.$2,function(a){var c=b.$1.get(a);return c!=null?c:a})};return a}();f["default"]=a}),66);
__d("WAFtsTokenizerPostLowercaseNormalizer",["WAFtsTokenizerBaseNormalizer"],(function(a,b,c,d,e,f,g){"use strict";a=[["\u0131","i"],["\u0629","\u0647"],["\u0640",""],["\u0649","\u064a"],["\u0671","\u0627"],["\u06a4","\u0641"],["\u06a9","\u0643"],["\u06ba","\u0646"],["\u06be","\u0647"],["\u06c3","\u06c2"],["\u06cc","\u064a"],["\u06d2","\u064a"],["\u06d5","\u0647"],["\u06f0","\u0660"],["\u06f1","\u0661"],["\u06f2","\u0662"],["\u06f3","\u0663"],["\u06f4","\u0664"],["\u06f5","\u0665"],["\u06f6","\u0666"],["\u06f7","\u0667"],["\u06f8","\u0668"],["\u06f9","\u0669"],["\u08bb","\u0641"],["\u08bc","\u0642"],["\u08bd","\u0646"],["\u200c",""],["\u0966","0"],["\u0967","1"],["\u0968","2"],["\u0969","3"],["\u096a","4"],["\u096b","5"],["\u096c","6"],["\u096d","7"],["\u096e","8"],["\u096f","9"],["\u0901","\u0902"],["\u0903",""],["\u093c",""],["\u09e6","0"],["\u09e7","1"],["\u09e8","2"],["\u09e9","3"],["\u09ea","4"],["\u09eb","5"],["\u09ec","6"],["\u09ed","7"],["\u09ee","8"],["\u09ef","9"],["\u0a66","0"],["\u0a67","1"],["\u0a68","2"],["\u0a69","3"],["\u0a6a","4"],["\u0a6b","5"],["\u0a6c","6"],["\u0a6d","7"],["\u0a6e","8"],["\u0a6f","9"],["\u0c66","0"],["\u0c67","1"],["\u0c68","2"],["\u0c69","3"],["\u0c6a","4"],["\u0c6b","5"],["\u0c6c","6"],["\u0c6d","7"],["\u0c6e","8"],["\u0c6f","9"],["\u0ae6","0"],["\u0ae7","1"],["\u0ae8","2"],["\u0ae9","3"],["\u0aea","4"],["\u0aeb","5"],["\u0aec","6"],["\u0aed","7"],["\u0aee","8"],["\u0aef","9"],["\u0ce6","0"],["\u0ce7","1"],["\u0ce8","2"],["\u0ce9","3"],["\u0cea","4"],["\u0ceb","5"],["\u0cec","6"],["\u0ced","7"],["\u0cee","8"],["\u0cef","9"],["\u0d66","0"],["\u0d67","1"],["\u0d68","2"],["\u0d69","3"],["\u0d6a","4"],["\u0d6b","5"],["\u0d6c","6"],["\u0d6d","7"],["\u0d6e","8"],["\u0d6f","9"],["\u0142","l"]];b=new(c("WAFtsTokenizerBaseNormalizer"))(a);d=b;g["default"]=d}),98);
__d("WAFtsTokenizerPreNFKDNormalizer",["WAFtsTokenizerBaseNormalizer"],(function(a,b,c,d,e,f,g){"use strict";a=[["\u0675","\u0674\u0627"],["\u0676","\u0674\u0648"],["\u0677","\u0674\u06c7"],["\u0678","\u0674\u0649"],["\u0905\u0946","\u0904"],["\u0905\u093e","\u0906"],["\u0930\u094d\u0907","\u0908"],["\u0909\u0941","\u090a"],["\u090f\u0945","\u090d"],["\u090f\u0946","\u090e"],["\u090f\u0947","\u0910"],["\u0905\u0949","\u0911"],["\u0906\u0945","\u0911"],["\u0905\u094a","\u0912"],["\u0906\u0946","\u0912"],["\u0905\u094b","\u0913"],["\u0906\u0947","\u0913"],["\u0905\u094c","\u0914"],["\u0906\u0948","\u0914"],["\u0905\u0945","\u0972"],["\u0905\u093a","\u0973"],["\u0905\u093b","\u0974"],["\u0906\u093a","\u0974"],["\u0905\u094f","\u0975"],["\u0905\u0956","\u0976"],["\u0905\u0957","\u0977"],["\u0985\u09be","\u0986"],["\u098b\u09c3","\u09e0"],["\u098c\u09e2","\u09e1"],["\u0a05\u0a3e","\u0a06"],["\u0a72\u0a3f","\u0a07"],["\u0a72\u0a40","\u0a08"],["\u0a73\u0a41","\u0a09"],["\u0a73\u0a42","\u0a0a"],["\u0a72\u0a47","\u0a0f"],["\u0a05\u0a48","\u0a10"],["\u0a73\u0a4b","\u0a13"],["\u0a05\u0a4c","\u0a14"],["\u0a85\u0abe","\u0a86"],["\u0a85\u0ac5","\u0a8d"],["\u0a85\u0ac7","\u0a8f"],["\u0a85\u0ac8","\u0a90"],["\u0a85\u0ac9","\u0a91"],["\u0a85\u0acb","\u0a93"],["\u0a85\u0abe\u0ac5","\u0a93"],["\u0a85\u0acc","\u0a94"],["\u0a85\u0abe\u0ac8","\u0a94"],["\u0ac5\u0abe","\u0ac9"],["\u0b05\u0b3e","\u0b06"],["\u0b0f\u0b57","\u0b10"],["\u0b13\u0b57","\u0b14"],["\u0bb8\u0bcd\u0bb0\u0bc0","\u0bb6\u0bcd\u0bb0\u0bc0"],["\u0c12\u0c55","\u0c13"],["\u0c12\u0c4c","\u0c14"],["\u0c3f\u0c55","\u0c40"],["\u0c46\u0c55","\u0c47"],["\u0c4a\u0c55","\u0c4b"],["\u0c89\u0cbe","\u0c8a"],["\u0c92\u0ccc","\u0c94"],["\u0c8b\u0cbe","\u0ce0"],["\u0d07\u0d57","\u0d08"],["\u0d09\u0d57","\u0d0a"],["\u0d0e\u0d46","\u0d10"],["\u0d12\u0d3e","\u0d13"],["\u0d12\u0d57","\u0d14"],["\u0d23\u0d4d\u200d","\u0d7a"],["\u0d28\u0d4d\u200d","\u0d7b"],["\u0d30\u0d4d\u200d","\u0d7c"],["\u0d32\u0d4d\u200d","\u0d7d"],["\u0d33\u0d4d\u200d","\u0d7e"],["\u0d85\u0dcf","\u0d86"],["\u0d85\u0dd0","\u0d87"],["\u0d85\u0dd1","\u0d88"],["\u0d8b\u0ddf","\u0d8c"],["\u0d8d\u0dd8","\u0d8e"],["\u0d8f\u0ddf","\u0d90"],["\u0d91\u0dca","\u0d92"],["\u0d91\u0dd9","\u0d93"],["\u0d94\u0ddf","\u0d96"]];b=new(c("WAFtsTokenizerBaseNormalizer"))(a);d=b;g["default"]=d}),98);
__d("WAFtsMultiLangTokenizer",["WAFtsTokenizerPostLowercaseNormalizer","WAFtsTokenizerPreNFKDNormalizer"],(function(a,b,c,d,e,f,g){"use strict";var h={NFC_CHARACTER:/(?!(?:[0-9\xB2\xB3\xB9\xBC-\xBE\u0660-\u0669\u06F0-\u06F9\u07C0-\u07C9\u0966-\u096F\u09E6-\u09EF\u09F4-\u09F9\u0A66-\u0A6F\u0AE6-\u0AEF\u0B66-\u0B6F\u0B72-\u0B77\u0BE6-\u0BF2\u0C66-\u0C6F\u0C78-\u0C7E\u0CE6-\u0CEF\u0D58-\u0D5E\u0D66-\u0D78\u0DE6-\u0DEF\u0E50-\u0E59\u0ED0-\u0ED9\u0F20-\u0F33\u1040-\u1049\u1090-\u1099\u1369-\u137C\u16EE-\u16F0\u17E0-\u17E9\u17F0-\u17F9\u1810-\u1819\u1946-\u194F\u19D0-\u19DA\u1A80-\u1A89\u1A90-\u1A99\u1B50-\u1B59\u1BB0-\u1BB9\u1C40-\u1C49\u1C50-\u1C59\u2070\u2074-\u2079\u2080-\u2089\u2150-\u2182\u2185-\u2189\u2460-\u249B\u24EA-\u24FF\u2776-\u2793\u2CFD\u3007\u3021-\u3029\u3038-\u303A\u3192-\u3195\u3220-\u3229\u3248-\u324F\u3251-\u325F\u3280-\u3289\u32B1-\u32BF\uA620-\uA629\uA6E6-\uA6EF\uA830-\uA835\uA8D0-\uA8D9\uA900-\uA909\uA9D0-\uA9D9\uA9F0-\uA9F9\uAA50-\uAA59\uABF0-\uABF9\uFF10-\uFF19]|\uD800[\uDD07-\uDD33\uDD40-\uDD78\uDD8A\uDD8B\uDEE1-\uDEFB\uDF20-\uDF23\uDF41\uDF4A\uDFD1-\uDFD5]|\uD801[\uDCA0-\uDCA9]|\uD802[\uDC58-\uDC5F\uDC79-\uDC7F\uDCA7-\uDCAF\uDCFB-\uDCFF\uDD16-\uDD1B\uDDBC\uDDBD\uDDC0-\uDDCF\uDDD2-\uDDFF\uDE40-\uDE48\uDE7D\uDE7E\uDE9D-\uDE9F\uDEEB-\uDEEF\uDF58-\uDF5F\uDF78-\uDF7F\uDFA9-\uDFAF]|\uD803[\uDCFA-\uDCFF\uDD30-\uDD39\uDE60-\uDE7E\uDF1D-\uDF26\uDF51-\uDF54\uDFC5-\uDFCB]|\uD804[\uDC52-\uDC6F\uDCF0-\uDCF9\uDD36-\uDD3F\uDDD0-\uDDD9\uDDE1-\uDDF4\uDEF0-\uDEF9]|\uD805[\uDC50-\uDC59\uDCD0-\uDCD9\uDE50-\uDE59\uDEC0-\uDEC9\uDF30-\uDF3B]|\uD806[\uDCE0-\uDCF2\uDD50-\uDD59]|\uD807[\uDC50-\uDC6C\uDD50-\uDD59\uDDA0-\uDDA9\uDFC0-\uDFD4]|\uD809[\uDC00-\uDC6E]|\uD81A[\uDE60-\uDE69\uDF50-\uDF59\uDF5B-\uDF61]|\uD81B[\uDE80-\uDE96]|\uD834[\uDEE0-\uDEF3\uDF60-\uDF78]|\uD835[\uDFCE-\uDFFF]|\uD838[\uDD40-\uDD49\uDEF0-\uDEF9]|\uD83A[\uDCC7-\uDCCF\uDD50-\uDD59]|\uD83B[\uDC71-\uDCAB\uDCAD-\uDCAF\uDCB1-\uDCB4\uDD01-\uDD2D\uDD2F-\uDD3D]|\uD83C[\uDD00-\uDD0C]|\uD83E[\uDFF0-\uDFF9]))(?:[#\*0-9\xA9\xAE\u203C\u2049\u2122\u2139\u2194-\u2199\u21A9\u21AA\u231A\u231B\u2328\u23CF\u23E9-\u23F3\u23F8-\u23FA\u24C2\u25AA\u25AB\u25B6\u25C0\u25FB-\u25FE\u2600-\u2604\u260E\u2611\u2614\u2615\u2618\u261D\u2620\u2622\u2623\u2626\u262A\u262E\u262F\u2638-\u263A\u2640\u2642\u2648-\u2653\u265F\u2660\u2663\u2665\u2666\u2668\u267B\u267E\u267F\u2692-\u2697\u2699\u269B\u269C\u26A0\u26A1\u26A7\u26AA\u26AB\u26B0\u26B1\u26BD\u26BE\u26C4\u26C5\u26C8\u26CE\u26CF\u26D1\u26D3\u26D4\u26E9\u26EA\u26F0-\u26F5\u26F7-\u26FA\u26FD\u2702\u2705\u2708-\u270D\u270F\u2712\u2714\u2716\u271D\u2721\u2728\u2733\u2734\u2744\u2747\u274C\u274E\u2753-\u2755\u2757\u2763\u2764\u2795-\u2797\u27A1\u27B0\u27BF\u2934\u2935\u2B05-\u2B07\u2B1B\u2B1C\u2B50\u2B55\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u3005\u3007\u3021-\u3029\u3030\u3038-\u303B\u303D\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FD-\u30FF\u31F0-\u31FF\u3297\u3299\u32D0-\u32FE\u3300-\u3357\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA490-\uA4C6\uF900-\uFA6D\uFA70-\uFAD9\uFF66-\uFF6F\uFF71-\uFF9D]|\uD81B[\uDFF0\uDFF1]|\uD82C[\uDC00-\uDD1E\uDD50-\uDD52\uDD64-\uDD67]|\uD83C[\uDC04\uDCCF\uDD70\uDD71\uDD7E\uDD7F\uDD8E\uDD91-\uDD9A\uDDE6-\uDE02\uDE1A\uDE2F\uDE32-\uDE3A\uDE50\uDE51\uDF00-\uDF21\uDF24-\uDF93\uDF96\uDF97\uDF99-\uDF9B\uDF9E-\uDFF0\uDFF3-\uDFF5\uDFF7-\uDFFF]|\uD83D[\uDC00-\uDCFD\uDCFF-\uDD3D\uDD49-\uDD4E\uDD50-\uDD67\uDD6F\uDD70\uDD73-\uDD7A\uDD87\uDD8A-\uDD8D\uDD90\uDD95\uDD96\uDDA4\uDDA5\uDDA8\uDDB1\uDDB2\uDDBC\uDDC2-\uDDC4\uDDD1-\uDDD3\uDDDC-\uDDDE\uDDE1\uDDE3\uDDE8\uDDEF\uDDF3\uDDFA-\uDE4F\uDE80-\uDEC5\uDECB-\uDED2\uDED5-\uDED7\uDEE0-\uDEE5\uDEE9\uDEEB\uDEEC\uDEF0\uDEF3-\uDEFC\uDFE0-\uDFEB]|\uD83E[\uDD0C-\uDD3A\uDD3C-\uDD45\uDD47-\uDD78\uDD7A-\uDDCB\uDDCD-\uDDFF\uDE70-\uDE74\uDE78-\uDE7A\uDE80-\uDE86\uDE90-\uDEA8\uDEB0-\uDEB6\uDEC0-\uDEC2\uDED0-\uDED6]|[\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879\uD880-\uD883][\uDC00-\uDFFF]|\uD869[\uDC00-\uDEDD\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A])/g,NFC_WORD:/((?!(?:[0-9\xB2\xB3\xB9\xBC-\xBE\u0660-\u0669\u06F0-\u06F9\u07C0-\u07C9\u0966-\u096F\u09E6-\u09EF\u09F4-\u09F9\u0A66-\u0A6F\u0AE6-\u0AEF\u0B66-\u0B6F\u0B72-\u0B77\u0BE6-\u0BF2\u0C66-\u0C6F\u0C78-\u0C7E\u0CE6-\u0CEF\u0D58-\u0D5E\u0D66-\u0D78\u0DE6-\u0DEF\u0E50-\u0E59\u0ED0-\u0ED9\u0F20-\u0F33\u1040-\u1049\u1090-\u1099\u1369-\u137C\u16EE-\u16F0\u17E0-\u17E9\u17F0-\u17F9\u1810-\u1819\u1946-\u194F\u19D0-\u19DA\u1A80-\u1A89\u1A90-\u1A99\u1B50-\u1B59\u1BB0-\u1BB9\u1C40-\u1C49\u1C50-\u1C59\u2070\u2074-\u2079\u2080-\u2089\u2150-\u2182\u2185-\u2189\u2460-\u249B\u24EA-\u24FF\u2776-\u2793\u2CFD\u3007\u3021-\u3029\u3038-\u303A\u3192-\u3195\u3220-\u3229\u3248-\u324F\u3251-\u325F\u3280-\u3289\u32B1-\u32BF\uA620-\uA629\uA6E6-\uA6EF\uA830-\uA835\uA8D0-\uA8D9\uA900-\uA909\uA9D0-\uA9D9\uA9F0-\uA9F9\uAA50-\uAA59\uABF0-\uABF9\uFF10-\uFF19]|\uD800[\uDD07-\uDD33\uDD40-\uDD78\uDD8A\uDD8B\uDEE1-\uDEFB\uDF20-\uDF23\uDF41\uDF4A\uDFD1-\uDFD5]|\uD801[\uDCA0-\uDCA9]|\uD802[\uDC58-\uDC5F\uDC79-\uDC7F\uDCA7-\uDCAF\uDCFB-\uDCFF\uDD16-\uDD1B\uDDBC\uDDBD\uDDC0-\uDDCF\uDDD2-\uDDFF\uDE40-\uDE48\uDE7D\uDE7E\uDE9D-\uDE9F\uDEEB-\uDEEF\uDF58-\uDF5F\uDF78-\uDF7F\uDFA9-\uDFAF]|\uD803[\uDCFA-\uDCFF\uDD30-\uDD39\uDE60-\uDE7E\uDF1D-\uDF26\uDF51-\uDF54\uDFC5-\uDFCB]|\uD804[\uDC52-\uDC6F\uDCF0-\uDCF9\uDD36-\uDD3F\uDDD0-\uDDD9\uDDE1-\uDDF4\uDEF0-\uDEF9]|\uD805[\uDC50-\uDC59\uDCD0-\uDCD9\uDE50-\uDE59\uDEC0-\uDEC9\uDF30-\uDF3B]|\uD806[\uDCE0-\uDCF2\uDD50-\uDD59]|\uD807[\uDC50-\uDC6C\uDD50-\uDD59\uDDA0-\uDDA9\uDFC0-\uDFD4]|\uD809[\uDC00-\uDC6E]|\uD81A[\uDE60-\uDE69\uDF50-\uDF59\uDF5B-\uDF61]|\uD81B[\uDE80-\uDE96]|\uD834[\uDEE0-\uDEF3\uDF60-\uDF78]|\uD835[\uDFCE-\uDFFF]|\uD838[\uDD40-\uDD49\uDEF0-\uDEF9]|\uD83A[\uDCC7-\uDCCF\uDD50-\uDD59]|\uD83B[\uDC71-\uDCAB\uDCAD-\uDCAF\uDCB1-\uDCB4\uDD01-\uDD2D\uDD2F-\uDD3D]|\uD83C[\uDD00-\uDD0C]|\uD83E[\uDFF0-\uDFF9]))[\u1100-\u11FF\u302E\u302F\u3131-\u318E\u3200-\u321E\u3260-\u327E\uA960-\uA97C\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uFFA0-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC])+|((?!(?:[0-9\xB2\xB3\xB9\xBC-\xBE\u0660-\u0669\u06F0-\u06F9\u07C0-\u07C9\u0966-\u096F\u09E6-\u09EF\u09F4-\u09F9\u0A66-\u0A6F\u0AE6-\u0AEF\u0B66-\u0B6F\u0B72-\u0B77\u0BE6-\u0BF2\u0C66-\u0C6F\u0C78-\u0C7E\u0CE6-\u0CEF\u0D58-\u0D5E\u0D66-\u0D78\u0DE6-\u0DEF\u0E50-\u0E59\u0ED0-\u0ED9\u0F20-\u0F33\u1040-\u1049\u1090-\u1099\u1369-\u137C\u16EE-\u16F0\u17E0-\u17E9\u17F0-\u17F9\u1810-\u1819\u1946-\u194F\u19D0-\u19DA\u1A80-\u1A89\u1A90-\u1A99\u1B50-\u1B59\u1BB0-\u1BB9\u1C40-\u1C49\u1C50-\u1C59\u2070\u2074-\u2079\u2080-\u2089\u2150-\u2182\u2185-\u2189\u2460-\u249B\u24EA-\u24FF\u2776-\u2793\u2CFD\u3007\u3021-\u3029\u3038-\u303A\u3192-\u3195\u3220-\u3229\u3248-\u324F\u3251-\u325F\u3280-\u3289\u32B1-\u32BF\uA620-\uA629\uA6E6-\uA6EF\uA830-\uA835\uA8D0-\uA8D9\uA900-\uA909\uA9D0-\uA9D9\uA9F0-\uA9F9\uAA50-\uAA59\uABF0-\uABF9\uFF10-\uFF19]|\uD800[\uDD07-\uDD33\uDD40-\uDD78\uDD8A\uDD8B\uDEE1-\uDEFB\uDF20-\uDF23\uDF41\uDF4A\uDFD1-\uDFD5]|\uD801[\uDCA0-\uDCA9]|\uD802[\uDC58-\uDC5F\uDC79-\uDC7F\uDCA7-\uDCAF\uDCFB-\uDCFF\uDD16-\uDD1B\uDDBC\uDDBD\uDDC0-\uDDCF\uDDD2-\uDDFF\uDE40-\uDE48\uDE7D\uDE7E\uDE9D-\uDE9F\uDEEB-\uDEEF\uDF58-\uDF5F\uDF78-\uDF7F\uDFA9-\uDFAF]|\uD803[\uDCFA-\uDCFF\uDD30-\uDD39\uDE60-\uDE7E\uDF1D-\uDF26\uDF51-\uDF54\uDFC5-\uDFCB]|\uD804[\uDC52-\uDC6F\uDCF0-\uDCF9\uDD36-\uDD3F\uDDD0-\uDDD9\uDDE1-\uDDF4\uDEF0-\uDEF9]|\uD805[\uDC50-\uDC59\uDCD0-\uDCD9\uDE50-\uDE59\uDEC0-\uDEC9\uDF30-\uDF3B]|\uD806[\uDCE0-\uDCF2\uDD50-\uDD59]|\uD807[\uDC50-\uDC6C\uDD50-\uDD59\uDDA0-\uDDA9\uDFC0-\uDFD4]|\uD809[\uDC00-\uDC6E]|\uD81A[\uDE60-\uDE69\uDF50-\uDF59\uDF5B-\uDF61]|\uD81B[\uDE80-\uDE96]|\uD834[\uDEE0-\uDEF3\uDF60-\uDF78]|\uD835[\uDFCE-\uDFFF]|\uD838[\uDD40-\uDD49\uDEF0-\uDEF9]|\uD83A[\uDCC7-\uDCCF\uDD50-\uDD59]|\uD83B[\uDC71-\uDCAB\uDCAD-\uDCAF\uDCB1-\uDCB4\uDD01-\uDD2D\uDD2F-\uDD3D]|\uD83C[\uDD00-\uDD0C]|\uD83E[\uDFF0-\uDFF9]))[\u0E01-\u0E3A\u0E40-\u0E5B])+|((?!(?:[0-9\xB2\xB3\xB9\xBC-\xBE\u0660-\u0669\u06F0-\u06F9\u07C0-\u07C9\u0966-\u096F\u09E6-\u09EF\u09F4-\u09F9\u0A66-\u0A6F\u0AE6-\u0AEF\u0B66-\u0B6F\u0B72-\u0B77\u0BE6-\u0BF2\u0C66-\u0C6F\u0C78-\u0C7E\u0CE6-\u0CEF\u0D58-\u0D5E\u0D66-\u0D78\u0DE6-\u0DEF\u0E50-\u0E59\u0ED0-\u0ED9\u0F20-\u0F33\u1040-\u1049\u1090-\u1099\u1369-\u137C\u16EE-\u16F0\u17E0-\u17E9\u17F0-\u17F9\u1810-\u1819\u1946-\u194F\u19D0-\u19DA\u1A80-\u1A89\u1A90-\u1A99\u1B50-\u1B59\u1BB0-\u1BB9\u1C40-\u1C49\u1C50-\u1C59\u2070\u2074-\u2079\u2080-\u2089\u2150-\u2182\u2185-\u2189\u2460-\u249B\u24EA-\u24FF\u2776-\u2793\u2CFD\u3007\u3021-\u3029\u3038-\u303A\u3192-\u3195\u3220-\u3229\u3248-\u324F\u3251-\u325F\u3280-\u3289\u32B1-\u32BF\uA620-\uA629\uA6E6-\uA6EF\uA830-\uA835\uA8D0-\uA8D9\uA900-\uA909\uA9D0-\uA9D9\uA9F0-\uA9F9\uAA50-\uAA59\uABF0-\uABF9\uFF10-\uFF19]|\uD800[\uDD07-\uDD33\uDD40-\uDD78\uDD8A\uDD8B\uDEE1-\uDEFB\uDF20-\uDF23\uDF41\uDF4A\uDFD1-\uDFD5]|\uD801[\uDCA0-\uDCA9]|\uD802[\uDC58-\uDC5F\uDC79-\uDC7F\uDCA7-\uDCAF\uDCFB-\uDCFF\uDD16-\uDD1B\uDDBC\uDDBD\uDDC0-\uDDCF\uDDD2-\uDDFF\uDE40-\uDE48\uDE7D\uDE7E\uDE9D-\uDE9F\uDEEB-\uDEEF\uDF58-\uDF5F\uDF78-\uDF7F\uDFA9-\uDFAF]|\uD803[\uDCFA-\uDCFF\uDD30-\uDD39\uDE60-\uDE7E\uDF1D-\uDF26\uDF51-\uDF54\uDFC5-\uDFCB]|\uD804[\uDC52-\uDC6F\uDCF0-\uDCF9\uDD36-\uDD3F\uDDD0-\uDDD9\uDDE1-\uDDF4\uDEF0-\uDEF9]|\uD805[\uDC50-\uDC59\uDCD0-\uDCD9\uDE50-\uDE59\uDEC0-\uDEC9\uDF30-\uDF3B]|\uD806[\uDCE0-\uDCF2\uDD50-\uDD59]|\uD807[\uDC50-\uDC6C\uDD50-\uDD59\uDDA0-\uDDA9\uDFC0-\uDFD4]|\uD809[\uDC00-\uDC6E]|\uD81A[\uDE60-\uDE69\uDF50-\uDF59\uDF5B-\uDF61]|\uD81B[\uDE80-\uDE96]|\uD834[\uDEE0-\uDEF3\uDF60-\uDF78]|\uD835[\uDFCE-\uDFFF]|\uD838[\uDD40-\uDD49\uDEF0-\uDEF9]|\uD83A[\uDCC7-\uDCCF\uDD50-\uDD59]|\uD83B[\uDC71-\uDCAB\uDCAD-\uDCAF\uDCB1-\uDCB4\uDD01-\uDD2D\uDD2F-\uDD3D]|\uD83C[\uDD00-\uDD0C]|\uD83E[\uDFF0-\uDFF9]))[\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF])+|((?!(?:[0-9\xB2\xB3\xB9\xBC-\xBE\u0660-\u0669\u06F0-\u06F9\u07C0-\u07C9\u0966-\u096F\u09E6-\u09EF\u09F4-\u09F9\u0A66-\u0A6F\u0AE6-\u0AEF\u0B66-\u0B6F\u0B72-\u0B77\u0BE6-\u0BF2\u0C66-\u0C6F\u0C78-\u0C7E\u0CE6-\u0CEF\u0D58-\u0D5E\u0D66-\u0D78\u0DE6-\u0DEF\u0E50-\u0E59\u0ED0-\u0ED9\u0F20-\u0F33\u1040-\u1049\u1090-\u1099\u1369-\u137C\u16EE-\u16F0\u17E0-\u17E9\u17F0-\u17F9\u1810-\u1819\u1946-\u194F\u19D0-\u19DA\u1A80-\u1A89\u1A90-\u1A99\u1B50-\u1B59\u1BB0-\u1BB9\u1C40-\u1C49\u1C50-\u1C59\u2070\u2074-\u2079\u2080-\u2089\u2150-\u2182\u2185-\u2189\u2460-\u249B\u24EA-\u24FF\u2776-\u2793\u2CFD\u3007\u3021-\u3029\u3038-\u303A\u3192-\u3195\u3220-\u3229\u3248-\u324F\u3251-\u325F\u3280-\u3289\u32B1-\u32BF\uA620-\uA629\uA6E6-\uA6EF\uA830-\uA835\uA8D0-\uA8D9\uA900-\uA909\uA9D0-\uA9D9\uA9F0-\uA9F9\uAA50-\uAA59\uABF0-\uABF9\uFF10-\uFF19]|\uD800[\uDD07-\uDD33\uDD40-\uDD78\uDD8A\uDD8B\uDEE1-\uDEFB\uDF20-\uDF23\uDF41\uDF4A\uDFD1-\uDFD5]|\uD801[\uDCA0-\uDCA9]|\uD802[\uDC58-\uDC5F\uDC79-\uDC7F\uDCA7-\uDCAF\uDCFB-\uDCFF\uDD16-\uDD1B\uDDBC\uDDBD\uDDC0-\uDDCF\uDDD2-\uDDFF\uDE40-\uDE48\uDE7D\uDE7E\uDE9D-\uDE9F\uDEEB-\uDEEF\uDF58-\uDF5F\uDF78-\uDF7F\uDFA9-\uDFAF]|\uD803[\uDCFA-\uDCFF\uDD30-\uDD39\uDE60-\uDE7E\uDF1D-\uDF26\uDF51-\uDF54\uDFC5-\uDFCB]|\uD804[\uDC52-\uDC6F\uDCF0-\uDCF9\uDD36-\uDD3F\uDDD0-\uDDD9\uDDE1-\uDDF4\uDEF0-\uDEF9]|\uD805[\uDC50-\uDC59\uDCD0-\uDCD9\uDE50-\uDE59\uDEC0-\uDEC9\uDF30-\uDF3B]|\uD806[\uDCE0-\uDCF2\uDD50-\uDD59]|\uD807[\uDC50-\uDC6C\uDD50-\uDD59\uDDA0-\uDDA9\uDFC0-\uDFD4]|\uD809[\uDC00-\uDC6E]|\uD81A[\uDE60-\uDE69\uDF50-\uDF59\uDF5B-\uDF61]|\uD81B[\uDE80-\uDE96]|\uD834[\uDEE0-\uDEF3\uDF60-\uDF78]|\uD835[\uDFCE-\uDFFF]|\uD838[\uDD40-\uDD49\uDEF0-\uDEF9]|\uD83A[\uDCC7-\uDCCF\uDD50-\uDD59]|\uD83B[\uDC71-\uDCAB\uDCAD-\uDCAF\uDCB1-\uDCB4\uDD01-\uDD2D\uDD2F-\uDD3D]|\uD83C[\uDD00-\uDD0C]|\uD83E[\uDFF0-\uDFF9]))[\u0F00-\u0F47\u0F49-\u0F6C\u0F71-\u0F97\u0F99-\u0FBC\u0FBE-\u0FCC\u0FCE-\u0FD4\u0FD9\u0FDA])+|((?!(?:[0-9\xB2\xB3\xB9\xBC-\xBE\u0660-\u0669\u06F0-\u06F9\u07C0-\u07C9\u0966-\u096F\u09E6-\u09EF\u09F4-\u09F9\u0A66-\u0A6F\u0AE6-\u0AEF\u0B66-\u0B6F\u0B72-\u0B77\u0BE6-\u0BF2\u0C66-\u0C6F\u0C78-\u0C7E\u0CE6-\u0CEF\u0D58-\u0D5E\u0D66-\u0D78\u0DE6-\u0DEF\u0E50-\u0E59\u0ED0-\u0ED9\u0F20-\u0F33\u1040-\u1049\u1090-\u1099\u1369-\u137C\u16EE-\u16F0\u17E0-\u17E9\u17F0-\u17F9\u1810-\u1819\u1946-\u194F\u19D0-\u19DA\u1A80-\u1A89\u1A90-\u1A99\u1B50-\u1B59\u1BB0-\u1BB9\u1C40-\u1C49\u1C50-\u1C59\u2070\u2074-\u2079\u2080-\u2089\u2150-\u2182\u2185-\u2189\u2460-\u249B\u24EA-\u24FF\u2776-\u2793\u2CFD\u3007\u3021-\u3029\u3038-\u303A\u3192-\u3195\u3220-\u3229\u3248-\u324F\u3251-\u325F\u3280-\u3289\u32B1-\u32BF\uA620-\uA629\uA6E6-\uA6EF\uA830-\uA835\uA8D0-\uA8D9\uA900-\uA909\uA9D0-\uA9D9\uA9F0-\uA9F9\uAA50-\uAA59\uABF0-\uABF9\uFF10-\uFF19]|\uD800[\uDD07-\uDD33\uDD40-\uDD78\uDD8A\uDD8B\uDEE1-\uDEFB\uDF20-\uDF23\uDF41\uDF4A\uDFD1-\uDFD5]|\uD801[\uDCA0-\uDCA9]|\uD802[\uDC58-\uDC5F\uDC79-\uDC7F\uDCA7-\uDCAF\uDCFB-\uDCFF\uDD16-\uDD1B\uDDBC\uDDBD\uDDC0-\uDDCF\uDDD2-\uDDFF\uDE40-\uDE48\uDE7D\uDE7E\uDE9D-\uDE9F\uDEEB-\uDEEF\uDF58-\uDF5F\uDF78-\uDF7F\uDFA9-\uDFAF]|\uD803[\uDCFA-\uDCFF\uDD30-\uDD39\uDE60-\uDE7E\uDF1D-\uDF26\uDF51-\uDF54\uDFC5-\uDFCB]|\uD804[\uDC52-\uDC6F\uDCF0-\uDCF9\uDD36-\uDD3F\uDDD0-\uDDD9\uDDE1-\uDDF4\uDEF0-\uDEF9]|\uD805[\uDC50-\uDC59\uDCD0-\uDCD9\uDE50-\uDE59\uDEC0-\uDEC9\uDF30-\uDF3B]|\uD806[\uDCE0-\uDCF2\uDD50-\uDD59]|\uD807[\uDC50-\uDC6C\uDD50-\uDD59\uDDA0-\uDDA9\uDFC0-\uDFD4]|\uD809[\uDC00-\uDC6E]|\uD81A[\uDE60-\uDE69\uDF50-\uDF59\uDF5B-\uDF61]|\uD81B[\uDE80-\uDE96]|\uD834[\uDEE0-\uDEF3\uDF60-\uDF78]|\uD835[\uDFCE-\uDFFF]|\uD838[\uDD40-\uDD49\uDEF0-\uDEF9]|\uD83A[\uDCC7-\uDCCF\uDD50-\uDD59]|\uD83B[\uDC71-\uDCAB\uDCAD-\uDCAF\uDCB1-\uDCB4\uDD01-\uDD2D\uDD2F-\uDD3D]|\uD83C[\uDD00-\uDD0C]|\uD83E[\uDFF0-\uDFF9]))[\u1000-\u109F\uA9E0-\uA9FE\uAA60-\uAA7F])+|((?!(?:[0-9\xB2\xB3\xB9\xBC-\xBE\u0660-\u0669\u06F0-\u06F9\u07C0-\u07C9\u0966-\u096F\u09E6-\u09EF\u09F4-\u09F9\u0A66-\u0A6F\u0AE6-\u0AEF\u0B66-\u0B6F\u0B72-\u0B77\u0BE6-\u0BF2\u0C66-\u0C6F\u0C78-\u0C7E\u0CE6-\u0CEF\u0D58-\u0D5E\u0D66-\u0D78\u0DE6-\u0DEF\u0E50-\u0E59\u0ED0-\u0ED9\u0F20-\u0F33\u1040-\u1049\u1090-\u1099\u1369-\u137C\u16EE-\u16F0\u17E0-\u17E9\u17F0-\u17F9\u1810-\u1819\u1946-\u194F\u19D0-\u19DA\u1A80-\u1A89\u1A90-\u1A99\u1B50-\u1B59\u1BB0-\u1BB9\u1C40-\u1C49\u1C50-\u1C59\u2070\u2074-\u2079\u2080-\u2089\u2150-\u2182\u2185-\u2189\u2460-\u249B\u24EA-\u24FF\u2776-\u2793\u2CFD\u3007\u3021-\u3029\u3038-\u303A\u3192-\u3195\u3220-\u3229\u3248-\u324F\u3251-\u325F\u3280-\u3289\u32B1-\u32BF\uA620-\uA629\uA6E6-\uA6EF\uA830-\uA835\uA8D0-\uA8D9\uA900-\uA909\uA9D0-\uA9D9\uA9F0-\uA9F9\uAA50-\uAA59\uABF0-\uABF9\uFF10-\uFF19]|\uD800[\uDD07-\uDD33\uDD40-\uDD78\uDD8A\uDD8B\uDEE1-\uDEFB\uDF20-\uDF23\uDF41\uDF4A\uDFD1-\uDFD5]|\uD801[\uDCA0-\uDCA9]|\uD802[\uDC58-\uDC5F\uDC79-\uDC7F\uDCA7-\uDCAF\uDCFB-\uDCFF\uDD16-\uDD1B\uDDBC\uDDBD\uDDC0-\uDDCF\uDDD2-\uDDFF\uDE40-\uDE48\uDE7D\uDE7E\uDE9D-\uDE9F\uDEEB-\uDEEF\uDF58-\uDF5F\uDF78-\uDF7F\uDFA9-\uDFAF]|\uD803[\uDCFA-\uDCFF\uDD30-\uDD39\uDE60-\uDE7E\uDF1D-\uDF26\uDF51-\uDF54\uDFC5-\uDFCB]|\uD804[\uDC52-\uDC6F\uDCF0-\uDCF9\uDD36-\uDD3F\uDDD0-\uDDD9\uDDE1-\uDDF4\uDEF0-\uDEF9]|\uD805[\uDC50-\uDC59\uDCD0-\uDCD9\uDE50-\uDE59\uDEC0-\uDEC9\uDF30-\uDF3B]|\uD806[\uDCE0-\uDCF2\uDD50-\uDD59]|\uD807[\uDC50-\uDC6C\uDD50-\uDD59\uDDA0-\uDDA9\uDFC0-\uDFD4]|\uD809[\uDC00-\uDC6E]|\uD81A[\uDE60-\uDE69\uDF50-\uDF59\uDF5B-\uDF61]|\uD81B[\uDE80-\uDE96]|\uD834[\uDEE0-\uDEF3\uDF60-\uDF78]|\uD835[\uDFCE-\uDFFF]|\uD838[\uDD40-\uDD49\uDEF0-\uDEF9]|\uD83A[\uDCC7-\uDCCF\uDD50-\uDD59]|\uD83B[\uDC71-\uDCAB\uDCAD-\uDCAF\uDCB1-\uDCB4\uDD01-\uDD2D\uDD2F-\uDD3D]|\uD83C[\uDD00-\uDD0C]|\uD83E[\uDFF0-\uDFF9]))[\u1780-\u17DD\u17E0-\u17E9\u17F0-\u17F9\u19E0-\u19FF])+|((?!(?:[0-9\xB2\xB3\xB9\xBC-\xBE\u0660-\u0669\u06F0-\u06F9\u07C0-\u07C9\u0966-\u096F\u09E6-\u09EF\u09F4-\u09F9\u0A66-\u0A6F\u0AE6-\u0AEF\u0B66-\u0B6F\u0B72-\u0B77\u0BE6-\u0BF2\u0C66-\u0C6F\u0C78-\u0C7E\u0CE6-\u0CEF\u0D58-\u0D5E\u0D66-\u0D78\u0DE6-\u0DEF\u0E50-\u0E59\u0ED0-\u0ED9\u0F20-\u0F33\u1040-\u1049\u1090-\u1099\u1369-\u137C\u16EE-\u16F0\u17E0-\u17E9\u17F0-\u17F9\u1810-\u1819\u1946-\u194F\u19D0-\u19DA\u1A80-\u1A89\u1A90-\u1A99\u1B50-\u1B59\u1BB0-\u1BB9\u1C40-\u1C49\u1C50-\u1C59\u2070\u2074-\u2079\u2080-\u2089\u2150-\u2182\u2185-\u2189\u2460-\u249B\u24EA-\u24FF\u2776-\u2793\u2CFD\u3007\u3021-\u3029\u3038-\u303A\u3192-\u3195\u3220-\u3229\u3248-\u324F\u3251-\u325F\u3280-\u3289\u32B1-\u32BF\uA620-\uA629\uA6E6-\uA6EF\uA830-\uA835\uA8D0-\uA8D9\uA900-\uA909\uA9D0-\uA9D9\uA9F0-\uA9F9\uAA50-\uAA59\uABF0-\uABF9\uFF10-\uFF19]|\uD800[\uDD07-\uDD33\uDD40-\uDD78\uDD8A\uDD8B\uDEE1-\uDEFB\uDF20-\uDF23\uDF41\uDF4A\uDFD1-\uDFD5]|\uD801[\uDCA0-\uDCA9]|\uD802[\uDC58-\uDC5F\uDC79-\uDC7F\uDCA7-\uDCAF\uDCFB-\uDCFF\uDD16-\uDD1B\uDDBC\uDDBD\uDDC0-\uDDCF\uDDD2-\uDDFF\uDE40-\uDE48\uDE7D\uDE7E\uDE9D-\uDE9F\uDEEB-\uDEEF\uDF58-\uDF5F\uDF78-\uDF7F\uDFA9-\uDFAF]|\uD803[\uDCFA-\uDCFF\uDD30-\uDD39\uDE60-\uDE7E\uDF1D-\uDF26\uDF51-\uDF54\uDFC5-\uDFCB]|\uD804[\uDC52-\uDC6F\uDCF0-\uDCF9\uDD36-\uDD3F\uDDD0-\uDDD9\uDDE1-\uDDF4\uDEF0-\uDEF9]|\uD805[\uDC50-\uDC59\uDCD0-\uDCD9\uDE50-\uDE59\uDEC0-\uDEC9\uDF30-\uDF3B]|\uD806[\uDCE0-\uDCF2\uDD50-\uDD59]|\uD807[\uDC50-\uDC6C\uDD50-\uDD59\uDDA0-\uDDA9\uDFC0-\uDFD4]|\uD809[\uDC00-\uDC6E]|\uD81A[\uDE60-\uDE69\uDF50-\uDF59\uDF5B-\uDF61]|\uD81B[\uDE80-\uDE96]|\uD834[\uDEE0-\uDEF3\uDF60-\uDF78]|\uD835[\uDFCE-\uDFFF]|\uD838[\uDD40-\uDD49\uDEF0-\uDEF9]|\uD83A[\uDCC7-\uDCCF\uDD50-\uDD59]|\uD83B[\uDC71-\uDCAB\uDCAD-\uDCAF\uDCB1-\uDCB4\uDD01-\uDD2D\uDD2F-\uDD3D]|\uD83C[\uDD00-\uDD0C]|\uD83E[\uDFF0-\uDFF9]))[\u02EA\u02EB\u3105-\u312F\u31A0-\u31BF])+/g},i=/(?![\u0902\u094D])(?:[\^`\xA8\xAF\xB4\xB7\xB8\u02B0-\u034E\u0350-\u0357\u035D-\u0362\u0374\u0375\u037A\u0384\u0385\u0483-\u0487\u0559\u0591-\u05A1\u05A3-\u05BD\u05BF\u05C1\u05C2\u05C4\u064B-\u0652\u0657\u0658\u06DF\u06E0\u06E5\u06E6\u06EA-\u06EC\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F5\u0818\u0819\u08E3-\u08FE\u093C\u094D\u0951-\u0954\u0971\u09BC\u09CD\u0A3C\u0A4D\u0ABC\u0ACD\u0AFD-\u0AFF\u0B3C\u0B4D\u0B55\u0BCD\u0C4D\u0CBC\u0CCD\u0D3B\u0D3C\u0D4D\u0DCA\u0E47-\u0E4C\u0E4E\u0EBA\u0EC8-\u0ECC\u0F18\u0F19\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F82-\u0F84\u0F86\u0F87\u0FC6\u1037\u1039\u103A\u1063\u1064\u1069-\u106D\u1087-\u108D\u108F\u109A\u109B\u135D-\u135F\u17C9-\u17D3\u17DD\u1939-\u193B\u1A75-\u1A7C\u1A7F\u1AB0-\u1ABD\u1B34\u1B44\u1B6B-\u1B73\u1BAA\u1BAB\u1C36\u1C37\u1C78-\u1C7D\u1CD0-\u1CE8\u1CED\u1CF4\u1CF7-\u1CF9\u1D2C-\u1D6A\u1DC4-\u1DCF\u1DF5-\u1DF9\u1DFD-\u1DFF\u1FBD\u1FBF-\u1FC1\u1FCD-\u1FCF\u1FDD-\u1FDF\u1FED-\u1FEF\u1FFD\u1FFE\u2CEF-\u2CF1\u2E2F\u302A-\u302F\u3099-\u309C\u30FC\uA66F\uA67C\uA67D\uA67F\uA69C\uA69D\uA6F0\uA6F1\uA700-\uA721\uA788-\uA78A\uA7F8\uA7F9\uA8C4\uA8E0-\uA8F1\uA92B-\uA92E\uA953\uA9B3\uA9C0\uA9E5\uAA7B-\uAA7D\uAABF-\uAAC2\uAAF6\uAB5B-\uAB5F\uAB69-\uAB6B\uABEC\uABED\uFB1E\uFE20-\uFE2F\uFF3E\uFF40\uFF70\uFF9E\uFF9F\uFFE3]|\uD800\uDEE0|\uD802[\uDEE5\uDEE6]|\uD803[\uDD22-\uDD27\uDF46-\uDF50]|\uD804[\uDCB9\uDCBA\uDD33\uDD34\uDD73\uDDC0\uDDCA-\uDDCC\uDE35\uDE36\uDEE9\uDEEA\uDF3C\uDF4D\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC42\uDC46\uDCC2\uDCC3\uDDBF\uDDC0\uDE3F\uDEB6\uDEB7\uDF2B]|\uD806[\uDC39\uDC3A\uDD3D\uDD3E\uDD43\uDDE0\uDE34\uDE47\uDE99]|\uD807[\uDC3F\uDD42\uDD44\uDD45\uDD97]|\uD81A[\uDEF0-\uDEF4\uDF30-\uDF36]|\uD81B[\uDF8F-\uDF9F\uDFF0\uDFF1]|\uD834[\uDD67-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD]|\uD838[\uDD30-\uDD36\uDEEC-\uDEEF]|\uD83A[\uDCD0-\uDCD6\uDD44-\uDD46\uDD48-\uDD4A])+/g,j=/(?:[!-#%-\/:-@\[-`\{-~\xA1\xA7\xA8\xAB\xAC\xAF\xB1\xB4\xB6-\xB8\xBB\xBF\xD7\xF7\u02C2-\u02C5\u02D2-\u02DF\u02E5-\u02EB\u02ED\u02EF-\u02FF\u0375\u037E\u0384\u0385\u0387\u03F6\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0606-\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u09FD\u0A76\u0AF0\u0C77\u0C84\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166E\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u1FBD\u1FBF-\u1FC1\u1FCD-\u1FCF\u1FDD-\u1FDF\u1FED-\u1FEF\u1FFD\u1FFE\u200D\u2010-\u2027\u2030-\u205E\u207A-\u207E\u208A-\u208E\u2118\u2140-\u2144\u214B\u2190-\u2194\u219A\u219B\u21A0\u21A3\u21A6\u21AE\u21CE\u21CF\u21D2\u21D4\u21F4-\u22FF\u2308-\u230B\u2320\u2321\u2329\u232A\u237C\u239B-\u23B3\u23DC-\u23E1\u25B7\u25C1\u25F8-\u25FF\u266F\u2768-\u2775\u27C0-\u27FF\u2900-\u2AFF\u2B30-\u2B44\u2B47-\u2B4C\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E4F\u2E52\u3001-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u309B\u309C\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA700-\uA716\uA720\uA721\uA789\uA78A\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uAB5B\uAB6A\uAB6B\uABEB\uFB29\uFBB2-\uFBC1\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE66\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0F\uFF1A-\uFF20\uFF3B-\uFF40\uFF5B-\uFF65\uFFE2\uFFE3\uFFE9-\uFFEC]|\uD800[\uDD00-\uDD02\uDF9F\uDFD0]|\uD801\uDD6F|\uD802[\uDC57\uDD1F\uDD3F\uDE50-\uDE58\uDE7F\uDEF0-\uDEF6\uDF39-\uDF3F\uDF99-\uDF9C]|\uD803[\uDEAD\uDF55-\uDF59]|\uD804[\uDC47-\uDC4D\uDCBB\uDCBC\uDCBE-\uDCC1\uDD40-\uDD43\uDD74\uDD75\uDDC5-\uDDC8\uDDCD\uDDDB\uDDDD-\uDDDF\uDE38-\uDE3D\uDEA9]|\uD805[\uDC4B-\uDC4F\uDC5A\uDC5B\uDC5D\uDCC6\uDDC1-\uDDD7\uDE41-\uDE43\uDE60-\uDE6C\uDF3C-\uDF3E]|\uD806[\uDC3B\uDD44-\uDD46\uDDE2\uDE3F-\uDE46\uDE9A-\uDE9C\uDE9E-\uDEA2]|\uD807[\uDC41-\uDC45\uDC70\uDC71\uDEF7\uDEF8\uDFFF]|\uD809[\uDC70-\uDC74]|\uD81A[\uDE6E\uDE6F\uDEF5\uDF37-\uDF3B\uDF44]|\uD81B[\uDE97-\uDE9A\uDFE2]|\uD82F\uDC9F|\uD835[\uDEC1\uDEDB\uDEFB\uDF15\uDF35\uDF4F\uDF6F\uDF89\uDFA9\uDFC3]|\uD836[\uDE87-\uDE8B]|\uD83A[\uDD5E\uDD5F]|\uD83B[\uDEF0\uDEF1]|\uD83C[\uDFFB-\uDFFF])/g,k=/(^|(?:[\t\n\r -#%-\*,-\/:;\?@\[-\]_\{\}\xA0\xA1\xA7\xAB\xB6\xB7\xBB\xBF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u09FD\u0A76\u0AF0\u0C77\u0C84\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166E\u1680\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2000-\u200A\u2010-\u2029\u202F-\u2043\u2045-\u2051\u2053-\u205F\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E4F\u2E52\u3000-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]|\uD800[\uDD00-\uDD02\uDF9F\uDFD0]|\uD801\uDD6F|\uD802[\uDC57\uDD1F\uDD3F\uDE50-\uDE58\uDE7F\uDEF0-\uDEF6\uDF39-\uDF3F\uDF99-\uDF9C]|\uD803[\uDEAD\uDF55-\uDF59]|\uD804[\uDC47-\uDC4D\uDCBB\uDCBC\uDCBE-\uDCC1\uDD40-\uDD43\uDD74\uDD75\uDDC5-\uDDC8\uDDCD\uDDDB\uDDDD-\uDDDF\uDE38-\uDE3D\uDEA9]|\uD805[\uDC4B-\uDC4F\uDC5A\uDC5B\uDC5D\uDCC6\uDDC1-\uDDD7\uDE41-\uDE43\uDE60-\uDE6C\uDF3C-\uDF3E]|\uD806[\uDC3B\uDD44-\uDD46\uDDE2\uDE3F-\uDE46\uDE9A-\uDE9C\uDE9E-\uDEA2]|\uD807[\uDC41-\uDC45\uDC70\uDC71\uDEF7\uDEF8\uDFFF]|\uD809[\uDC70-\uDC74]|\uD81A[\uDE6E\uDE6F\uDEF5\uDF37-\uDF3B\uDF44]|\uD81B[\uDE97-\uDE9A\uDFE2]|\uD82F\uDC9F|\uD836[\uDE87-\uDE8B]|\uD83A[\uDD5E\uDD5F]))((?:[0-9A-Z\^`-z\xA8\xAA\xAF\xB2-\xB5\xB7-\xBA\xBC-\xBE\xC0-\xD6\xD8-\xF6\xF8-\u034E\u0350-\u0357\u035D-\u0362\u0370-\u0377\u037A-\u037D\u037F\u0384-\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u0591-\u05A1\u05A3-\u05BD\u05BF\u05C1\u05C2\u05C4\u05D0-\u05EA\u05EF-\u05F2\u0620-\u0652\u0657\u0658\u0660-\u0669\u066E\u066F\u0671-\u06D3\u06D5\u06DF\u06E0\u06E5\u06E6\u06EA-\u06EC\u06EE-\u06FC\u06FF\u0710\u0712-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u0815\u0818-\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u08E3-\u08FE\u0904-\u0939\u093C\u093D\u094D\u0950-\u0954\u0958-\u0961\u0966-\u096F\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC\u09BD\u09CD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09E6-\u09F1\u09F4-\u09F9\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A4D\u0A59-\u0A5C\u0A5E\u0A66-\u0A6F\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC\u0ABD\u0ACD\u0AD0\u0AE0\u0AE1\u0AE6-\u0AEF\u0AF9\u0AFD-\u0AFF\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C\u0B3D\u0B4D\u0B55\u0B5C\u0B5D\u0B5F-\u0B61\u0B66-\u0B6F\u0B71-\u0B77\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BCD\u0BD0\u0BE6-\u0BF2\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C4D\u0C58-\u0C5A\u0C60\u0C61\u0C66-\u0C6F\u0C78-\u0C7E\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC\u0CBD\u0CCD\u0CDE\u0CE0\u0CE1\u0CE6-\u0CEF\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3D\u0D4D\u0D4E\u0D54-\u0D56\u0D58-\u0D61\u0D66-\u0D78\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DE6-\u0DEF\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E4C\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBA\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECC\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F33\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F82-\u0F84\u0F86-\u0F8C\u0FC6\u1000-\u102A\u1037\u1039\u103A\u103F-\u1049\u1050-\u1055\u105A-\u105D\u1061\u1063-\u1066\u1069-\u1070\u1075-\u1081\u1087-\u109B\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1369-\u137C\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17C9-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u17F0-\u17F9\u1810-\u1819\u1820-\u1878\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1939-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19DA\u1A00-\u1A16\u1A20-\u1A54\u1A75-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B05-\u1B34\u1B44-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B83-\u1BA0\u1BAA\u1BAB\u1BAE-\u1BE5\u1C00-\u1C23\u1C36\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CD0-\u1CFA\u1D00-\u1DBF\u1DC4-\u1DCF\u1DF5-\u1DF9\u1DFD-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FC4\u1FC6-\u1FD3\u1FD6-\u1FDB\u1FDD-\u1FEF\u1FF2-\u1FF4\u1FF6-\u1FFE\u2070\u2071\u2074-\u2079\u207F-\u2089\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2150-\u2189\u2460-\u249B\u24EA-\u24FF\u2776-\u2793\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2CFD\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u3192-\u3195\u31A0-\u31BF\u31F0-\u31FF\u3220-\u3229\u3248-\u324F\u3251-\u325F\u3280-\u3289\u32B1-\u32BF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA67C\uA67D\uA67F-\uA69D\uA6A0-\uA6F1\uA700-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA830-\uA835\uA840-\uA873\uA882-\uA8B3\uA8C4\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD\uA8FE\uA900-\uA925\uA92B-\uA92E\uA930-\uA946\uA953\uA960-\uA97C\uA984-\uA9B3\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAABF-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB6B\uAB70-\uABE2\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE20-\uFE2F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3E\uFF40-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC\uFFE3]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD07-\uDD33\uDD40-\uDD78\uDD8A\uDD8B\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0-\uDEFB\uDF00-\uDF23\uDF2D-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC58-\uDC76\uDC79-\uDC9E\uDCA7-\uDCAF\uDCE0-\uDCF2\uDCF4\uDCF5\uDCFB-\uDD1B\uDD20-\uDD39\uDD80-\uDDB7\uDDBC-\uDDCF\uDDD2-\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE40-\uDE48\uDE60-\uDE7E\uDE80-\uDE9F\uDEC0-\uDEC7\uDEC9-\uDEE6\uDEEB-\uDEEF\uDF00-\uDF35\uDF40-\uDF55\uDF58-\uDF72\uDF78-\uDF91\uDFA9-\uDFAF]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDCFA-\uDD27\uDD30-\uDD39\uDE60-\uDE7E\uDE80-\uDEA9\uDEB0\uDEB1\uDF00-\uDF27\uDF30-\uDF54\uDFB0-\uDFCB\uDFE0-\uDFF6]|\uD804[\uDC03-\uDC37\uDC52-\uDC6F\uDC83-\uDCAF\uDCB9\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD03-\uDD26\uDD33\uDD34\uDD36-\uDD3F\uDD44\uDD47\uDD50-\uDD73\uDD76\uDD83-\uDDB2\uDDC0-\uDDC4\uDDCA-\uDDCC\uDDD0-\uDDDA\uDDDC\uDDE1-\uDDF4\uDE00-\uDE11\uDE13-\uDE2B\uDE35\uDE36\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDEE9\uDEEA\uDEF0-\uDEF9\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3C\uDF3D\uDF4D\uDF50\uDF5D-\uDF61\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC00-\uDC34\uDC42\uDC46-\uDC4A\uDC50-\uDC59\uDC5F-\uDC61\uDC80-\uDCAF\uDCC2-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDAE\uDDBF\uDDC0\uDDD8-\uDDDB\uDE00-\uDE2F\uDE3F\uDE44\uDE50-\uDE59\uDE80-\uDEAA\uDEB6-\uDEB8\uDEC0-\uDEC9\uDF00-\uDF1A\uDF2B\uDF30-\uDF3B]|\uD806[\uDC00-\uDC2B\uDC39\uDC3A\uDCA0-\uDCF2\uDCFF-\uDD06\uDD09\uDD0C-\uDD13\uDD15\uDD16\uDD18-\uDD2F\uDD3D-\uDD3F\uDD41\uDD43\uDD50-\uDD59\uDDA0-\uDDA7\uDDAA-\uDDD0\uDDE0\uDDE1\uDDE3\uDE00\uDE0B-\uDE32\uDE34\uDE3A\uDE47\uDE50\uDE5C-\uDE89\uDE99\uDE9D\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC3F\uDC40\uDC50-\uDC6C\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD42\uDD44-\uDD46\uDD50-\uDD59\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD89\uDD97\uDD98\uDDA0-\uDDA9\uDEE0-\uDEF2\uDFB0\uDFC0-\uDFD4]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD822\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879\uD880-\uD883][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF5B-\uDF61\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDE40-\uDE96\uDF00-\uDF4A\uDF50\uDF8F-\uDF9F\uDFE0\uDFE1\uDFE3\uDFF0\uDFF1]|\uD821[\uDC00-\uDFF7]|\uD823[\uDC00-\uDCD5\uDD00-\uDD08]|\uD82C[\uDC00-\uDD1E\uDD50-\uDD52\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD834[\uDD67-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDEE0-\uDEF3\uDF60-\uDF78]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD838[\uDD00-\uDD2C\uDD30-\uDD3D\uDD40-\uDD49\uDD4E\uDEC0-\uDEF9]|\uD83A[\uDC00-\uDCC4\uDCC7-\uDCD6\uDD00-\uDD46\uDD48-\uDD4B\uDD50-\uDD59]|\uD83B[\uDC71-\uDCAB\uDCAD-\uDCAF\uDCB1-\uDCB4\uDD01-\uDD2D\uDD2F-\uDD3D\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD83C[\uDD00-\uDD0C]|\uD83E[\uDFF0-\uDFF9]|\uD869[\uDC00-\uDEDD\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A])+)[\"\'\xAB\xBB\u2018-\u201F\u2039\u203A\u2E42\u300C-\u300F\u301D-\u301F\uFE41-\uFE44\uFF02\uFF07\uFF62\uFF63]((?:[0-9A-Z\^`-z\xA8\xAA\xAF\xB2-\xB5\xB7-\xBA\xBC-\xBE\xC0-\xD6\xD8-\xF6\xF8-\u034E\u0350-\u0357\u035D-\u0362\u0370-\u0377\u037A-\u037D\u037F\u0384-\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u0591-\u05A1\u05A3-\u05BD\u05BF\u05C1\u05C2\u05C4\u05D0-\u05EA\u05EF-\u05F2\u0620-\u0652\u0657\u0658\u0660-\u0669\u066E\u066F\u0671-\u06D3\u06D5\u06DF\u06E0\u06E5\u06E6\u06EA-\u06EC\u06EE-\u06FC\u06FF\u0710\u0712-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u0815\u0818-\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u08E3-\u08FE\u0904-\u0939\u093C\u093D\u094D\u0950-\u0954\u0958-\u0961\u0966-\u096F\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC\u09BD\u09CD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09E6-\u09F1\u09F4-\u09F9\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A4D\u0A59-\u0A5C\u0A5E\u0A66-\u0A6F\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC\u0ABD\u0ACD\u0AD0\u0AE0\u0AE1\u0AE6-\u0AEF\u0AF9\u0AFD-\u0AFF\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C\u0B3D\u0B4D\u0B55\u0B5C\u0B5D\u0B5F-\u0B61\u0B66-\u0B6F\u0B71-\u0B77\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BCD\u0BD0\u0BE6-\u0BF2\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C4D\u0C58-\u0C5A\u0C60\u0C61\u0C66-\u0C6F\u0C78-\u0C7E\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC\u0CBD\u0CCD\u0CDE\u0CE0\u0CE1\u0CE6-\u0CEF\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3D\u0D4D\u0D4E\u0D54-\u0D56\u0D58-\u0D61\u0D66-\u0D78\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DE6-\u0DEF\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E4C\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBA\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECC\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F33\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F82-\u0F84\u0F86-\u0F8C\u0FC6\u1000-\u102A\u1037\u1039\u103A\u103F-\u1049\u1050-\u1055\u105A-\u105D\u1061\u1063-\u1066\u1069-\u1070\u1075-\u1081\u1087-\u109B\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1369-\u137C\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17C9-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u17F0-\u17F9\u1810-\u1819\u1820-\u1878\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1939-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19DA\u1A00-\u1A16\u1A20-\u1A54\u1A75-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B05-\u1B34\u1B44-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B83-\u1BA0\u1BAA\u1BAB\u1BAE-\u1BE5\u1C00-\u1C23\u1C36\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CD0-\u1CFA\u1D00-\u1DBF\u1DC4-\u1DCF\u1DF5-\u1DF9\u1DFD-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FC4\u1FC6-\u1FD3\u1FD6-\u1FDB\u1FDD-\u1FEF\u1FF2-\u1FF4\u1FF6-\u1FFE\u2070\u2071\u2074-\u2079\u207F-\u2089\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2150-\u2189\u2460-\u249B\u24EA-\u24FF\u2776-\u2793\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2CFD\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u3192-\u3195\u31A0-\u31BF\u31F0-\u31FF\u3220-\u3229\u3248-\u324F\u3251-\u325F\u3280-\u3289\u32B1-\u32BF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA67C\uA67D\uA67F-\uA69D\uA6A0-\uA6F1\uA700-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA830-\uA835\uA840-\uA873\uA882-\uA8B3\uA8C4\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD\uA8FE\uA900-\uA925\uA92B-\uA92E\uA930-\uA946\uA953\uA960-\uA97C\uA984-\uA9B3\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAABF-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB6B\uAB70-\uABE2\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE20-\uFE2F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3E\uFF40-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC\uFFE3]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD07-\uDD33\uDD40-\uDD78\uDD8A\uDD8B\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0-\uDEFB\uDF00-\uDF23\uDF2D-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC58-\uDC76\uDC79-\uDC9E\uDCA7-\uDCAF\uDCE0-\uDCF2\uDCF4\uDCF5\uDCFB-\uDD1B\uDD20-\uDD39\uDD80-\uDDB7\uDDBC-\uDDCF\uDDD2-\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE40-\uDE48\uDE60-\uDE7E\uDE80-\uDE9F\uDEC0-\uDEC7\uDEC9-\uDEE6\uDEEB-\uDEEF\uDF00-\uDF35\uDF40-\uDF55\uDF58-\uDF72\uDF78-\uDF91\uDFA9-\uDFAF]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDCFA-\uDD27\uDD30-\uDD39\uDE60-\uDE7E\uDE80-\uDEA9\uDEB0\uDEB1\uDF00-\uDF27\uDF30-\uDF54\uDFB0-\uDFCB\uDFE0-\uDFF6]|\uD804[\uDC03-\uDC37\uDC52-\uDC6F\uDC83-\uDCAF\uDCB9\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD03-\uDD26\uDD33\uDD34\uDD36-\uDD3F\uDD44\uDD47\uDD50-\uDD73\uDD76\uDD83-\uDDB2\uDDC0-\uDDC4\uDDCA-\uDDCC\uDDD0-\uDDDA\uDDDC\uDDE1-\uDDF4\uDE00-\uDE11\uDE13-\uDE2B\uDE35\uDE36\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDEE9\uDEEA\uDEF0-\uDEF9\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3C\uDF3D\uDF4D\uDF50\uDF5D-\uDF61\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC00-\uDC34\uDC42\uDC46-\uDC4A\uDC50-\uDC59\uDC5F-\uDC61\uDC80-\uDCAF\uDCC2-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDAE\uDDBF\uDDC0\uDDD8-\uDDDB\uDE00-\uDE2F\uDE3F\uDE44\uDE50-\uDE59\uDE80-\uDEAA\uDEB6-\uDEB8\uDEC0-\uDEC9\uDF00-\uDF1A\uDF2B\uDF30-\uDF3B]|\uD806[\uDC00-\uDC2B\uDC39\uDC3A\uDCA0-\uDCF2\uDCFF-\uDD06\uDD09\uDD0C-\uDD13\uDD15\uDD16\uDD18-\uDD2F\uDD3D-\uDD3F\uDD41\uDD43\uDD50-\uDD59\uDDA0-\uDDA7\uDDAA-\uDDD0\uDDE0\uDDE1\uDDE3\uDE00\uDE0B-\uDE32\uDE34\uDE3A\uDE47\uDE50\uDE5C-\uDE89\uDE99\uDE9D\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC3F\uDC40\uDC50-\uDC6C\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD42\uDD44-\uDD46\uDD50-\uDD59\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD89\uDD97\uDD98\uDDA0-\uDDA9\uDEE0-\uDEF2\uDFB0\uDFC0-\uDFD4]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD822\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879\uD880-\uD883][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF5B-\uDF61\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDE40-\uDE96\uDF00-\uDF4A\uDF50\uDF8F-\uDF9F\uDFE0\uDFE1\uDFE3\uDFF0\uDFF1]|\uD821[\uDC00-\uDFF7]|\uD823[\uDC00-\uDCD5\uDD00-\uDD08]|\uD82C[\uDC00-\uDD1E\uDD50-\uDD52\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD834[\uDD67-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDEE0-\uDEF3\uDF60-\uDF78]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD838[\uDD00-\uDD2C\uDD30-\uDD3D\uDD40-\uDD49\uDD4E\uDEC0-\uDEF9]|\uD83A[\uDC00-\uDCC4\uDCC7-\uDCD6\uDD00-\uDD46\uDD48-\uDD4B\uDD50-\uDD59]|\uD83B[\uDC71-\uDCAB\uDCAD-\uDCAF\uDCB1-\uDCB4\uDD01-\uDD2D\uDD2F-\uDD3D\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD83C[\uDD00-\uDD0C]|\uD83E[\uDFF0-\uDFF9]|\uD869[\uDC00-\uDEDD\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A])+)($|(?:[\t\n\r -#%-\*,-\/:;\?@\[-\]_\{\}\xA0\xA1\xA7\xAB\xB6\xB7\xBB\xBF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u09FD\u0A76\u0AF0\u0C77\u0C84\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166E\u1680\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2000-\u200A\u2010-\u2029\u202F-\u2043\u2045-\u2051\u2053-\u205F\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E4F\u2E52\u3000-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]|\uD800[\uDD00-\uDD02\uDF9F\uDFD0]|\uD801\uDD6F|\uD802[\uDC57\uDD1F\uDD3F\uDE50-\uDE58\uDE7F\uDEF0-\uDEF6\uDF39-\uDF3F\uDF99-\uDF9C]|\uD803[\uDEAD\uDF55-\uDF59]|\uD804[\uDC47-\uDC4D\uDCBB\uDCBC\uDCBE-\uDCC1\uDD40-\uDD43\uDD74\uDD75\uDDC5-\uDDC8\uDDCD\uDDDB\uDDDD-\uDDDF\uDE38-\uDE3D\uDEA9]|\uD805[\uDC4B-\uDC4F\uDC5A\uDC5B\uDC5D\uDCC6\uDDC1-\uDDD7\uDE41-\uDE43\uDE60-\uDE6C\uDF3C-\uDF3E]|\uD806[\uDC3B\uDD44-\uDD46\uDDE2\uDE3F-\uDE46\uDE9A-\uDE9C\uDE9E-\uDEA2]|\uD807[\uDC41-\uDC45\uDC70\uDC71\uDEF7\uDEF8\uDFFF]|\uD809[\uDC70-\uDC74]|\uD81A[\uDE6E\uDE6F\uDEF5\uDF37-\uDF3B\uDF44]|\uD81B[\uDE97-\uDE9A\uDFE2]|\uD82F\uDC9F|\uD836[\uDE87-\uDE8B]|\uD83A[\uDD5E\uDD5F]))/g,l=/(?:[\t\n\r -#%-\*,-\/:;\?@\[-\]_\{\}\xA0\xA1\xA7\xAB\xB6\xB7\xBB\xBF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u09FD\u0A76\u0AF0\u0C77\u0C84\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166E\u1680\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2000-\u200A\u2010-\u2029\u202F-\u2043\u2045-\u2051\u2053-\u205F\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E4F\u2E52\u3000-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]|\uD800[\uDD00-\uDD02\uDF9F\uDFD0]|\uD801\uDD6F|\uD802[\uDC57\uDD1F\uDD3F\uDE50-\uDE58\uDE7F\uDEF0-\uDEF6\uDF39-\uDF3F\uDF99-\uDF9C]|\uD803[\uDEAD\uDF55-\uDF59]|\uD804[\uDC47-\uDC4D\uDCBB\uDCBC\uDCBE-\uDCC1\uDD40-\uDD43\uDD74\uDD75\uDDC5-\uDDC8\uDDCD\uDDDB\uDDDD-\uDDDF\uDE38-\uDE3D\uDEA9]|\uD805[\uDC4B-\uDC4F\uDC5A\uDC5B\uDC5D\uDCC6\uDDC1-\uDDD7\uDE41-\uDE43\uDE60-\uDE6C\uDF3C-\uDF3E]|\uD806[\uDC3B\uDD44-\uDD46\uDDE2\uDE3F-\uDE46\uDE9A-\uDE9C\uDE9E-\uDEA2]|\uD807[\uDC41-\uDC45\uDC70\uDC71\uDEF7\uDEF8\uDFFF]|\uD809[\uDC70-\uDC74]|\uD81A[\uDE6E\uDE6F\uDEF5\uDF37-\uDF3B\uDF44]|\uD81B[\uDE97-\uDE9A\uDFE2]|\uD82F\uDC9F|\uD836[\uDE87-\uDE8B]|\uD83A[\uDD5E\uDD5F])+/g,m=/(?:[\$\xA2-\xA5\u058F\u060B\u07FE\u07FF\u09F2\u09F3\u09FB\u0AF1\u0BF9\u0E3F\u17DB\u20A0-\u20BF\uA838\uFDFC\uFE69\uFF04\uFFE0\uFFE1\uFFE5\uFFE6]|\uD807[\uDFDD-\uDFE0]|\uD838\uDEFF|\uD83B\uDCB0)+/g;function n(a){return a.replace(k,function(a,b,c,d,e){return" "+c+d+" "+c+" "+d+" "})}function o(a){return a.split(l)}function p(a){return a.replace(j,"")}function q(a){return a.replace(i,"")}function r(a){return a.normalize("NFC").replace(h.NFC_CHARACTER,function(a){return" "+a+" "})}function s(a){return a.normalize("NFC").replace(h.NFC_WORD,function(a){return" "+a+" "})}function t(a){return a.replace(m,function(a){return" "+a+" "})}a=function(){function a(){}var b=a.prototype;b.tokenize=function(a){a===void 0&&(a="");a=n(a);a=t(r(s(a)));a=o(a);a=a.map(function(a){a=a;a=p(a);if(!a.length)return a;else a.match(h.NFC_CHARACTER)?a=a.normalize("NFC"):a.match(h.NFC_WORD)?a=a.normalize("NFC"):(a=q(c("WAFtsTokenizerPreNFKDNormalizer").normalize(a).normalize("NFKD")),a=a.toLocaleLowerCase("en-US"),a=c("WAFtsTokenizerPostLowercaseNormalizer").normalize(a));return a});return new Set(a.filter(function(a){return!!a&&!!a.trim()&&!a.match(l)}))};return a}();g["default"]=a}),98);
__d("MAWDbStaleQueue",["MAWODSProxy","MAWSharedCOPLogger","WAGetPlatformFromStanzaId","WAOdsEnums","WAPersistedQueue","WAPersistedQueueApi","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Dropping: ",", error: ",". Source: ",""]);h=function(){return a};return a}var i=null;function j(){if(i)return i;var a=d("WAPersistedQueue").initPersistedQueue("staleQueue",d("WAPersistedQueueApi").dexieApiForPersistedQueue());i=a;return a}function a(a,b){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var e=a.type==="message"?a.subtype!=null?d("WAGetPlatformFromStanzaId").getPlatformFromStanzaId(a.stanzaId):d("WAGetPlatformFromStanzaId").getPlatformFromStanzaId(a.message.details.externalId):null;c("MAWSharedCOPLogger").EXPECTED_ERROR(h(),a.type,b,e);d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.POISON_QUEUE_ENTTITY,key:""+a.type});e=j();if(a.type!=="message")return;return e.addAndCommit([{exception:b,stanza:a}])});return k.apply(this,arguments)}e=function(){return j().read({limit:1}).then(function(a){return a.length===0})};f=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a===void 0&&(a=500);a=j().read({limit:a});a=(yield a.then(function(a){return a.flatMap(function(a){return a})}));return a});return function(b){return a.apply(this,arguments)}}();g.mawAddStaleStanza=a;g.isEmpty=e;g.read=f}),98);
__d("MAWIsQuotaExceededError",[],(function(a,b,c,d,e,f){"use strict";a=function(a){return a.name==="QuotaExceededError"||a.inner&&a.inner.name==="QuotaExceededError"};f.isQuotaExceededError=a}),66);
__d("MAWSharedRestoreUnavailableMessages",["LSMEBTaskCreationSource","MAWBridgeEventTransmitter","WAGlobals","WAJids","setTimeout"],(function(a,b,c,d,e,f,g){"use strict";var h=1e4,i=new Map();function j(a){if(i.has(a.externalId))return;i.set(a.externalId,!0);c("setTimeout")(function(){var b=a.chat;d("MAWBridgeEventTransmitter").issuePointQueryOutsideTxn(a.externalId,d("WAJids").threadIdForChatJid(b),void 0,c("LSMEBTaskCreationSource").EB_POINT_QUERY_RETRY_DECRYPTION_FAILURES,b)},h)}function a(a){a.forEach(function(a){if(a.type!=="message")return;if(a.subtype!=null){if(a.subtype==="unavailable"||a.subtype==="ciphertext"){var b=d("WAJids").extractUserJid(a.from);j({author:d("WAGlobals").getMyUserJid()===b?"@me":b,chat:a.jid,externalId:a.stanzaId})}}else(a.message.decrypted.type==="IncomingCiphertextMsg"||a.message.decrypted.type==="UnavailableMsg")&&j(a.message.decrypted.id)})}g.restoreUnavailableMessages=a}),98);
__d("MAWSharedCOPHandleBatch",["MAWDbStaleQueue","MAWIsQuotaExceededError","MAWSharedCOPLogger","MAWSharedRestoreUnavailableMessages","WAProtocolQueue","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Received more than 1 entry, despite having limit === 1"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed processing "," items"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[ackProtocols] Cannot ack from MAWConsumer: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Runtime error while processing stanzas batch. ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Quota exceeded while processing stanzas batch. ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose([""," stanzas. Config:",""]);m=function(){return a};return a}function n(a,b,c,d){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f){var g=(yield a(b));b.order==="desc"&&(g=g.toReversed());if(g.length===0)return{exhausted:!0,handled:0};f==null?void 0:f.publish({type:"maw-infra-batch"});c("MAWSharedCOPLogger").LOG(m(),g.length,b);d("MAWSharedRestoreUnavailableMessages").restoreUnavailableMessages(g);var o=(yield e(g).then(function(a){return[a,null,!1]})["catch"](function(a){if(d("MAWIsQuotaExceededError").isQuotaExceededError(a)){c("MAWSharedCOPLogger").ERROR(l(),a);return[[],null,!0]}c("MAWSharedCOPLogger").ERROR(k(),a);return[[],a instanceof Error?a:c("err")(""+a),!1]})),p=o[0],q=o[1];o=o[2];if(o)return{exhausted:!0,handled:0};yield d("WAProtocolQueue").protocolQueue().ack(p)["catch"](function(a){return c("MAWSharedCOPLogger").ERROR(j(),a)});if(p.length>=g.length)return{exhausted:!1,handled:p.length};c("MAWSharedCOPLogger").WARN(i(),g.length-p.length);if(b.limit===1){g.length>1&&c("MAWSharedCOPLogger").ERROR(h());if(g.length===0)return{exhausted:!1,handled:0};o=g[0];q=(g=q==null?void 0:q.toString())!=null?g:"not-processed";yield d("WAProtocolQueue").protocolQueue()["delete"]([o.stanzaQueueId]);yield d("MAWDbStaleQueue").mawAddStaleStanza(o,q);return{exhausted:!1,handled:1}}o=(yield n(a,{limit:Math.ceil(((g=b.limit)!=null?g:1)/2),order:b.order},e,f));return{exhausted:!1,handled:p.length+o.handled}});return o.apply(this,arguments)}g.copHandleBatch=n}),98);
__d("WAPromiseEach",["regeneratorRuntime"],(function(a,b,c,d,e,f){"use strict";a=function(a,c){var d,e;return b("regeneratorRuntime").async(function(f){while(1)switch(f.prev=f.next){case 0:d=[],e=0;case 2:if(!(e<a.length)){f.next=11;break}f.t0=d;f.next=6;return b("regeneratorRuntime").awrap(c(a[e]));case 6:f.t1=f.sent,f.t0.push.call(f.t0,f.t1);case 8:e++;f.next=2;break;case 11:return f.abrupt("return",d);case 12:case"end":return f.stop()}},null,this)};f.promiseEach=a}),66);
__d("MAWSharedCOPHandler",["MAWSharedCOPHandleBatch","MAWSharedCOPLogger","WAPromiseEach","WAProtocolQueue","asyncToGeneratorRuntime","gkx","justknobx"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Processed "," stanzas. Exhausted: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[SafeGuard] Processing get downgraded to in order processing. Verify if it's intentional"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[UserBlocking] Processed "," stanzas from "," chats"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[LoadMoreMsgs] "," requested: ",", processed: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[OnDemand] Fatal: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[UserFacing] Processed "," stanzas. Exhausted: ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Background] Processed "," stanzas. Exhausted: ",""]);n=function(){return a};return a}var o=c("justknobx")._("2541"),p=c("justknobx")._("2542"),q=c("justknobx")._("2653");function a(a){return r.apply(this,arguments)}function r(){r=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a.processEntries;var b=q?"desc":"asc",e=c("justknobx")._("2539");e=(yield d("MAWSharedCOPHandleBatch").copHandleBatch(d("WAProtocolQueue").protocolQueue().index("priority").read,{limit:e,order:b},a,null));b=e.exhausted;a=e.handled;c("MAWSharedCOPLogger").LOG(n(),a,b);return{exhausted:b,handled:a}});return r.apply(this,arguments)}function e(a){return s.apply(this,arguments)}function s(){s=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.activeJid;a=a.processEntries;if(!q)return w({processEntries:a}).then(function(){return{exhausted:!0}});var e={exhausted:!0,handled:0};b!=null&&(e=(yield d("MAWSharedCOPHandleBatch").copHandleBatch(d("WAProtocolQueue").protocolQueue().index("[jid+priority]").equals([b,d("WAProtocolQueue").WAProtocolQueuePriorityHigh]).read,{limit:p,order:"desc"},a,null)));b=e.handled;e.exhausted&&(e=(yield d("MAWSharedCOPHandleBatch").copHandleBatch(d("WAProtocolQueue").protocolQueue().index("priority").equals([d("WAProtocolQueue").WAProtocolQueuePriorityHigh]).read,{limit:p,order:"desc"},a,null)),b+=e.handled);b>0&&c("MAWSharedCOPLogger").LOG(m(),b,e.exhausted);return{exhausted:e.exhausted}});return s.apply(this,arguments)}function f(a){return t.apply(this,arguments)}function t(){t=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.activeJid,e=a.count;a=a.processEntries;if(!q)return;a=(yield d("MAWSharedCOPHandleBatch").copHandleBatch(d("WAProtocolQueue").protocolQueue().index("[jid+priority]").equals([b,d("WAProtocolQueue").WAProtocolQueuePriorityHigh]).read,{limit:e,order:"desc"},a,null)["catch"](function(a){c("MAWSharedCOPLogger").ERROR(l(),a)}));c("MAWSharedCOPLogger").LOG(k(),b,e,a==null?void 0:a.handled)});return t.apply(this,arguments)}function u(a){return v.apply(this,arguments)}function v(){v=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=a.activeChat,f=a.processEntries,g=a.pubSub;a=a.recentChats;if(!q)return w({processEntries:f,pubSub:g});var h=0;yield d("WAPromiseEach").promiseEach(a,function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=c("gkx")("4258")&&a!==e?1:o;a=(yield d("MAWSharedCOPHandleBatch").copHandleBatch(d("WAProtocolQueue").protocolQueue().index("[jid+priority]").equals([a,d("WAProtocolQueue").WAProtocolQueuePriorityHigh]).read,{limit:b,order:"desc"},f,g));h+=a.handled});return function(b){return a.apply(this,arguments)}}());c("MAWSharedCOPLogger").LOG(j(),h,a.length)});return v.apply(this,arguments)}function w(a){return x.apply(this,arguments)}function x(){x=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.processEntries;a=a.pubSub;c("MAWSharedCOPLogger").ERROR(i());a==null?void 0:a.publish({type:"idle-oq-safe-guard"});var e=d("WAProtocolQueue").protocolQueue().index("priority").equals([d("WAProtocolQueue").WAProtocolQueuePriorityHigh]).read;while((f=(yield d("MAWSharedCOPHandleBatch").copHandleBatch(e,{limit:c("justknobx")._("2540"),order:"asc"},b,(f=a)!=null?f:null))).exhausted===!1){var f;c("MAWSharedCOPLogger").LOG(h(),f.handled,f.exhausted)}});return x.apply(this,arguments)}g.copHandleBackgroundBatch=a;g.copHandleUserFacingBatch=e;g.copHandleMessagesOnDemand=f;g.copHandleRecentMessages=u}),98);
__d("MAWSharedCOPLoop",["$InternalEnum","MAWSharedCOPLogger","Promise","WAResolvable","WAShiftTimer","justknobx"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Completed: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Started: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Stuck: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Possibly stuck: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["COPLoop fatal: ",""]);m=function(){return a};return a}var n=b("$InternalEnum")({BLOCKING:-1,NON_BLOCKING:0,BASE_TIMEOUT:2}),o=0,p=1,q=2,r=function(){function a(){var a=this;this.$2=0;this.$3=60;this.$4=30;this.$5=c("justknobx")._("2543");this.$6=new(d("WAResolvable").Resolvable)();this.$7=new(d("WAResolvable").Resolvable)();this.$8=new(d("WAResolvable").Resolvable)();this.$9=new(d("WAShiftTimer").ShiftTimer)(function(){try{a.$10()}catch(b){c("MAWSharedCOPLogger").ERROR(m(),b),a.$9.onOrBefore(a.$5)}});this.$11=c("MAWSharedCOPLogger").TAGS(["loop"]);this.$12=[new Map(),new Map(),new Map()]}var e=a.prototype;e.$13=function(){if(!this.$1)return;this.$2++;switch(this.$1.behaviour){case n.BLOCKING:break;case n.NON_BLOCKING:this.$1=null;return;case n.BASE_TIMEOUT:if(this.$2>Number(n.BASE_TIMEOUT)){this.$1=null;return}break}if(!this.$1)return;var a=this.$1;this.$2>this.$4&&a.stuck===!1&&(a.stuck=!0,this.$11.WARN(l(),a.id));this.$2>this.$3&&(this.$11.ERROR(k(),a.id),this.$1=null)};e.$14=function(){var a=this;if(this.$1!=null)return{endReached:!1};for(var b=o;b<=q;b++){var c=this.$12[b].entries().next().value;if(c!=null){var d=function(){var d=c[0],e=c[1];a.$12[b]["delete"](d);a.$1=e;a.$2=0;a.$11.LOG(j(),e.id);e.fn()["finally"](function(){a.$2=0,a.$11.LOG(i(),e.id),a.$1=null,(a.$12[o].size>0||a.$5===0)&&a.$9.forceRunNow()});return{v:{endReached:!1}}}();if(typeof d==="object")return d.v}b===o&&this.$6.resolve();b===p&&this.$7.resolve();b===q&&this.$8.resolve()}return{endReached:!0}};e.$10=function(){this.$13();var a=this.$14();a=a.endReached;a||this.$9.onOrBefore(this.$5)};e.$15=function(a,c,e,f){var g;for(var i=q;i>a;i--){var j=this.$12[i].get(c);j!=null&&(g=j.resolvable,this.$12[i]["delete"](c))}for(j=o;j<a;j++){i=this.$12[j].get(c);if(i!=null)return i.resolvable.promise}g==null&&(g=new(d("WAResolvable").Resolvable)());i={behaviour:f,fn:function(b){function a(){return b.apply(this,arguments)}a.toString=function(){return b.toString()};return a}(function(){g.resolve((h||(h=b("Promise"))).resolve().then(e));return g.promise}),id:c,resolvable:g,stuck:!1};this.$12[a].set(c,i);a===o&&this.$1==null?this.$9.forceRunNow():this.$9.onOrBefore(this.$5);return g.promise};e.awaitUserBlocking=function(a,b,c){this.$6.resolveWasCalled()&&(this.$6=new(d("WAResolvable").Resolvable)());this.$7.resolveWasCalled()&&(this.$7=new(d("WAResolvable").Resolvable)());this.$8.resolveWasCalled()&&(this.$8=new(d("WAResolvable").Resolvable)());return this.$15(o,a,b,c)};e.awaitUserFacing=function(a,b,c){this.$7.resolveWasCalled()&&(this.$7=new(d("WAResolvable").Resolvable)());this.$8.resolveWasCalled()&&(this.$8=new(d("WAResolvable").Resolvable)());return this.$15(p,a,b,c)};e.awaitBackground=function(a,b,c){this.$8.resolveWasCalled()&&(this.$8=new(d("WAResolvable").Resolvable)());return this.$15(q,a,b,c)};e.waitForBackgroundQueueEmpty=function(){return this.$8.promise};e.waitForUserFacingQueueEmpty=function(){return this.$7.promise};e.waitForUserUnblocked=function(){return this.$6.promise};return a}();function a(a){return"p0-"+a}var s=0;function e(a){s++;return a+"-"+s}function f(a){return a}var t="cop-rest",u="cop-user-facing",v="cop-user-blocking";g.COPBehaviour=n;g.COPLoop=r;g.makeChatCopId=a;g.makeCopGUID=e;g.makeCopNonUniqueId=f;g.copBackground=t;g.copUserFacing=u;g.copUserBlocking=v}),98);
__d("MAWSharedStaleQueueReporter",["MAWDbStaleQueue","MAWQplProxy","asyncToGeneratorRuntime","justknobx","qpl"],(function(a,b,c,d,e,f,g){"use strict";function a(){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("MAWDbStaleQueue").isEmpty());if(a)return;a=c("justknobx")._("1498");a=(yield d("MAWDbStaleQueue").read(a));var b=a.map(function(a){return[a.dbVersion,a.exception]});d("MAWQplProxy").startQplUserFlow(c("qpl")._(1056849770,"993"),{"int":{count:a.length},string_array:{dbErrors:Array.from(new Set(b.map(function(a){return a[1]}))),dbVersions:Array.from(new Set(b.map(function(a){return""+a[0]})))}}).endSuccess()});return h.apply(this,arguments)}g["default"]=a}),98);
__d("MAWSharedCOP",["FBLogger","MAWSharedCOPHandler","MAWSharedCOPLogger","MAWSharedCOPLoop","MAWSharedStaleQueueReporter","Promise","WAPubSub","WAWaitForUserUnblocked","WorkerScheduler","asyncToGeneratorRuntime","err","gkx","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["StaleQueue: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["StaleQueue: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["IdleOQ: Offline"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Background FATAL: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Background FATAL: ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["HighPri FATAL: ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["HighPri FATAL: ",""]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["HighPri FATAL: ",""]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["HighPri FATAL: ",""]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["IdleOQ M2: Online"]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["UserFacing FATAL: ",""]);s=function(){return a};return a}function t(){var a=babelHelpers.taggedTemplateLiteralLoose(["UserFacing FATAL: ",""]);t=function(){return a};return a}function u(){return c("gkx")("5571")||c("gkx")("5625")}var v=function(){function a(a){var e=this;this.$1="offline";this.$2=d("WAPubSub").simplePubSub();this.$4=null;this.$5=new Set();this.$10=null;this.$7=function(){if(u()){var a=!1;if(e.$10!=null)return;e.$10=e.$6.run({dedupe:!0,fn:function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){a=(yield d("MAWSharedCOPHandler").copHandleUserFacingBatch({activeJid:e.$4,processEntries:e.$3})).exhausted});function f(){return c.apply(this,arguments)}return f}(),name:"user-facing"});e.$10.promise["catch"](function(a){c("MAWSharedCOPLogger").ERROR(t(),a)})["finally"](function(){e.$10=null,a||e.$7()})}else e.queue.awaitUserFacing(d("MAWSharedCOPLoop").copUserFacing,b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("MAWSharedCOPHandler").copHandleUserFacingBatch({activeJid:e.$4,processEntries:e.$3}));a=a.exhausted;a||e.$7()}),d("MAWSharedCOPLoop").COPBehaviour.BLOCKING)["catch"](function(a){c("MAWSharedCOPLogger").ERROR(s(),a),e.$7()})};this.$11=null;this.queue=new(d("MAWSharedCOPLoop").COPLoop)();this.$6=d("WorkerScheduler").makeScheduler("cop",{concurrency:1,maxConcurrency:1,maxThrottleMs:200});this.$3=a}var e=a.prototype;e.handleThreadMetadata=function(a){var b=this;a.forEach(function(a){b.$5.add(a)})};e.onlineProcessing=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=this;c("MAWSharedCOPLogger").LOG(r());if(u())try{yield this.$6.run({fn:function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield d("MAWSharedCOPHandler").copHandleUserFacingBatch({activeJid:void 0,processEntries:a.$3})});function e(){return c.apply(this,arguments)}return e}(),name:"online",priority:d("WorkerScheduler").BLOCKING_PRIORITY}).promise}catch(a){c("MAWSharedCOPLogger").ERROR(q(),a)}finally{this.$7(),this.$8()}else try{yield this.queue.awaitUserBlocking(d("MAWSharedCOPLoop").makeCopNonUniqueId("online"),b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield d("MAWSharedCOPHandler").copHandleUserFacingBatch({activeJid:void 0,processEntries:a.$3})}),d("MAWSharedCOPLoop").COPBehaviour.BLOCKING)}catch(a){c("MAWSharedCOPLogger").ERROR(p(),a)}finally{this.$7(),this.$8()}});function e(){return a.apply(this,arguments)}return e}();e.$9=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=this;this.$2.publish({type:"maw-infra-start"});this.$4!=null&&this.$5.add(this.$4);if(u())try{yield this.$6.run({dedupe:!0,fn:function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield d("MAWSharedCOPHandler").copHandleRecentMessages({activeChat:a.$4,processEntries:a.$3,pubSub:a.$2,recentChats:Array.from(a.$5)}),a.$2.publish({success:!0,type:"maw-infra-end"})});function e(){return c.apply(this,arguments)}return e}(),name:"unblock-user",priority:d("WorkerScheduler").BLOCKING_PRIORITY}).promise}catch(a){c("MAWSharedCOPLogger").ERROR(o(),a),this.$2.publish({success:!1,type:"maw-infra-end"})}finally{this.$7()}else try{yield this.queue.awaitUserBlocking(d("MAWSharedCOPLoop").copUserBlocking,b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield d("MAWSharedCOPHandler").copHandleRecentMessages({activeChat:a.$4,processEntries:a.$3,pubSub:a.$2,recentChats:Array.from(a.$5)}),a.$2.publish({success:!0,type:"maw-infra-end"})}),d("MAWSharedCOPLoop").COPBehaviour.BLOCKING)}catch(a){c("MAWSharedCOPLogger").ERROR(n(),a),this.$2.publish({success:!1,type:"maw-infra-end"})}finally{this.$7()}});function e(){return a.apply(this,arguments)}return e}();e.$8=function(){var a=this;if(u()){var e=!1;if(this.$11!=null)return;this.$11=this.$6.run({dedupe:!0,fn:function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){e=(yield d("MAWSharedCOPHandler").copHandleBackgroundBatch({processEntries:a.$3})).exhausted});function f(){return c.apply(this,arguments)}return f}(),name:"background",priority:d("WorkerScheduler").BACKGROUND_PRIORITY});this.$11.promise["catch"](function(a){c("MAWSharedCOPLogger").ERROR(m(),a)})["finally"](function(){a.$11=null,e||a.$8()})}else this.queue.awaitBackground(d("MAWSharedCOPLoop").copBackground,b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var b=(yield d("MAWSharedCOPHandler").copHandleBackgroundBatch({processEntries:a.$3}));b=b.exhausted;b||a.$8()}),d("MAWSharedCOPLoop").COPBehaviour.BLOCKING)["catch"](function(b){c("MAWSharedCOPLogger").ERROR(l(),b),a.$8()})};e.$12=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){c("MAWSharedCOPLogger").LOG(k());yield this.$9();this.$5.clear();this.$7();this.$8();u()?this.$6.run({dedupe:!0,fn:function(){return c("MAWSharedStaleQueueReporter")()},name:"stale-queue-report",priority:d("WorkerScheduler").BACKGROUND_PRIORITY}).promise["catch"](function(a){c("MAWSharedCOPLogger").ERROR(j(),a)}):this.queue.awaitBackground(d("MAWSharedCOPLoop").makeCopNonUniqueId("stale-queue-report"),function(){return c("MAWSharedStaleQueueReporter")()},d("MAWSharedCOPLoop").COPBehaviour.NON_BLOCKING)["catch"](function(a){c("MAWSharedCOPLogger").ERROR(i(),a)});return});function e(){return a.apply(this,arguments)}return e}();e.loadMoreMsgs=function(a,c){var e=this;this.$4=a;if(!d("WAWaitForUserUnblocked").isStillWaitingForUserUnblocked())return(h||(h=b("Promise"))).resolve();if(u())return this.$6.run({fn:function(){return d("MAWSharedCOPHandler").copHandleMessagesOnDemand({activeJid:a,count:c,processEntries:e.$3})},name:"load-more-msgs-"+a,priority:d("WorkerScheduler").BLOCKING_PRIORITY}).promise;else return this.queue.awaitUserBlocking(d("MAWSharedCOPLoop").makeCopNonUniqueId("load-more-msgs-"+a),function(){return d("MAWSharedCOPHandler").copHandleMessagesOnDemand({activeJid:a,count:c,processEntries:e.$3})},d("MAWSharedCOPLoop").COPBehaviour.BLOCKING)};e.subscribeToOfflineQueue=function(a,b){var e=this;a.subscribe(function(a){switch(a.type){case"offline-start":e.$1="offline";d("WAWaitForUserUnblocked").maybeResetWaitForUserUnblocked();break;case"offline-end":e.$1="online";e.$12()["finally"](function(){d("WAWaitForUserUnblocked").unblockUser()});break;default:a.type;break}});b.subscribe(function(a){switch(a.type){case"flush":if(e.$1!=="online")return;c("promiseDone")(e.onlineProcessing());return}})};e.awaitBackground=function(a,b){var c=this;return d("WAWaitForUserUnblocked").waitForUserUnblocked().then(function(){if(u())return c.$6.run({dedupe:!0,fn:b,name:a,priority:d("WorkerScheduler").BACKGROUND_PRIORITY}).promise;else return c.queue.awaitBackground(a,b,d("MAWSharedCOPLoop").COPBehaviour.NON_BLOCKING)})};e.subscribe=function(a){return this.$2.subscribe(a)};e.TEST_ONLY_setMode=function(a){this.$1=a};e.TEST_ONLY_getMode=function(){return this.$1};return a}(),w=null;function a(a){w!==null&&c("FBLogger")("messenger_e2ee_web").mustfix("COP init is called twice");w=new v(a);return w}function e(){if(w===null){c("FBLogger")("messenger_e2ee_web").mustfix("COP is called before init");throw c("err")("COP is called before init")}return w}g.COP=v;g.makeCOP=a;g.getCOP=e}),98);
__d("MAWGetProtocolMsgIdByMsgId",["MAWDexieTable","MAWIndexedDb","MAWTransactionMode","WAJids"],(function(a,b,c,d,e,f,g){"use strict";b=d("MAWIndexedDb").makeMsgrTransactor({messages:(a=d("MAWTransactionMode")).READONLY,reactions:a.READONLY,threads:a.READONLY,unrenderedMessages:a.READONLY},"getProtocolMsgByMsgId",function(a){return function(b){return d("MAWDexieTable").dexieAll([a.messages.get({msgId:b}),a.unrenderedMessages.get({msgId:b}),a.reactions.get({reactionId:b})]).then(function(b){var c=b[0],e=b[1];b=b[2];if(b!=null)if(d("WAJids").isAuthorSystem(b.author))return null;else return{author:b.author,chat:b.threadJid,externalId:b.externalId};var f=c||e;return f==null?null:a.threads.get({jid:f.threadJid}).then(function(a){if(a==null)return null;return d("WAJids").isAuthorSystem(f.author)?null:{author:f.author,chat:a.jid,externalId:f.externalId}})})}});g.getProtocolMsgIdByMsgId=b}),98);
__d("MAWGetDownloadableThumbnailForMediaApi",["MAWOptimisticUploadManager","WALogger","WAMediaUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["GetDownloadableThumbnail - previewEntry optimistedPromise rejected with ",""]);h=function(){return a};return a}a=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=d("MAWOptimisticUploadManager").getOptimisticUploadManager().get(a);if(a==null)return null;a=a.previewPlaintextHash;if(a==null)return null;var b=d("MAWOptimisticUploadManager").getOptimisticUploadManager().get(a);if(b==null)return null;try{yield b.optimisticUploadPromise}catch(a){d("WALogger").ERROR(h(),a);return null}a=(b=d("MAWOptimisticUploadManager").getOptimisticUploadManager().get(a))==null?void 0:b.mediaEntry;if(a==null)return null;b=d("WAMediaUtils").decodeMediaEntryData(a);a=b.directPath;var c=b.fileEncSha256,e=b.fileSha256,f=b.mediaKey,g=b.mediaKeyTimestamp;b=b.objectId;return{directPath:a,fileEncSha256:c,fileSha256:e,mediaKey:f,mediaKeyTimestamp:g,objectId:b}});return function(b){return a.apply(this,arguments)}}();g.getDownloadableThumbnailForMedia=a}),98);
__d("MAWGetMediaKnownEntriesApi",["MAWDbMediaTxns","MAWDbMsgTxns","MAWDexieTable","MAWIndexedDb","MAWTransactionMode","WAHashUtils","WAJids","WAMsgMap","WAResultOrError","WATagsLogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Message missing in messages table for given msgId for plaintextHash ",". Skipping..."]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["No existing media entry found for plaintextHash ",". Returning new MsgMap."]);i=function(){return a};return a}var j=d("WATagsLogger").TAGS(["GetMediaKnownEntries"]);a=d("MAWIndexedDb").makeMsgrTransactor({media:d("MAWTransactionMode").READONLY,messages:d("MAWTransactionMode").READONLY},"getMediaKnownEntries",function(a){return function(b){return k(a,b)}});function k(a,b){return d("MAWDbMediaTxns").maybeGetMediaFromPlaintextHash(a,b).then(function(c){if(!c){j.LOG(i(),d("WAHashUtils").sanitisePlaintextHash(b));return d("WAResultOrError").makeError("no-media-entry-by-plaintext-hash")}var e=Array.from(c.mediaEntries.keys());return d("MAWDexieTable").dexieAll(e.map(function(b){return d("MAWDbMsgTxns").maybeGetMsgListByMsgId_I_KNOW_WHAT_I_AM_DOING(a,b)})).then(function(a){a=a.map(function(a){return a.find(function(a){return(a==null?void 0:a.mediaId)===c.mediaId})});var f=[];a=a.reduce(function(a,g,i){if(!g){j.WARN(h(),d("WAHashUtils").sanitisePlaintextHash(b));f.push(e[i]);return a}i=c.mediaEntries.get(g.msgId);var k=g.author,l=g.threadJid;i&&!d("WAJids").isAuthorSystem(k)&&l!=null&&a.set({author:k,chat:l,externalId:g.externalId},i);return a},new(d("WAMsgMap").MsgMap)());return{missingMessages:f,msgMap:a,numEntries:e.length}}).then(d("WAResultOrError").makeResult)})}g.getMediaKnownEntries=a;g.getMediaKnownEntriesTxn=k}),98);
__d("MAWGetOrCreateMediaKnownEntriesApi",["MAWGetMediaKnownEntriesApi","MAWIndexedDb","MAWTransactionMode","WAMsgMap"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({media:d("MAWTransactionMode").READONLY,messages:d("MAWTransactionMode").READONLY},"getMediaKnownEntries",function(a){return function(b){return d("MAWGetMediaKnownEntriesApi").getMediaKnownEntriesTxn(a,b).then(function(a){if(a.success===!1)return new(d("WAMsgMap").MsgMap)();else return a.value.msgMap})}});g.getOrCreateMediaKnownEntries=a}),98);
__d("MAWMediaSizeCheck",[],(function(a,b,c,d,e,f){"use strict";function a(a){return a>100*1024}f.isMinSizeForImagePreviewGeneration=a}),66);
__d("MAWStartMediaUploadQplFlow",["WAGetStorageQplAnnotations","WAJids","WAMediaQplHelper","WAPREList","WAPREMetrics","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.chatJid,e=a.fileSize,f=a.serverMediaType;a=a.uploadEntry;var g=d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.MEDIA_UPLOAD,{string:{chat_type:d("WAJids").switchOnMsgrChatJidType(b,{group:function(){return"group"},user:function(){return"user"}}),jid:b,media_size:d("WAMediaQplHelper").convertIntegerSizeToStringBucket(e),media_type:f,upload_entry:a}},void 0);c("promiseDone")(d("WAGetStorageQplAnnotations").getStorageQplAnnotations().then(function(a){g.addAnnotations(a)}));return g}g.startMediaUploadQplFlow=a}),98);
__d("MAWUpdateMediaEntryForOptimisticUploadApi",["MAWGetProtocolMsgIdByMsgId","MAWOptimisticUploadManager","MAWUpdateMediaEntryForMsgApi","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){"use strict";a=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f){var g=d("MAWOptimisticUploadManager").getOptimisticUploadManager(),h=g.get(a),i=h==null?void 0:h.msgId,j=b();if(i!=null){i=(yield d("MAWGetProtocolMsgIdByMsgId").getProtocolMsgIdByMsgId(i));i&&(yield d("MAWUpdateMediaEntryForMsgApi").updateMediaEntryForMsg(a,i,b,e,f))}else{if(!h)throw c("err")("Cannot update mediaEntry without both uploadEntry and msgId");g.set(a,babelHelpers["extends"]({},h,{mediaEntry:j}))}return});return function(b,c,d,e){return a.apply(this,arguments)}}();g.updateMediaEntryForOptimisticUpload=a}),98);
__d("MAWOptimisticUploadMedia",["MAWConfig","MAWFrontendMediaUtils","MAWGetDownloadableThumbnailForMediaApi","MAWGetMediaPlaintextApi","MAWGetOrCreateMediaKnownEntriesApi","MAWMediaSizeCheck","MAWMediaUtils","MAWOptimisticUploadManager","MAWStartMediaUploadQplFlow","MAWUpdateMediaEntryForMsgApi","MAWUpdateMediaEntryForOptimisticUploadApi","WAAPI","WAHashUtils","WALogger","WAMediaCrypto","WAResultOrError","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["optimisticUploadMedia: fileUploadResult success, setting with previewPlaintextHash"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["optimisticUploadMedia: previewUploadResult success"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["OptimisticUploadMedia - unsupported preview media type ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["optimisticUploadMedia: preview uploading"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["optimisticUploadMedia: thumbnail_exists: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["optimisticUploadMedia: File is already being uploaded"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["optimisticUploadMedia: fileUploadResult success"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["optimisticUploadMedia: file uploading"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["Expected chatJid in optimisticUploadMedia"]);p=function(){return a};return a}function q(a,b,c){return r.apply(this,arguments)}function r(){r=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e){var f=(yield d("MAWMediaUtils").hashBlob(a));f=d("WAHashUtils").toPlaintextHash(f);var g=d("MAWOptimisticUploadManager").getOptimisticUploadManager();g=g.get(f);if(g!=null)return d("WAResultOrError").makeError("already_uploading");if(b==null){d("WALogger").ERROR(p());return d("WAResultOrError").makeError("missing_chat_jid")}g=e.type==="regular"?e.mediaType:"preview";var h=(yield d("MAWStartMediaUploadQplFlow").startMediaUploadQplFlow({chatJid:b,fileSize:a.size,serverMediaType:g,uploadEntry:"optimisticUploadMedia"}));b=c("WAAPI").uploadMedia({chatJid:b,filename:g==="document"?a.name:void 0,getDownloadableThumbnailForMedia:d("MAWGetDownloadableThumbnailForMediaApi").getDownloadableThumbnailForMedia,getMediaKnownEntries:d("MAWGetOrCreateMediaKnownEntriesApi").getOrCreateMediaKnownEntries,getMediaPlaintext:d("MAWGetMediaPlaintextApi").getMediaPlaintext,hash:f,mediaTypeDetails:e,protocolMsgId:null,size:a.size,updateMediaEntryForMsg:d("MAWUpdateMediaEntryForMsgApi").updateMediaEntryForMsg,updateMediaEntryForOptimisticUpload:d("MAWUpdateMediaEntryForOptimisticUploadApi").updateMediaEntryForOptimisticUpload,uploadMediaMetric:h});return d("WAResultOrError").makeResult({plaintextHash:f,uploadPromise:b})});return r.apply(this,arguments)}function a(a){return s.apply(this,arguments)}function s(){s=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.file,c=a.jid;a=a.thumbnail;var e=d("MAWOptimisticUploadManager").getOptimisticUploadManager(),f=d("MAWFrontendMediaUtils").getMediaTypeAndServerMediaTypeFromBlob(b.type);f=f.serverMediaType;d("WALogger").LOG(o());var g=(yield q(b,c,{mediaType:f,type:"regular"}));if(g.success===!0)d("WALogger").LOG(n()),e.set(g.value.plaintextHash,{file:b,optimisticUploadPromise:g.value.uploadPromise,previewPlaintextHash:null});else{var p=g.error;switch(p){case"already_uploading":d("WALogger").LOG(m());break;case"missing_chat_jid":break}}p=null;d("WALogger").LOG(l(),a!=null);if(a&&t(f,b.size)){d("WALogger").LOG(k());var r=d("WAMediaCrypto").convertServerMediaTypeToPreviewMediaType(f);if(r==null){d("WALogger").ERROR(j(),f);return}f=(yield q(a,c,{messageType:r,type:"preview"}));f.success===!0&&(d("WALogger").LOG(i()),p=f.value.plaintextHash,e.set(f.value.plaintextHash,{file:a,optimisticUploadPromise:f.value.uploadPromise}),g.success===!0&&(d("WALogger").LOG(h()),e.set(g.value.plaintextHash,{file:b,optimisticUploadPromise:g.value.uploadPromise,previewPlaintextHash:p})))}});return s.apply(this,arguments)}function t(a,b){if(a==="image"&&d("MAWConfig").getConfig().skipPreviewUploadForImages()===!0)return!1;if(a!=="image")return!0;a;return d("MAWMediaSizeCheck").isMinSizeForImagePreviewGeneration(b)}g.optimisticUploadMedia=a;g.shouldUploadPreview=t}),98);
__d("MAWMsgUtil",["MAWDbMsgTxns","MAWIndexedDb","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";b=d("MAWIndexedDb").makeMsgrTransactor({chunk:(a=d("MAWTransactionMode")).READONLY,media:a.READONLY,messages:a.READWRITE,receiverFetchInfo:a.READONLY,xma:a.READONLY},"updateSystemAckWithTxn",function(a){return function(b,c){return d("MAWDbMsgTxns").updateSystemAck(a,b,c).then(function(){})}});g.updateSystemAckWithTxn=b}),98);
__d("MAWSendMediaMsg",["FBLogger","MAWAckLevel","MAWAsConsumerApplication","MAWBridgeTypesCreators","MAWBridgeUpload","MAWCastToMsgrServerMediaType","MAWConfig","MAWDbChunkTxns","MAWDbMedia","MAWDbMediaTxns","MAWDbThreadTxns","MAWDexieTable","MAWFrontendMediaUtils","MAWGetDownloadableThumbnailForMediaApi","MAWGetMediaPlaintextApi","MAWGetMsgIdByProtocolMsgId","MAWGetOrCreateMediaKnownEntriesApi","MAWIndexedDb","MAWJobDefinitions","MAWJobManager","MAWMediaAfterTxns","MAWMediaBackupTxns","MAWMediaDownloadStatus","MAWMediaDownloadStatusForUI","MAWMediaManagementTxns","MAWMediaUtils","MAWMessageSendScheduler","MAWMsgType","MAWMsgUtil","MAWOptimisticUploadManager","MAWQplProxy","MAWSendWrittenMsg","MAWStartMediaUploadQplFlow","MAWTransactionMode","MAWUpdateMediaEntryForMsgApi","MAWUpdateMediaEntryForOptimisticUploadApi","MAWWriteOutgoingMsgApi","Promise","WAAPI","WAJids","WAJobOrchestratorTypes","WALogger","WAMediaUtils","WASortedLists","WorkerScheduler","asyncToGeneratorRuntime","err","gkx","isInstamadilloEB","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to upload media: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[MAWSendMediaMsg] - msgId mismatch between put msg and got msg"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to send media: "," - missing thread"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["MAWSendMediaMsg - begin writing "," media msg"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Chat ",": "," is received in job"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["Missing required args for media backup in send media"]);n=function(){return a};return a}function o(a,b){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var e=a.args,f=a.attachmentType,g=a.chatJid,h=a.externalId;a=a.file;d("WALogger").LOG(m(),g,a.name);f=d("MAWFrontendMediaUtils").getMediaTypeAndServerMediaTypeFromBlob(a.type,void 0,f);var i=f.mediaType;f=f.serverMediaType;var j;switch(i){case d("MAWDbMedia").MEDIA_TYPE.IMAGE:j=d("MAWMsgType").MSG_TYPE.IMAGE;break;case d("MAWDbMedia").MEDIA_TYPE.VIDEO:j=d("MAWMsgType").MSG_TYPE.VIDEO;break;case d("MAWDbMedia").MEDIA_TYPE.PTT:j=d("MAWMsgType").MSG_TYPE.PTT;break;case d("MAWDbMedia").MEDIA_TYPE.GIF:j=d("MAWMsgType").MSG_TYPE.GIF;break;case d("MAWDbMedia").MEDIA_TYPE.STICKER:j=d("MAWMsgType").MSG_TYPE.STICKER;break;case d("MAWDbMedia").MEDIA_TYPE.DOCUMENT_FILE:j=d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE;break;default:c("FBLogger")("labyrinth_web","unsupported_media").mustfix("unsupported media type");throw c("err")("Expected media msg type")}d("WALogger").LOG(l(),j);yield c("WAAPI").getDevicesBeforeSend({chatJid:g,reason:"SendMediaMsg"});h=(yield d("MAWWriteOutgoingMsgApi").writeOutgoingMsg(h,g,b,e,j));if(h.type==="missing_thread"){d("MAWQplProxy").sendQplPointThroughBridge(c("qpl")._(25313175,"1551"),"writing_media_to_db_failed",{instanceKey:e.s2sInstanceKey});d("WALogger").LOG(k(),a.name);throw c("err")("Failed to write msg to DB")}return[h,{mediaType:i,serverMediaType:f}]});return p.apply(this,arguments)}function q(a,b,c,d,e,f){return r.apply(this,arguments)}function r(){r=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f,g,h){f=b.mediaType;b=b.serverMediaType;var k=g.args;g.attachmentType;var l=g.chatJid;g.externalId;g=g.file;var m=d("MAWCastToMsgrServerMediaType").castToMsgrServerMediaType(b);if(!m){c("FBLogger")("labyrinth_web","unsupported_media").mustfix("unsupported media type");d("MAWQplProxy").sendQplPointThroughBridge(c("qpl")._(25313175,"1551"),"failed_media_unsupported_type",{instanceKey:k.s2sInstanceKey});throw c("err")("Media type unsupported: "+((m=b)!=null?m:""))}m=(yield d("MAWGetMsgIdByProtocolMsgId").getMsgIdByProtocolMsgId(a.protocolMsgId));if(!m.success){d("MAWQplProxy").sendQplPointThroughBridge(c("qpl")._(25313175,"1551"),"failed_media_msgid_missing_in_db",{instanceKey:k.s2sInstanceKey});throw c("err")("Message missing in db")}m.value!==a.msgId&&d("WALogger").ERROR(j());m=a.msgId;var n=s(f,k);yield v(l,a.protocolMsgId,g,e,void 0,void 0,f,n,k.offlineAttachmentId);f=d("MAWOptimisticUploadManager").getOptimisticUploadManager();n=f.get(e);var o=n==null?void 0:n.optimisticUploadPromise,p=o!=null;d("MAWQplProxy").sendQPLBoolAnnotationThroughBridge(c("qpl")._(25313175,"1551"),"isOptimisticUpload",p,k.s2sInstanceKey);d("MAWQplProxy").sendQplPointThroughBridge(c("qpl")._(25313175,"1551"),"uploading_media_to_backend",{instanceKey:k.s2sInstanceKey});var q;o!=null&&(q=(yield o),q.success||d("MAWQplProxy").sendQplPointThroughBridge(c("qpl")._(25313175,"1551"),"optimistic_upload_failure",{annotations:{string:{optimisticUploadError:q.error}},instanceKey:k.s2sInstanceKey}));if(q==null||!q.success){q==null&&d("MAWQplProxy").sendQplPointThroughBridge(c("qpl")._(25313175,"1551"),"upload_media_when_no_existing_optimistic_upload",{instanceKey:k.s2sInstanceKey});p=(yield d("MAWStartMediaUploadQplFlow").startMediaUploadQplFlow({chatJid:l,fileSize:g.size,serverMediaType:b,uploadEntry:"sendMediaMsg"}));q=(yield c("WAAPI").uploadMedia({chatJid:l,filename:b==="document"?g.name:void 0,getDownloadableThumbnailForMedia:d("MAWGetDownloadableThumbnailForMediaApi").getDownloadableThumbnailForMedia,getMediaKnownEntries:d("MAWGetOrCreateMediaKnownEntriesApi").getOrCreateMediaKnownEntries,getMediaPlaintext:d("MAWGetMediaPlaintextApi").getMediaPlaintext,hash:e,mediaTypeDetails:{mediaType:b,type:"regular"},protocolMsgId:a.protocolMsgId,size:g.size,updateMediaEntryForMsg:d("MAWUpdateMediaEntryForMsgApi").updateMediaEntryForMsg,updateMediaEntryForOptimisticUpload:d("MAWUpdateMediaEntryForOptimisticUploadApi").updateMediaEntryForOptimisticUpload,uploadMediaMetric:p}))}if(!q.success){d("WALogger").LOG(i(),g.name);d("MAWQplProxy").sendQplPointThroughBridge(c("qpl")._(25313175,"1551"),"failed_upload_media_to_backend",{instanceKey:k.s2sInstanceKey});d("MAWQplProxy").sendQPLStringAnnotationThroughBridge(c("qpl")._(25313175,"1551"),"errorDescription",q.error,k.s2sInstanceKey);return d("MAWMsgUtil").updateSystemAckWithTxn(m,d("MAWAckLevel").ACK.failed)}d("MAWQplProxy").sendQplPointThroughBridge(c("qpl")._(25313175,"1551"),"successful_upload_media_to_backend",{instanceKey:k.s2sInstanceKey});yield x(e,m,l,a.protocolMsgId.externalId,(o=q.value)==null?void 0:o.objectId,b);c("gkx")("5800")?yield d("MAWSendWrittenMsg").sendWrittenMsgExternal({protocolMsgId:a.protocolMsgId,s2sInstanceKey:k.s2sInstanceKey,type:"message"},h):yield d("MAWJobManager").getJobManager().waitUntilPersisted(d("MAWJobDefinitions").createStartJobInfo("sendWrittenMsg",{protocolMsgId:a.protocolMsgId,s2sInstanceKey:k.s2sInstanceKey,scheduleConfig:{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION},type:"message"}));f["delete"](e);(n==null?void 0:n.previewPlaintextHash)!=null&&f["delete"](n.previewPlaintextHash)});return r.apply(this,arguments)}function s(a,b){a={validatedAudioInfo:a==="Ptt"&&b.duration!=null?{duration:b.duration,mimetype:d("MAWAsConsumerApplication").AUDIO_MIME_TYPE,played:!1}:null,validatedDocumentFileInfo:a==="DocumentFile"&&b.filename!=null?{filename:b.filename,mimetype:d("MAWAsConsumerApplication").FILE_MIME_TYPE}:null,validatedImageInfo:a==="Image"?{height:b.height,jpegThumbnail:b.jpegThumbnail,jpegThumbnailHeight:b.jpegThumbnailHeight,jpegThumbnailWidth:b.jpegThumbnailWidth,width:b.width}:a==="Gif"||a==="Sticker"?{height:b.height,jpegThumbnailHeight:b.height,jpegThumbnailWidth:b.width,width:b.width}:null,validatedVideoInfo:a==="Video"?{duration:b.duration,height:b.height,jpegThumbnail:b.jpegThumbnail,jpegThumbnailHeight:b.jpegThumbnailHeight,jpegThumbnailWidth:b.jpegThumbnailWidth,mimetype:d("MAWAsConsumerApplication").VIDEO_MIME_TYPE,width:b.width}:null};return a}function t(a,b){return u.apply(this,arguments)}function u(){u=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){d("MAWQplProxy").sendQplPointThroughBridge(c("qpl")._(25313175,"1551"),"received_media_in_wajob",{instanceKey:a.args.s2sInstanceKey});var e=(yield o(a,b.jobStartTime)),f=e[0];e=e[1];var g=(yield d("MAWMediaUtils").genBlobHashes(a.file)),h=g[0];g=g[1];yield q(f,e,h,g,a,b.afterCrash)});return u.apply(this,arguments)}a=d("MAWJobManager").getPersistedJobsApi().definePersistedJob().finalStep("sendMediaMsg",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f){c("gkx")("5801")?yield d("MAWMessageSendScheduler").messageSendScheduler().run({fn:function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield t(a,f)});function d(){return c.apply(this,arguments)}return d}(),name:"media",priority:d("WorkerScheduler").BLOCKING_PRIORITY}).promise:yield t(a,f)});return function(b,c,d){return a.apply(this,arguments)}}()).end();function v(a,b,c,d,e,f,g,h,i){return w.apply(this,arguments)}function w(){w=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f,g,h,i,j,k){var l;d("MAWMediaDownloadStatusForUI").sendMediaDownloadStatusToUI({hash:f,status:c("MAWMediaDownloadStatus").DOWNLOADING,type:"main"});var m=(yield d("WAMediaUtils").blobToArrayBuffer(e));return d("MAWIndexedDb").makeMsgrTransactor({chunk:(l=d("MAWTransactionMode")).READWRITE,media:l.READWRITE,mediaBackup:l.READWRITE,messages:l.READWRITE,unrenderedMessages:l.READWRITE},"attachHashAndSaveMedia",function(l){return function(){return d("MAWDexieTable").dexieAll([d("MAWMediaManagementTxns").attachHashToMediaMsg(l,b,f,g,h,i,e.size,j,!1),d("MAWDbChunkTxns").getOrCreateMediaChunk(l,f,m,e.type)]).then(function(b){var e=b[0];return l.messages.where("msgId").anyOf(e.msgIds).toArray().then(function(b){d("MAWMediaDownloadStatusForUI").sendMediaDownloadStatusToUI({hash:f,mediaId:e.mediaId,status:c("MAWMediaDownloadStatus").SUCCESS,type:"main"});b=d("MAWBridgeTypesCreators").createBridgeMedia({chatJid:a,filteredMsgIds:d("MAWBridgeTypesCreators").getMsgIdsFilteredByJid(b,a),hasMediaForUI:!0,media:e,offlineAttachmentId:k});c("gkx")("2616")===!0?d("MAWMediaAfterTxns").handleNewMediaAfterTxnWithBridgeMedia(l,b):d("MAWIndexedDb").afterTransaction({tag:"NewMedia",value:b})})})}})()});return w.apply(this,arguments)}function x(a,e,f,g,i,j){var k=d("MAWOptimisticUploadManager").getOptimisticUploadManager(),l=k.get(a),m=l==null?void 0:l.mediaEntry;if(l==null)return(h||(h=b("Promise"))).resolve();k.set(a,babelHelpers["extends"]({},l,{msgId:e}));return m==null?(h||(h=b("Promise"))).resolve():d("MAWIndexedDb").makeMsgrTransactor({media:d("MAWTransactionMode").READWRITE,mediaBackup:d("MAWTransactionMode").READWRITE,threads:d("MAWTransactionMode").READONLY},"maybePersistMediaEntry",function(b){return function(){return d("MAWDbMediaTxns").maybeGetMediaFromPlaintextHash(b,a).then(function(a){if(a){var h=babelHelpers["extends"]({},a,{mediaEntries:a.mediaEntries.set(e,m),msgIds:d("WASortedLists").addToSet(a.msgIds,e)});i!=null&&(h=babelHelpers["extends"]({},h,{objectId:d("WAMediaUtils").stringToDeliveryObjectId(i)}));var k=d("WAMediaUtils").decodeMediaEntryData(m);return b.media.update(a.mediaId,h).then(function(c){return i!=null?d("MAWMediaBackupTxns").linkMediaBackup(b,a.mediaId,e,d("WAMediaUtils").stringToDeliveryObjectId(i)):d("MAWDexieTable").dexieResolve()}).then(function(){var a=d("MAWCastToMsgrServerMediaType").castToMsgrServerMediaType(j),e=k.mediaKeyTimestamp;if(i!=null&&a!=null&&e!=null&&!c("isInstamadilloEB")())return d("MAWDbThreadTxns").getThread(b,f).then(function(b){b.success&&(a!=="file"||d("MAWConfig").getConfig().enableDocumentBackupAndRestore())&&d("MAWIndexedDb").afterTransaction({tag:"UploadAttachment",value:d("MAWBridgeUpload").createBridgeUploadAttachment(i,a,g,d("MAWConfig").getConfig().productTypeForEBAttachments,d("WAJids").threadIdForChatJid(f),f,e)})});else d("WALogger").WARN(n())})}else throw c("err")("media should already exist upon this point")})}})()}g.writeToDb=o;g.saveAndPassOff=q;g.sendMediaMsg=a;g.maybePersistMediaEntry=x}),98);
__d("IGDLowLevelApiBridgeHandlers",["EncryptedBackupsUploadQueue","MAWBridgeHandlers","MAWEbUploadQueue","Promise","WALogger","asyncToGeneratorRuntime","cr:8399","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[DYI] Instamadillo DYI is not enabled"]);i=function(){return a};return a}a=babelHelpers["extends"]({},d("MAWBridgeHandlers").bridgeHandlers,{backupWriteCompletionHook:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=d("EncryptedBackupsUploadQueue").ebUploadQueue();yield a.queueIds.map(function(a){return b.ack([a])});c("promiseDone")(d("MAWEbUploadQueue").scheduleNextRun())});function e(b){return a.apply(this,arguments)}return e}(),handleInstamadilloDYIRangeQueryRestore:function(a){if(b("cr:8399")==null){d("WALogger").LOG(i());return(h||(h=b("Promise"))).resolve()}return b("cr:8399")(a.threadId,a.messages,a.hasMoreBefore,a.nextMessageTimestampMsBefore)}});g.igdBridgeHandlers=a}),98);
__d("IGDBackendBridgeHandlers",["EBBridgedAPIHandler","IGDBridgedAPIHandler","IGDLowLevelApiBridgeHandlers","MAWJobManager","Promise","WABridgedAPIHandler","WAErr","WAMockServerShell","WAWaitForComms","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["handle with type "," not found"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["handle with type "," not found"]);j=function(){return a};return a}function a(a){return babelHelpers["extends"]({},d("IGDLowLevelApiBridgeHandlers").igdBridgeHandlers,{ebapi:function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){yield d("WAWaitForComms").waitForComms();var c=d("EBBridgedAPIHandler").ebapi[b.type];c==null&&a.TAGS(["EBBridgedAPI"]).ERROR(j(),b.type);return c.apply(void 0,b.args)});function e(a){return c.apply(this,arguments)}return e}(),igdapi:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield d("WAWaitForComms").waitForComms();return d("IGDBridgedAPIHandler").igdapi.apply(void 0,arguments)});function c(){return a.apply(this,arguments)}return c}(),initMockServer:function(a){return d("WAMockServerShell").getMockServer==null?(h||(h=b("Promise"))).reject("Mock server is not available. Make sure you use worker v2"):d("WAMockServerShell").getMockServer().init(a)},runJobFireAndForget:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield d("WAWaitForComms").waitForComms();return d("MAWJobManager").getJobManager().fireAndForget(a)});function c(b){return a.apply(this,arguments)}return c}(),runJobWaitUntilCompleted:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield d("WAWaitForComms").waitForComms();return d("MAWJobManager").getJobManager().waitUntilCompleted(a)});function c(b){return a.apply(this,arguments)}return c}(),runJobWaitUntilPersisted:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield d("WAWaitForComms").waitForComms();return d("MAWJobManager").getJobManager().waitUntilPersisted(a)});function c(b){return a.apply(this,arguments)}return c}(),runMock:function(a){return d("WAMockServerShell").getMockServer==null?(h||(h=b("Promise"))).reject("Mock server is not available. Make sure you use worker v2"):d("WAMockServerShell").getMockServer().runMock(a)},setMockVariables:function(a){if(d("WAMockServerShell").getMockServer==null)throw c("WAErr")("Mock server is not available. Make sure you use worker v2");d("WAMockServerShell").getMockServer().setVariables(a.variables)},waapi:function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){yield d("WAWaitForComms").waitForComms();var c=d("WABridgedAPIHandler").waapi[b.type];c==null&&a.TAGS(["WABridgedAPI"]).ERROR(i(),b.type);return c.apply(void 0,b.args)});function e(a){return c.apply(this,arguments)}return e}()})}g.getIGDBridgeHandlers=a}),98);
__d("IGDCOP",["MAWSharedCOP","cr:5112","cr:5114"],(function(a,b,c,d,e,f,g){"use strict";c=(a=b("cr:5112"))!=null?a:b("cr:5114");e=d("MAWSharedCOP").makeCOP(c.processProtocolQueueEntries);g.cop=e}),98);
__d("IGDGetMediaKnownEntriesApi",["I64","MAWDbMsg","MAWJids","MAWMediaUtils","MAWReStoreDb","Promise","WAJids","WALogger","WAMsgMap","WAStanzaUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["No existing media entry found for hashedPlaintextHash ",". Returning new MsgMap."]);j=function(){return a};return a}a=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var c=(yield d("MAWReStoreDb").getDB(f.id+":35")),e=d("MAWMediaUtils").genHMACPlaintextHash(a);a=(yield c.runInTransaction(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var c=(yield a.e2ee_media.index("hashedPlaintextHash").get(e));if(c==null){d("WALogger").ERROR(j(),e);return new(d("WAMsgMap").MsgMap)()}var f=Array.from(c.mediaEntries.keys());f=(yield (i||(i=b("Promise"))).all(f.map(function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){b=(yield a.messages.index("messageId").get(b));return b});return function(a){return c.apply(this,arguments)}}())));f=f.reduce(function(a,b){if(b!=null){var e=c.mediaEntries.get(d("MAWDbMsg").instamadilloMsgIdToMsgId(b.messageId)),f=d("WAJids").validateUserJid(d("WAJids").toMsgrUserJid((h||(h=d("I64"))).to_string(b.threadKey))),g=d("WAStanzaUtils").toStanzaId(b.offlineThreadingId);if(e&&!b.isAdminMessage&&f!=null){b={author:d("MAWJids").toUserJid((h||(h=d("I64"))).to_string(b.senderId)),chat:f,externalId:g};a.set(b,e)}}return a},new(d("WAMsgMap").MsgMap)());return f});return function(b){return a.apply(this,arguments)}}(),"readonly",void 0,void 0,f.id+":38"));return a});return function(b){return a.apply(this,arguments)}}();g.getMediaKnownEntries=a}),98);
__d("InstamadilloMediaUpload",["FBLogger","IGDGetMediaKnownEntriesApi","IGDGetMediaPlaintextApi","IGDUpdateMediaEntryForMsgApi","LSIntEnum","MAWFetchXMABlob","MAWFrontendMediaUtils","MAWGetDownloadableThumbnailForMediaApi","MAWMediaUtils","MAWOptimisticUploadMedia","MAWStartMediaUploadQplFlow","MAWUpdateMediaEntryForOptimisticUploadApi","MessagingAttachmentType","WAAPI","WAHashUtils","WAMediaCrypto","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a,b,c){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e){var f=(yield d("MAWMediaUtils").hashBlob(b));f=d("WAHashUtils").toPlaintextHash(f);var g=e.type==="regular"?e.mediaType:"preview",h=(yield d("MAWStartMediaUploadQplFlow").startMediaUploadQplFlow({chatJid:a.chat,fileSize:b.size,serverMediaType:g,uploadEntry:"InstamadilloMediaUpload"}));return c("WAAPI").uploadMedia({chatJid:a.chat,filename:g==="document"?b.name:void 0,getDownloadableThumbnailForMedia:d("MAWGetDownloadableThumbnailForMediaApi").getDownloadableThumbnailForMedia,getMediaKnownEntries:d("IGDGetMediaKnownEntriesApi").getMediaKnownEntries,getMediaPlaintext:d("IGDGetMediaPlaintextApi").getMediaPlaintext,hash:f,mediaTypeDetails:e,protocolMsgId:a,size:b.size,updateMediaEntryForMsg:d("IGDUpdateMediaEntryForMsgApi").updateMediaEntryForMsg,updateMediaEntryForOptimisticUpload:d("MAWUpdateMediaEntryForOptimisticUploadApi").updateMediaEntryForOptimisticUpload,uploadMediaMetric:h})});return j.apply(this,arguments)}function a(a,b,c){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e){if(e.playableUrlMimeType==null)throw c("FBLogger")("igd_web_on_msgr").mustfixThrow("instamadilloUpload: mimeType is null");var f=d("MAWFrontendMediaUtils").getMediaTypeAndServerMediaTypeFromBlob(e.playableUrlMimeType);f=f.serverMediaType;var g=(yield i(a,b,{mediaType:f,type:"regular"}));if(g.success!==!0)throw c("FBLogger")("igd_web_on_msgr").mustfixThrow("instamadilloUpload: Failed to upload media");var j=null,k=(h||(h=d("LSIntEnum"))).unwrapIntEnum(e.attachmentType);e=(yield d("MAWFetchXMABlob").fetchBlob({descriptionForLogging:"InstamadilloMediaUpload",url:e.previewUrl}));if(e!=null){e=(yield e.arrayBuffer());k=k===c("MessagingAttachmentType").IMAGE||k===c("MessagingAttachmentType").VIDEO?d("MAWMediaUtils").convertJpegThumbnailArrayBufferToFile(e):null;if(k&&d("MAWOptimisticUploadMedia").shouldUploadPreview(f,b.size)){e=d("WAMediaCrypto").convertServerMediaTypeToPreviewMediaType(f);if(e==null)throw c("FBLogger")("igd_web_on_msgr").mustfixThrow("unsupported preview media type %s",f);b=(yield i(a,k,{messageType:e,type:"preview"}));if(b.success!==!0)throw c("FBLogger")("igd_web_on_msgr").mustfixThrow("instamadilloUpload: Failed to upload preview media");j=b.value}}return{mediaEntry:g.value,thumbnailMediaEntry:j}});return k.apply(this,arguments)}g.instamadilloUpload=a}),98);
__d("createInstamadilloMediaPayload",["FBLogger"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.directPath,d=a.duration,e=a.fileEncSha256,f=a.fileLength,g=a.fileSha256,m=a.height,n=a.isAnimated,o=a.isSticker,p=a.mediaId,q=a.mediaKey,r=a.mediaKeyTimestamp,s=a.mediaType,t=a.mimetype,u=a.objectId,v=a.sidecar,w=a.thumbnail,x=a.waveforms,y=a.waveformSamplingFrequencyHz;a=a.width;b={directPath:b,fileEncSha256:e,fileLength:f,fileSha256:g,mediaId:p,mediaKey:q,mediaKeyTimestamp:r,mimetype:t,objectId:u,sidecar:v};switch(s){case"Image":return h(m,a,b,w);case"Video":return i(m,a,b,w);case"Ptt":if(x==null)throw c("FBLogger")("igd_web_on_msgr").mustfixThrow("createInstamadilloMedia: waveforms is null");return j(d,b,x,y);case"Gif":return k(m,a,b,o);case"Sticker":return l(b,n);default:throw c("FBLogger")("igd_web_on_msgr").mustfixThrow("createInstamadilloMedia: mediaType is unsupported")}}function h(a,b,c,d){return{staticPhoto:{height:a,mediaTransport:c,thumbnail:d,width:b}}}function i(a,b,c,d){return{video:{height:a,mediaTransport:c,thumbnail:d,width:b}}}function j(a,b,c,d){return{voice:{duration:a,mediaTransport:b,waveforms:c,waveformSamplingFrequencyHz:d}}}function k(a,b,c,d){return{gif:{height:a,isSticker:d,mediaTransport:c,width:b}}}function l(a,b){return{avatarSticker:{isAnimated:b,mediaTransport:a}}}g.createInstamadilloMediaEncode=a}),98);
__d("InstamadilloSendMediaMessageUtils",["FBLogger","I64","InstamadilloMediaUpload","LSIntEnum","MAWDbMsg","MAWFetchXMABlob","MAWFrontendMediaUtils","MAWMediaUtils","MAWReStoreDb","MessagingAttachmentType","ReQL","WABase64","WAMediaUtils","WASortedLists","WATimeUtils","asyncToGeneratorRuntime","createInstamadilloMediaPayload"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a,b,c){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){a=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.attachments).getKeyRange(b,c)));return a});return j.apply(this,arguments)}function k(a){return{validatedAudioInfo:l(a),validatedDocumentFileInfo:null,validatedImageInfo:m(a),validatedVideoInfo:n(a)}}function l(a){return(h||(h=d("I64"))).equal(a==null?void 0:a.attachmentType,(i||(i=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").AUDIO))?{duration:a.playableDurationMs?(h||(h=d("I64"))).to_float(a.playableDurationMs):0,mimetype:a.playableUrlMimeType}:null}function m(a){return(h||(h=d("I64"))).equal(a==null?void 0:a.attachmentType,(i||(i=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").IMAGE))?{height:a.previewHeight?(h||(h=d("I64"))).to_float(a.previewHeight):0,width:a.previewWidth?(h||(h=d("I64"))).to_float(a.previewWidth):0}:null}function n(a){return(h||(h=d("I64"))).equal(a==null?void 0:a.attachmentType,(i||(i=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").VIDEO))?{duration:a.playableDurationMs?(h||(h=d("I64"))).to_float(a.playableDurationMs):0,height:a.previewHeight?(h||(h=d("I64"))).to_float(a.previewHeight):0,mimetype:a.playableUrlMimeType,width:a.previewWidth?(h||(h=d("I64"))).to_float(a.previewWidth):0}:null}function o(a){var b=a.directPath,c=a.fbid,e=a.fileEncSha256,f=a.fileSha256,g=a.mediaKey,h=a.mediaKeyTimestamp;a=a.objectId;return{directPath:(b=b)!=null?b:void 0,fileEncSha256:d("WABase64").encodeB64(e),fileSha256:d("WABase64").encodeB64(f),mediaId:(b=c)!=null?b:void 0,mediaKey:d("WABase64").encodeB64(g),mediaKeyTimestamp:String(h),objectId:(e=a)!=null?e:void 0}}function e(a,b){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e){var g,i=(yield d("MAWFetchXMABlob").fetchBlob({descriptionForLogging:"InstamadilloSendMediaMessageUtils",url:e.playableUrl}));if(i==null)throw c("FBLogger")("igd_web_on_msgr").mustfixThrow("Blob is null");var j=e.playableUrlMimeType;if(j==null)throw c("FBLogger")("igd_web_on_msgr").mustfixThrow("IGDSendMessageTaskHandler: mimeType is null");var l=d("MAWFrontendMediaUtils").getMediaTypeAndServerMediaTypeFromBlob(j),m=l.mediaType;l=l.serverMediaType;if(m==null)throw c("FBLogger")("igd_web_on_msgr").mustfixThrow("handleInstamadilloMediaSends: mediaType is null");var n=(yield d("MAWMediaUtils").genBlobHashes(i)),p=n[0],q=n[1];n=(yield d("MAWReStoreDb").getDB(f.id+":185"));var r=(yield n.runInTransaction(function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){var c=(yield b.e2ee_media.index("hashedPlaintextHash").get(q)),f=new Map(c==null?void 0:c.mediaEntries),g=k(e),h=d("MAWDbMsg").stanzaIdToMsgId(a.externalId);if(c!=null){var l=d("WASortedLists").addToSet(c.msgIds,h);c=babelHelpers["extends"]({},c,g,{mediaEntries:f,msgIds:l})}else c=babelHelpers["extends"]({hashedPlaintextHash:q,mediaEntries:f,mediaType:m,msgIds:d("WASortedLists").singleElement(h),plaintextHash:p,size:i.size,ts:d("WATimeUtils").unixTime()},g);yield b.e2ee_media.put(c);l=(yield d("WAMediaUtils").blobToArrayBuffer(i));f=(yield b.e2ee_chunk.index("hashedPlaintextHash").get(q));f==null&&(yield b.e2ee_chunk.put({blobData:l,hashedPlaintextHash:q,mimetype:j,plaintextHash:p}));return c});return function(a){return c.apply(this,arguments)}}(),"readwrite",void 0,void 0,f.id+":186"));g=new File([i],(g=e.filename)!=null?g:"",{type:j});var s=(yield d("InstamadilloMediaUpload").instamadilloUpload(a,g,e)),t=s.mediaEntry;s=s.thumbnailMediaEntry;var u=babelHelpers["extends"]({},r,{objectId:t.objectId!=null?d("WAMediaUtils").stringToDeliveryObjectId(t.objectId):void 0});yield n.runInTransaction(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield a.e2ee_media.put(u)});return function(b){return a.apply(this,arguments)}}(),"readwrite",void 0,void 0,f.id+":253");r=o(t);r.$$unknownFieldCount;n=babelHelpers.objectWithoutPropertiesLoose(r,["$$unknownFieldCount"]);t=babelHelpers["extends"]({},n,{duration:e.playableDurationMs!=null?(h||(h=d("I64"))).to_int32(e.playableDurationMs):void 0,fileLength:g.size,height:e.previewHeight!=null?(h||(h=d("I64"))).to_int32(e.previewHeight):void 0,isAnimated:!1,isSticker:!1,mediaType:m,mimetype:j,sidecar:void 0,waveforms:e.waveformData!=null?e.waveformData.split(",").map(Number):void 0,waveformSamplingFrequencyHz:e.samplingFrequencyHz!=null?(h||(h=d("I64"))).to_int32(e.samplingFrequencyHz):void 0,width:e.previewWidth!=null?(h||(h=d("I64"))).to_int32(e.previewWidth):void 0});if(s!=null){r=o(s);r.$$unknownFieldCount;n=babelHelpers.objectWithoutPropertiesLoose(r,["$$unknownFieldCount"]);g={mediaTransport:n};t=babelHelpers["extends"]({},t,{thumbnail:g})}s=d("createInstamadilloMediaPayload").createInstamadilloMediaEncode(t);return{media:u,mediaEncode:s,serverMediaType:l}});return p.apply(this,arguments)}g.getMediaAttachment=a;g.generateValidatedMediaInfoFromAttachment=k;g.prepareMediaProtobuf=e}),98);
__d("MAWDbChunk",[],(function(a,b,c,d,e,f){"use strict";function a(a){return a}function b(a){return a}f.convertNumberToChunkId=a;f.convertToChunkId64=b}),66);
__d("MAWGroupInfoStore",["MAWBridgeTypesCreators","MAWDbMsgTxns","MAWDbThreadTxns","MAWDexieCastToPromise","MAWDexieTable","MAWFolderTypes","MAWGetOrCreateThreadTxns","MAWIndexedDb","MAWLoadMsgsTxns","MAWLoadThreadsTxns","MAWThreadManagementTxns","MAWTransactionMode","WAResultOrError","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function h(a){return a!=null&&typeof a==="object"&&a.groupStatus!=null&&typeof a.groupStatus==="string"?a.groupStatus:void 0}function i(a){return a!=null&&typeof a==="object"&&a.clientThreadKey!=null&&typeof a.clientThreadKey==="string"?a.clientThreadKey:void 0}function j(a){return a!=null&&typeof a==="object"&&a.folder!=null&&typeof a.folder==="number"?a.folder:void 0}function k(a){return a!=null&&typeof a==="object"&&a.updateParticipantMedatadata!=null&&typeof a.updateParticipantMedatadata==="boolean"?a.updateParticipantMedatadata:void 0}function l(a){return a===null?{}:a}a=function(){function a(a){var b=this;this.get=function(a,c){c=j(c);return d("MAWDexieCastToPromise").dexieCastToPromise(d("MAWThreadManagementTxns").getGroupThread(b.db,a,c).then(function(a){return a!=null?a:null}).then(function(a){return a==null?d("WAResultOrError").makeError("missing_group"):d("MAWLoadThreadsTxns").loadContentsForThreads(b.db,[a.thread],1,null,"getGroupInfoStore").then(function(){return a.groupInfo}).then(function(a){return d("WAResultOrError").makeResult(m(a))})}))};this.create=function(a,c){var e=h(c)==="added"?d("WATimeUtils").millisTime():d("WATimeUtils").castUnixTimeToMillisTime(a.creationTs);return d("MAWDexieCastToPromise").dexieCastToPromise(d("MAWGetOrCreateThreadTxns").getOrCreateThread(b.db,{clientThreadKey:i(c),createTs:e,description:"MAWGroupInfoStore-create",folder:d("MAWFolderTypes").FOLDER_ID.INBOX,jid:a.jid}).then(function(c){var e=c.created,f=c.thread,g=n(a);return d("MAWDexieTable").dexieAll([b.db.groupInfo.put(g),d("MAWDbMsgTxns").getThreadNewestMessageId(b.db,f.jid)]).then(function(a){a[0];a=a[1];d("MAWIndexedDb").afterTransaction({tag:"GroupInfoUpdated",value:d("MAWBridgeTypesCreators").createBridgeUpdatedGroupInfo(g)});a!=null?d("MAWLoadMsgsTxns").loadMsgsAndMediaFromOffset(b.db,f.jid,a,10,!0):d("MAWDexieTable").dexieResolve()}).then(function(){return f.archived===!0?d("MAWDbThreadTxns").unarchiveThreads(b.db,[f.jid]):d("MAWDexieTable").dexieResolve()}).then(function(){return e?d("WAResultOrError").makeResult(g.groupJid):d("WAResultOrError").makeError("existing")})}))};this["delete"]=function(a){return d("MAWDexieCastToPromise").dexieCastToPromise(d("MAWDexieTable").dexieAll([b.db.threads.get({jid:a}),b.db.groupInfo["delete"](a)]).then(function(a){a=a[0];return a==null?d("WAResultOrError").makeError("missing_group"):d("MAWDexieTable").dexieAll([d("MAWDbThreadTxns").deleteThreadRow(b.db,a.jid),b.db.participants.where("threadJid").equals(a.jid)["delete"]()]).then(function(){return d("WAResultOrError").makeResult()})}))};this.update=function(a,c,e){return d("MAWDexieCastToPromise").dexieCastToPromise(b.db.threads.get({jid:a}).then(function(f){return f==null?d("WAResultOrError").makeError("missing_group"):b.db.groupInfo.get(a).then(function(a){if(a==null)return d("WAResultOrError").makeError("missing_group");a=m(a);a=c(a);var g=n(a);return b.db.groupInfo.put(g).then(function(){d("MAWIndexedDb").afterTransaction({tag:"GroupInfoUpdated",value:d("MAWBridgeTypesCreators").createBridgeUpdatedGroupInfo(g)});k(e)===!0&&d("MAWIndexedDb").afterTransaction({tag:"UpdateE2EEMetadataParticipants",value:d("MAWBridgeTypesCreators").createBridgeUpdateE2EEMetadataParticipants(f.jid)});return d("WAResultOrError").makeResult()})})}))};this.clear=function(){return d("MAWDexieCastToPromise").dexieCastToPromise(b.db.groupInfo.clear())};this.db=a}var b=a.prototype;b.has=function(a){return d("MAWDexieCastToPromise").dexieCastToPromise(this.db.groupInfo.get(a).then(function(a){return a!=null?!0:!1}))};return a}();a.tableLocks={chunk:(b=d("MAWTransactionMode")).READONLY,editMsgHistory:b.READONLY,groupInfo:b.READWRITE,groupInvites:b.READONLY,media:b.READONLY,messages:b.READWRITE,participants:b.READWRITE,reactions:b.READONLY,receiverFetchInfo:b.READONLY,threads:b.READWRITE,xma:b.READONLY};function m(a){return babelHelpers["extends"]({jid:a.groupJid},l(a.creator!=null?{creator:a.creator}:null),{creationTs:a.creationTs},l(a.participantVersion!=null?{participantVersion:a.participantVersion}:null),{inviter:a.inviter,memberAddMode:a.memberAddMode,subject:babelHelpers["extends"]({content:a.name},l(a.nameOwner!=null?{user:a.nameOwner}:null),l(a.nameTs!=null?{ts:a.nameTs}:null))})}function n(a){var b=a.subject.content;b!=null&&b.length===0&&(b=void 0);return{creationTs:a.creationTs,creator:a.creator,groupJid:a.jid,inviter:a.inviter,memberAddMode:a.memberAddMode,name:b,nameOwner:a.subject.user,nameTs:a.subject.ts,participantVersion:a.participantVersion}}g.MAWGroupInfoStore=a}),98);
__d("MAWGetExpiredMsgs",["WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=d("WATimeUtils").unixTime();return a.messages.where("messageDeleteTs").belowOrEqual(b).toArray().then(function(a){return a.map(function(a){var b=a.author,c=a.externalId;a=a.threadJid;return a==null?null:{author:b,chat:a,externalId:c}}).filter(Boolean)})}g.getExpiredMsgs=a}),98);
__d("MAWMessageStore",["I64","MAWAckLevel","MAWAuthor","MAWBridgeMsg","MAWDbMessageHandler","MAWDbMsg","MAWDbMsgTxns","MAWDbThread","MAWDexieCastToPromise","MAWDexieTable","MAWFolderTypes","MAWGetExpiredMsgs","MAWIndexedDb","MAWLocalizationUtils","MAWMsgType","MAWThreadFetchAndEmitTxns","MAWTransactionMode","MAWWriteMsgTxns","WAJids","WALogger","WAResultOrError","WATimeUtils","err"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Successfully deleted: "," reactions rows."]);i=function(){return a};return a}function j(a){if(a!=null&&typeof a==="object"&&a.optimisticMsg!=null){a=a.optimisticMsg;if(typeof a.msgId==="string"&&typeof a.ts==="number")return{msgId:a.msgId,ts:a.ts}}return void 0}function k(a){return a!=null&&typeof a==="object"&&a.openMessageOtid!=null&&typeof a.openMessageOtid==="string"?a.openMessageOtid:void 0}function l(a){if(a!=null&&typeof a==="object"&&a.folder!=null&&typeof a.folder==="number")if(a.folder===d("MAWFolderTypes").FOLDER_ID.INBOX)return d("MAWFolderTypes").FOLDER_ID.INBOX;else if(a.folder===d("MAWFolderTypes").FOLDER_ID.PENDING)return d("MAWFolderTypes").FOLDER_ID.PENDING;else if(a.folder===d("MAWFolderTypes").FOLDER_ID.OTHER)return d("MAWFolderTypes").FOLDER_ID.OTHER;else if(a.folder===d("MAWFolderTypes").FOLDER_ID.ARCHIVED)return d("MAWFolderTypes").FOLDER_ID.ARCHIVED;return null}a=function(){function a(a){this.db=a}var b=a.prototype;b.create=function(a,b){var e=this,f=j(b),g=k(b);b=l(b);return d("MAWDexieCastToPromise").dexieCastToPromise(d("MAWThreadFetchAndEmitTxns").fetchAndEmitThread(this.db,a.id.chat,b,void 0,"MAWMessageStore_DEPRECATED-create").then(function(b){if(b==null)return d("WAResultOrError").makeError({type:"missing_thread"});var i=b.thread;if(a.type===d("MAWMsgType").MSG_TYPE.TEXT){b=void 0;a.ephemeralSetting!=null&&(b={ephemeralExpirationInSec:a.ephemeralSetting.expirationTs,ephemeralLastUpdatedOrSetTimestamp:a.ephemeralSetting.updatedTs});b={ack:a.ack,altIndex:void 0,author:a.id.author,ephemeralSetting:b,externalId:a.id.externalId,forwardingScore:a.forwardingScore,isForwarded:a.forwardingScore>0,msgContent:{content:((b=a.msgContent)==null?void 0:b.content)||""},threadJid:i.jid,ts:a.ts,type:d("MAWMsgType").MSG_TYPE.TEXT};return d("MAWWriteMsgTxns").writeMsg(e.db,b,i,{openMessageOtid:g,optimisticMsg:f}).then(function(){return d("WAResultOrError").makeResult()})}else if(a.type===d("MAWMsgType").MSG_TYPE.ICDC_ALERT){b={ack:a.ack,altIndex:void 0,author:a.id.author,externalId:a.id.externalId,msgContent:{adminType:a.msgContent.adminType,authorName:a.msgContent.authorName},threadJid:i.jid,ts:a.ts,type:d("MAWMsgType").MSG_TYPE.ICDC_ALERT};return d("MAWWriteMsgTxns").writeMsg(e.db,b,i,{openMessageOtid:g,optimisticMsg:f}).then(function(){a.hasUnknownName&&!d("WAJids").isAuthorMe(a.id.author)&&!d("WAJids").isAuthorSystem(a.id.author)&&(d("MAWIndexedDb").afterTransaction({tag:"SyncContacts",value:[d("WAJids").userIdFromJid(a.id.author)]}),d("MAWDbMessageHandler").isThreadUpdateEnabledViaMiddlewareForMsgType(a.type)||d("MAWIndexedDb").afterTransaction({tag:"ThreadBumpedServer",value:{description:"MAWMessageStore_DEPRECATED-create",isCurrentDeviceSendingMsg:!1,lastActivityTs:d("WATimeUtils").castUnixTimeToMillisTime(a.ts),lastMsgExternalId:(h||(h=d("I64"))).of_string_opt(a.id.externalId),threadJid:i.jid}}));return d("WAResultOrError").makeResult()})}else if(a.type===d("MAWMsgType").MSG_TYPE.ADMIN){b={ack:a.ack,altIndex:void 0,author:d("WAJids").AUTHOR_SYSTEM,externalId:a.id.externalId,msgContent:babelHelpers["extends"]({},a.msgContent,{version:d("MAWLocalizationUtils").isAdminMsgNormalized(a.msgContent.adminType)?1:0}),threadJid:i.jid,ts:a.ts,type:a.type};return d("MAWWriteMsgTxns").writeMsg(e.db,b,i).then(function(){return d("WAResultOrError").makeResult()})}throw c("err")("non renderable store not implemented yet")}))};b.get=function(a){return d("MAWDexieCastToPromise").dexieCastToPromise(d("MAWDexieTable").dexieAll([this.db.threads.get({jid:a.chat}),this.db.messages.where("externalId").equals(a.externalId).toArray()]).then(function(b){var c,e=b[0];b=b[1];if(e==null)return d("MAWDexieTable").dexieResolve(null);b=b.find(function(b){return b.threadJid===e.jid&&b.author===a.author});return b==null||b.type!=="Text"?d("MAWDexieTable").dexieResolve(null):d("MAWDexieTable").dexieResolve({ack:b.ack,forwardingScore:(c=b.forwardingScore)!=null?c:0,id:a,msgContent:{content:b.msgContent.content},ts:b.ts,type:b.type})}))};b.update=function(a){var b=this;return d("MAWDexieCastToPromise").dexieCastToPromise(d("MAWDexieTable").dexieAll([this.db.threads.get({jid:a.id.chat}),this.db.messages.where("externalId").equals(a.id.externalId).toArray()]).then(function(c){var e=c[0];c=c[1];if(e==null)return d("MAWDexieTable").dexieResolve(d("WAResultOrError").makeError("missing"));var f=c.find(function(b){return b.threadJid===e.jid&&b.author===a.id.author});if(f==null||f.type!=="Text")return d("MAWDexieTable").dexieResolve(d("WAResultOrError").makeError("missing"));c=f.ack<d("MAWAckLevel").ACK.sent;f.ack=a.ack;f.ts=a.ts;f.serverTs=a.sentTs;var g=void 0;a.ephemeralSetting!=null&&(g={ephemeralExpirationInSec:a.ephemeralSetting.expirationTs,ephemeralLastUpdatedOrSetTimestamp:a.ephemeralSetting.updatedTs});f.ephemeralSetting=g;g=a.sentTs;var i=g==null?g:d("WATimeUtils").castUnixTimeToMillisTime(g);g=i!=null&&c?b.db.threads.put(babelHelpers["extends"]({},e,{newestMsgTs:i,threadOrder:d("MAWDbThread").craftThreadOrder(i,e.jid)})).then(function(){f.altIndex!==d("MAWDbMsg").SPAM_ALT_INDEX&&f.altIndex!==d("MAWDbMsg").FUTUREPROOF_SPAM_ALT_INDEX&&!d("MAWDbMessageHandler").isThreadUpdateEnabledViaMiddlewareForMsgType(f.type)&&d("MAWIndexedDb").afterTransaction({tag:"ThreadBumpedServer",value:{description:"MAWMessageStore_DEPRECATED-update",isCurrentDeviceSendingMsg:!1,lastActivityTs:i,lastMsgExternalId:(h||(h=d("I64"))).of_string_opt(a.id.externalId),threadJid:e.jid}})}):d("MAWDexieTable").dexieResolve();return d("MAWDexieTable").dexieAll([b.db.messages.put(f),g]).then(function(){var a=null;d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(f,void 0,a)});return d("WAResultOrError").makeResult()})}))};b.deleteReactionsForMsg=function(a){var b=this;return d("MAWDexieCastToPromise").dexieCastToPromise(this.db.reactions.where("reactToExternalId").equals(a.externalId).filter(function(b){return d("MAWAuthor").getAuthorUserJid(b.reactToAuthor)===d("MAWAuthor").getAuthorUserJid(a.author)&&b.threadJid===a.chat}).toArray().then(function(a){return b.db.reactions.bulkDelete(a.map(function(a){return a.rowId}))}))};b.bulkGetExpiredMsgIds=function(){return d("MAWDexieCastToPromise").dexieCastToPromise(d("MAWGetExpiredMsgs").getExpiredMsgs(this.db))};b.bulkDelete=function(a){var b=this,c=d("MAWDexieTable").dexieAll(a.map(function(a){var c=a.author,e=a.chat;a=a.externalId;var f=d("MAWAuthor").getAuthorUserJid(c);return b.db.reactions.where("reactToExternalId").equals(a).filter(function(a){return d("MAWAuthor").getAuthorUserJid(a.reactToAuthor)===f&&a.threadJid===e}).toArray()})).then(function(a){return a.flat()}).then(function(a){d("WALogger").LOG(i(),a.length);return b.db.reactions.bulkDelete(a.map(function(a){return a.rowId}))});return d("MAWDexieCastToPromise").dexieCastToPromise(d("MAWDbMsgTxns").getMsgsByProtocolMsgId(this.db,a).then(function(a){var e=a.map(function(a){return a.rowId});return d("MAWDexieTable").dexieAll([b.db.messages.bulkDelete(e),c]).then(function(){return e.length})}))};b.bulkGetInGroup=function(a){return d("MAWDexieCastToPromise").dexieCastToPromise(this.db.messages.where("threadJid").equals(a).toArray()).then(function(b){return b==null||b.length===0?[]:b.map(function(b){return{author:b.author,chat:a,externalId:b.externalId}})})};return a}();a.tableLocks={chunk:(b=d("MAWTransactionMode")).READONLY,ftsBackloggedMessages:b.READWRITE,groupInfo:b.READWRITE,groupInvites:b.READONLY,media:b.READONLY,messages:b.READWRITE,participants:b.READWRITE,reactions:b.READWRITE,receiverFetchInfo:b.READONLY,threads:b.READWRITE,xma:b.READONLY};g.MAWMessageStore_DEPRECATED_DO_NOT_USE=a}),98);
__d("WAResultOrErrorUtils",[],(function(a,b,c,d,e,f){"use strict";function a(a){var b=[];a.forEach(function(a){a.success&&b.push(a.value)});return b}function b(a){var b=[];a.forEach(function(a){a.success||b.push(a.error)});return b}f.unpackValues=a;f.unpackErrors=b}),66);
__d("MAWParticipantsStore",["MAWBridgeParticipants","MAWBridgeTypesCreators","MAWDbParticipant","MAWDbParticipantTxns","MAWDbThreadTxns","MAWDexieCastToPromise","MAWDexieTable","MAWIndexedDb","MAWTransactionMode","WAArrayGroupBy","WAArrayZip","WAGlobals","WAResultOrError","WAResultOrErrorUtils","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";a=function(a){var b=this;this.bulkGetInGroup=function(a){return d("MAWDexieCastToPromise").dexieCastToPromise(b.db.threads.get({jid:a}).then(function(a){return a!=null?d("MAWDbParticipantTxns").getParticipantsInThread(b.db,a.jid).then(function(b){return d("WAResultOrError").makeResult(b.map(function(b){return h(b,a.jid)}))}):d("WAResultOrError").makeError("missing_group")}))};this.bulkPut=function(a){return d("MAWDexieCastToPromise").dexieCastToPromise(k(b.db,a.map(function(a){a=a.chatJid;return a})).then(function(b){return d("WAResultOrErrorUtils").unpackValues(a.map(function(a){return!b.has(a.chatJid)?d("WAResultOrError").makeError():d("WAResultOrError").makeResult({participantId:d("MAWDbParticipant").craftParticipantId(a.chatJid,a.user),waParticipant:a})}))}).then(function(a){return b.db.participants.bulkGet(a.map(function(a){a=a.participantId;return a})).then(function(b){return d("WAArrayZip").zip(a,b).map(function(a){var b=a[0].waParticipant;a=a[1];return{chatJid:b.chatJid,dbParticipantToPut:babelHelpers["extends"]({deliveredWatermarkTs:d("WATimeUtils").castToUnixTime(0),lastReadWatermarkTs:d("WATimeUtils").castToUnixTime(0)},a,i(b)),existed:a!=null,participant:b}})})}).then(function(a){var c=a.map(function(a){a=a.dbParticipantToPut;return babelHelpers["extends"]({},a)});c.forEach(function(a){return d("MAWDbParticipantTxns").logIfIllegalParticipant(a,"MAWParticipantsStore::bulkPut")});return b.db.participants.bulkPut(c).then(function(){return l(b.db,a)})}))};this.bulkDelete=function(a,c){c=c||{};var e=c.remover,f=d("WAArrayGroupBy").groupBy(a.map(function(a,b){return{index:b,key:a}}),function(a){a=a.key;return a.groupJid});c=f.map(function(a){a=a[0];return a});return d("MAWDexieCastToPromise").dexieCastToPromise(k(b.db,c).then(function(a){return f.flatMap(function(b){var c=b[0];b=b[1];return b.map(function(b){var e=b.index;b=b.key;return!a.has(c)?d("WAResultOrError").makeError({index:e,message:"missing_group"}):d("WAResultOrError").makeResult({groupJid:c,index:e,participantId:d("MAWDbParticipant").craftParticipantId(c,b.userJid),participantKey:[c,b.userJid],userJid:b.userJid})})})}).then(function(a){var c=d("WAResultOrErrorUtils").unpackValues(a),e=d("WAResultOrErrorUtils").unpackErrors(a).map(function(a){return d("WAResultOrError").makeError(a)});a=c.map(function(a){a=a.participantId;return a});return b.db.participants.bulkGet(a).then(function(a){return d("WAArrayZip").zip(c,a).map(function(a){var b=a[0];a=a[1];return a==null?d("WAResultOrError").makeError({index:b.index,message:"missing_participant"}):d("WAResultOrError").makeResult(b)}).concat(e)})}).then(function(a){var c=d("WAResultOrErrorUtils").unpackValues(a),f=c.map(function(a){a=a.participantKey;return a}),g=c.map(function(a){var b=a.groupJid;a=a.userJid;return{groupJid:b,userJid:a}});return d("MAWDbParticipantTxns").bulkDeleteParticipants(b.db,f).then(function(){return m(b.db,g,e)}).then(function(){return a})}).then(function(a){return a.map(function(a){return a.success?{index:a.value.index,result:d("WAResultOrError").makeResult()}:{index:a.error.index,result:d("WAResultOrError").makeError(a.error.message)}}).sort(function(a,b){a=a.index;b=b.index;return a-b}).map(function(a){a=a.result;return a})}))};this.clear=function(){return d("MAWDexieCastToPromise").dexieCastToPromise(b.db.participants.clear())};this.db=a};a.tableLocks={participants:d("MAWTransactionMode").READWRITE,threads:d("MAWTransactionMode").READWRITE};function h(a,b){var c=a.addressable!=null?{addressable:a.addressable}:null;return babelHelpers["extends"]({chatJid:b,type:a.type,user:a.userJid},c)}function i(a){return{addressable:a.addressable,id:d("MAWDbParticipant").craftParticipantId(a.chatJid,a.user),threadJid:a.chatJid,type:a.type,userJid:a.user}}function j(a){return a.map(function(a){return a.user}).filter(function(a){return a===d("WAGlobals").getMyUserJid()||a==="@me"}).length>0}function k(a,b){a=a.threads;return a.where("jid").anyOf(b).toArray().then(function(a){return new Set(a.map(function(a){a=a.jid;return a}))})}function l(a,b){var c=b.filter(function(a){a=a.existed;return!a}).map(function(a){var b=a.chatJid;a=a.participant;return{chatJid:b,participant:a}});c=d("WAArrayGroupBy").groupBy(c,function(a){a=a.chatJid;return a}).map(function(a){var b=a[0];a=a[1];return[b,a.map(function(a){a=a.participant;return a})]});b.forEach(function(a){a=a.dbParticipantToPut;d("MAWIndexedDb").afterTransaction({tag:"ParticipantUpdated",value:d("MAWBridgeParticipants").createBridgeParticipant(a)})});b=c.filter(function(a){a[0];a=a[1];return j(a)}).map(function(a){a=a[0];return a});return d("MAWDbThreadTxns").subscribeToThreads(a,b)}function m(a,b,c){b=Array.from(b);b.forEach(function(a){a=a.groupJid;return d("MAWIndexedDb").afterTransaction({tag:"UpdateE2EEMetadataParticipants",value:d("MAWBridgeTypesCreators").createBridgeUpdateE2EEMetadataParticipants(a)})});var e=new Set(b.filter(function(a){return a.userJid===d("WAGlobals").getMyUserJid()&&(c===d("WAGlobals").getMyUserJid()||c==="@me")}).map(function(a){return a.groupJid}));b=new Set(b.filter(function(a){a=a.userJid;return a!==c&&(a===d("WAGlobals").getMyUserJid()||a==="@me")}).filter(function(a){a=a.groupJid;return!e.has(a)}).map(function(a){a=a.groupJid;return a}));return d("MAWDexieTable").dexieAll([d("MAWDbThreadTxns").archiveThreads(a,Array.from(e),!0),d("MAWDbThreadTxns").unsubscribeFromThreads(a,Array.from(b))])}g.MAWParticipantsStore=a}),98);
__d("MAWRunInTransaction",["MAWGroupInfoStore","MAWIndexedDb","MAWMessageStore","MAWParticipantsStore","MAWTransactionMode","dexie_maw"],(function(a,b,c,d,e,f,g){"use strict";var h={GroupInfoStore:d("MAWGroupInfoStore").MAWGroupInfoStore.tableLocks,MessagesStore:d("MAWMessageStore").MAWMessageStore_DEPRECATED_DO_NOT_USE.tableLocks,ParticipantsStore:d("MAWParticipantsStore").MAWParticipantsStore.tableLocks};a=function(a,b,e){var f=[];for(var g in a)a[g]===!0&&f.push(g);g=f.flatMap(function(a){return Object.entries(h[a])}).reduce(function(a,b){var c=b[0];b=b[1];if(a[c]===d("MAWTransactionMode").READWRITE)return a;c=c;return babelHelpers["extends"]({},a,(a={},a[""+c]=b,a))},{});g=d("MAWIndexedDb").makeMsgrTransactor(g,(f=e)!=null?f:"runInTransaction",function(e){return function(){var f={CollectionVersionStore:null,GroupInfoStore:a.GroupInfoStore===!0?new(d("MAWGroupInfoStore").MAWGroupInfoStore)(e):null,MessagesStore:a.MessagesStore===!0?new(d("MAWMessageStore").MAWMessageStore_DEPRECATED_DO_NOT_USE)(e):null,MissingKeyStore:null,ParticipantsStore:a.ParticipantsStore===!0?new(d("MAWParticipantsStore").MAWParticipantsStore)(e):null,PendingMutationStore:null,SyncActionStore:null,SyncKeyStore:null};return new(c("dexie_maw").Promise)(function(a){a(b(f))})}});return g()};g.runInTransaction=a}),98);
__d("MAWGetGroupInfoApi",["MAWRunInTransaction","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";a=function(a){return d("MAWRunInTransaction").runInTransaction({GroupInfoStore:!0},function(b){b=b.GroupInfoStore;return h({GroupInfoStore:b},a)},"getGroupInfo")};function h(a,b){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=a.GroupInfoStore;a=(yield a.get(b));return a.success?a.value:null});return i.apply(this,arguments)}g.getGroupInfo=a;g.getGroupInfoTransactor=h}),98);
__d("MAWMediaTypeAttribute",["MAWMsgType","WAAssertUnreachable","WAWap"],(function(a,b,c,d,e,f,g){"use strict";function a(a){if(a==null)return d("WAWap").DROP_ATTR;switch(a.type){case d("MAWMsgType").MSG_TYPE.IMAGE:return"image";case d("MAWMsgType").MSG_TYPE.VIDEO:return"video";case d("MAWMsgType").MSG_TYPE.PTT:return"ptt";case d("MAWMsgType").MSG_TYPE.GIF:return"gif";case d("MAWMsgType").MSG_TYPE.STICKER:return"sticker";case d("MAWMsgType").MSG_TYPE.XMA:return"xma-image";case d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:return"document";case d("MAWMsgType").MSG_TYPE.TEXT:case d("MAWMsgType").MSG_TYPE.FUTUREPROOF:case d("MAWMsgType").MSG_TYPE.CIPHERTEXT:case d("MAWMsgType").MSG_TYPE.UNAVAILABLE:case d("MAWMsgType").MSG_TYPE.EXPIRED_EPHEMERAL:case d("MAWMsgType").MSG_TYPE.REVOKED:case d("MAWMsgType").MSG_TYPE.ADMIN:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_ADMIN:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SCREENSHOT_ACTION:case d("MAWMsgType").MSG_TYPE.ICDC_ALERT:case d("MAWMsgType").MSG_TYPE.RECEIVER_FETCH:case d("MAWMsgType").MSG_TYPE.GROUP_INVITE:case d("MAWMsgType").MSG_TYPE.RAVEN:case d("MAWMsgType").MSG_TYPE.EDIT_ACTION:case d("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE:return d("WAWap").DROP_ATTR;default:return c("WAAssertUnreachable")(a.type)}}g.getMediaTypeAttribute=a}),98);
__d("MAWSpamReportUtils",["I64","InstamadilloTransportPayload.pb","LSIntEnum","MAWAsMessageApplication","MAWMediaTypeAttribute","MAWMediaUtils","MAWMsgType","WAGlobals","WAJids","WAMsgApplication.pb","WAWap","createInstamadilloAddMessagePayload","createInstamadilloTransportPayload","encodeProtobuf","err","justknobx"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a,b,c,e,f,g){var j;g===void 0&&(g=!1);g=g?d("WAWap").CUSTOM_STRING("1"):d("WAWap").CUSTOM_STRING("0");var k=(h||(h=d("I64"))).to_string(a.timestampMs),l=a.isUnsent?d("WAWap").CUSTOM_STRING("1"):d("WAWap").CUSTOM_STRING("0"),m=d("WAWap").DROP_ATTR,n,o,p=d("WAWap").CUSTOM_STRING("2"),q=d("WAWap").DROP_ATTR;j=(j=a==null?void 0:a.text)!=null?j:null;if((h||(h=d("I64"))).equal(a.displayedContentTypes,(i||(i=d("LSIntEnum"))).ofNumber(131072))&&j!==null)j=new TextEncoder().encode(j),n=d("WAWap").DROP_ATTR,o=d("WAWap").CUSTOM_STRING("3");else if((h||(h=d("I64"))).equal(a.displayedContentTypes,(i||(i=d("LSIntEnum"))).ofNumber(65536)))j=null,n=d("WAWap").DROP_ATTR,o=d("WAWap").DROP_ATTR;else if((h||(h=d("I64"))).equal(a.displayedContentTypes,(i||(i=d("LSIntEnum"))).ofNumber(256))||a.isUnsent){var r=d("MAWAsMessageApplication").asMessageApplicationLSDb(a);j=d("encodeProtobuf").encodeProtobuf(d("WAMsgApplication.pb").MessageApplicationSpec,r).readByteArray();n="text";o=d("WAWap").CUSTOM_STRING("3");q=a.isUnsent?d("WAWap").CUSTOM_STRING("7"):d("WAWap").DROP_ATTR}else if(a.transportKey==="Instamadillo"){r=f!=null?d("createInstamadilloAddMessagePayload").createInstamadilloAddMessageMediaPayload(a,f):d("createInstamadilloAddMessagePayload").createInstamadilloAddMessageTextPayload(a);r=d("createInstamadilloTransportPayload").createInstamadilloAddMessageTransportPayload(r);j=d("encodeProtobuf").encodeProtobuf(d("InstamadilloTransportPayload.pb").TransportPayloadSpec,r).readByteArray();n=f!=null?"media":"text";o=d("WAWap").CUSTOM_STRING("3");p=d("WAWap").CUSTOM_STRING("3")}else{r=d("MAWAsMessageApplication").asMessageApplicationLSDb(a);j=d("encodeProtobuf").encodeProtobuf(d("WAMsgApplication.pb").MessageApplicationSpec,r).readByteArray();n="text";o=d("WAWap").CUSTOM_STRING("3")}return d("WAWap").wap("message",{edit:q,from:c!=null?d("WAWap").GROUP_JID(c):e!=null?d("WAWap").USER_JID(e):d("WAWap").DROP_ATTR,id:d("WAWap").CUSTOM_STRING(a.messageId),participant:e!=null?d("WAWap").USER_JID(e):d("WAWap").DROP_ATTR,selected:g,t:d("WAWap").CUSTOM_STRING(k),to:b!=null?d("WAWap").USER_JID(b):d("WAWap").DROP_ATTR,type:n,unsent:l},d("WAWap").wap("raw",{mediatype:m,protocol_v:p,v:o},j))}function j(a){var b;if(((b=a.reportingMeta)==null?void 0:b.reportingContent)!=null){return{content:(b=a.reportingMeta)==null?void 0:b.reportingContent,shouldIgnoreFranking:!1}}b=(b=a.serverTs)!=null?b:a.ts;return b<=1708459984?{content:null,shouldIgnoreFranking:!0}:{content:null,shouldIgnoreFranking:!1}}function b(a,b,c,d,e,f,g,h){var i=[];i.push(k(a,b,d,e,f,g,h));if(c!=null)for(var a=c,c=Array.isArray(a),j=0,a=c?a:a[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var l;if(c){if(j>=a.length)break;l=a[j++]}else{j=a.next();if(j.done)break;l=j.value}l=l;i.push(k(l,b,d,e,f,g,h))}return i}function k(a,b,e,f,g,h,i){i=i?d("WAWap").CUSTOM_STRING("1"):d("WAWap").CUSTOM_STRING("0");var k=a.type===d("MAWMsgType").MSG_TYPE.REVOKED?d("WAWap").CUSTOM_STRING("1"):d("WAWap").CUSTOM_STRING("0"),l=d("WAWap").DROP_ATTR,m,n,o,p,q=d("WAWap").DROP_ATTR,r=!1;if(a.editMsgHistoryId!=null){if(a.editExternalId==null)return null;p=a.editExternalId;o=(a.editTs*1e3).toString();var s=d("MAWAsMessageApplication").asEditMessageApplication(a);m=d("encodeProtobuf").encodeProtobuf(d("WAMsgApplication.pb").MessageApplicationSpec,s).readByteArray();s="text";n=d("WAWap").CUSTOM_STRING("3")}else if(a.type===d("MAWMsgType").MSG_TYPE.FUTUREPROOF){var t;m=new Uint8Array(a.msgContent.protobuf);o=(((t=a.serverTs)!=null?t:a.ts)*1e3).toString();s=d("WAWap").DROP_ATTR;n=d("WAWap").CUSTOM_STRING("3");p=a.externalId}else if(a.type===d("MAWMsgType").MSG_TYPE.CIPHERTEXT){o=(((t=a.serverTs)!=null?t:a.ts)*1e3).toString();m=null;s=d("WAWap").DROP_ATTR;n=d("WAWap").DROP_ATTR;p=a.externalId}else if(a.type===d("MAWMsgType").MSG_TYPE.REVOKED||a.type===d("MAWMsgType").MSG_TYPE.DELETE_FOR_ME){t=d("MAWAsMessageApplication").deletedMsgAsMessageApplicationForSpamReporting(a);if(t==null)return null;m=d("encodeProtobuf").encodeProtobuf(d("WAMsgApplication.pb").MessageApplicationSpec,t).readByteArray();s="text";n=d("WAWap").CUSTOM_STRING("3");p=a.externalId;q=a.type===d("MAWMsgType").MSG_TYPE.REVOKED?d("WAWap").CUSTOM_STRING("7"):d("WAWap").DROP_ATTR;b!=null&&(l=d("MAWMediaUtils").getServerMediaTypeFromMediaType(b.mediaType));if(!h){t=j(a);t.content!=null&&(m=t.content);r=t.shouldIgnoreFranking}o=a.originalTs!=null?(a.originalTs*1e3).toString():(((t=a.serverTs)!=null?t:a.ts)*1e3).toString()}else{if(!h){t=j(a);t.content!=null&&(m=t.content);r=t.shouldIgnoreFranking}if(h||m==null){t=d("MAWAsMessageApplication").asMessageApplication(a,b);m=d("encodeProtobuf").encodeProtobuf(d("WAMsgApplication.pb").MessageApplicationSpec,t).readByteArray()}a.type==="Image"||a.type==="Ptt"||a.type==="Video"||a.type==="Gif"?s="media":s="text";n=d("WAWap").CUSTOM_STRING("3");l=d("MAWMediaTypeAttribute").getMediaTypeAttribute(a);o=(((h=a.serverTs)!=null?h:a.ts)*1e3).toString();p=a.externalId}b=null;if(d("WAGlobals").getConfig().isFrankingEnabled()&&((t=a.reportingMeta)==null?void 0:t.frankingTag)!=null&&((h=a.reportingMeta)==null?void 0:h.reportingTag)!=null&&!r){b=d("WAWap").wap("franking",null,d("WAWap").wap("franking_tag",null,(t=a.reportingMeta)==null?void 0:t.frankingTag),d("WAWap").wap("reporting_tag",null,(h=a.reportingMeta)==null?void 0:h.reportingTag))}(a.type===d("MAWMsgType").MSG_TYPE.REVOKED||a.type===d("MAWMsgType").MSG_TYPE.DELETE_FOR_ME)&&c("justknobx")._("1753")&&(b=null);return d("WAWap").wap("message",{edit:q,from:f!=null?d("WAWap").GROUP_JID(f):g!=null?d("WAWap").USER_JID(g):d("WAWap").DROP_ATTR,id:d("WAWap").CUSTOM_STRING(p),participant:g!=null?d("WAWap").USER_JID(g):d("WAWap").DROP_ATTR,selected:i,t:d("WAWap").CUSTOM_STRING(o),to:e!=null?d("WAWap").USER_JID(e):d("WAWap").DROP_ATTR,type:s,unsent:k},d("WAWap").wap("raw",{mediatype:l,v:n},m),b)}function e(a){var b;a.author===d("WAJids").AUTHOR_ME?b=d("WAGlobals").getMyUserJid():b=d("WAJids").authorAsUserJid(a.author);if(b==null)throw c("err")("Impossible message author");return b}function f(a,b){a.author===d("WAJids").AUTHOR_ME?a=b:a=d("WAGlobals").getMyUserJid();if(a==null)throw c("err")("Impossible message recipient");return a}g.formatLSDbMsgForSpamReport=a;g.getformattedMsgsForSpamReport=b;g.getAuthorAsJidForSpam=e;g.getRecipientAsJidForSpam=f}),98);
__d("IGDReportUserSpamJob",["FBLogger","I64","InstamadilloSendMediaMessageUtils","LSIntEnum","MAWDbChunk","MAWDbMedia","MAWDbMsg","MAWGetGroupInfoApi","MAWJids","MAWJobManager","MAWReStoreDb","MAWSpamReportUtils","Promise","WABase64","WADeprecatedSendIq","WAGlobals","WAJids","WAMediaUtils","WAResultOrError","WAWap","asyncToGeneratorRuntime","createInstamadilloMediaPayload","err","isStringNullOrEmpty"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;a=d("MAWJobManager").getPersistedJobsApi().definePersistedJob().finalStep("reportUserSpam",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=a.chatJid,f=a.context,g=a.frxParams,h=a.frxTags,i=a.msgs,j=a.reportedMessageId,l=a.spamFlow,m=a.userJid;a=null;if(h!=null){if(h.length===0)throw c("err")("spam reasons should not be an empty array");a=d("WAWap").wap("tagset",null,h.map(function(a){return d("WAWap").wap("tag",{value:d("WAWap").CUSTOM_STRING(a)})}))}h=null;c("isStringNullOrEmpty")(g)||(h=d("WAWap").wap("parameters",null,g));g=null;f!=null&&(g=d("WAWap").wap("context",null,f));var n=null;(a!=null||g!=null||h!=null)&&(n=d("WAWap").wap("frx",null,a,g,h));var q=(yield k(i,e,m,j));f=(yield d("WAJids").switchOnMsgrChatJidType(e,{group:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=d("WAWap").DROP_ATTR,c=d("WAWap").DROP_ATTR,e=(yield d("MAWGetGroupInfoApi").getGroupInfo(a));e!=null&&e.subject!=null&&e.subject.content!=null&&(b=d("WAWap").CUSTOM_STRING(e.subject.content));e!=null&&e.inviter!=null&&(c=d("WAWap").USER_JID(e.inviter));return o(q,a,m,c,b,l,n)});function c(b){return a.apply(this,arguments)}return c}(),user:function(){return p(q,m,l,n)}}));d("WADeprecatedSendIq").deprecatedCastStanza(f);return d("WAResultOrError").makeResult()});return function(b){return a.apply(this,arguments)}}()).end();function k(a,c,e,f){a=((a=a)!=null?a:[]).map(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=d("MAWJids").toUserJid((i||(i=d("I64"))).to_string(a.senderId)),g;a.transportKey==="Instamadillo"&&(i||(i=d("I64"))).equal(a.displayedContentTypes,(j||(j=d("LSIntEnum"))).ofNumber(2))&&(g=(yield l(a)));if(d("WAJids").interpretAsGroupJid(c)!=null)return d("MAWSpamReportUtils").formatLSDbMsgForSpamReport(a,null,d("WAJids").toGroupJid(c),b);else{var h=(i||(i=d("I64"))).equal(a.senderId,(i||(i=d("I64"))).of_string(d("WAJids").userIdFromJid(d("WAGlobals").getMyUserJid())))?e:d("WAGlobals").getMyUserJid();return d("MAWSpamReportUtils").formatLSDbMsgForSpamReport(a,h,null,b,g,f===a.messageId)}});return function(b){return a.apply(this,arguments)}}());return(h||(h=b("Promise"))).all(a)}function l(a){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=(yield d("MAWReStoreDb").getDB(f.id+":244"));e=(yield e.runInTransaction(function(){var e=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){var e=(yield d("InstamadilloSendMediaMessageUtils").getMediaAttachment(b,a.threadKey,a.messageId));if(e==null)throw c("FBLogger")("igd_web_on_msgr").warn("IGDReportUserSpam: Tried to send a message with associated attachment");var f=d("MAWDbMedia").convertToMediaId64((i||(i=d("I64"))).of_string(e.attachmentFbid));f=(yield b.e2ee_media.get(f));if(f==null)throw c("FBLogger")("igd_web_on_msgr").warn("IGDReportUserSpam: Tried to send an E2EE media message without associated e2ee_media");var g=d("MAWDbChunk").convertToChunkId64(i.of_string(e.attachmentFbid));b=(yield b.e2ee_chunk.get(g));if(b==null)throw c("FBLogger")("igd_web_on_msgr").warn("IGDReportUserSpam: Tried to send an E2EE media message without associated e2ee_chunk");return{attachment:e,chunk:b,media:f}});return function(a){return e.apply(this,arguments)}}(),"readonly",void 0,void 0,f.id+":245"));var g=e.attachment;e=e.media;var h=d("MAWDbMsg").instamadilloMsgIdToMsgId(a.messageId);if(!e.msgIds.includes(h))throw c("FBLogger")("igd_web_on_msgr").warn("IGDReportUserSpam: media is not linked to this message");h=e.mediaEntries.get(h);if(h==null)throw c("FBLogger")("igd_web_on_msgr").warn("IGDreportUserSpam: media entry not found");h=d("WAMediaUtils").mediaEntryDataToRawData(e.plaintextHash,h);h=n(h);h.$$unknownFieldCount;h=babelHelpers.objectWithoutPropertiesLoose(h,["$$unknownFieldCount"]);h=babelHelpers["extends"]({},h,{duration:g.playableDurationMs!=null?(i||(i=d("I64"))).to_int32(g.playableDurationMs):void 0,fileLength:e.size!=null?e.size:void 0,height:g.previewHeight!=null?(i||(i=d("I64"))).to_int32(g.previewHeight):void 0,isAnimated:!1,isSticker:!1,mediaType:e.mediaType,mimetype:g.playableUrlMimeType,sidecar:void 0,waveforms:g.waveformData!=null?g.waveformData.split(",").map(Number):void 0,waveformSamplingFrequencyHz:g.samplingFrequencyHz!=null?(i||(i=d("I64"))).to_int32(g.samplingFrequencyHz):void 0,width:g.previewWidth!=null?(i||(i=d("I64"))).to_int32(g.previewWidth):void 0});e=d("createInstamadilloMediaPayload").createInstamadilloMediaEncode(h);return e});return m.apply(this,arguments)}function n(a){var b=a.directPath,c=a.fbid,e=a.fileEncSha256,f=a.fileSha256,g=a.mediaKey,h=a.mediaKeyTimestamp;a=a.objectId;return{directPath:b!=null?b:void 0,fileEncSha256:e!=null?d("WABase64").encodeB64(e):void 0,fileSha256:f!=null?d("WABase64").encodeB64(f):void 0,mediaId:(b=c)!=null?b:void 0,mediaKey:g!=null?d("WABase64").encodeB64(g):void 0,mediaKeyTimestamp:String(h),objectId:(e=a)!=null?e:void 0}}function o(a,b,c,e,f,g,h){var i;return(i=d("WAWap")).wap("iq",{id:i.generateId(),to:i.S_WHATSAPP_NET,type:"set",xmlns:"spam"},i.wap("spam_list",{jid:i.GROUP_JID(b),reportee:i.USER_JID(c),source:e,spam_flow:i.CUSTOM_STRING(g),subject:f},a),h)}function p(a,b,c,e){var f;return(f=d("WAWap")).wap("iq",{id:f.generateId(),to:f.S_WHATSAPP_NET,type:"set",xmlns:"spam"},f.wap("spam_list",{jid:f.USER_JID(b),reportee:f.USER_JID(b),spam_flow:f.CUSTOM_STRING(c)},a),e)}g.igdReportUserSpam=a}),98);
__d("IGDStartInstamadilloDYIJob",["EncryptedBackupsDYISingleton","EncryptedBackupsDYITypes","MAWJobManager","MAWReStoreDb","asyncToGeneratorRuntime","cr:1288"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Instamadillo DYI not enabled"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Started job startInstamadilloDYI"]);i=function(){return a};return a}a=d("MAWJobManager").getPersistedJobsApi().definePersistedJob().finalStep("startInstamadilloDYI",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a.qplInstanceKey;d("EncryptedBackupsDYISingleton").initSingleton(d("EncryptedBackupsDYITypes").EncryptedBackupsDYIConfig.Instamadillo,d("MAWReStoreDb").getDB,a);a=d("EncryptedBackupsDYISingleton").getSingleton();var c=a.getLogger();c.LOG(i());a.logDYIQPLPoint("instamadillo_dyi_job_start");b("cr:1288")!=null?(yield b("cr:1288").getInstance().startDYI(),a.logDYIQPLPoint("instamadillo_dyi_started")):c.ERROR(h())});return function(b){return a.apply(this,arguments)}}()).end();g.startInstamadilloDYI=a}),98);
__d("MAWCreateJobNotImplemented",["WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose([""," not implemented for MAW"]);h=function(){return a};return a}function a(a){return[{info:function(b,c){return{code:function(){d("WALogger").WARN(h(),a)},requirements:null}},stepName:"NOT_IMPLEMENTED"}]}g.createNotImplementedJob=a}),98);
__d("IGDJobHandlers",["IGDReportUserSpamJob","IGDStartInstamadilloDYIJob","MAWCreateJobNotImplemented"],(function(a,b,c,d,e,f,g){"use strict";function a(){var a;return{acceptGroupInvite:(a=d("MAWCreateJobNotImplemented")).createNotImplementedJob("acceptGroupInvite"),addGroupParticipants:a.createNotImplementedJob("addGroupParticipants"),createGroup:a.createNotImplementedJob("createGroup"),deleteMsgsForMe:a.createNotImplementedJob("deleteMsgsForMe"),deleteThread:a.createNotImplementedJob("deleteThread"),demoteGroupParticipants:a.createNotImplementedJob("demoteGroupParticipants"),downloadAndHandleMedia:a.createNotImplementedJob("downloadAndHandleMedia"),downloadAndRestoreMedia:a.createNotImplementedJob("downloadAndRestoreMedia"),forwardMsg:a.createNotImplementedJob("forwardMsg"),getSpams:a.createNotImplementedJob("getSpams"),handleFutureproofMsg:a.createNotImplementedJob("handleFutureproofMsg"),handleSpamMsg:a.createNotImplementedJob("handleSpamMsg"),igdReportUserSpam:d("IGDReportUserSpamJob").igdReportUserSpam,leaveGroups:a.createNotImplementedJob("leaveGroups"),markThreadAsRead:a.createNotImplementedJob("markThreadAsRead"),promoteGroupParticipants:a.createNotImplementedJob("promoteGroupParticipants"),removeGroupParticipants:a.createNotImplementedJob("removeGroupParticipants"),reportUserSpam:a.createNotImplementedJob("reportUserSpam"),requestReuploadMedia:a.createNotImplementedJob("requestReuploadMedia"),rerevokeMsgs:a.createNotImplementedJob("rerevokeMsgs"),resendWrittenAppData:a.createNotImplementedJob("resendWrittenAppData"),restoreMessagesFromEncryptedBackups:a.createNotImplementedJob("restoreMessagesFromEncryptedBackups"),restoreProtobufsFromEncryptedBackups:a.createNotImplementedJob("restoreProtobufsFromEncryptedBackups"),restoreThreadsFromEncryptedBackups:a.createNotImplementedJob("restoreThreadsFromEncryptedBackups"),reuploadMedia:a.createNotImplementedJob("reuploadMedia"),revokeMsgs:a.createNotImplementedJob("revokeMsgs"),sendAppData:a.createNotImplementedJob("sendAppData"),sendEditMsg:a.createNotImplementedJob("sendEditMsg"),sendEphemeralSettingMsg:a.createNotImplementedJob("sendEphemeralSettingMsg"),sendGroupInviteMsg:a.createNotImplementedJob("sendGroupInviteMsg"),sendMediaMsg:a.createNotImplementedJob("sendMediaMsg"),sendMsg:a.createNotImplementedJob("sendMsg"),sendRavenActionMsg:a.createNotImplementedJob("sendRavenActionMsg"),sendReactionMsg:a.createNotImplementedJob("sendReactionMsg"),sendWrittenAppData:a.createNotImplementedJob("sendWrittenAppData"),sendWrittenMsg:a.createNotImplementedJob("sendWrittenMsg"),sendXMAShareMsg:a.createNotImplementedJob("sendXMAShareMsg"),setGroupSubject:a.createNotImplementedJob("setGroupSubject"),startInstamadilloDYI:d("IGDStartInstamadilloDYIJob").startInstamadilloDYI,updateBackupEntFbidForMedia:a.createNotImplementedJob("updateBackupEntFbidForMedia"),uploadRetroactiveThreadsAndMessages:a.createNotImplementedJob("uploadRetroactiveThreadsAndMessages")}}g.getJobHandlers=a}),98);
__d("IGDLoadRecentParticipantsApi",["I64","LSIntEnum","MAWReStoreDb","ReQL","WAJids","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i;a=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=(yield d("MAWReStoreDb").getDB(f.id+":30"));c=(yield d("ReQL").toArrayAsync(d("ReQL").fromTableDescending(c.tables.threads.index("lastActivityTimestampMs")).filter(function(a){return(h||(h=d("I64"))).equal(a.threadType,(i||(i=d("LSIntEnum"))).ofNumber(1))}).take(a)));var e=[];c.forEach(function(a){a=d("WAJids").interpretAsUserJid(d("WAJids").toMsgrUserJid((h||(h=d("I64"))).to_string(a.threadKey)));a!=null&&a!==b&&e.push(a)});return new Set(e)});return function(b,c){return a.apply(this,arguments)}}();g.loadRecentParticipants=a}),98);
__d("InstamadilloBackend",["cr:4482","cr:4772","cr:4849","cr:5025","cr:7098","cr:7629","cr:7691","cr:8224","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h=(d=b("cr:7098"))!=null?d:b("cr:7629"),i=(e=b("cr:4849"))!=null?e:b("cr:5025");function a(a){i!=null&&c("promiseDone")(i.setDeviceJid(a.deviceJid)),b("cr:8224")==null?void 0:b("cr:8224").initEbUploadQueue(),b("cr:7691")==null?void 0:b("cr:7691").initIGDEbRestoreProcessor(),b("cr:4772")==null?void 0:b("cr:4772").listenForEbUploadQueueFlush(),h!=null&&(h.initPendingMessageStanzaQueue(),c("promiseDone")(h.processFutureproofPendingMessageStanzas())),b("cr:4482")==null?void 0:b("cr:4482").startIGDDisappearingMsgCleaner()}g.init=a}),98);
__d("WACryptoCurve25519Dependencies",["Promise","WACryptoPrimitives","WASignalKeys","WASignalOther"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(){return(h||(h=b("Promise"))).resolve().then(function(){return d("WASignalKeys").makeKeyPair()})}function c(a,c){return(h||(h=b("Promise"))).resolve().then(function(){return d("WACryptoPrimitives").scalarMult(d("WASignalOther").ensureSize(c,32),d("WASignalOther").ensureSize(a,32)).buffer})}e={generateIdentityKeyPair:a,calculateAgreement:c};g.calculateAgreement=c;g.CURVE25519_SIGNAL_DEPENDENCIES=e}),98);
__d("WAFrameSocket",["WABinary","WAErrors","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["FrameSocket: queueing partial frame of "," bytes"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Buffer to send: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["FrameSocket closed"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["FrameSocket error"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["FrameSocket closed, waiting for pending processing"]);l=function(){return a};return a}var m=function(b){babelHelpers.inheritsLoose(a,b);function a(a){var c="SocketClosed";a=b.call(this,(a=a)!=null?a:c)||this;a.name=c;return a}return a}(babelHelpers.wrapNativeSuper(Error));a=function(){function a(a,b){var c=this;this.$3=new(d("WABinary").Binary)();this.closed=!1;this.$4=!1;this.onFrame=null;this.onClose=null;this.$5=function(a){c.$3.writeByteArray(a),c.convertBufferedToFrames()};this.$6=function(){if(c.$3.peek(n)){d("WALogger").LOG(l());c.$4=!0;return}c.$9()};this.$7=function(a){d("WALogger").DEV(k()).devConsole(a)};this.$2=b;this.$1=a;a.onData=this.$5;a.onClose=this.$6;a.onError=this.$7}var b=a.prototype;b.sendFrame=function(a){if(this.$4)return;this.throwIfClosed();var b=this.$2,c=a.byteLength,d=this.$1.dataToSend;b?(this.$2=null,d.ensureAdditionalCapacity(b.length+3+c),d.writeByteArray(b)):d.ensureAdditionalCapacity(3+c);this.$8(c);d.writeUint8(c>>16);d.writeUint16(c&65535);d.write(a);this.$1.requestSend()};b.$9=function(){if(this.closed)return;d("WALogger").LOG(j());this.$4=!1;this.closed=!0;var a=this.onClose;a&&a()};b.$8=function(a){if(a>=1<<24){d("WALogger").WARN(i(),a);throw new(d("WAErrors").BufferTooLargeError)("Buffer too large: "+a)}};b.convertBufferedToFrames=function(){var a=this.$3,b=this.onFrame;while(b&&a.peek(n)){var c=o(a);c=a.readByteArray(c);b(c);b=this.onFrame}this.$4&&!a.peek(n)&&this.$9();b&&a.size()&&d("WALogger").LOG(h(),a.size())};b.throwIfClosed=function(){if(this.closed)throw new m()};b.close=function(){this.$1.close()};return a}();function n(a){if(a.size()<3)return!1;var b=o(a);return b<=a.size()}function o(a){return a.readUint8()<<16|a.readUint16()}g.SocketClosed=m;g.FrameSocket=a}),98);
__d("WANoiseSocket",["Promise","WACryptoDependencies","WALogger","WAPromiseQueue","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendFrame adding to queue with frame size: "," bytes"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["NoiseSocket socket closed while encrypting frame"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Sending encrypted frame to web socket"]);k=function(){return a};return a}a=(h||(h=b("Promise"))).reject("UNINITIALIZED HANDSHAKE");var l=new Uint8Array(0);a["catch"](function(){});c=function(){function a(a,b,c){var e=this;this.$4=[];this.$5=new(d("WAPromiseQueue").PromiseQueue)();this.$6=new(d("WAPromiseQueue").PromiseQueue)();this.$7=0;this.$8=0;this.$9=!1;this.$14=function(a){!e.$1.closed?(d("WALogger").DEV(k()).tags("WANoiseSocket"),e.$1.sendFrame(a)):d("WALogger").LOG(j())};this.$12=function(a){var b=e.$7++;e.$5.enqueueHandlers(o(e.$2,b,void 0,a),e.$15)};this.$13=function(){e.$9=!0,e.$5.wait().then(function(){e.$9=!1;var a=e.$11;a&&a()})};this.$15=function(a){e.$10?e.$10(a):e.$4.push(a)};this.$1=a;this.$3=b;this.$2=c;a.onFrame=this.$12;this.$1.onClose=this.$13;a.convertBufferedToFrames()}var c=a.prototype;c.sendFrameAsync=function(a){var c;return b("regeneratorRuntime").async(function(d){while(1)switch(d.prev=d.next){case 0:d.next=2;return b("regeneratorRuntime").awrap(this.sendFrame(a));case 2:c=d.sent;return d.abrupt("return",c);case 4:case"end":return d.stop()}},null,this)};c.sendFrame=function(a){if(this.$9)return(h||(h=b("Promise"))).resolve();this.$1.throwIfClosed();var c=this.$8++;d("WALogger").DEV(i(),a.length).tags("WANoiseSocket");return this.$6.enqueueHandlers(n(this.$3,c,void 0,a),this.$14)};c.setOnFrame=function(a){this.$10=a};c.setOnClose=function(a){this.$11=a};c.close=function(){this.$1.close()};return a}();function m(a){var b=new ArrayBuffer(12),c=new DataView(b);c.setUint32(8,a);return new Uint8Array(b)}function n(a,b,c,e){return d("WACryptoDependencies").getCrypto().subtle.encrypt({name:"AES-GCM",iv:m(b),additionalData:c?new Uint8Array(c):l},a,e)}function o(a,b,c,e){return d("WACryptoDependencies").getCrypto().subtle.decrypt({name:"AES-GCM",iv:m(b),additionalData:c?new Uint8Array(c):l},a,e)}g.NoiseSocket=c}),98);
__d("MAWAdminAddParticipantMsg",["MAWLocalizationType","WAGlobals","WAJids"],(function(a,b,c,d,e,f,g){"use strict";var h=1;function i(a,b,c){switch(a){case 1:return{adminMsgContent:[b],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_YOU};case 2:return{adminMsgContent:[b,c],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_YOU_AND_ONE_USER};default:return{adminMsgContent:[b,(a-1).toString()],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_YOU_AND_MORE_THAN_ONE_USERS}}}function j(a,b,c){switch(a){case 1:return{adminMsgContent:[b],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_ONE_PARTICIPANT};case 2:return{adminMsgContent:[b,c],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_TWO_PARTICIPANTS};default:return{adminMsgContent:[b,(a-1).toString()],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_MORE_THAN_TWO_PARTICIPANTS}}}function k(a,b,c,e){switch(a){case 1:return{adminMsgContent:[b,c],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_ONE_USER};case 2:return{adminMsgContent:[b,c,e],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_TWO_USER}}return{adminMsgContent:[b,c,(a-1).toString()],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_MORE_THAN_TWO_USER}}function l(a,b){switch(a){case 1:return{adminMsgContent:[],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_YOU};case 2:return{adminMsgContent:[b],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_YOU_AND_ONE_USER}}return{adminMsgContent:[(a-1).toString()],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_YOU_AND_MORE_THAN_ONE_USER}}function m(a,b,c){switch(a){case 1:return{adminMsgContent:[b],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_ONE_USER};case 2:return{adminMsgContent:[b,c],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_TWO_USER}}return{adminMsgContent:[b,(a-1).toString()],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_MORE_THAN_TWO_USER}}function n(a,b){var c=d("WAGlobals").getMyUserJid(),e=b[0],f=b[1],g=d("WAJids").userIdFromJid(e);f=f!=null?d("WAJids").userIdFromJid(f):"";if(a==null)return b.includes(c)?l(b.length,e===c?f:g):m(b.length,g,f);if(a===c)return j(b.length,g,f);a=d("WAJids").userIdFromJid(a);return b.includes(c)?i(b.length,a,e===c?f:g):k(b.length,a,g,f)}function a(a,b){return babelHelpers["extends"]({},n(a,b),{version:h})}g.createAddParticipantsAdminMessage=a}),98);
__d("MAWAdminRemoveParticipantMsg",["MAWAdminMsgType","WAGlobals","WAJids"],(function(a,b,c,d,e,f,g){"use strict";var h=1;function i(a,b,c){switch(a){case 1:return{adminMsgContent:[b],adminType:d("MAWAdminMsgType").ADMIN_MSG_TYPE.PARTICIPANT_REMOVED_YOU};case 2:return{adminMsgContent:[b,c],adminType:d("MAWAdminMsgType").ADMIN_MSG_TYPE.PARTICIPANT_REMOVED_YOU_AND_ONE_USER};default:return{adminMsgContent:[b,(a-1).toString()],adminType:d("MAWAdminMsgType").ADMIN_MSG_TYPE.PARTICIPANT_REMOVED_YOU_AND_MORE_THAN_ONE_USERS}}}function j(a,b,c,e){switch(a){case 1:return e?{adminMsgContent:[],adminType:d("MAWAdminMsgType").ADMIN_MSG_TYPE.CURRENT_USER_LEFT_GROUP}:{adminMsgContent:[b],adminType:d("MAWAdminMsgType").ADMIN_MSG_TYPE.CURRENT_USER_REMOVED_ONE_PARTICIPANT};case 2:return{adminMsgContent:[b,c],adminType:d("MAWAdminMsgType").ADMIN_MSG_TYPE.CURRENT_USER_REMOVED_TWO_PARTICIPANTS};default:return{adminMsgContent:[b,(a-1).toString()],adminType:d("MAWAdminMsgType").ADMIN_MSG_TYPE.CURRENT_USER_REMOVED_MORE_THAN_TWO_PARTICIPANTS}}}function k(a,b,c,e,f){switch(a){case 1:return f?{adminMsgContent:[b],adminType:d("MAWAdminMsgType").ADMIN_MSG_TYPE.PARTICIPANT_LEFT_GROUP}:{adminMsgContent:[b,c],adminType:d("MAWAdminMsgType").ADMIN_MSG_TYPE.PARTICIPANT_REMOVED_ONE_USER};case 2:return{adminMsgContent:[b,c,e],adminType:d("MAWAdminMsgType").ADMIN_MSG_TYPE.PARTICIPANT_REMOVED_TWO_USER}}return{adminMsgContent:[b,c,(a-1).toString()],adminType:d("MAWAdminMsgType").ADMIN_MSG_TYPE.PARTICIPANT_REMOVED_MORE_THAN_TWO_USER}}function l(a,b){var c=d("WAGlobals").getMyUserJid(),e=b[0],f=b[1],g=d("WAJids").userIdFromJid(e);f=f!=null?d("WAJids").userIdFromJid(f):"";if(a==null)return b.includes(c)?{adminMsgContent:[],adminType:d("MAWAdminMsgType").ADMIN_MSG_TYPE.UNKNOWN_USER_REMOVED_YOU}:{adminMsgContent:[g],adminType:d("MAWAdminMsgType").ADMIN_MSG_TYPE.UNKNOWN_USER_REMOVED_ONE_USER};if(a===c)return j(b.length,g,f,e===c);var h=d("WAJids").userIdFromJid(a);return b.includes(c)?i(b.length,h,e===c?f:g):k(b.length,h,g,f,e===a)}function a(a,b){return babelHelpers["extends"]({},l(a,b),{version:h})}g.createRemoveParticipantsAdminMessage=a}),98);
__d("MAWAdminWriteChangeParticipantsAdminMsgTxn",["MAWAdminAddParticipantMsg","MAWAdminRemoveParticipantMsg","MAWDbThreadTxns","MAWLocalizationUtils","MAWWriteMsgTxns","WAGlobals","err"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return h(a,b,d("MAWAdminAddParticipantMsg").createAddParticipantsAdminMessage)}function b(a,b){return h(a,b,d("MAWAdminRemoveParticipantMsg").createRemoveParticipantsAdminMessage)}function h(a,b,e){var f=b.admin,g=b.chatJid,h=b.participants,i=b.serverTs;if(h.length===0)throw c("err")("invalid number of participants when writing participants change admin msg");return d("MAWDbThreadTxns").getThread(a,g).then(function(b){if(!b.success)throw c("err")("no thread when writing participants change admin msg");b=b.value;var g=d("WAGlobals").getMyUserJid();g=f==="@me"?g:f;if(g==null)return;g=d("MAWLocalizationUtils").buildUnstoredDbAdminMsg(e(g,h),b.jid,i);return d("MAWWriteMsgTxns").writeMsg(a,g,b).then(function(){})})}g.writeAddParticipantAdminMsg=a;g.writeRemoveParticipantAdminMsg=b}),98);
__d("MAWAdminWriteGroupNameChangeTxn",["MAWAdminMsgType","MAWDexieTable","MAWLocalizationUtils","MAWWriteMsgTxns","WAGlobals","WAJids","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c){var e=b.name;if(e==null)return d("MAWDexieTable").dexieResolve();var f=d("WAGlobals").getMyUserJid(),g=[];b.nameOwner===f?(f=d("MAWAdminMsgType").ADMIN_MSG_TYPE.CURRENT_USER_NAMED_GROUP,g.push(e)):b.nameOwner==null?(f=d("MAWAdminMsgType").ADMIN_MSG_TYPE.UNKNOWN_USER_NAMED_GROUP,g.push(e)):(f=d("MAWAdminMsgType").ADMIN_MSG_TYPE.PARTICIPANT_NAMED_GROUP,g.push(d("WAJids").userIdFromJid(b.nameOwner),e));b=d("MAWLocalizationUtils").buildUnstoredDbAdminMsg({adminMsgContent:g,adminType:f,version:1},c.jid,d("WATimeUtils").castMillisTimeToUnixTime(d("WATimeUtils").millisTime()));return d("MAWWriteMsgTxns").writeMsg(a,b,c).then(function(){})}g.writeGroupNameChangeInfo=a}),98);
__d("MAWParticipantManagementTxns",["MAWDbParticipantTxns","MAWDbThreadTxns","MAWDexieTable","WAGlobals"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c){return d("MAWDbParticipantTxns").getParticipantsInThread(a,b).then(function(e){if(c.length===0&&e.length===0)return{addedJids:[],participants:e,removedJids:[],typeUpdateJids:[]};var f=new Map();e.forEach(function(a){f.set(a.userJid,a)});var g=new Set(c.map(function(a){return a.userJid})),h=[],i=[],j=[],k=[];f.forEach(function(a,b){g.has(b)||(a.type!=="invitedParticipant"?h.push(b):(k.push({type:a.type,userJid:a.userJid}),j.push(babelHelpers["extends"]({},a))))});c.forEach(function(a){var b=f.get(a.userJid);b==null?(i.push(a),a.type==="admin"&&k.push({type:a.type,userJid:a.userJid})):(b.type!==a.type&&k.push({type:a.type,userJid:a.userJid}),j.push(babelHelpers["extends"]({},b,a)))});var l=h.indexOf(d("WAGlobals").getMyUserJid())>=0;e=function(){return[d("MAWDbParticipantTxns").bulkAddParticipants(a,b,i),d("MAWDbParticipantTxns").bulkUpdateParticipants(a,j),d("MAWDbParticipantTxns").bulkDeleteParticipantsInThread(a,b,h),l?d("MAWDbThreadTxns").archiveThreads(a,[b],!0):d("MAWDexieTable").dexieResolve()]};return d("MAWDexieTable").dexieAll(e()).then(function(a){var b=a[0];a=a[1];return{addedJids:i.map(function(a){return a.userJid}),participants:[].concat(b,a),removedJids:h,typeUpdateJids:k}})})}g.syncParticipantList=a}),98);
__d("MAWGroupManagementTxns",["MAWAdminWriteChangeParticipantsAdminMsgTxn","MAWAdminWriteGroupNameChangeTxn","MAWDbGroupInfoTxns","MAWDbMsgTxns","MAWDbParticipantTxns","MAWDbThreadTxns","MAWDexieTable","MAWFolderTypes","MAWGetOrCreateThreadTxns","MAWLoadMsgsTxns","MAWParticipantManagementTxns","MAWThreadManagementTxns","WAGlobals","WATimeUtils","isGroupInvitesEnabled"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c){return d("MAWDexieTable").dexieAll([d("MAWThreadManagementTxns").deleteAllThreadData(a,c),d("MAWDbGroupInfoTxns").deleteGroupInfo(a,b)]).then(function(a){a=a[0];return a}).then(function(a){return a})}b=function(a,b){var e=b.authoritativeThreadKey,f=b.deduplicationKey,g=b.extras,h=b.folder,i=b.groupStatus,j=b.groupToCreate,k=b.serverTs;b=i==="added"?d("WATimeUtils").unixTime():j.creationTs;return d("MAWGetOrCreateThreadTxns").getOrCreateThread(a,{authoritativeThreadKey:e,clientThreadKey:g==null?void 0:g.clientThreadKey,createTs:d("WATimeUtils").castUnixTimeToMillisTime(b),deduplicationKey:f,description:"createGroup",folder:h==null?d("MAWFolderTypes").FOLDER_ID.INBOX:h,jid:j.jid}).then(function(b){var e=b.created,f=b.thread;b=j.participants.map(function(a){return a.error?c("isGroupInvitesEnabled")()&&a.error.errorCode===403?{addressable:!0,type:"invitedParticipant",userJid:a.error.user}:null:{addressable:a.value.addressable,type:a.value.type,userJid:a.value.user}}).filter(Boolean);var g=e?d("MAWDbParticipantTxns").bulkAddParticipants:d("MAWParticipantManagementTxns").syncParticipantList,h=g(a,f.jid,b);g=d("WAGlobals").getMyUserJid();var l=i==="added"&&!e&&j.creator!==g?d("MAWAdminWriteChangeParticipantsAdminMsgTxn").writeAddParticipantAdminMsg(a,{admin:j.inviter,chatJid:f.jid,participants:[g],serverTs:k}):d("MAWDexieTable").dexieResolve();j.description;j.participants;var m=babelHelpers.objectWithoutPropertiesLoose(j,["description","participants"]);return d("MAWDbMsgTxns").getThreadNewestMessageId(a,f.jid).then(function(b){return d("MAWDexieTable").dexieAll([h,d("MAWDbGroupInfoTxns").putGroupInfo(a,m),b==null?d("MAWDexieTable").dexieResolve():d("MAWLoadMsgsTxns").loadMsgsAndMediaFromOffset(a,f.jid,b,10,!0),l]).then(function(b){b[0];b=b[1];return e&&i==="added"?d("MAWAdminWriteGroupNameChangeTxn").writeGroupNameChangeInfo(a,b,f):d("MAWDexieTable").dexieResolve()}).then(function(){return f.archived===!0?d("MAWDbThreadTxns").unarchiveThreads(a,[f.jid]):d("MAWDbThreadTxns").subscribeToThreads(a,[f.jid])}).then(function(a){return f.jid})})})};g.deleteGroup=a;g.createGroupInternal=b}),98);
__d("MAWDebugSendReaction",["MAWJobDefinitions","MAWJobManager","WADevToolsDebugFns"],(function(a,b,c,d,e,f,g){"use strict";a=d("WADevToolsDebugFns").defineDebugFunction("sendReaction",{desc:"Sends reaction to a message",execute:function(a,b,c,e){return d("MAWJobManager").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.sendReactionMsg(a,b,c,e))},serializedArgs:[{desc:"ChatJid of the thread containing the message to react to",name:"chatJid",placeholder:"ChatJid",type:"string"},{desc:"ProtocolMsgId of the message to react to",name:"reactTo",placeholder:"ProtocolMsgId",type:"object"},{desc:"FBID of the author of the message to react to",name:"author",placeholder:"FBID",type:"string"},{desc:"Reaction emoji to use",name:"reaction",placeholder:"\ud83d\ude00",type:"string"}]});g.sendReaction=a}),98);
__d("MAWDebugDefineFunctions",["MAWDebug","MAWDebugHydrateOfflineQueue","MAWDebugSendMultipleMsgs","MAWDebugSendReaction"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b){return{desc:a,execute:b,name:a,serializedArgs:[]}}function a(){var a=Object.keys(d("MAWDebug").MAWDebugFuncs).reduce(function(a,b){return Object.assign(a,(a={},a[b]=h(b,d("MAWDebug").MAWDebugFuncs[b]),a))},{});return babelHelpers["extends"]({},a,{hydrateOfflineQueue:d("MAWDebugHydrateOfflineQueue").hydrateOfflineQueue,sendMultipleMsgs:d("MAWDebugSendMultipleMsgs").sendMultipleMsgs,sendReaction:d("MAWDebugSendReaction").sendReaction})}g.getAllDebugFunctions=a}),98);
__d("WAParseMessageTransport",["decodeProtobuf"],(function(a,b,c,d,e,f,g){"use strict";function h(a){return{version:"v3",type:"error",error:a}}function i(a,b){return a!=null&&(b.dsm==null||b.dsm.destinationJid==null||b.dsm.destinationJid!==a)}function a(a,b){var c=a.payload;a=a.protocol;if(c==null&&a==null)return h("There is no payload and protocol in the message transport");else if(a==null)return h("There is no protocol part in the message transport");var e=a.integral;if(e==null)return h("There is no integral part in the message transport");else if(e.padding==null)return h("There is no padding in the message transport");else if(i(b,e))return h("The recipient does not match the device sent message recipient");else if(d("decodeProtobuf").getUnknownFields(e)!=null)return babelHelpers["extends"]({},h("There are unknown fields in the integral"),{futureProof:c==null?void 0:c.futureProof});if(c!=null){b=c.applicationPayload;return b==null?h("There is no applicationPayload payload in the message transport"):{type:"applicationPayload",applicationPayload:b,skdm:j(a.ancillary),icdc:k(a.ancillary)}}e=j(a.ancillary);return e!=null?{type:"skdm",skdm:e,icdc:k(a.ancillary)}:{type:"unknown"}}function j(a){return a==null?null:a.skdm}function k(a){return a==null?null:a.icdc}g.parseMessageTransport=a}),98);
__d("WADecodeIncomingMsg",["WALogger","WALongInt","WAMsgApplication.pb","WAMsgTransport.pb","WAParseMessageApplication","WAParseMessageTransport","WATimeUtils","decodeProtobuf"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["decodeIncomingMsg called with unexpected encoding version: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["instamadillo decodeIncomingMsg called with null applicationPayload"]);i=function(){return a};return a}function j(a,b){return a.futureProof?{version:"v3",type:"futureProof",futureProof:a.futureProof,protobuf:b,subtype:null}:{version:"v3",type:"error",error:a.error}}function a(a,b,c,e){if(b==="v2")return{version:"v2",encoded:a};else if(b==="v3"){var f=d("decodeProtobuf").decodeProtobufWithUnknowns(d("WAMsgTransport.pb").MessageTransportSpec,a);f=d("WAParseMessageTransport").parseMessageTransport(f,c);if(f.type==="error")return j(f,a);if(f.type==="skdm")return k(f.skdm,f.icdc);else if(f.type==="applicationPayload"){if(e===!0){if(f.applicationPayload.payload==null){d("WALogger").DEV(i());return{version:"v3",type:"error",error:"instamadillo unhandled proto"}}return{version:"v3",type:"instamadillo",applicationPayload:new Uint8Array(f.applicationPayload.payload)}}c=l(f.applicationPayload,a,f.icdc);if(f.skdm!=null){e=k(f.skdm,f.icdc);return{version:"v3",type:"msgWithSKDM",msg:c,skdm:e}}return c}else{f.type;return{version:"v3",type:"error",error:"unhandled proto"}}}else{d("WALogger").DEV(h(),b);return{type:"error",version:"v3",error:"decodeIncomingMsg called with unexpected encoding version: "+b}}}function k(a,b){var c=a.axolotlSenderKeyDistributionMessage;a=a.groupId;if(c==null)return{type:"error",version:"v3",error:"parseSKDM called with null axolotlSenderKeyDistributionMessage"};else if(a==null)return{type:"error",version:"v3",error:"parseSKDM called with null groupId"};return{version:"v3",type:"skdm",msg:{senderKey:c,groupId:a},icdc:b}}function l(a,b,c){var e=d("decodeProtobuf").decodeProtobufWithUnknowns(d("WAMsgApplication.pb").MessageApplicationSpec,a.payload);if(e.payload==null)return m(e.metadata);var f=d("WAParseMessageApplication").parseMessageApplication(e);return f.type==="error"?j(f,b):{version:"v3",type:"subprotocol",metadata:(e=e.metadata)!=null?e:null,subprotocolType:f.subprotocolType,subprotocol:f.payload,protobuf:b,frankingContent:a.payload,icdc:c}}function m(a){a=a==null?void 0:a.chatEphemeralSetting;if(a!=null){var b=a.ephemeralExpiration,c=a.ephemeralSettingTimestamp;if(b==null)return{version:"v3",type:"error",error:"Ephemeral setting without expiration"};try{c=c!=null?d("WATimeUtils").castToUnixTime(d("WALongInt").numberOrThrowIfTooLarge(c)/1e3):d("WATimeUtils").DEFAULT_UNIXTIME;return{version:"v3",type:"ephemeral",ephemeralExpirationInSec:b,ephemeralLastUpdatedOrSetTimestamp:c,isEphemeralSettingReset:(c=a.isEphemeralSettingReset)!=null?c:!1}}catch(e){return{version:"v3",type:"ephemeral",ephemeralExpirationInSec:b,ephemeralLastUpdatedOrSetTimestamp:d("WATimeUtils").DEFAULT_UNIXTIME,isEphemeralSettingReset:(c=a.isEphemeralSettingReset)!=null?c:!1}}}else return{version:"v3",type:"error",error:"MessageApplication has no payload and is not ephemeral"}}g.decodeIncomingMsg=a}),98);
__d("WAPreKeysStanzaUtils",["WAWap"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b;return(b=d("WAWap")).wap("key",null,b.wap("id",null,b.BIG_ENDIAN_CONTENT(a.id,3)),b.wap("value",null,a.keyPair.publicKey))}function b(a){var b;return(b=d("WAWap")).wap("skey",null,b.wap("id",null,b.BIG_ENDIAN_CONTENT(a.id,3)),b.wap("value",null,a.keyPair.publicKey),b.wap("signature",null,a.signature))}function c(a){var b=a.child("skey"),c=null;if(a.hasChild("key")){var d=a.child("key");c={id:d.child("id").contentUint(3),publicKey:d.child("value").contentSerializedPubKey()}}return{identity:a.child("identity").contentSerializedPubKey(),signedKey:{id:b.child("id").contentUint(3),publicKey:b.child("value").contentSerializedPubKey(),signature:b.child("signature").contentBytes(64)},oneTimeKey:c}}g.xmppPreKey=a;g.xmppSignedPreKey=b;g.readSessionInfo=c}),98);
__d("WAReceiptUtils",["WACryptoManagerUtils","WADeprecatedSendIq","WAMapWithDefault","WAMsg","WAPREList","WAPREMetrics","WAPreKeysStanzaUtils","WARequestPreKeyDigest","WAWap","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=a.retryCount;c=c+1;var e=d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.RETRY_RECEIPTS_SENT,{"int":{retries:c}});c>=3&&(yield d("WARequestPreKeyDigest").requestPreKeyDigestFn(function(a){return a(b)}));var f=null;c>=2&&(f=(yield d("WACryptoManagerUtils").getSignalInfoForRetry(b.cryptoManager)));var g=b.cryptoManager.regInfo.regId;e.endSuccess();return k(a,c,g,f)});return i.apply(this,arguments)}function a(a,b){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=a.externalId,e=a.from,f=a.participant,g;e.type==="group"?g=e.groupJid:(e.type,g=e.deviceJid);yield d("WADeprecatedSendIq").deprecatedSendStanzaAndWaitForAck(yield h(a,b),{id:c,"class":"receipt",from:g,participant:f})});return j.apply(this,arguments)}function k(a,b,c,e){var f=null;if(e!=null){var g=e.keyType,h=e.signedPreKey,i=e.preKey;e=e.publicKey;var j=a.deviceIdentity!=null?d("WAWap").wap("device-identity",null,a.deviceIdentity):null;f=d("WAWap").wap("keys",null,d("WAWap").wap("type",null,d("WAWap").BIG_ENDIAN_CONTENT(g,1)),d("WAWap").wap("identity",null,e),d("WAPreKeysStanzaUtils").xmppPreKey(i),d("WAPreKeysStanzaUtils").xmppSignedPreKey(h),j)}a.from.type==="group"?g=a.from.groupJid:(a.from.type,g=a.from.deviceJid);return d("WAWap").wap("receipt",{category:a.category!=null?d("WAWap").CUSTOM_STRING(a.category):d("WAWap").DROP_ATTR,id:d("WAWap").CUSTOM_STRING(a.externalId),participant:a.participant?d("WAWap").DEVICE_JID(a.participant):d("WAWap").DROP_ATTR,recipient:a.recipient?d("WAWap").USER_JID(a.recipient):d("WAWap").DROP_ATTR,to:d("WAWap").JID(g),type:"retry"},d("WAWap").wap("retry",{count:d("WAWap").INT(b),id:d("WAWap").CUSTOM_STRING(a.externalId),t:d("WAWap").INT(a.ts),v:"1"}),d("WAWap").wap("registration",null,d("WAWap").BIG_ENDIAN_CONTENT(c)),f)}function c(a){var b=new(d("WAMapWithDefault").MapWithDefault)(function(a){return new Set()});for(a of a){var c=a.receipt;if(c.receiptType==="group"||c.receiptType==="user")for(var e of c.externalIds)b.get(d("WAMsg").craftWAMsgIdString({author:c.messageAuthor,chat:c.chat,externalId:e})).add(c.from.author);else if(c.receiptType==="group-server-agg")for(e of c.receivers)b.get(d("WAMsg").craftWAMsgIdString({author:c.messageAuthor,chat:c.chat,externalId:c.externalId})).add(e.device)}return b.toMap()}g.makeRetryReceipt=h;g.sendRetryReceipt=a;g.calculateIdentitiesToDelete=c}),98);
__d("WAParseV3Protocol",["WAAckLevel","WAAssertUnreachable","WAErr","WAGlobals","WAHex","WAMsgType","WAParseConsumerMessageProtocol"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return function(b,e,f,g,h,i){h={id:{chat:e,author:g,externalId:f},ts:h,serverTs:h,ack:d("WAAckLevel").ACK.RECEIVED,forwardingScore:b.type!=="futureProof"?(f=b==null?void 0:(g=b.metadata)==null?void 0:g.forwardingScore)!=null?f:0:0};g=b.type!=="futureProof"&&((g=b.metadata)==null?void 0:(f=g.chatEphemeralSetting)==null?void 0:f.ephemeralExpiration)!=null&&((g=b.metadata)==null?void 0:(f=g.chatEphemeralSetting)==null?void 0:f.ephemeralExpiration)>0;if(b.type==="futureProof"||g&&!d("WAGlobals").getConfig().isEphemeralMessagesEnabled())return{unstoredMsg:{type:d("WAMsgType").FUTUREPROOF,msgContent:{subtype:null,protobuf:d("WAHex").bytesToBuffer(b.protobuf)},id:h.id,ts:h.ts,sentTs:h.sentTs,serverTs:h.serverTs,ack:h.ack,reportingMeta:h.reportingMeta},unstoredMedia:null,unstoredQuotedMedia:null};else if(b.type==="subprotocol"){f=a==null?void 0:a.get(b.subprotocolType);if(f!=null)return f(e,b.subprotocol,h,b.protobuf,b.metadata);switch(b.subprotocolType){case"consumerMessage":return d("WAParseConsumerMessageProtocol").parseConsumerMessageProtocol(e,b.subprotocol,h,b.protobuf,b.metadata,i);case"businessMessage":throw c("WAErr")("unsupported subprotocolType: "+b.subprotocolType);case"paymentMessage":throw c("WAErr")("unsupported subprotocolType: "+b.subprotocolType);case"multiDevice":throw c("WAErr")("unsupported subprotocolType: "+b.subprotocolType);case"voip":throw c("WAErr")("unsupported subprotocolType: "+b.subprotocolType);default:throw c("WAErr")("Subprotocol parser for: "+b.subprotocolType+" was not found")}}else return c("WAAssertUnreachable")(b.type)}}g.createV3ProtocolParser=a}),98);
__d("WASmaxInGroupsEnums",["WAJids"],(function(a,b,c,d,e,f,g){a={304:"304",419:"419"};b={403:"403",404:"404",406:"406",419:"419"};c={404:"404",406:"406"};e={404:"404",419:"419"};f={406:"406",500:"500"};var h={accept:"accept",auto_add:"auto_add",default_sub_group_admin_add:"default_sub_group_admin_add",general_chat_auto_add:"general_chat_auto_add",invite:"invite",invite_auto_add:"invite_auto_add",linked_group_join:"linked_group_join",sub_group_suggestion_approved:"sub_group_suggestion_approved"},i={accept:"accept",default_sub_group_promote:"default_sub_group_promote",invite:"invite",invite_auto_add:"invite_auto_add",linked_group_join:"linked_group_join"},j={admin:"admin",creator:"creator"},k={admin:"admin",superadmin:"superadmin"},l={approved:"approved",cancelled:"cancelled",rejected:"rejected"},m={deactivate_general_chat:"deactivate_general_chat",delete_capi:"delete_capi",delete_parent:"delete_parent",integrity_delete_parent:"integrity_delete_parent"},n={deactivate_group:"deactivate_group",delete_parent:"delete_parent",integrity_delete_parent:"integrity_delete_parent",unlink_group:"unlink_group"},o={e2ee_migration:"e2ee_migration",regular:"regular",rtc:"rtc"},p={"false":"false","true":"true"},q={group:"group",user:"user"},r={image:"image",preview:"preview"},s={invite_link:"invite_link",linked_group_join:"linked_group_join",non_admin_add:"non_admin_add"},t={lid:"lid",pn:"pn"},u={parent_group:"parent_group",sibling_group:"sibling_group",sub_group:"sub_group"};d={validators:[d("WAJids").validateDomainJid,d("WAJids").validateGroupJid],typeName:"DomainJid|GroupJid"};g.ENUM_304_419=a;g.ENUM_403_404_406_419=b;g.ENUM_404_406=c;g.ENUM_404_419=e;g.ENUM_406_500=f;g.ENUM_ACCEPT_AUTOADD_DEFAULTSUBGROUPADMINADD_GENERALCHATAUTOADD_INVITE_INVITEAUTOADD_LINKEDGROUPJOIN_SUBGROUPSUGGESTIONAPPROVED=h;g.ENUM_ACCEPT_DEFAULTSUBGROUPPROMOTE_INVITE_INVITEAUTOADD_LINKEDGROUPJOIN=i;g.ENUM_ADMIN_CREATOR=j;g.ENUM_ADMIN_SUPERADMIN=k;g.ENUM_APPROVED_CANCELLED_REJECTED=l;g.ENUM_DEACTIVATEGENERALCHAT_DELETECAPI_DELETEPARENT_INTEGRITYDELETEPARENT=m;g.ENUM_DEACTIVATEGROUP_DELETEPARENT_INTEGRITYDELETEPARENT_UNLINKGROUP=n;g.ENUM_E2EEMIGRATION_REGULAR_RTC=o;g.ENUM_FALSE_TRUE=p;g.ENUM_GROUP_USER=q;g.ENUM_IMAGE_PREVIEW=r;g.ENUM_INVITELINK_LINKEDGROUPJOIN_NONADMINADD=s;g.ENUM_LID_PN=t;g.ENUM_PARENTGROUP_SIBLINGGROUP_SUBGROUP=u;g.DOMAINJID_GROUPJID=d}),98);
__d("WASmaxInGroupsGroupAddressingModeMixin",["WAResultOrError","WASmaxInGroupsEnums","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxParseUtils").attrStringEnum(a,"addressing_mode",d("WASmaxInGroupsEnums").ENUM_LID_PN);return!a.success?a:d("WAResultOrError").makeResult({addressingMode:a.value})}g.parseGroupAddressingModeMixin=a}),98);
__d("WASmaxInGroupsPhoneNumberMixin",["WAResultOrError","WASmaxParseJid"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxParseJid").attrUserJid(a,"phone_number");return!a.success?a:d("WAResultOrError").makeResult({phoneNumber:a.value})}g.parsePhoneNumberMixin=a}),98);
__d("WASmaxInGroupsParticipantNotAddressableMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"participant");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"addressable","false");return!b.success?b:d("WAResultOrError").makeResult({addressable:b.value})}g.parseParticipantNotAddressableMixin=a}),98);
__d("WASmaxInGroupsDedupAttrsMixin",["WAResultOrError","WASmaxInGroupsEnums","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").attrString(a,"key");if(!b.success)return b;a=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrStringEnum,a,"create_ctx",d("WASmaxInGroupsEnums").ENUM_E2EEMIGRATION_REGULAR_RTC);return!a.success?a:d("WAResultOrError").makeResult({key:b.value,createCtx:a.value})}g.parseDedupAttrsMixin=a}),98);
__d("WASmaxInGroupsNamedSubjectMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxParseUtils").attrString(a,"subject");return!a.success?a:d("WAResultOrError").makeResult({subject:a.value})}g.parseNamedSubjectMixin=a}),98);
__d("WASmaxInGroupsUnnamedSubjectFallbackMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrString,a,"subject");return!a.success?a:d("WAResultOrError").makeResult({subject:a.value})}g.parseUnnamedSubjectFallbackMixin=a}),98);
__d("WASmaxInGroupsNamedSubjectOrUnnamedSubjectFallbackMixinGroup",["WAResultOrError","WASmaxInGroupsNamedSubjectMixin","WASmaxInGroupsUnnamedSubjectFallbackMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInGroupsNamedSubjectMixin").parseNamedSubjectMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"NamedSubject",value:b.value});var c=d("WASmaxInGroupsUnnamedSubjectFallbackMixin").parseUnnamedSubjectFallbackMixin(a);return c.success?d("WAResultOrError").makeResult({name:"UnnamedSubjectFallback",value:c.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["NamedSubject","UnnamedSubjectFallback"],[b,c])}g.parseNamedSubjectOrUnnamedSubjectFallbackMixinGroup=a}),98);
__d("WASmaxInGroupsAdminAddModeMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"member_add_mode");if(!b.success)return b;b=d("WASmaxParseUtils").literalContent(d("WASmaxParseUtils").contentString,a,"admin_add");return!b.success?b:d("WAResultOrError").makeResult({elementValue:b.value})}g.parseAdminAddModeMixin=a}),98);
__d("WASmaxInGroupsAllMembersAddModeMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"member_add_mode");if(!b.success)return b;b=d("WASmaxParseUtils").literalContent(d("WASmaxParseUtils").contentString,a,"all_member_add");return!b.success?b:d("WAResultOrError").makeResult({elementValue:b.value})}g.parseAllMembersAddModeMixin=a}),98);
__d("WASmaxInGroupsUnknownAddModeMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"member_add_mode");if(!b.success)return b;b=d("WASmaxParseUtils").contentString(a);return!b.success?b:d("WAResultOrError").makeResult({elementValue:b.value})}g.parseUnknownAddModeMixin=a}),98);
__d("WASmaxInGroupsAdminOrAllMembersOrUnknownAddModeMixinGroup",["WAResultOrError","WASmaxInGroupsAdminAddModeMixin","WASmaxInGroupsAllMembersAddModeMixin","WASmaxInGroupsUnknownAddModeMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInGroupsAdminAddModeMixin").parseAdminAddModeMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"AdminAddMode",value:b.value});var c=d("WASmaxInGroupsAllMembersAddModeMixin").parseAllMembersAddModeMixin(a);if(c.success)return d("WAResultOrError").makeResult({name:"AllMembersAddMode",value:c.value});var e=d("WASmaxInGroupsUnknownAddModeMixin").parseUnknownAddModeMixin(a);return e.success?d("WAResultOrError").makeResult({name:"UnknownAddMode",value:e.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["AdminAddMode","AllMembersAddMode","UnknownAddMode"],[b,c,e])}g.parseAdminOrAllMembersOrUnknownAddModeMixinGroup=a}),98);
__d("WASmaxInGroupsGroupMemberAddModeMixin",["WAResultOrError","WASmaxInGroupsAdminOrAllMembersOrUnknownAddModeMixinGroup","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxParseUtils").flattenedChildWithTag(a,"member_add_mode");if(!a.success)return a;a=d("WASmaxInGroupsAdminOrAllMembersOrUnknownAddModeMixinGroup").parseAdminOrAllMembersOrUnknownAddModeMixinGroup(a.value);return!a.success?a:d("WAResultOrError").makeResult({memberAddModeAdminOrAllMembersOrUnknownAddModeMixinGroup:a.value})}g.parseGroupMemberAddModeMixin=a}),98);
__d("WASmaxInGroupsGroupJoinMembershipApprovalModeEnabledMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"group_join");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"state","on");return!b.success?b:d("WAResultOrError").makeResult({state:b.value})}g.parseGroupJoinMembershipApprovalModeEnabledMixin=a}),98);
__d("WASmaxInGroupsMembershipApprovalGroupJoinModeEnabledMixin",["WASmaxInGroupsGroupJoinMembershipApprovalModeEnabledMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"membership_approval_mode");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"group_join");if(!b.success)return b;a=d("WASmaxInGroupsGroupJoinMembershipApprovalModeEnabledMixin").parseGroupJoinMembershipApprovalModeEnabledMixin(b.value);return!a.success?a:a}g.parseMembershipApprovalGroupJoinModeEnabledMixin=a}),98);
__d("WASmaxInGroupsParentGroupDefaultMembershipApprovalModeMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"parent");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"default_membership_approval_mode","request_required");return!b.success?b:d("WAResultOrError").makeResult({defaultMembershipApprovalMode:b.value})}g.parseParentGroupDefaultMembershipApprovalModeMixin=a}),98);
__d("WASmaxInGroupsParentGroupMixin",["WAResultOrError","WASmaxParseJid"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxParseJid").attrGroupJid(a,"parent_group_jid");return!a.success?a:d("WAResultOrError").makeResult({parentGroupJid:a.value})}g.parseParentGroupMixin=a}),98);
__d("MAWServerRPC",["MAWHandleAbPropsRefreshNotification","MAWHandleAppdataMessage","MAWHandleChatState","MAWHandleFailure","MAWHandleFbDeviceChangeNotification","MAWHandleFbMultiwayNotification","MAWHandleFbThreadNotification","MAWHandleGroupNotification","MAWHandleGroupReceipt","MAWHandleGroupRetryReceipt","MAWHandleIndividualRetryReceipt","MAWHandleLoginSuccess","MAWHandlePeerAppdataReceipt","MAWHandlePeerAppdataRetryReceipt","MAWHandleSpam","MAWHandleThreadMetadata","Promise","WAHandleErrorStanza","WAHandleIncomingMsg","WAHandleInfoBulletin","WAHandlePrekeyContactIDChangedNotification","WAHandlePrekeyDigestNotification","WAHandlePrekeyLowCountNotification","WAHandleReceipt","WAHandleServerPing","WAHandleStreamError","WALogger","WAServerRPC"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Peer messages are not supported"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Broadcast messages are not supported"]);j=function(){return a};return a}function a(){var a;return d("WAServerRPC").makeServerRPC({abprops:{handleAbPropsRefreshNotification:d("MAWHandleAbPropsRefreshNotification").handleAbPropsRefreshNotification},accountSync:null,appdataMessage:{handleAppdataMessage:d("MAWHandleAppdataMessage").handleAppdataMessage,handlePeerAppdataReceipt:d("MAWHandlePeerAppdataReceipt").handlePeerAppdataReceipt,handlePeerAppdataRetryReceipt:d("MAWHandlePeerAppdataRetryReceipt").handlePeerAppdataRetryReceipt},broadcast:{handleBroadcastMessage:function(a){a=a.makeAck;d("WALogger").ERROR(j());return(h||(h=b("Promise"))).resolve(a())}},clientLog:null,comms:{handleEdgeRoutingInfo:d("WAHandleInfoBulletin").handleEdgeRoutingInfo,handleServerPing:d("WAHandleServerPing").handleServerPing},error:{handleErrorStanza:d("WAHandleErrorStanza").handleErrorStanza,handleSmaxErrorStanza:d("WAHandleErrorStanza").handleSmaxErrorStanza},fb:{handleFbDeviceChangeNotification:d("MAWHandleFbDeviceChangeNotification").handleFbDeviceChangeNotification,handleFbMultiwayNotification:d("MAWHandleFbMultiwayNotification").handleFbMultiwayNotification,handleFbThreadNotification:d("MAWHandleFbThreadNotification").handleFbThreadNotification},groupMessage:{handleGroupChatState:d("MAWHandleChatState").handleGroupChatState,handleGroupDirtyBit:null,handleGroupMessage:d("WAHandleIncomingMsg").handleGroupMessage,handleGroupNotification:d("MAWHandleGroupNotification").handleGroupNotification,handleGroupReceipt:d("MAWHandleGroupReceipt").handleGroupReceipt,handleGroupRetryReceipt:d("MAWHandleGroupRetryReceipt").handleGroupRetryReceipt},individualMessage:{handleIndividualChatState:d("MAWHandleChatState").handleIndividualChatState,handleIndividualMessage:d("WAHandleIncomingMsg").handleIncomingIndividualMsg,handleIndividualReceipt:d("WAHandleReceipt").handleIndividualReceipt,handleIndividualRetryReceipt:d("MAWHandleIndividualRetryReceipt").handleIndividualRetryReceipt},login:{handleLoginFailure:d("MAWHandleFailure").handleLoginFailure,handleLoginSuccess:d("MAWHandleLoginSuccess").handleLoginSuccess},md:null,newsletter:null,offline:{handleOfflineEnd:d("WAHandleInfoBulletin").handleOfflineEnd,handleOfflineStart:d("WAHandleInfoBulletin").handleOfflineStart,handleThreadMetadata:d("MAWHandleThreadMetadata").handleThreadMetadata},peerMessage:{handlePeerMessage:function(a){a=a.makeAck;d("WALogger").ERROR(i());return(h||(h=b("Promise"))).resolve(a())}},prekey:{handlePrekeyContactIDChangedNotification:d("WAHandlePrekeyContactIDChangedNotification").handlePrekeyContactIDChangedNotification,handlePrekeyDigestNotification:d("WAHandlePrekeyDigestNotification").handlePrekeyDigestNotification,handlePrekeyLowCountNotification:d("WAHandlePrekeyLowCountNotification").handlePrekeyLowCountNotification},presence:null,serverProps:null,spam:{handleSpam:d("MAWHandleSpam").handleSpam},status:null,streamError:{handleAckKick:(a=d("WAHandleStreamError")).handleAckKick,handleBadMac:a.handleBadMac,handleConflict:a.handleConflict,handlePingKick:a.handlePingKick,handleStreamErrorCode:a.handleStreamErrorCode,handleXmlNotWellFormed:a.handleXmlNotWellFormed},syncd:null,usync:null})}g.makeServerRPC=a}),98);
__d("WADebugTools",["WADevToolsDebugFns"],(function(a,b,c,d,e,f,g){"use strict";function a(a){self.Debug==null&&(self.Debug={});var b=function(b){var c=a[b];self.Debug[c.name]=function(){return c.execute.apply(c,arguments)}};for(var c in a)b(c);d("WADevToolsDebugFns").registerDebugFnsToDevTool(a)}g.initDebugFunctions=a}),98);
__d("IGDBackend",["IGDAWDebug","IGDAWMainWebWorkerConfig","IGDBackendBridgeHandlers","IGDCOP","IGDJobHandlers","IGDLoadRecentParticipantsApi","InstamadilloBackend","MAWClearSignalAndTempStores","MAWCommsConfig","MAWConfig","MAWCreateGroupApi","MAWCurrentUser","MAWDebugDefineFunctions","MAWDefinePersistedJob","MAWEphemeralConsts","MAWFbCat","MAWGetWorkerStatusApi","MAWHandleReachabilityErrorAdminMsgApi","MAWMessageReceiveReliabilityLogger","MAWPREListeners","MAWQplProxy","MAWReStoreDb","MAWServerRPC","MAWSharedOfflineQueueMetric","MAWSharedOfflineResumeUINotifier","MAWTaskDefinitions","WAArrayBufferUtils","WADebugTools","WAMessageLoggingPublisher","WAMockServerShell","WAPassiveMode","WAService","WATagsLogger","WAWaitForComms","WAWaitForUserUnblocked","asyncToGeneratorRuntime","emptyFunction","isUseridAnnotationEnabled","promiseDone","qpl"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Worker inited"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to init worker (post-startup): ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["deviceJid: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["initWAInfra"]);k=function(){return a};return a}var l=d("WATagsLogger").TAGS(["backend"]);function a(a,b,c,d,e){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f,g){l.LOG(k());l.LOG(j(),a.deviceJid);d("MAWQplProxy").sendQplPointThroughBridge(c("qpl")._(25310776,"6155"),"igd_backend_setup_start");d("MAWFbCat").setFbCat(d("WAArrayBufferUtils").stringToArrayBuffer(a.fbCat));f=d("MAWServerRPC").makeServerRPC();g=(yield d("WAService").makeWAService({config:g,dependencies:{clearSignalAndTempStores:d("MAWClearSignalAndTempStores").clearSignalAndTempStores,createGroups:d("MAWCreateGroupApi").createGroups,ephemeralMaxDeletionWindowForUnseenMessage:function(){return d("MAWEphemeralConsts").ephemeralMaxDelectionWindowForUnseenMessage},handleReachabilityErrorAdminMsg:d("MAWHandleReachabilityErrorAdminMsgApi").handleReachabilityErrorAdminMsg,isEmployee:d("MAWCurrentUser").isEmployee,isUseridAnnotationEnabled:c("isUseridAnnotationEnabled"),loadRecentParticipants:d("MAWReStoreDb").shouldUseReStoreDb()?d("IGDLoadRecentParticipantsApi").loadRecentParticipants:c("emptyFunction"),mediaUploadRoot:function(){return"/wa-igd/mms"}},getCommsConfig:d("MAWCommsConfig").getCommsConfig,hmacKey:b,regData:a,serverRPC:f})["catch"](function(a){l.ERROR(i(),a);throw a}));d("MAWMessageReceiveReliabilityLogger").subscribeToIncomingMessageEvents(d("WAMessageLoggingPublisher").messageLoggingPublisher);d("MAWSharedOfflineQueueMetric").makeOfflineQueueMetric(g.oneQueue,d("WAPassiveMode").passiveModeNotifier,d("IGDCOP").cop,d("WAMessageLoggingPublisher").messageLoggingPublisher);d("MAWConfig").setConfig(d("IGDAWMainWebWorkerConfig").mawConfig);d("IGDCOP").cop.subscribeToOfflineQueue(g.oneQueue,g.protocolQueue);d("MAWSharedOfflineResumeUINotifier").offlineResumeUINotifier.subscribeToWAEvents(g.oneQueue);d("MAWSharedOfflineResumeUINotifier").offlineResumeUINotifier.subscribeToMawEvents(d("IGDCOP").cop);d("WAMockServerShell").isMockServerMode||c("promiseDone")(d("WAWaitForComms").waitForComms().then(function(){return d("MAWTaskDefinitions").registerTasks(d("WAWaitForUserUnblocked").waitForUserUnblocked())}));e.setHandlers("backend",d("IGDBackendBridgeHandlers").getIGDBridgeHandlers(l));d("MAWPREListeners").initializeWAPREMetrics();d("InstamadilloBackend").init(a);d("MAWDefinePersistedJob").setMsgrJobImplementations(d("IGDJobHandlers").getJobHandlers());yield g.startComms();l.LOG(h());d("MAWGetWorkerStatusApi").updateWorkerStatus("success");d("WAWaitForComms").unblockComms();d("MAWQplProxy").sendQplPointThroughBridge(c("qpl")._(25310776,"6155"),"igd_backend_setup_end")});return m.apply(this,arguments)}g.startIGDBackend=a}),98);
__d("IGDLowLevelApiImpl",["IGDLowLevelApiBridgeHandlers"],(function(a,b,c,d,e,f,g){"use strict";function a(){return{bridgeHandlers:d("IGDLowLevelApiBridgeHandlers").igdBridgeHandlers}}g.makeLowLevelApi=a}),98);
__d("MAWDbInitIndexedDb",["MAWIndexedDb","MWEARKeychainV3","WALogger","gkx"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[DB INIT] REGULAR DB INIT"]);h=function(){return a};return a}function a(){d("WALogger").LOG(h());return d("MAWIndexedDb").makeDB(d("MWEARKeychainV3").getDbEncryptionKey,{enableDataSyncMiddleware:!0,enableMutationValidator:c("gkx")("1627")})}g.dbInit=a}),98);
__d("MAWReStoreMigrationUtils",["Deferred","MAWDbAppMeta","MAWDbObjEncryption","MAWDbSchema.restore","MAWGetDbVersion","MAWReStoreDbSetup","MWEARKeychainV3","Promise","WATagsLogger","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Error fetching batch: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["REQUESTING ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[MAWReStoreMigrationUtils] DELETING "," DB"]);k=function(){return a};return a}var l=d("WATagsLogger").TAGS(["DBInit","Migration"]),m=new Map(d("MAWDbSchema.restore").clientSchema.map(function(a){return[a.name,a]}));function a(a){return new(h||(h=b("Promise")))(function(b,c){var d=indexedDB.open(a);d.onupgradeneeded=function(a){a.target.transaction.abort(),b(null)};d.onerror=function(a){c("Error opening database: "+a.target.error)};d.onsuccess=function(a){a=a.target.result;b(a)}})}function e(a){l.LOG(k(),a);var b=new(c("Deferred"))();a=indexedDB.deleteDatabase(a);a.onsuccess=function(){return b.resolve()};a.onerror=function(a){return b.reject(a)};return b.getPromise()}function n(a,c){var e=a.transaction("appMeta").objectStore("appMeta");return new(h||(h=b("Promise")))(function(a,b){var f=e.get(c);f.onsuccess=function(b){b=b.target.result;if(b==null){a();return}a(d("MAWDbObjEncryption").decryptDbObj(b,"appMeta",d("MWEARKeychainV3").getDbEncryptionKey))};f.onerror=function(a){l.LOG(j(),a),b(a)}})}function o(a,c,e){if(a==null)return(h||(h=b("Promise"))).resolve();var f=a.transaction("appMeta","readwrite").objectStore("appMeta");return new(h||(h=b("Promise")))(function(a,b){var g;g=f.put(d("MAWDbObjEncryption").encryptDbObj({key:c,value:(g={},g[c]=e,g)},"appMeta",d("MWEARKeychainV3").getDbEncryptionKey));g.onsuccess=function(){a()};g.onerror=function(a){b(a)}})}function p(a,c){return new(h||(h=b("Promise")))(function(b,d){var e=a.transaction(c).objectStore(c);e=e.count();e.onsuccess=function(a){b(a.target.result)};e.onerror=function(a){d(a)}})}function q(a,c){var d="e2ee_"+c;c=m.get(d);return c==null?(h||(h=b("Promise"))).resolve(-1):a.runInTransaction(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=new WeakMap();a=(yield a[d].keys(b,"asc",void 0));b=0;var c=(yield a.next());while(!c.done)b++,c=(yield a.next());return b});return function(b){return a.apply(this,arguments)}}(),"readonly",void 0,void 0,f.id+":153")}function r(a,d){var e=100,f=[];return new(h||(h=b("Promise")))(function(b){if(d==null){b([]);return}var g=a==null?d.openCursor():d.openCursor(IDBKeyRange.lowerBound(a,!0));g.onsuccess=function(a){a=a.target.result;a&&f.length<e?(f.push([a.key,a.value]),a["continue"]()):b(f)};g.onerror=function(a){l.ERROR(i(),a.target.error);throw c("err")("Error opening cursor: "+a.target.error)}})}function s(a,c){return new(h||(h=b("Promise")))(function(b){var d=a.transaction([c],"readwrite"),e=d.objectStore(c);e.add({}).onsuccess=function(a){b(a.target.result);try{d.abort()}catch(a){}}})}function t(a){var b=d("MAWGetDbVersion").getArmadilloDbVersion()*10;return a.version===b}function u(){return v.apply(this,arguments)}function v(){v=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("MAWReStoreDbSetup").getDB(f.id+":230"));yield a.runInTransaction(function(a){return a.e2ee_appMeta.put({key:d("MAWDbAppMeta").AppMetaKeysEnum.hasMigratedFromDexie,value:(a={},a[d("MAWDbAppMeta").AppMetaKeysEnum.hasMigratedFromDexie]=!0,a)})},"readwrite",void 0,void 0,f.id+":232")});return v.apply(this,arguments)}g.getDBForMigration=a;g.deleteDB=e;g.fetchAppMetaKey=n;g.putAppMetaKey=o;g.indexedDBCount=p;g.restoreCount=q;g.fetchIDBBatch=r;g.getNextKey=s;g.isLatestDexieVersion=t;g.selfCertify=u}),98);
__d("MAWRestoreDbBackwardMigration",["I64","MAWBridge","MAWCurrentUser","MAWDbAppMeta","MAWDbObjEncryption","MAWDbSchema.restore","MAWDexieTable","MAWIndexedDBDeletion","MAWIndexedDb","MAWIndexedDbMetadata","MAWQplProxy","MAWReStoreDbSetup","MAWReStoreMigrationUtils","MAWRestoreDbState","MAWRestoreSchemaIndexedDB","MAWTransactionMode","MWEARKeychainV3","Promise","ReQL","ReStoreMigrateUtil","WAExceededStorageQuota","WATagsLogger","asyncToGeneratorRuntime","gkx","promiseDone","qex","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to close db migration indicator: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Successfully closed db migration indicator"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Armadillo DB to ReStore migration error: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Database cleanup done."]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["Migration complete, adding meta to allow migrations from Dexie to ReStore"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["Data migration completed from v3 to v1 for ",""]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["Migrating data from v3 to v1 for ",""]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["Purged all stale data"]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["Purging stale data v1"]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["Starting backwards migration to dexie"]);s=function(){return a};return a}function t(){var a=babelHelpers.taggedTemplateLiteralLoose(["Checking if we need to migrate the database: ",""]);t=function(){return a};return a}function u(){var a=babelHelpers.taggedTemplateLiteralLoose(["Already migrated to Dexie"]);u=function(){return a};return a}function v(){var a=babelHelpers.taggedTemplateLiteralLoose(["No ReStore database to migrate"]);v=function(){return a};return a}var w=d("WATagsLogger").TAGS(["DBInit","Migration","Revert"]);function x(a){return function(b){var c;return babelHelpers["extends"]({},b,(c={},c[a]=(i||(i=d("I64"))).to_int32(b[a]),c))}}function y(){if(c("gkx")("1159")&&d("MAWRestoreDbState").getTargetDbState()==="dexie")return!0;if(c("gkx")("1159")&&d("MAWRestoreDbState").getTargetDbState()==="restore")return!1;if(c("qex")._("1210")===!0)return!1;return c("qex")._("736")===!0?!1:c("gkx")("23906")&&c("gkx")("23907")}function a(){return z.apply(this,arguments)}function z(){z=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=d("MAWCurrentUser").getID();a=d("MAWIndexedDbMetadata").restoreDbName2(a);if(!y())return!1;var e=(yield d("MAWReStoreMigrationUtils").getDBForMigration(a));if(e==null){w.LOG(v());return!0}e.close();var f=d("MAWQplProxy").startQplUserFlow(c("qpl")._(1056837640,"750"),void 0,void 0,5*60*1e3);e=d("MAWIndexedDb").makeMAWIndexedDBFactory(w);try{f.addPoint("get_restore_db_start");var g=(yield d("MAWReStoreDbSetup").getDB());f.addPoint("get_restore_db_end");var i=(yield g.tables.e2ee_appMeta.get("restoreToDexieMigrationComplete"));if((i==null?void 0:i.value.restoreToDexieMigrationComplete)===!0){w.LOG(u());d("MAWRestoreSchemaIndexedDB").closeDB();f.endSuccess({string:{reason:"already_migrated"}});return!0}w.LOG(t(),g!=null);w.LOG(s());d("MAWBridge").getBridge().fireAndForget("event","isDbMigrating",{status:!0});f.addPoint("dexie_init_start");yield e.makeDB(d("MWEARKeychainV3").getDbEncryptionKey,{enableDataSyncMiddleware:!0,enableMutationValidator:!1});f.addPoint("dexie_init_end");var z=e.getDBExn(),A=new Map(d("MAWDbSchema.restore").clientSchema.map(function(a){return[a.name,a]}));i=Object.keys(d("MAWDbSchema.restore").msgrDbStores).filter(function(a){return A.has(a)});var B=new Map(i.map(function(a){return[a,a.replace("e2ee_","")]})),C=Array.from(B.values());w.LOG(r());f.addPoint("purge_old_data_start");yield z.transact(d("MAWTransactionMode").READWRITE,C,function(){return d("MAWDexieTable").dexieAll(C.map(function(a){return z.stores[a].clear()})).then(function(){w.LOG(q())})});f.addPoint("purge_old_data_end");f.addPoint("data_migration_start");var D=[];yield (h||(h=b("Promise"))).all(i.map(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b,c=B.get(a),e=A.get(a);b=(b=e==null?void 0:e.primary_key)!=null?b:[];var h=b[0];b=(b=e==null?void 0:e.auto_increment)!=null?b:!1;if(c==null)return;var i=z.stores[c];w.LOG(p(),a);var j=!0,k=!1,l;try{var m=function*(){var a=r,b=h!=null&&(e==null?void 0:e.auto_increment)===!0?a.map(x(h)):a;yield z.transact(d("MAWTransactionMode").READWRITE,[c],function(){return i.bulkPut(b).then(function(){})});g.clearCacheIfSupported==null?void 0:g.clearCacheIfSupported()};for(var n=babelHelpers.asyncIterator(d("ReStoreMigrateUtil").fetchReQLBatch(d("ReQL").fromTableAscending(g.tables[a]),100)),q,r;q=(yield n.next()),j=q.done,r=(yield q.value),!j;j=!0)yield* m()}catch(a){k=!0,l=a}finally{try{!j&&n["return"]!=null&&(yield n["return"]())}finally{if(k)throw l}}if(b&&h!=null){var s=(yield g.tables[a].peekNextAutoIncrementId());s>0&&(yield z.transact(d("MAWTransactionMode").READWRITE,[c],function(){var a;return i.add((a={},a[h]=s,a)).then(function(){return i["delete"](s)})}))}w.LOG(o(),a);D.push(a);f.addAnnotations({string_array:{migrated_tables:D}})});return function(b){return a.apply(this,arguments)}}()));f.addPoint("data_migration_end");f.addAnnotations({"int":{num_of_tables:i.length}});w.LOG(n());var E=z.stores.appMeta,F=d("MAWDbAppMeta").AppMetaKeysEnum.hasMigratedFromDexie;yield z.transact(d("MAWTransactionMode").READWRITE,["appMeta"],function(){var a;return E.put(d("MAWDbObjEncryption").encryptDbObj({key:F,value:(a={},a[F]=!1,a)},"appMeta",d("MWEARKeychainV3").getDbEncryptionKey))});d("MAWBridge").getBridge().fireAndForget("event","isDbMigrating",{status:!1});d("MAWRestoreSchemaIndexedDB").closeDB();yield d("MAWIndexedDBDeletion").deleteDB(a,"maw_v3");yield e.closeDB();f.endSuccess();w.LOG(m());return!0}catch(b){yield e.closeDB();d("MAWRestoreSchemaIndexedDB").closeDB();w.ERROR(l(),b);d("WAExceededStorageQuota").checkQuotaExceededError(b);i=typeof b.message==="string"?b.message:"Unknown error";a=typeof b.stack==="string"?b.stack:"Unknown stack";f.endFail("migration_failed_with_error",{string:{error:i,error_stack:a}});return!1}finally{c("promiseDone")(d("MAWBridge").getBridge().sendAndReceive("event","isDbMigrating",{status:!1}).then(function(){w.LOG(k())})["catch"](function(a){w.ERROR(j(),a)}))}});return z.apply(this,arguments)}g.migrateToDexieFromRestore=a}),98);
__d("MWOneDbDualWriteHooksIgnore",[],(function(a,b,c,d,e,f){"use strict";var g=!1;function a(){g=!0;return function(){g=!1}}function b(){return g}f.ignore=a;f.isIgnored=b}),66);
__d("WADbSchema",[],(function(a,b,c,d,e,f){"use strict";a={e2ee_mediaKeys:!0,e2ee_browserEncryptionMeta:!0,e2ee_contacts:!0,e2ee_danglingQueue:!0,e2ee_identity:!0,e2ee_meta:!0,e2ee_personalSenderKeyStatuses:!0,e2ee_prekey:!0,e2ee_prekeyGeneration:!0,e2ee_receipts:!0,e2ee_senderKeySessions:!0,e2ee_sentBytesCache:!0,e2ee_session:!0,e2ee_signedPrekey:!0,e2ee_staleQueue:!0,e2ee_stanzaQueue:!0,e2ee_tasks:!0};f.signalDbStores=a}),66);
__d("MAWRestoreDbMigration",["I64","LSQueryBulkUtils","MAWBridge","MAWDbAppMeta","MAWDbObjEncryption","MAWDbSchema.restore","MAWGetDbVersion","MAWIndexedDb","MAWReStoreDbSetup","MAWReStoreMigrationUtils","MAWRestoreDbState","MWEARKeychainV3","MWOneDbDualWriteHooksIgnore","WADbSchema","WAResultOrError","WATagsLogger","err","gkx","justknobx","promiseDone","qex"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to close db migration indicator: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Successfully closed db migration indicator"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Incrementing failed migration counter: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Incrementing failure count as executeMigration returned false"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Resetting DB migration from restoreToDexie to allow backwards migration"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["Marking DB as not needing migration in the future."]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["Migration completed with status: ",""]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["Migrated database is self certifying that migration completed successfully"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["Starting DB migration"]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["Skipping due to previous failures"]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["Migration is currently disabled, skipping the attempt"]);s=function(){return a};return a}function t(){var a=babelHelpers.taggedTemplateLiteralLoose(["Already migrated db, no need to migrate"]);t=function(){return a};return a}function u(){var a=babelHelpers.taggedTemplateLiteralLoose(["Skipping due to source db not existing"]);u=function(){return a};return a}function v(){var a=babelHelpers.taggedTemplateLiteralLoose(["Dexie is not on latest version, updating to latest version: V",""]);v=function(){return a};return a}function w(){var a=babelHelpers.taggedTemplateLiteralLoose(["Checking if we need to migrate the database"]);w=function(){return a};return a}function x(){var a=babelHelpers.taggedTemplateLiteralLoose(["Completing migration"]);x=function(){return a};return a}function y(){var a=babelHelpers.taggedTemplateLiteralLoose(["Data counts match.... completing migration"]);y=function(){return a};return a}function z(){var a=babelHelpers.taggedTemplateLiteralLoose(["Data moved, checking for consistency"]);z=function(){return a};return a}function A(){var a=babelHelpers.taggedTemplateLiteralLoose(["Moving data"]);A=function(){return a};return a}function B(){var a=babelHelpers.taggedTemplateLiteralLoose(["Previous migration attempt purged"]);B=function(){return a};return a}function C(){var a=babelHelpers.taggedTemplateLiteralLoose(["Purging previous migration attempt"]);C=function(){return a};return a}var D=d("WATagsLogger").TAGS(["DBInit","Migration"]),E=c("justknobx")._("1864"),F=c("justknobx")._("1871"),G=new Map(d("MAWDbSchema.restore").clientSchema.filter(function(a){return!(a.name in d("WADbSchema").signalDbStores)}).map(function(a){return[a.name,a]})),H=function(a){return new Promise(function(b){return setTimeout(b,a)})};function I(){return d("MAWRestoreDbState").getTargetDbState()==="restore"?!0:c("qex")._("744")===!0||c("gkx")("23908")}async function J(a){a=await a.tables.e2ee_appMeta.get(d("MAWDbAppMeta").AppMetaKeysEnum.hasMigratedFromDexie);return(a==null?void 0:a.value.hasMigratedFromDexie)===!0}async function K(a,b){var c=await d("MAWReStoreMigrationUtils").getDBForMigration(a);if(c==null)return;c.close();await d("MAWReStoreDbSetup").closeDB();c=await d("MAWReStoreDbSetup").getDB(f.id+":95");c=await J(c);c||(D.LOG(C()),b==null?void 0:b.addAnnotations({bool:{purgedPreviousAttempt:!0}}),await d("MAWReStoreDbSetup").closeDB(),await d("MAWReStoreMigrationUtils").deleteDB(a),D.LOG(B()))}async function L(a,b,c){if(b==null)return;var e="e2ee_"+c,g=await d("MAWReStoreMigrationUtils").fetchIDBBatch(null,b.transaction(c).objectStore(c)),i=G.get(e)||{},j=i.auto_increment;i=i.primary_key;i=(i=i)!=null?i:[];var k=i[0];i=async function(){var i=g.map(function(a){a[0];a=a[1];a=babelHelpers.extends({},d("MAWDbObjEncryption").decryptDbObj(a,c,d("MWEARKeychainV3").getDbEncryptionKey));k!=null&&j===!0&&(a[k]=(h||(h=d("I64"))).of_int32(a[k]));return a});await a.runInTransaction(async function(a){await d("LSQueryBulkUtils").bulkPut(a[e],i)},"readwrite",void 0,void 0,f.id+":145");a.clearCacheIfSupported==null?void 0:a.clearCacheIfSupported();g=await d("MAWReStoreMigrationUtils").fetchIDBBatch(g[g.length-1][0],b.transaction(c).objectStore(c))};while(g.length)await i();if(j===!0){i=await d("MAWReStoreMigrationUtils").getNextKey(b,c);var l=(h||(h=d("I64"))).of_int32(i);await a.runInTransaction(async function(a){var b;b=(b={},b[k]=l,b);var c=d("MWOneDbDualWriteHooksIgnore").ignore();await a[e].add(b);await a[e].delete(l);c()},"readwrite",void 0,void 0,f.id+":162")}}async function M(a,b,e){var f=Array.from(a.objectStoreNames).filter(function(a){return G.has("e2ee_"+a)});D.LOG(A());e==null?void 0:e.addPoint("table-migration-start");await f.reduce(function(c,d){return c.then(function(){return L(b,a,d)})},Promise.resolve());e==null?void 0:e.addPoint("table-migration-end");D.LOG(z());e==null?void 0:e.addPoint("data-verification-start");f=await f.reduce(function(c,e){return c.then(async function(c){var f=await Promise.all([d("MAWReStoreMigrationUtils").indexedDBCount(a,e),d("MAWReStoreMigrationUtils").restoreCount(b,e)]),g=f[0];f=f[1];b.clearCacheIfSupported==null?void 0:b.clearCacheIfSupported();return[].concat(c,[[e,g===f]])})},Promise.resolve([]));if(!f.every(function(a){a=a[1];return a})){f=f.filter(function(a){a=a[1];return!a}).map(function(a){a=a[0];return a});throw c("err")("count mismatch: "+f.join(",")+" ")}D.LOG(y());e==null?void 0:e.addPoint("data-verification-end");D.LOG(x());return!0}async function N(){var a;a=await ((a=navigator.storage)==null?void 0:a.estimate==null?void 0:a.estimate());return(a=a==null?void 0:a.usage)!=null?a:0}async function a(a,b,c){D.LOG(w());c==null?void 0:c.addPoint("open-source-db-start");var e=await d("MAWReStoreMigrationUtils").getDBForMigration(a);c==null?void 0:c.addPoint("open-source-db-end");c==null?void 0:c.addAnnotations({bool:{shouldRunMigration:e!=null},int:{storageSize:await N()}});if(e!=null&&d("MAWReStoreMigrationUtils").isLatestDexieVersion(e)!==!0){D.LOG(v(),d("MAWGetDbVersion").getArmadilloDbVersion());e.close();var f=d("MAWIndexedDb").makeMAWIndexedDBFactory(D,"shim_idb");await f.makeDB(d("MWEARKeychainV3").getDbEncryptionKey,{enableDataSyncMiddleware:!1,enableMutationValidator:!1});await f.closeDB();e=await d("MAWReStoreMigrationUtils").getDBForMigration(a)}if(e==null){D.LOG(u());c==null?void 0:c.addAnnotations({string:{migrationSkipReason:"new-indexeddb"}});await d("MAWReStoreMigrationUtils").selfCertify();return d("WAResultOrError").makeResult()}f=await Promise.all([d("MAWReStoreMigrationUtils").fetchAppMetaKey(e,d("MAWDbAppMeta").AppMetaKeysEnum.restoreMigrationAttempts),d("MAWReStoreMigrationUtils").fetchAppMetaKey(e,d("MAWDbAppMeta").AppMetaKeysEnum.hasMigratedFromDexie)]);a=f[0];f=f[1];a=(a=a==null?void 0:(a=a.value)==null?void 0:a.restoreMigrationAttempts)!=null?a:0;f=(f=f==null?void 0:(f=f.value)==null?void 0:f.hasMigratedFromDexie)!=null?f:!1;if(f===!0){D.LOG(t());c==null?void 0:c.addAnnotations({string:{migrationSkipReason:"previously-migrated"}});e.close();return d("WAResultOrError").makeResult()}if(!I()){D.LOG(s());c==null?void 0:c.addAnnotations({string:{migrationSkipReason:"migration-disabled"}});e.close();return d("WAResultOrError").makeError()}if(a>F){c==null?void 0:c.addAnnotations({string:{migrationSkipReason:"exceeded-max-attempts"}});D.LOG(r());e.close();return d("WAResultOrError").makeError()}c==null?void 0:c.addPoint("checking-target-db-start");await K(b,c);c==null?void 0:c.addPoint("checking-target-db-end");return O(e,c,a)}async function O(a,b,e){try{D.LOG(q());var g=await d("MAWReStoreDbSetup").getDB(f.id+":346");if(await J(g)){D.LOG(p());b==null?void 0:b.addAnnotations({string:{migrationSkipReason:"previously-migrated-v3-indicates"}});a.close();return d("WAResultOrError").makeResult()}d("MAWBridge").getBridge().fireAndForget("event","isDbMigrating",{status:!0});var h=await Promise.race([H(E).then(function(){throw c("err")("timeout")}),M(a,g,b)]).then(function(a){return typeof a==="boolean"?a:!1});D.LOG(o(),h);h?(b==null?void 0:b.addPoint("mark-migration-complete-start"),D.LOG(n()),await d("MAWReStoreMigrationUtils").putAppMetaKey(a,d("MAWDbAppMeta").AppMetaKeysEnum.hasMigratedFromDexie,!0),D.LOG(m()),await g.runInTransaction(function(a){return a.e2ee_appMeta.put({key:d("MAWDbAppMeta").AppMetaKeysEnum.restoreToDexieMigrationComplete,value:(a={},a[d("MAWDbAppMeta").AppMetaKeysEnum.restoreToDexieMigrationComplete]=!1,a)})},"readwrite",void 0,void 0,f.id+":377"),await g.runInTransaction(function(a){return a.e2ee_appMeta.put({key:d("MAWDbAppMeta").AppMetaKeysEnum.hasMigratedFromDexie,value:(a={},a[d("MAWDbAppMeta").AppMetaKeysEnum.hasMigratedFromDexie]=!0,a)})},"readwrite",void 0,void 0,f.id+":387"),b==null?void 0:b.addPoint("mark-migration-complete-end")):(b==null?void 0:b.addPoint("incrementing-failure-counter-start"),D.LOG(l()),await d("MAWReStoreMigrationUtils").putAppMetaKey(a,d("MAWDbAppMeta").AppMetaKeysEnum.restoreMigrationAttempts,e+1),b==null?void 0:b.addPoint("incrementing-failure-counter-end"));a.close();return h?d("WAResultOrError").makeResult():d("WAResultOrError").makeError()}catch(b){a!=null&&(D.LOG(k(),b),await d("MAWReStoreMigrationUtils").putAppMetaKey(a,d("MAWDbAppMeta").AppMetaKeysEnum.restoreMigrationAttempts,e+1),a.close());throw b}finally{c("promiseDone")(d("MAWBridge").getBridge().sendAndReceive("event","isDbMigrating",{status:!1}).then(function(){D.LOG(j())}).catch(function(a){D.ERROR(i(),a)}))}}g.migrateToRestoreFromDexie=a}),98);
__d("MAWDbInitShimIndexedDb",["MAWCurrentUser","MAWGetReStoreDBError","MAWIndexedDbMetadata","MAWQplProxy","MAWReStoreDbSetup","MAWRestoreDbBackwardMigration","MAWRestoreDbMigration","MAWRestoreDbState","MAWShimIndexedDb","MWLSIndexedDBName","ReStoreIDBFactory","WAResultOrError","WATagsLogger","asyncToGeneratorRuntime","gkx","qex","qpl"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Running shimmed db init"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to migrate to shim: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Error with ReStore db setup"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Shim IndexedDB initializing"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Shim IndexedDB is not enabled, early return initialisation"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to migrate back to dexie from restore: ",""]);m=function(){return a};return a}var n=d("WATagsLogger").TAGS(["DBInit","ShimIndexedDb"]);function a(){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("MAWRestoreDbBackwardMigration").migrateToDexieFromRestore()["catch"](function(a){n.ERROR(m(),a);return!1}));if(a){d("MAWRestoreDbState").setIsUsingShim(!1);return}if(d("MAWRestoreDbState").getTargetDbState()!=="restore"&&c("gkx")("23906")!==!0&&c("qex")._("1210")!==!0&&c("qex")._("736")!==!0){n.LOG(l());d("MAWRestoreDbState").setIsUsingShim(!1);return}n.LOG(k());a=d("MAWCurrentUser").getID();var b=d("MAWIndexedDbMetadata").dbName(a);a=c("qex")._("1210")?d("MWLSIndexedDBName").dbName():d("MAWIndexedDbMetadata").restoreDbName2(a);var e=d("MAWQplProxy").startQplUserFlow(c("qpl")._(1056845565,"194"),{string:{version:"shim_indexed_db"}});e.addPoint("migrate-db");b=(yield d("MAWRestoreDbMigration").migrateToRestoreFromDexie(b,a,e).then(function(a){a?e.endSuccess():e.endFail("migrate-db-fail");return a})["catch"](function(a){e.addAnnotations({string:{failureReason:a}});e.endFail("migrate-db-fail");if(a instanceof c("MAWGetReStoreDBError")){n.ERROR(j());throw a}n.ERROR(i(),a);return d("WAResultOrError").makeError()}));d("MAWRestoreDbState").setIsUsingShim(b.success);if(!b.success)return;a=new(d("ReStoreIDBFactory").ReStoreIDBFactory)(yield d("MAWReStoreDbSetup").getDB());n.LOG(h());return d("MAWShimIndexedDb").makeShimDB({IDBKeyRange:d("ReStoreIDBFactory").ReStoreIDBKeyRange,enableDataSyncMiddleware:!0,enableMutationValidator:c("gkx")("1627"),indexedDB:a})});return o.apply(this,arguments)}g.dbInit=a}),98);
__d("MAWDeviceRegistrationActions",["MAWCurrentUser","MAWDexieTable","MAWLoggerUtils","MessengerWebInitData","WACompareIdentity","WADbSignal","WALoggerTag","WATagsLogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": signedPrekey}"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Device Registration Meta Check] Device Id should be a number"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["MAWDeviceRegistrationActions: sessionId is null"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": ",""]);o=function(){return a};return a}var p="Device registration meta is incomplete: ",q=d("WATagsLogger").TAGS([d("MAWLoggerUtils").Tag.DeviceRegistration]);function r(a,b,e,f,g){(a!=null||b!=null||e!=null||f!=null||g!=null)&&(a==null&&q.TAGS([c("WALoggerTag").SignedPrekey]).ERROR(o(),p,d("WADbSignal").MetaKeysEnum.lastSignedPrekeyId),b==null&&q.ERROR(n(),p,d("WADbSignal").MetaKeysEnum.deviceUUID),e==null&&q.ERROR(m(),p,d("WADbSignal").MetaKeysEnum.regId),f==null&&q.ERROR(l(),p,d("WADbSignal").MetaKeysEnum.identityKeyPair),g==null&&q.ERROR(k(),p,d("WADbSignal").MetaKeysEnum.fbid))}function a(a){var b;return d("MAWDexieTable").dexieAll([a.meta.bulkGet([(b=d("WADbSignal")).MetaKeysEnum.lastSignedPrekeyId,b.MetaKeysEnum.deviceUUID,b.MetaKeysEnum.lastSessionDeviceWasLinkedTo,b.MetaKeysEnum.regId,b.MetaKeysEnum.identityKeyPair,b.MetaKeysEnum.fbid,b.MetaKeysEnum.deviceId,b.MetaKeysEnum.registrationVersion]),d("WACompareIdentity").compareIdentityDexie(a)]).then(function(b){var d=b[0],e=d[0],f=d[1],g=d[2],k=d[3],l=d[4],m=d[5],n=d[6];d=d[7];var o=b[1],s=e==null?void 0:(b=e.value)==null?void 0:b.lastSignedPrekeyId,t=f==null?void 0:(e=f.value)==null?void 0:e.deviceUUID,u=g==null?void 0:(b=g.value)==null?void 0:b.lastSessionDeviceWasLinkedTo,v=k==null?void 0:(f=k.value)==null?void 0:f.regId,w=l==null?void 0:(e=l.value)==null?void 0:e.identityKeyPair;b=m==null?void 0:(g=m.value)==null?void 0:g.fbid;var x=n==null?void 0:(k=n.value)==null?void 0:k.deviceId,y=d==null?void 0:d.value.registrationVersion;if(s==null||t==null||v==null||w==null||b==null){r(s,t,v,w,b);return null}c("MessengerWebInitData").sessionId==null&&q.ERROR(j());if(x!=null&&typeof x!=="number"){q.ERROR(i());return null}return a.signedPrekey.get(s).then(function(a){if(a==null){q.TAGS([c("WALoggerTag").SignedPrekey]).ERROR(h(),p);return null}return{deviceId:x,deviceUUID:t,identityCompareResult:o,lastSessionDeviceWasLinkedTo:u,lastSignedPrekeyId:s,registrationVersion:y,signalRegInfo:{identityKeyPair:w,regId:v,signedPreKey:a}}})})}function b(a,b){var c;return d("MAWDexieTable").dexieAll([a.meta.bulkPut([{key:(c=d("WADbSignal")).MetaKeysEnum.deviceUUID,value:{deviceUUID:b.deviceUUID}},{key:c.MetaKeysEnum.fbid,value:{fbid:d("MAWCurrentUser").getID()}},{key:c.MetaKeysEnum.regId,value:{regId:b.signalRegInfo.regId}},{key:c.MetaKeysEnum.identityKeyPair,value:{identityKeyPair:b.signalRegInfo.identityKeyPair}},{key:c.MetaKeysEnum.lastSignedPrekeyId,value:{lastSignedPrekeyId:b.signalRegInfo.signedPreKey.keyId}},{key:c.MetaKeysEnum.registrationVersion,value:{registrationVersion:b.registrationVersion}},{key:c.MetaKeysEnum.authKeyPair,value:{authKeyPair:b.signalRegInfo.authKeyPair}}]),a.signedPrekey.put(b.signalRegInfo.signedPreKey)])}function e(a,b){return a.meta.put({key:d("WADbSignal").MetaKeysEnum.deviceId,value:{deviceId:b}})}function f(a,b,c){return a.contacts.get(b).then(function(d){if(d!=null)return a.contacts.put(babelHelpers["extends"]({},d,{icdcInfo:c}));else return a.contacts.put({contactJid:b,dhash:null,icdcInfo:c})}).then(function(){})}g.getRegistrationMetaDexie=a;g.saveUnsentRegistrationMeta=b;g.saveDeviceId=e;g.saveICDC=f}),98);
__d("WAPreRegistrationCrypto",["WACryptoManager","WAErr","WASignalSignatures","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function a(){var a,c,e,f,g,h,i,j;return b("regeneratorRuntime").async(function(k){while(1)switch(k.prev=k.next){case 0:k.next=2;return b("regeneratorRuntime").awrap(d("WACryptoManager").generateRegistrationInfo());case 2:a=k.sent;c=a.regId;e=a.staticKeyPair;f=a.authKeyPair;g=Date.now();k.next=9;return b("regeneratorRuntime").awrap(d("WASignalSignatures").generateSignedPreKey(1,g,e));case 9:h=k.sent;i=h.plainObject;j=h.record;return k.abrupt("return",{regId:c,identityKeyPair:e,authKeyPair:f,signedPreKey:{keyId:i.id,encoded:j}});case 13:case"end":return k.stop()}},null,this)}function e(a){var b=d("WASignalSignatures").deserializeSignedPreKey(a.signedPreKey.encoded);if(b==null||b.id!==a.signedPreKey.keyId)throw c("WAErr")("Badly formatted signed prekey");return{regId:a.regId,identityPubKeyType:5,identityPubKey:a.identityKeyPair.publicKey,signedPreKey:b}}g.makeRegistrationData=a;g.serializeRegistrationData=e}),98);
__d("MAWDeviceRegistrationUtilWorker",["FBLogger","MAWConstants","MAWCurrentUser","URI","WABase64","WADbDeviceRegistration","WAPreRegistrationCrypto","WAWorkerGlobalScope","asyncToGeneratorRuntime","err","gkx","uuidv4"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a,b){var c=new Uint8Array(b);a=a;for(b=b-1|0;b>=0;--b)c[b]=a&255,a=a>>>8;return c}function j(a,b,c,e,f,g,h,j,k){var l;f=(l=d("WABase64")).encodeB64(i(f,4));g=l.encodeB64(i(g,1));h=l.encodeB64(h);var m=l.encodeB64(i(j.id,3)),n=l.encodeB64(j.keyPair.publicKey);l=l.encodeB64(j.signature);j=new Map().set("fbid",a).set("fb_cat",b).set("app_id",c).set("device_id",e).set("e_regid",f).set("e_keytype",g).set("e_ident",h).set("e_skey_id",m).set("e_skey_val",n).set("e_skey_sig",l);if(k){a=d("WABase64").encodeB64(k.signedICDCIdentityList);b=d("WABase64").encodeB64(k.ihash);j.set("icdc_list",a).set("icdc_ts",k.ts).set("icdc_seq",k.seq).set("ihash",b)}return j}function k(a){var b=[];a.forEach(function(a,c,d){b.push(encodeURIComponent(c)+("="+encodeURIComponent(a.toString())))});return b.join("&")}function l(a,b){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){b=(yield d("WAWorkerGlobalScope").workerGlobalScope.fetch(b,{body:a,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},method:"POST"}));return yield b.json()});return m.apply(this,arguments)}function n(a,b){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){b=(yield d("WAWorkerGlobalScope").workerGlobalScope.fetch(b,{body:a,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},method:"POST"}));return b.json()});return o.apply(this,arguments)}function p(){var a=new(h||(h=c("URI")))(s()+d("WADbDeviceRegistration").ICDC_ENDPOINT);return a.toString()}function q(a){return r.apply(this,arguments)}function r(){r=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=p();a=(yield l(a,b));if(a==null)throw c("err")(d("WADbDeviceRegistration").NULL_RESPONSE_FROM_SERVER);if(a.status!==200)throw c("err")("WA Server returned status code "+a.status+" while attempting device registration");return a});return r.apply(this,arguments)}function s(){var a=Number(d("MAWCurrentUser").getAppID()),b=d("WADbDeviceRegistration").REG_FB_DOMAIN;switch(a){case 1217981644879628:case 936619743392459:case 487152425211411:case 1035956773910536:b=d("WADbDeviceRegistration").REG_IGD_DOMAIN;break;case 772021112871879:b=d("WADbDeviceRegistration").REG_MSGR_DOMAIN;break;default:b=d("WADbDeviceRegistration").REG_FB_DOMAIN}return b}function t(){var a=new(h||(h=c("URI")))(s()+d("WADbDeviceRegistration").REGISTRATION_ENDPOINT);return a.toString()}var u=new Set(["www.facebook.com","intern.facebook.com","web.facebook.com","www.instagram.com","www.messenger.com"]);function v(){if(c("gkx")("2456")){var a=d("WAWorkerGlobalScope").workerGlobalScope.location.hostname;u.has(a)||c("FBLogger")("bt","device_registration").warn("Invalid subdomain for device registration: %s",a)}}function w(a){return x.apply(this,arguments)}function x(){x=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=t();v();var e;try{e=(yield n(a,b))}catch(a){throw c("err")("Post request failed: "+(a==null?void 0:a.message)+" url:"+b)}if(e==null)throw c("err")(d("WADbDeviceRegistration").NULL_RESPONSE_FROM_SERVER);if(e.status!==200){c("FBLogger")("messenger_e2ee_web").warn("WA Server returned status code %s %s while attempting device registration",e.status,(a=e.message)!=null?a:"");return{message:(b=e.message)!=null?b:"Empty message",status:e.status,success:!1}}if(typeof e.wa_device_id!=="number")throw c("err")("Device ID from WA Server was not a number");if(typeof e.product!=="string")throw c("err")("Product info from WA Server was not a string");return{edge_routing_info:e.edge_routing_info,icdc_success:e.icdc_success,product:e.product,status:200,success:!0,type:e.type,wa_device_id:e.wa_device_id}});return x.apply(this,arguments)}function a(a,b,c,d){a=new Map().set("fbid",a).set("fb_cat",b).set("app_id",c).set("device_id",d);b=k(a);return q(b)}function e(a,b,c,d,e,f,g,h,i){a=j(a,b,c,d,e,f,g,h,i);b=k(a);return w(b)}function f(){return y.apply(this,arguments)}function y(){y=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("WAPreRegistrationCrypto").makeRegistrationData());return{deviceUUID:c("uuidv4")(),lastSignedPrekeyId:a.signedPreKey.keyId,registrationVersion:d("MAWConstants").CURRENT_REGISTRATION_VERSION,signalRegInfo:a}});return y.apply(this,arguments)}g.getRegistrationEndpoint=t;g.fetchICDC=a;g.register=e;g.createNewRegistrationMeta=f}),98);
__d("WorkerBanzaiLazyQueueChannelWorker",["BanzaiLazyQueue","WorkerFuncChannel"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=d("WorkerFuncChannel").importChannel({queuePost:null},a,"banzai_lazyqueue_channel");c("BanzaiLazyQueue").onQueue.add(function(){h(b)});h(b)}function h(a){c("BanzaiLazyQueue").flushQueue().forEach(function(b){a.queuePost.apply(a,b)})}g.init=a}),98);
__d("WorkerSelf",["WorkerBanzaiLazyQueueChannelWorker","WorkerFuncChannel","WorkerQPLChannel"],(function(a,b,c,d,e,f,g){"use strict";function a(a){d("WorkerFuncChannel").activateChannels(a,"worker","client"),d("WorkerBanzaiLazyQueueChannelWorker").init(a),d("WorkerQPLChannel").setMessagePort(a)}g.init=a}),98);
__d("getBroadcastChannelForExecutionContext",["CometTaskFrameworkTypes","MWBroadcastChannel"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return d("MWBroadcastChannel").MWBroadcastChannel(d("CometTaskFrameworkTypes").TASK_FRAMEWORK_PREFIX+"_"+String(a))}g["default"]=a}),98);
__d("loadTaskHandlerResource",["asyncToGeneratorRuntime","cr:3760"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=b("cr:3760").TASK_HANDLERS_RESOURCES[a];return a==null?null:a.getModuleIfRequired()||a.load()});return h.apply(this,arguments)}g["default"]=a}),98);
__d("registerExecutionContext",["BroadcastChannelClientServerHandshake","FBLogger","asyncToGeneratorRuntime","getBroadcastChannelForExecutionContext","loadTaskHandlerResource","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var d=a.context,e=a.name,f=a.payload;try{var g=(yield c("loadTaskHandlerResource")(e));if(g==null)throw c("FBLogger")("maw_worker").mustfixThrow("No task handler found in context %s",e);e=(yield g.handleTask(f,d));g={context:d,result:e,type:"task_success"};b.postMessage(g)}catch(g){c("FBLogger")("maw_worker").catching(g).mustfix("%s executionContext: Failed to execute task %s",String(a.context.executionContext),a.name);e={context:d,reason:(f=g.message)!=null?f:"",type:"task_failure"};b.postMessage(e)}return});return i.apply(this,arguments)}function a(a){var b=c("getBroadcastChannelForExecutionContext")(a);d("BroadcastChannelClientServerHandshake").listen(b);var e=new Set();b.addEventListener("message",function(a){switch(a.data.type){case"execute_task":a=a.data;var d=a.context.taskID;if(e.has(d))return;e.add(d);c("promiseDone")(h(a,b)["finally"](function(){e["delete"](d)}));break;default:}});return function(){return b.close()}}g["default"]=a}),98);
__d("IGDAWMainWebWorker",["CurrentWorkerMessagePort","FalcoLoggerTransports","IGDAWMainWebWorkerConfig","IGDBackend","IGDLowLevelApiImpl","MAWCommonMainWebWorker"],(function(a,b,c,d,e,f,g){"use strict";function a(){self.Env=self.Env||{};var a=new(d("MAWCommonMainWebWorker").BridgeAdaptor)(d("CurrentWorkerMessagePort").getMessagePort(),"IGDAWMainWebWorker");d("MAWCommonMainWebWorker").initWorker(a,d("IGDLowLevelApiImpl").makeLowLevelApi,d("IGDAWMainWebWorkerConfig").waConfig,d("IGDBackend").startIGDBackend);d("FalcoLoggerTransports").attach()}g["default"]=a}),98);
__d("MAWIncomingReceiptUtils",["WALogger","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["User "," is in affectedUserJids in receipt-writing results, but they have no corresponding read/delivery receipt entry in the DB"]);h=function(){return a};return a}function a(a){var b=new Map();a.forEach(function(a){if(a.msgRenderType==="unrendered")return;a.affectedUserJids.forEach(function(c){var e=a.receipt.statusTsPerUser.get(c);if(e==null){d("WALogger").WARN(h(),c);return}c=[a.threadJid,c];var f=b.get(JSON.stringify(c)),g=e.deliveredTs!=null,i=e.readTs!=null;g=g?a.msgTs:0;i=i?a.msgTs:0;e=(e=e.readTs)!=null?e:0;if(f!=null){var j=f.lastDeliveredMsgTs,k=f.lastReadMsgTs;f=f.lastReadActionTs;g=Math.max(g,j);i=Math.max(i,k);e=Math.max(e,f)}b.set(JSON.stringify(c),{lastDeliveredMsgTs:d("WATimeUtils").castToUnixTime(g),lastReadActionTs:d("WATimeUtils").castToUnixTime(e),lastReadMsgTs:d("WATimeUtils").castToUnixTime(i)})})});return new Map(Array.from(b).map(function(a){var b=a[0];a=a[1];return[JSON.parse(b),a]}))}g.getMaxTimestampsPerParticipant=a}),98);
__d("MAWAckAndTimestampUpdatesForReceiptsTxns",["MAWDbMsgTxns","MAWDbParticipantTxns","MAWDbUnrenderedMsgTxns","MAWDexieTable","MAWIncomingReceiptUtils","MAWLoggerUtils","WATagsLogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Updating timestamps for "," participants"]);h=function(){return a};return a}var i=d("WATagsLogger").TAGS([d("MAWLoggerUtils").Tag.Ephemeral,d("MAWLoggerUtils").Tag.Countdown,d("MAWLoggerUtils").Tag.Incoming]);function a(a,b,c){b=d("MAWIncomingReceiptUtils").getMaxTimestampsPerParticipant(b);i.LOG(h(),b.size);var e=[];b.forEach(function(a,b){e.push({deliveredWatermarkTs:a.lastDeliveredMsgTs,lastReadActionTs:a.lastReadActionTs,lastReadWatermarkTs:a.lastReadMsgTs,participantKey:b})});b=c.regular.length>0?d("MAWDbMsgTxns").bulkUpdateSystemAck(a,c.regular):d("MAWDexieTable").dexieResolve();c=c.unrendered.length>0?d("MAWDbUnrenderedMsgTxns").bulkUpdateSystemAckForUnrenderedMsgs(a,c.unrendered):d("MAWDexieTable").dexieResolve();b=d("MAWDexieTable").dexieAll([b,c]);return d("MAWDexieTable").dexieAll([b,e.length>0?d("MAWDbParticipantTxns").bulkUpdateParticipantTimestamps(a,e):d("MAWDexieTable").dexieResolve()]).then(function(){})}g.handleAckAndTimestampUpdatesForReceipts=a}),98);
__d("MAWAddGroupParticipantsApi",["MAWAdminMsgHelpers","MAWRunInTransaction","WAResultOrError","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";a=function(){for(var a=arguments.length,b=new Array(a),c=0;c<a;c++)b[c]=arguments[c];return d("MAWRunInTransaction").runInTransaction({GroupInfoStore:!0,MessagesStore:!0,ParticipantsStore:!0},function(a){return h.apply(void 0,[a].concat(b))},"addGroupParticipants")};var h=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e,f,g,h){h=a.GroupInfoStore;var i=a.MessagesStore;a=a.ParticipantsStore;var j=(yield h.get(c));if(!j.success)return d("WAResultOrError").makeError("missing_group");j=j.value;if(b!=null&&b.previous!=null&&j.participantVersion!==b.previous)return d("WAResultOrError").makeError("mismatch");j=f.map(function(a){return{addressable:a.addressable,chatJid:c,type:a.type,user:a.user}});yield a.bulkPut(j);if(b!=null){f=d("MAWAdminMsgHelpers").createParticipantAddAdminMessage(c,j.map(function(a){return a.user}),e);yield i.create(f);yield h.update(c,function(a){return babelHelpers["extends"]({},a,{participantVersion:b.current})},{updateParticipantMedatadata:g})}return d("WAResultOrError").makeResult()});return function(b,c,d,e,f,g,h){return a.apply(this,arguments)}}();g.addGroupParticipants=a;g.addGroupParticipantsTransactor=h}),98);
__d("MAWAdminWriteUsersConnectedMsgTxn",["MAWDbMsgTxns","MAWDbThreadTxns","MAWDexieTable","MAWIndexedDb","MAWLocalizationType","MAWLocalizationUtils","MAWWriteMsgTxns","MessengerMSplitFlag","WAGlobals","WAJids","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["writeUsersConnectedAdminMsg found a thread without messages from both users, which we'll not append to."]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["writeUsersConnectedAdminMsg failed to create or get 1:1 thread"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["writeUsersConnectedAdminMsg is called for self thread"]);j=function(){return a};return a}function a(a,b,e,f){var g=d("WAGlobals").getMyUserJid();if(b===g){d("WALogger").WARN(j());return d("MAWDexieTable").dexieResolve()}return d("MAWDbThreadTxns").getThread(a,b).then(function(b){if(!b.success){d("WALogger").WARN(i());return}var j=b.value;return d("MAWDbMsgTxns").getNonAdminMsgs(a,j.jid).then(function(b){var i=b.find(function(a){return a.author===g||a.author===d("WAJids").AUTHOR_ME})!=null;b=b.find(function(a){return a.author!==g&&a.author!==d("WAJids").AUTHOR_ME})!=null;if(!i||!b){d("WALogger").WARN(h());return}i=d("MAWLocalizationUtils").buildUnstoredDbAdminMsg({adminMsgContent:[],adminType:c("MessengerMSplitFlag").is_msplit_account||e?d("MAWLocalizationType").LOCALIZATION_TYPE.TWO_USERS_CONNECTED_ONE_MSPLIT:d("MAWLocalizationType").LOCALIZATION_TYPE.TWO_USERS_CONNECTED,version:1},j.jid,f);return d("MAWWriteMsgTxns").writeMsg(a,i,j).then(function(){var a=d("WAJids").interpretAsUserJid(j.jid);if(a==null)return;d("MAWIndexedDb").afterTransaction({tag:"UpdateContactAsConnected",value:{contactUserId:d("WAJids").extractUserId(a),threadJid:j.jid}})})})})}g.writeUsersConnectedAdminMsg=a}),98);
__d("MAWBulkGetAppDataForRetryApi",["MAWIndexedDb","MAWTransactionMode","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";var h=30*d("WATimeUtils").DAY_SECONDS;a=d("MAWIndexedDb").makeMsgrTransactor({appData:d("MAWTransactionMode").READONLY},"bulkGetAppDataForRetry",function(a){return function(b){var c=b.map(function(a){a=a.externalId;return a});return a.appData.where("externalId").anyOf(c).toArray().then(function(a){var c=new Map(a.map(function(a){return[a.externalId,a]}));return b.map(function(a){var b=a.deviceJid;a=a.externalId;a=c.get(a);if(a==null)return{type:"missing"};b=a.permittedIdentitiesPerDevice.get(b);return b==null||!d("WATimeUtils").happenedWithin(a.ts,h)?{type:"unauthorized"}:{appData:a.contents,deviceIdentity:b,permittedIdentitiesPerDevice:a.permittedIdentitiesPerDevice,type:"unacked"}})})}});g.bulkGetAppDataForRetry=a}),98);
__d("MAWIncomingReceiptDataFormatTxns",["MAWDbMsgTxns","MAWDbUnrenderedMsgTxns","MAWDexieTable","MAWMsgType","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to map the threadId of a message to its threadJid during receipt-writing"]);h=function(){return a};return a}function i(a){var b=a.author,c=a.chat;a=a.externalId;return c+"_"+a+"_"+b}function a(a,b){if(b.length===0)return d("MAWDexieTable").dexieResolve();var c=new Map(),e=new Set();b.forEach(function(a){a=a.msgs;a.forEach(function(a){return e.add(babelHelpers["extends"]({},a))})});a=d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").getMsgsByProtocolMsgId(a,Array.from(e)),d("MAWDbUnrenderedMsgTxns").getUnrenderedMsgsByProtocolMsgId(a,Array.from(e))]).then(function(a){var b=a[0];a=a[1];var c=[];b.forEach(function(a){return c.push({msg:a,renderType:"regular"})});a.forEach(function(a){return c.push({msg:a,renderType:"unrendered"})});return{msgs:c}});return a.then(function(a){a=a.msgs;b.forEach(function(a){var b=a.msgs,d=a.receivers,e=a.type;b.forEach(function(a){var b=i(a),f=c.get(b)||{deliveryReceipts:[],protocolMsgId:a,readReceipts:[],senderReceipts:[]};d.forEach(function(a){if(e==="read"||e==="read-self"){f.readReceipts.push(a);return}else if(e==="delivered"){f.deliveryReceipts.push(a);return}else if(e==="sender"){f.senderReceipts.push(a);return}else if(e==="inactive"){f.deliveryReceipts.push(a);return}e});c.set(b,f)})});var e=new Map(),f=new Map(),g=[];a.forEach(function(a){var b=a.msg,g=b.author,j=b.externalId,k=b.msgId,l=b.threadJid;b=b.type;if(l==null){d("WALogger").ERROR(h());return}if(b!==d("MAWMsgType").MSG_TYPE.CIPHERTEXT){b=i({author:g,chat:l,externalId:j});g=c.get(b);if(g!=null){g.protocolMsgId;l=babelHelpers.objectWithoutPropertiesLoose(g,["protocolMsgId"]);j=babelHelpers["extends"]({msgId:k},l);f.set(k,j);c["delete"](b)}}e.set(k,a)});c.forEach(function(a){var b=a.deliveryReceipts,c=a.protocolMsgId;a=a.readReceipts;if(b.length===0&&a.length===0)return;var d=c.author,e=c.chat;c=c.externalId;g.push({author:d,deliveryReceipts:b,externalId:c,readReceipts:a,thread:e})});return{msgIdToDbMsgMap:e,pendingReceiptsToWrite:g,receiptsToWriteMap:f}})}g.prepareDataForReceiptsToWrite=a}),98);
__d("MAWIncomingReceiptDataFormatUtils",["MAWAckLevel","MAWDbMsg"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){var c=[],e=[];a.forEach(function(a){var f=null,g=a.receipt.msgId,h=a.receipt.statusTsPerUser,i=b.get(g);if(i==null)return;var j=i.msg;i=i.renderType;a.affectedUserJids.forEach(function(a){var b,c=null;((b=h.get(a))==null?void 0:b.readTs)!=null?c=d("MAWAckLevel").ACK.read:((b=h.get(a))==null?void 0:b.deliveredTs)!=null&&(c=d("MAWAckLevel").ACK.received);f=f==null||c!=null&&c>f?c:f});f!=null&&f>j.ack&&(i==="regular"?c.push({ack:f,msgId:g,reportingMeta:null}):(i,e.push({ack:f,msgId:g})))});return{regular:c,unrendered:e}}function b(a,b,c){return a.map(function(a){var e=b.get(a.receipt.msgId);if(e==null)return null;var f=e.msg,g=c.get(f.msgId);return g==null||g.deliveryReceipts.length===0&&g.readReceipts.length===0?null:babelHelpers["extends"]({},a,{externalId:f.externalId,msgRenderType:e.renderType,msgTs:d("MAWDbMsg").getCanonicalTsFromMsg(f),threadJid:f.threadJid})}).filter(Boolean)}g.createUpdateSystemAckParams=a;g.formatWriteReceiptResultsWithExtras=b}),98);
__d("MAWReceiptTrace",["ArmadilloDataTraceType","MAWBridgeTrace","MAWBridgeTraceEvent","MAWIndexedDb"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){if(a==="delivered"){a=b.reduce(function(a,b){return b.externalId!=null?[].concat(a,[b.externalId]):a},[]);a.length>0&&d("MAWIndexedDb").afterTransaction({tag:"UpdateTrace",value:d("MAWBridgeTrace").createBridgeUpdateTraceData(a,c("MAWBridgeTraceEvent").ReceivedReceipt,d("ArmadilloDataTraceType").armadilloMessageSend)})}}g.flushTrace=a}),98);
__d("MAWIncomingReceiptTxns",["MAWAckAndTimestampUpdatesForReceiptsTxns","MAWDbPendingReceiptTxns","MAWDbReceiptTxns","MAWDexieTable","MAWIncomingReceiptDataFormatUtils","MAWReceiptTrace"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){if(b==null)return d("MAWDexieTable").dexieResolve();var c=b.msgIdToDbMsgMap,e=b.pendingReceiptsToWrite,f=b.receiptsToWriteMap;b=Array.from(f.values());return d("MAWDexieTable").dexieAll([d("MAWDbReceiptTxns").bulkWriteReceiptsForDevices(b),d("MAWDbPendingReceiptTxns").bulkAddPendingReceipts(a,e)]).then(function(b){b=b[0];var e=d("MAWIncomingReceiptDataFormatUtils").createUpdateSystemAckParams(b,c);b=d("MAWIncomingReceiptDataFormatUtils").formatWriteReceiptResultsWithExtras(b,c,f);var g=b.filter(function(a){a=((a=f.get(a.receipt.msgId))==null?void 0:a.deliveryReceipts)||[];return a.length>0});g.length>0&&d("MAWReceiptTrace").flushTrace("delivered",g);return d("MAWAckAndTimestampUpdatesForReceiptsTxns").handleAckAndTimestampUpdatesForReceipts(a,b,e)})}g.bulkHandleIncomingReceipts=a}),98);
__d("MAWWriteAppDataReceiptsApi",["MAWDexieTable","MAWIndexedDb","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({appData:d("MAWTransactionMode").READWRITE},"writeAppDataReceipts",function(a){return function(b){return h(a,b).then(function(b){return i(a,b)})}});function h(a,b){if(b.length===0)return d("MAWDexieTable").dexieResolve();b=b.reduce(function(a,b){var c=a.appDataExternalIdSet,d=a.appDataReceiversSet;a=b.externalIds;b=b.receivers;a.forEach(function(a){c.add(a)});b.forEach(function(a){d.add(a)});return{appDataExternalIdSet:c,appDataReceiversSet:d}},{appDataExternalIdSet:new Set(),appDataReceiversSet:new Set()});var c=b.appDataExternalIdSet;b=b.appDataReceiversSet;c=Array.from(c);var e=Array.from(b);return a.appData.where("externalId").anyOf(c).toArray().then(function(a){if(a.length===0)return;return j(a,e)})}function i(a,b){if(b==null)return d("MAWDexieTable").dexieResolve();var c=b.toDelete;b=b.toUpdate;return d("MAWDexieTable").dexieAll([c.length>0?a.appData.bulkDelete(c):d("MAWDexieTable").dexieResolve(),b.length>0?a.appData.bulkPut(b):d("MAWDexieTable").dexieResolve()]).then(function(){})}function j(a,b){return a.reduce(function(a,c){if(c==null)return a;for(var d=0;d<b.length;d++){var e=b[d];c.permittedIdentitiesPerDevice["delete"](e)}if(c.permittedIdentitiesPerDevice.size===0){a.toDelete.push(c.appDataId);return a}else{a.toUpdate.push(c);return a}},{toDelete:[],toUpdate:[]})}g.writeAppDataReceipts=a;g.prepareBulkAppDataReceipts=h;g.writeBulkAppDataReceipts=i}),98);
__d("MAWWritePeerMsgReceiptsApi",["MAWDbMsg","MAWDbMsgTxns","MAWDbPendingReceiptTxns","MAWDexieTable","MAWLoggerUtils","MAWMarkThreadAsReadTxns","MAWMsgType","WAGlobals","WAJids","WATagsLogger","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Processing "," receipt for messages not from me"]);h=function(){return a};return a}function i(a,b,c){return d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,b).then(function(a){return a==null||a.type===d("MAWMsgType").MSG_TYPE.CIPHERTEXT?{msg:b,readReceipt:c,type:"missing"}:{dbMsg:a,msg:b,readReceipt:c,type:"found"}})}function j(a){a=a.map(function(a){return a.type==="missing"?null:a.dbMsg}).filter(Boolean);return a.reduce(function(a,b){var c=b.threadJid,e=d("WATimeUtils").castToMillisTime(d("MAWDbMsg").getSortOrderWithFallback(b)),f=a.get(c);(f==null||e>f.msgSortOrderMs)&&a.set(c,{msgId:b.msgId,msgSortOrderMs:e});return a},new Map())}function a(a,b){if(b.length===0)return d("MAWDexieTable").dexieResolve([]);b=b.map(function(a){d("WATagsLogger").TAGS([d("MAWLoggerUtils").Tag.Ephemeral,d("MAWLoggerUtils").Tag.PeerReceipt]).LOG(h(),a.type);if(a.type==="delivered")return;var b={device:void 0,ts:void 0};a.receivers.forEach(function(a){var c=a.device;a=a.ts;var e=d("WAJids").extractUserJid(c);e===d("WAGlobals").getMyUserJid()&&(b.ts==null||a<b.ts)&&(b.device=c,b.ts=a)});if(b.device!=null&&b.ts!=null)return babelHelpers["extends"]({},a,{receivers:{device:b.device,ts:b.ts}});else return}).filter(Boolean);var c=[];b.forEach(function(a){a.msgs.forEach(function(b){c.push([b,a.receivers])})});return d("MAWDexieTable").dexieAll(c.map(function(b){var c=b[0];b=b[1];return i(a,c,b)}))}function b(a,b){if(b.length===0)return d("MAWDexieTable").dexieResolve();var c=[],e=[];b.map(function(a){a.type==="missing"?c.push({author:a.msg.author,deliveryReceipts:[],externalId:a.msg.externalId,readReceipts:[a.readReceipt],thread:a.msg.chat}):e.push({msgId:a.msg,ts:a.readReceipt.ts})});var f=j(b);b=b.reduce(function(a,b){b=b.msg.chat;var c=f.get(b);c!=null&&a.set(b,{msgId:c.msgId,sortOrderMs:c.msgSortOrderMs});return a},new Map());return d("MAWDexieTable").dexieAll([d("MAWDbPendingReceiptTxns").bulkAddPendingReceipts(a,c),d("MAWMarkThreadAsReadTxns").bulkMarkThreadAsReadUpToMsgSortOrderMs(a,b)]).then(function(){})}g.getResultByProtocolMsgId=i;g.prepareReceiptsForMeToWrite=a;g.bulkWritePeerReceiptsForMsgsNotFromMeInternal=b}),98);
__d("MAWBulkWriteReceiptsApi",["MAWDexieTable","MAWIncomingReceiptDataFormatTxns","MAWIncomingReceiptTxns","MAWIndexedDb","MAWTransactionMode","MAWWriteAppDataReceiptsApi","MAWWritePeerMsgReceiptsApi"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b){var c=[],e=[],f=[];b.forEach(function(a){switch(a.type){case"msg-receipt":c.push(a.params);break;case"not-from-me":e.push(a.params);break;default:f.push(a.params);break}});return d("MAWDexieTable").dexieAll([f.length>0?d("MAWWriteAppDataReceiptsApi").prepareBulkAppDataReceipts(a,f):d("MAWDexieTable").dexieResolve(),c.length>0?d("MAWIncomingReceiptDataFormatTxns").prepareDataForReceiptsToWrite(a,c):d("MAWDexieTable").dexieResolve(),e.length>0?d("MAWWritePeerMsgReceiptsApi").prepareReceiptsForMeToWrite(a,e):d("MAWDexieTable").dexieResolve([])]).then(function(a){var b=a[0],c=a[1];a=a[2];if(b==null)return{incomingReceiptData:c,processedPeerReceiptsNotForMeResults:a};var d=b.toDelete;b=b.toUpdate;return{appDataReceipts:{toDelete:d,toUpdate:b},incomingReceiptData:c,processedPeerReceiptsNotForMeResults:a}})}b=d("MAWIndexedDb").makeMsgrTransactor({appData:(a=d("MAWTransactionMode")).READWRITE,chunk:a.READONLY,media:a.READONLY,messages:a.READWRITE,participants:a.READWRITE,pendingReceipts:a.READWRITE,receiverFetchInfo:a.READONLY,threads:a.READWRITE,unrenderedMessages:a.READWRITE,xma:a.READONLY},"bulkWriteReceipts",function(a){return function(b){return b.length===0?d("MAWDexieTable").dexieResolve():h(a,b).then(function(b){var c=b.appDataReceipts,e=b.incomingReceiptData;b=b.processedPeerReceiptsNotForMeResults;return d("MAWDexieTable").dexieAll([c!=null&&(c==null?void 0:c.toDelete.length)>0&&(c==null?void 0:c.toUpdate.length)>0?d("MAWWriteAppDataReceiptsApi").writeBulkAppDataReceipts(a,c):d("MAWDexieTable").dexieResolve(),e!=null?d("MAWIncomingReceiptTxns").bulkHandleIncomingReceipts(a,e):d("MAWDexieTable").dexieResolve(),b.length>0?d("MAWWritePeerMsgReceiptsApi").bulkWritePeerReceiptsForMsgsNotFromMeInternal(a,b):d("MAWDexieTable").dexieResolve()]).then(function(){})})}});g.bulkWriteReceipts=b}),98);
__d("MAWDbHistorySyncQRCodeData",[],(function(a,b,c,d,e,f){"use strict";a="qrCodeRowId";f.qrCodeRowId=a}),66);
__d("MAWHandleEncryptedBackupsSecretsApi",["MAWDbHistorySyncQRCodeData","MAWIndexedDb","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({historySyncQRCodeData:d("MAWTransactionMode").READWRITE},"handleEncryptedBackupsSecret",function(a){return function(b){var c=b.backupId,e=b.epoch,f=b.mailboxRootKey,g=b.obliviousValidationToken,i=b.serverDataId,j=b.tempOcmfClientState;return a.historySyncQRCodeData.get(d("MAWDbHistorySyncQRCodeData").qrCodeRowId).then(function(b){if(!(b==null?void 0:b.isQRScanned))return a.historySyncQRCodeData.put({isQRScanned:!0,rowId:d("MAWDbHistorySyncQRCodeData").qrCodeRowId}).then(function(a){d("MAWIndexedDb").afterTransaction({tag:"CallFinishAddDevice",value:{backupId:c.toString(),epoch:h(e),mailboxRootKey:f,obliviousValidationToken:g,serverDataId:i.toString(),tempOcmfClientState:j}});return})["catch"](function(b){return a.historySyncQRCodeData.put({isQRScanned:!1,rowId:d("MAWDbHistorySyncQRCodeData").qrCodeRowId}).then(function(){})})})}});function h(a){return a.map(function(a){var b=a.anonId,c=a.id,d=a.rootKey;a=a.status;return{epoch_anon_id:b,epoch_id:c.toString(),epoch_root_key:d,epoch_status:a.toString()}})}g.handleEncryptedBackupsSecret=a}),98);
__d("MAWWriteMetaSyncsTxns",["MAWDbDeletedMessages","MAWDbPendingStanza","MAWDbPendingStanzaTxns","MAWDbThreadTxns","MAWDexieTable","MAWFTSTxns","MAWThreadManagementTxns","WALogger","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[MAWWriteMetaSyncsTxns] Thread delete stanza was processed before thread insertion ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Received chatDelete: ",""]);i=function(){return a};return a}var j=30*d("WATimeUtils").DAY_SECONDS;function a(a,b){d("WALogger").LOG(i(),b);var c=b.messageRange;c=c!=null?d("MAWDbPendingStanzaTxns").putPendingStanza(a,{content:{metaSyncMessageRange:c},type:d("MAWDbPendingStanza").PENDING_TYPE.DELETE_THREAD},j,b.chatJid,d("MAWDbPendingStanza").PENDING_TYPE.DELETE_THREAD):d("MAWDexieTable").dexieResolve();return d("MAWDexieTable").dexieAll([d("MAWDbThreadTxns").getThread(a,b.chatJid),c,d("MAWFTSTxns").maybePutThreadToPurgeBacklog(a,b.chatJid)]).then(function(c){c=c[0];if(c.success)return d("MAWThreadManagementTxns").metaSyncChatDeleteThread(a,c.value,b.messageRange,d("MAWDbDeletedMessages").DbDeletedMsgReasonEnum.cast(b.type));else{d("WALogger").LOG(h(),b.chatJid);return{deletedMessages:[]}}})}g.PENDING_DELETE_THREAD_EXPIRATION_IN_SEC=j;g.handleChatDelete=a}),98);
__d("WADeleteReceiptsApi",["MAWTransactionMode","WADbTransactor"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b){return a.receipts.where("waMsgId").anyOf(b)["delete"]().then(function(){})}a=d("WADbTransactor").makeSignalTransactor({receipts:d("MAWTransactionMode").READWRITE},"deleteReceipts",function(a){return function(b){return h(a,b)}});g.deleteAllReceiptsForWAMsgIds=h;g.deleteReceipts=a}),98);
__d("MAWHandleMetaSyncAction",["MAWIndexedDb","MAWTransactionMode","MAWWriteDeleteMessageTxns","MAWWriteMetaSyncsTxns","Promise","WAAssertUnreachable","WADeleteReceiptsApi","WALogger","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Received action: ",""]);i=function(){return a};return a}function a(a){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){for(a of a.actions)a.chatAction?yield k(a.chatAction):a.messageAction&&(yield n(a.messageAction))});return j.apply(this,arguments)}function k(a){d("WALogger").LOG(i(),a);switch(a.type){case"chat_archive":return l(a);case"chat_delete":return o(a).then(function(a){a=a.deletedMessages;return d("WADeleteReceiptsApi").deleteReceipts(a)});default:a.type;return m(a)}}function l(a){return(h||(h=b("Promise"))).resolve()}function m(a){return(h||(h=b("Promise"))).resolve()}function n(a){switch(a.type){case"delete_for_me":return p(a).then(function(){});default:return c("WAAssertUnreachable")(a.type)}}var o=d("MAWIndexedDb").makeMsgrTransactor({chunk:(e=d("MAWTransactionMode")).READWRITE,deletedMessages:e.READWRITE,editMsgHistory:e.READWRITE,ftsPurgeThreadBacklog:e.READWRITE,groupInfo:e.READWRITE,groupInvites:e.READWRITE,media:e.READWRITE,messages:e.READWRITE,participants:e.READWRITE,pendingStanzas:e.READWRITE,reactions:e.READWRITE,threads:e.READWRITE,unrenderedMessages:e.READWRITE,xma:e.READWRITE},"writeOutgoingAppData",function(a){return function(b){return d("MAWWriteMetaSyncsTxns").handleChatDelete(a,b)}}),p=d("MAWIndexedDb").makeMsgrTransactor({chunk:e.READWRITE,editMsgHistory:e.READWRITE,ftsPurgeBacklog:e.READWRITE,groupInfo:e.READWRITE,groupInvites:e.READWRITE,media:e.READWRITE,messages:e.READWRITE,participants:e.READWRITE,pendingStanzas:e.READWRITE,reactions:e.READWRITE,threads:e.READWRITE,unrenderedMessages:e.READWRITE,xma:e.READWRITE},"writeOutgoingAppData",function(a){return function(b){return d("MAWWriteDeleteMessageTxns").handleDeleteForMe(a,b)}});g.handleMetaSyncActions=a}),98);
__d("MAWProtocolQueueAppdata",["MAWHandleEncryptedBackupsSecretsApi","MAWHandleMetaSyncAction","MAWSharedCOPLogger","Promise","WAConvertAppData","WAMsgApplication.pb","WAParseMessageApplication","WAProtocolQueue","WAResultOrError","decodeProtobuf"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unknown appdata type: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Handle appdata: backup secret"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Handle appdata: meta sync"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Handle appdata"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Appdata contains unparseable message application."]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["Parse Appdata application protocol"]);n=function(){return a};return a}function a(a){var c=a.map(function(a){return o(a.appdata)});return(h||(h=b("Promise"))).all(c.map(function(a){a=p(a);return a})).then(function(b){var c=[];b.map(function(b,d){b.success===!0&&c.push(a[d].stanzaQueueId)});return{followUpParams:void 0,toAck:c}})}function o(a){c("MAWSharedCOPLogger").DEV(n());a=d("decodeProtobuf").decodeProtobufWithUnknowns(d("WAMsgApplication.pb").MessageApplicationSpec,d("WAProtocolQueue").extractSubProtocolFromAppdataProtocol(a).payload);a=d("WAParseMessageApplication").parseMessageApplication(a);if(a.type==="error"){c("MAWSharedCOPLogger").ERROR(m());return}return d("WAConvertAppData").parseAppData(a)}function p(a){c("MAWSharedCOPLogger").LOG(l());if(a==null)return(h||(h=b("Promise"))).resolve(d("WAResultOrError").makeResult());switch(a.type){case"meta_sync":c("MAWSharedCOPLogger").LOG(k());return d("MAWHandleMetaSyncAction").handleMetaSyncActions(a).then(function(){return d("WAResultOrError").makeResult()});case"backups_secrets":c("MAWSharedCOPLogger").LOG(j());return d("MAWHandleEncryptedBackupsSecretsApi").handleEncryptedBackupsSecret(a.encryptedBackupsSecrets).then(function(){return d("WAResultOrError").makeResult()});case"sync_key_share":return(h||(h=b("Promise"))).resolve(d("WAResultOrError").makeResult());case"sync_key_request":return(h||(h=b("Promise"))).resolve(d("WAResultOrError").makeResult());default:a.type;c("MAWSharedCOPLogger").WARN(i(),a.type);return(h||(h=b("Promise"))).resolve(d("WAResultOrError").makeResult())}}g.handleAppdataStanzas=a}),98);
__d("MAWCOPAppdataHandler",["MAWIsQuotaExceededError","MAWProtocolQueueAppdata","MAWSharedCOPLogger","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Errors occurred while processing appdata batch, see transactor error reports."]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["appdata consumer: ",""]);i=function(){return a};return a}function a(a){return j(a)["catch"](function(a){if(d("MAWIsQuotaExceededError").isQuotaExceededError(a))throw a;c("MAWSharedCOPLogger").ERROR(i(),a);return[]})}function j(a){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(a.length===0)return[];var b=(yield d("MAWProtocolQueueAppdata").handleAppdataStanzas(a));b.toAck.length!==a.length&&c("MAWSharedCOPLogger").WARN(h());return b.toAck});return k.apply(this,arguments)}g["default"]=a}),98);
__d("WAUpdateDevicesForUserApi",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){return a.identity.where("userJid").equals(b).toArray().then(function(a){return a.map(function(a){return a.deviceJid})})}function b(a){var b=a.allowSecurityAlertForContact;a=a.isMe;return!a&&b}f.getAllDeviceJidsForUser=a;f.getShouldShowAdminMessages=b}),66);
__d("WAUpdateRotateSenderKeyToTrue",["MAWTransactionMode","WADbPersonalSenderKeyStatusTxns","WADbTransactor"],(function(a,b,c,d,e,f,g){"use strict";a=d("WADbTransactor").makeSignalTransactor({personalSenderKeyStatuses:d("MAWTransactionMode").READWRITE},"updateRotateSenderKeyToTrue",function(a){return function(b){return d("WADbPersonalSenderKeyStatusTxns").bulkSetRotateSenderKeyToTrueTxn(a,b)}});g.updateRotateSenderKeyToTrue=a}),98);
__d("MAWProtocolQueueInstructions",["MAWAdminWriteUserDeviceMsgTxn","MAWBridge","MAWDbAddDeviceChangeAlertsTxn","MAWDbDeviceChangeAlerts","MAWDbGetAlertsWithDeviceJidTxn","MAWDbGetUnArchivedDeviceChangeAlertsCountTxn","MAWDbMsgTypeVersionTxns","MAWDbThreadTxns","MAWDbUpdateDeviceChangeAlertsLogInStatusTxn","MAWDexieTable","MAWIndexedDb","MAWODSProxy","MAWTransactionMode","WAAssertUnreachable","WADbContact","WAGlobals","WAJids","WALogger","WAOdsEnums","WAUpdateDevicesForUserApi","WAUpdateRotateSenderKeyToTrue","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["ICDC error instruction for thread "," not found"]);h=function(){return a};return a}function i(a,b){b=new Set(b.map(function(a){return a.jid}));return d("MAWDexieTable").dexieAll([d("MAWDbMsgTypeVersionTxns").maybeBulkGetSecuritySetting(a),d("MAWDbThreadTxns").getAllThreadsForUsers(a,Array.from(b))])}function a(a){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield d("MAWBridge").getBridge().sendAndReceive("event","getLSDBUsersRelationships",{users:Array.from(new Set(a.map(function(a){return a.jid})))}));a=(yield k(a,b));b=a.followUpParams;a=a.toAck;b=b.groupsToUpdateForIdentityRemoved.flat();yield d("WAUpdateRotateSenderKeyToTrue").updateRotateSenderKeyToTrue(b);return{followUpParams:void 0,toAck:a}});return j.apply(this,arguments)}var k=d("MAWIndexedDb").makeMsgrTransactor({appMeta:(e=d("MAWTransactionMode")).READONLY,deviceChangeAlerts:e.READWRITE,ftsBackloggedMessages:e.READWRITE,groupInfo:e.READONLY,messages:e.READWRITE,participants:e.READONLY,threads:e.READWRITE},"handleInstructions",function(a){return function(b,c){return i(a,b).then(function(e){var f=e[0],g=f.allowSecurityAlertForContact,h=f.allowSecurityAlertForSelf,i=e[1];return d("MAWDexieTable").dexieSequentialAll(b.map(function(b){var e=b.jid,f=e===d("WAGlobals").getMyUserJid(),j=d("WAUpdateDevicesForUserApi").getShouldShowAdminMessages({allowSecurityAlertForContact:g,isMe:f})&&c.get(e)===d("WADbContact").TWO_WAY_CONTACT,k={allowSecurityAlertForSelf:h,isMe:f,shouldShowAdminMessages:j,threads:(f=i.get(e))!=null?f:[],user:e};return function(){return l(a,b,k)}})).then(function(){var a=b.filter(function(a){return a.instruction==="identityRemoved"}).map(function(a){a=(a=i.get(a.jid))!=null?a:[];a=a.map(function(a){return d("WAJids").interpretAsGroupJid(a.jid)}).filter(Boolean);return a});return{followUpParams:{groupsToUpdateForIdentityRemoved:a},toAck:b.map(function(a){return a.stanzaQueueId})}})})}});function l(a,b,d){switch(b.instruction){case"identityChanged":return m(a,b,d);case"identityAdded":return n(a,b,d);case"identityRemoved":return o(a,b,d);case"icdcError":return p(a,b,d);default:throw c("WAAssertUnreachable")(b)}}function m(a,b,c){var e=c.allowSecurityAlertForSelf,f=c.isMe,g=c.shouldShowAdminMessages;c=c.threads;var h=f&&b.model!=null&&b.platform!=null&&b.notificationTs!=null;return d("MAWDexieTable").dexieAll([h&&b.model!=null&&b.platform!=null&&b.notificationTs!=null?d("MAWDbAddDeviceChangeAlertsTxn").addDeviceChangeAlertsTxn(a,{action:d("MAWDbDeviceChangeAlerts").KEY_CHANGE,deviceJid:b.device,identity:b.identity,isArchived:!e,model:b.model,platform:b.platform,ts:b.notificationTs}).then(function(){return d("MAWDbGetUnArchivedDeviceChangeAlertsCountTxn").getUnArchivedDeviceChangeAlertsCountTxn(a)}):d("MAWDexieTable").dexieResolve()].concat(g?c.map(function(c){return d("WAJids").interpretAsGroupJid(c.jid)==null&&d("MAWAdminWriteUserDeviceMsgTxn").writeUserDeviceAdminMsg(a,b.jid,c,d("MAWAdminWriteUserDeviceMsgTxn").DeviceChange.update,b.notificationTs)}):[])).then(function(){(h||g)&&d("MAWODSProxy").odsBumpEntityKey({entity:f?d("WAOdsEnums").Entity.SECURITY_ALERT_FOR_SELF:d("WAOdsEnums").Entity.SECURITY_ALERT_FOR_CONTACT,key:d("MAWDbDeviceChangeAlerts").KEY_CHANGE})})}function n(a,b,c){var e=c.allowSecurityAlertForSelf,f=c.isMe,g=c.shouldShowAdminMessages,h=c.threads,i=c.user,j=f&&b.model!=null&&b.platform!=null&&b.notificationTs!=null;return d("MAWDexieTable").dexieAll([j&&b.model!=null&&b.platform!=null&&b.notificationTs!=null?d("MAWDbAddDeviceChangeAlertsTxn").addDeviceChangeAlertsTxn(a,{action:d("MAWDbDeviceChangeAlerts").ADD,deviceJid:b.device,identity:b.identity,isArchived:!e,model:b.model,platform:b.platform,ts:b.notificationTs}).then(function(){return d("MAWDbGetUnArchivedDeviceChangeAlertsCountTxn").getUnArchivedDeviceChangeAlertsCountTxn(a)}):d("MAWDexieTable").dexieResolve()].concat(g?h.map(function(c){return d("WAJids").interpretAsGroupJid(c.jid)==null&&d("MAWAdminWriteUserDeviceMsgTxn").writeUserDeviceAdminMsg(a,i,c,d("MAWAdminWriteUserDeviceMsgTxn").DeviceChange.add,b.notificationTs)}):[])).then(function(){(j||g)&&d("MAWODSProxy").odsBumpEntityKey({entity:f?d("WAOdsEnums").Entity.SECURITY_ALERT_FOR_SELF:d("WAOdsEnums").Entity.SECURITY_ALERT_FOR_CONTACT,key:d("MAWDbDeviceChangeAlerts").ADD})})}function o(a,b,c){var e=c.isMe,f=c.shouldShowAdminMessages,g=c.threads,h=c.user;return d("MAWDexieTable").dexieAll([e?d("MAWDbGetAlertsWithDeviceJidTxn").getAlertsWithDeviceJidTxn(a,b.device).then(function(){return d("MAWDbUpdateDeviceChangeAlertsLogInStatusTxn").updateDeviceChangeAlertsLogInStatusTxn(a,b.device)}).then(function(){return d("MAWDbGetUnArchivedDeviceChangeAlertsCountTxn").getUnArchivedDeviceChangeAlertsCountTxn(a)}):d("MAWDexieTable").dexieResolve()].concat(f?g.map(function(c){return d("WAJids").interpretAsGroupJid(c.jid)==null&&d("MAWAdminWriteUserDeviceMsgTxn").writeUserDeviceAdminMsg(a,h,c,d("MAWAdminWriteUserDeviceMsgTxn").DeviceChange.remove,b.notificationTs)}):[])).then(function(){(e||f)&&d("MAWODSProxy").odsBumpEntityKey({entity:e?d("WAOdsEnums").Entity.SECURITY_ALERT_FOR_SELF:d("WAOdsEnums").Entity.SECURITY_ALERT_FOR_CONTACT,key:d("MAWDbDeviceChangeAlerts").REMOVE})})}function p(a,b,c){c=c.threads;if(!d("WAGlobals").getConfig().isICDCErrorEnabled())return d("MAWDexieTable").dexieResolve();c=c.find(function(a){return a.jid===b.jid});if(c==null){d("WALogger").ERROR(h(),b.jid);return d("MAWDexieTable").dexieResolve()}return d("MAWAdminWriteUserDeviceMsgTxn").writeICDCAlert(a,b.jid,c,b.notificationTs)}g.handleInstructions=a}),98);
__d("MAWCOPInstructionsHandler",["MAWIsQuotaExceededError","MAWProtocolQueueInstructions","MAWSharedCOPLogger","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Errors occurred while processing instructions batch, see transactor error reports."]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["instruction consumer: ",""]);i=function(){return a};return a}function a(a){return j(a)["catch"](function(a){if(d("MAWIsQuotaExceededError").isQuotaExceededError(a))throw a;c("MAWSharedCOPLogger").ERROR(i(),a);return[]})}function j(a){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(a.length===0)return[];var b=(yield d("MAWProtocolQueueInstructions").handleInstructions(a));b.toAck.length!==a.length&&c("MAWSharedCOPLogger").WARN(h());return b.toAck});return k.apply(this,arguments)}g["default"]=a}),98);
__d("MAWEbUploadFollowUp",["EncryptedBackupsUploadQueue","I64","MAWEBUploadMessageUtils","MAWEBUploadTrackingUtils","MAWMsgType","MessageBackupDirectiveGenerator","WAAsMessageApplication","WAGlobals","WAJids","WALogger","WAMediaUtils","WAMsgApplication.pb","WATimeUtils","encodeProtobuf"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] no result or failed for incoming stanza ",""]);i=function(){return a};return a}function j(a){var b,c=a.stanza.message.decrypted.id;if(((b=a.decodedMsg)==null?void 0:b.unstoredDbReaction)!=null)return{author:a.decodedMsg.unstoredDbReaction.reactToAuthor,chat:c.chat,externalId:a.decodedMsg.unstoredDbReaction.reactToExternalId};else if(((b=a.decodedMsg)==null?void 0:b.unstoredDbEditActionMsg)!=null)return{author:c.author,chat:c.chat,externalId:a.decodedMsg.unstoredDbEditActionMsg.originalMsgExternalId};return c}function a(a,b){a=a.map(function(a){var c,e=a.stanza.message.decrypted.id,f=b.get(a.stanza.message.decrypted.id),g=k(a.decodedMsg);if(f==null||!f.success||g==null){d("WALogger").EXPECTED_ERROR(i(),a.stanza.message.decrypted.id);return null}f=j(a);var m=a.stanza.message.decrypted.msg;if((m==null?void 0:m.version)!=="v3"||m.type!=="subprotocol")return null;m={metadata:m.metadata,payload:{subProtocol:(c={},c[m.subprotocolType]={payload:m.subprotocol.buffer,version:1},c)}};c={bytes:d("WAAsMessageApplication").castToMessageApplicationBytes(d("encodeProtobuf").encodeProtobuf(d("WAMsgApplication.pb").MessageApplicationSpec,m).readByteArray()),version:"v3"};m=a.stanza.message.details.reportingMeta;var n=l(a);d("MAWEBUploadTrackingUtils").maybeStartTrackingForUploadQueue(e,"receive",g);a=a.stanza.message.details.ts;return{attachmentContext:n,backupDirective:d("MessageBackupDirectiveGenerator").createMessageBackupDirective(f,(h||(h=d("I64"))).of_string(d("WAJids").authorToUserId(e.author,d("WAJids").extractUserId(d("WAGlobals").getMyUserJid()))),g),messageApplication:c.bytes,msgId:e,originalMsgProtocolId:f,reportingMeta:m,senderId:h.of_string(d("WAJids").authorToUserId(e.author,d("WAJids").extractUserId(d("WAGlobals").getMyUserJid()))),serverTs:a,sortOrderMs:d("WATimeUtils").castToMillisTime(d("MAWEBUploadMessageUtils").echoOverrideMessageSortOrder({externalId:e.externalId,serverTs:a,ts:a}))}}).filter(Boolean);return d("EncryptedBackupsUploadQueue").putMsgsToEbUpload(a)}function k(a){if(a==null)return null;var b;if(a.unstoredDbReaction!=null)return d("MAWMsgType").MSG_TYPE.REACTION;else if(a.unstoredDbEditActionMsg!=null)return d("MAWMsgType").MSG_TYPE.EDIT_ACTION;else if(a.unstoredDbMedia!=null)b=a.unstoredDbMedia.mediaType;else if(a.unstoredXMA!=null)b=d("MAWMsgType").MSG_TYPE.XMA;else if(a.unstoredDbMsg!=null)b=a.unstoredDbMsg.type;else return null;return d("MAWMsgType").isEBSupportedMsgType(b)?b:null}function l(a){var b;if(((b=a.decodedMsg)==null?void 0:b.unstoredDbMedia)!=null){a=(b=a.decodedMsg)==null?void 0:b.unstoredDbMedia;b=d("WAMediaUtils").decodeMediaEntryData(a.mediaEntry);if(b.objectId!=null&&a.mediaType!=null)return[{mediaObjectId:d("WAMediaUtils").stringToDeliveryObjectId(b.objectId),mediaType:a.mediaType}]}return void 0}g.putMessagesToEbUploadQueue=a}),98);
__d("MAWIncomingMsgUtils",["MAWEphemeralUtil","MAWParseArmadilloProtocol","MAWUnstoredContentToUnstoredDbContentUtils","WAParseV3Protocol","err"],(function(a,b,c,d,e,f,g){"use strict";var h=null;function i(a){if(h==null){var b=function(b,c,e,f,g){return d("MAWParseArmadilloProtocol").parseArmadilloProtocol(b,c,e,f,a,g)};h=d("WAParseV3Protocol").createV3ProtocolParser(new Map([["armadillo",b]]))}return h}function a(a,b){var e=a.author,f=a.chat,g=a.ebTimestampMs,h=a.externalId,j=a.msg,k=a.reportingMeta;a=a.serverTs;if(j.version==="v2")throw c("err")("Armadillo does not support protobuf v2");if(j.type==="ephemeral"){var l=d("MAWEphemeralUtil").buildUnstoredDbEphemeralSettingMsgWithoutContentPlaceholder(a);k!=null&&l.unstoredDbMsg!=null&&(l.unstoredDbMsg.reportingMeta=k);return l}l=babelHelpers["extends"]({unstoredXMA:null},i(b)(j,f,h,e,a,g));k!=null&&l.unstoredMsg!=null&&(l.unstoredMsg.reportingMeta=k);return d("MAWUnstoredContentToUnstoredDbContentUtils").unstoredContentToUnstoredDbContent(l)}g.getDbMsg=a}),98);
__d("MAWProtocolQueueDecodeProto",["MAWIncomingMsgUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c){switch(a.type){case"IncomingMsg":var e=a.folder,f=a.id,g=a.msg,h=a.reportingMeta;a=a.ts;var i=f.author,j=f.chat;f=f.externalId;return d("MAWIncomingMsgUtils").getDbMsg({author:i,chat:j,ebTimestampMs:c,externalId:f,folder:e,msg:g,reportingMeta:h,serverTs:a},b);case"InvisibleMsg":case"IncomingCiphertextMsg":default:return}}g.decodeMsg=a}),98);
__d("WAQueryGroupInvite",["WADeprecatedSendIq","WAPREList","WAPREMetrics","WAQueryGroup","WAResultOrError","WAWap","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c,d){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e){var f,g=d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.QUERY_GROUP);a=(f=d("WAWap")).wap("iq",{id:f.generateId(),to:f.GROUP_JID(a),type:"get",xmlns:"w:g2"},f.wap("query",null,f.wap("add_request",{admin:f.USER_JID(e),code:f.CUSTOM_STRING(b),expiration:f.CUSTOM_STRING(c.toString(10))})));e=(yield d("WADeprecatedSendIq").deprecatedSendIq(a,d("WAQueryGroup").parseQueryGroupResponse));if(!e.success){g.endFail("query_group_for_invitee_fail");return d("WAResultOrError").makeError(e)}g.endSuccess();return d("WAResultOrError").makeResult(e.result.group)});return h.apply(this,arguments)}g.queryGroupInvite=a}),98);
__d("MAWCOPMessagesHandler",["ACTSanitizerApiLazyLoader","IGDInstamadilloUtils","MAWDbStaleQueue","MAWDebugMsg","MAWEbUploadFollowUp","MAWIsQuotaExceededError","MAWJobDefinitions","MAWJobManager","MAWLoggerUtils","MAWMsgType","MAWODSProxy","MAWProtocolQueueDecodeProto","MAWProtocolQueueMsg","MAWProtocolQueueUtils","MAWSharedCOPLogger","MAWSharedCOPLoop","Promise","WACreateGroup","WAGlobals","WAHashUtils","WAJids","WAOdsEnums","WAPREList","WAProtocolQueue","WAQueryGroup","WAQueryGroupInvite","WAResultOrError","WATimeUtils","asyncToGeneratorRuntime","err","gkx","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Media: externalId="," - plaintextFollowUp - plaintextHash=",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Cannot find db result for message"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Errors occurred while processing messages batch, see transactor error reports."]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Cannot prepare msgs to put to EBUploadQueue: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Decode fails: ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["Cannot load XMA Validation WASM module: ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["Error creating groups: ",""]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["Error creating groups: ",""]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["Scheduling job for ",", plaintextHash: ",""]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleMsg: detected out-of-sync ephemeral setting for ",", sending EPHEMERAL_SYNC_RESPONSE"]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["message consumer: ",""]);s=function(){return a};return a}function a(a,b){return t(a,b)["catch"](function(a){if(d("MAWIsQuotaExceededError").isQuotaExceededError(a))throw a;c("MAWSharedCOPLogger").ERROR(s(),a);return[]})}function t(a,b){return u.apply(this,arguments)}function u(){u=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){if(a.length===0)return[];var e=new Set();z(a);var f;try{f=(yield d("ACTSanitizerApiLazyLoader").loadACTSanitizerApi())}catch(a){c("MAWSharedCOPLogger").TAGS(["ActSanitizerWasmApi"]).ERROR(n(),a),f=d("ACTSanitizerApiLazyLoader").fallbackACTSanitizerApi}var g=f.isXMAValid,h=new Map(a.map(function(a){a=A(a);a=d("WAProtocolQueue").mapProcolQueueMessageV2toV1(a);try{if(a.message.decrypted.type==="InstamadilloMsg")if(c("gkx")("3577")){d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.IGDW_INSTAMADILLO_MESSAGE_ON_OLD_WORKER,key:"message"});e.add(a.stanzaQueueId);return null}else throw c("err")("InstamadilloMsg is not supported in MSGR. Should never happen "+d("IGDInstamadilloUtils").getE2EEGatingStateAsString());var b=d("MAWProtocolQueueDecodeProto").decodeMsg(a.message.decrypted,g,a.ebTimestampMs);a.incomingType==="ebrestore"&&(a.message.details.type=(b==null?void 0:b.unstoredDbReaction)!=null?"reaction":(b==null?void 0:b.unstoredXMA)!=null||(b==null?void 0:b.unstoredDbMedia)!=null?"media":"text");return[a.stanzaQueueId,d("MAWProtocolQueueUtils").addMetricToMessage({decodedMsg:b!=null?b:void 0,stanza:babelHelpers["extends"]({},a)},a.incomingType==="ebrestore"?d("WAPREList").PRE_METRIC.EB_RESTORE_WITH_HIM:d("WAPREList").PRE_METRIC.RECEIVE_MESSAGE)]}catch(f){b=f instanceof Error?f:null;c("MAWSharedCOPLogger").ERROR(m(),f);c("promiseDone")(d("MAWDbStaleQueue").mawAddStaleStanza(a,"Decode issue: "+((b=b==null?void 0:b.message)!=null?b:"")));e.add(a.stanzaQueueId);return null}}).filter(Boolean)),o=(yield d("MAWProtocolQueueMsg").handleIncomingMessagesStanzas(Array.from(h.values())));o.toAck.forEach(function(a){return e.add(a)});f=a.map(function(a){var b=h.get(a.stanzaQueueId);if(b==null)return null;b=b;var c=o.followUpParams.incomingMsgResults.get(b.stanza.message.decrypted.id);return[b,e.has(a.stanzaQueueId),c]}).filter(Boolean);try{d("MAWEbUploadFollowUp").putMessagesToEbUploadQueue(Array.from(h.values()).filter(function(a){return a.stanza.incomingType==="wa"}),o.followUpParams.incomingMsgResults)}catch(a){c("MAWSharedCOPLogger").ERROR(l(),a)}e.size!==a.length&&c("MAWSharedCOPLogger").WARN(k());var p=new Map(),q=new Set();f.forEach(function(a){var e=a[0],f=a[1];a=a[2];e.receiveFlow.addPoint("consumer_handle_message_stanza_end",{bool:{dbSuccess:!!(a==null?void 0:a.success)}});if(f){e.receiveFlow.addPoint("ack_received");var g=e.stanza.message.decrypted.type;g==="UnavailableMsg"||g==="IncomingCiphertextMsg"?e.receiveFlow.endFail(g):(e.stanza.message.details.type==="media"&&e.receiveFlow.addPoint("message_with_media"),e.receiveFlow.endSuccess())}if(!a&&!f){c("MAWSharedCOPLogger").ERROR(j());e.receiveFlow.endFail("db_result_not_found");return}if(!a)return;if(a.success===!1){g=a.error;switch(g.type){case"group_invite":e.receiveFlow.endFail("end_with_db_error_group_invite");p.set(g.groupJid,{folder:g.folder,inviteCode:g.inviteCode,inviteExpireTs:g.inviteExpireTs,inviterJid:g.inviterJid});e.receiveFlow.endFail("need_group_invite");break;default:g.type;e.receiveFlow.endFail("invlid_args");break}return}a.success;if(a.value!=null){f=a.value;var h=f.msgType;g=f.outOfSyncEphemeralSetting;a=f.plaintextHashs;var k=f.protocolMsgId;f=f.unknownGroup;if(f){f=d("WAJids").interpretAsGroupJid(k.chat);f!=null&&q.add(f)}v(g,k,b);a==null?void 0:a.forEach(function(a){c("MAWSharedCOPLogger").LOG(i(),e.stanza.message.details.externalId,d("WAHashUtils").sanitisePlaintextHash(a)),w(k,a,h)})}});x(q,b);y(p,b);return Array.from(e)});return u.apply(this,arguments)}function v(a,b,e){a!=null&&(c("MAWSharedCOPLogger").TAGS([d("MAWLoggerUtils").Tag.Ephemeral,d("MAWLoggerUtils").Tag.SettingSync]).LOG(r(),b==null?void 0:b.externalId),c("promiseDone")(e.awaitBackground(d("MAWSharedCOPLoop").makeCopGUID("ephemeral_sync_response"),function(){return d("MAWJobManager").getJobManager().waitUntilPersisted(d("MAWJobDefinitions").jobSerializers.sendEphemeralSettingMsg(a.chatJid,{ephemeralSetting:{ephemeralExpirationInSec:a.correctEphemeralExpirationInSec,ephemeralLastUpdatedOrSetTimestamp:a.correctEphemeralLastUpdatedOrSetTimestamp},isEphemeralSettingReset:!1,isForSyncResponse:!0}))},d("MAWSharedCOPLoop").COPBehaviour.NON_BLOCKING)))}function w(a,b,e){a!=null&&b!=null&&e!==d("MAWMsgType").MSG_TYPE.RAVEN&&(c("MAWSharedCOPLogger").TAGS(["downloadAndHandleMedia"]).LOG(q(),a,d("WAHashUtils").sanitisePlaintextHash(b)),d("MAWJobManager").getJobManager().fireAndForget(d("MAWJobDefinitions").jobSerializers.downloadAndHandleMedia(a,b,"WAIncomingMsg",e,null)))}function x(a,e){if(a.size===0)return;c("promiseDone")(e.awaitBackground(d("MAWSharedCOPLoop").makeCopGUID("queryGroup"),function(){f()["catch"](function(a){c("MAWSharedCOPLogger").ERROR(p(),a)});return(h||(h=b("Promise"))).resolve()},d("MAWSharedCOPLoop").COPBehaviour.NON_BLOCKING));function f(){return g.apply(this,arguments)}function g(){g=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var c=(yield (h||(h=b("Promise"))).all(Array.from(a).map(function(a){return d("WAQueryGroup").queryGroup(a,"interactive")["catch"](function(a){return d("WAResultOrError").makeError()})})));c=c.map(function(a){if(a.success===!0){a={extras:null,folder:null,groupStatus:"added",groupToCreate:a.value,key:null,serverTs:d("WATimeUtils").unixTime()};return a}return null}).filter(Boolean);yield d("WACreateGroup").createGroups(c)});return g.apply(this,arguments)}}function y(a,e){if(a.size===0)return;c("promiseDone")(e.awaitBackground(d("MAWSharedCOPLoop").makeCopGUID("queryGroupInvite"),function(){f()["catch"](function(a){c("MAWSharedCOPLogger").ERROR(o(),a)});return(h||(h=b("Promise"))).resolve()},d("MAWSharedCOPLoop").COPBehaviour.NON_BLOCKING));function f(){return g.apply(this,arguments)}function g(){g=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var c=(yield (h||(h=b("Promise"))).all(Array.from(a.entries()).map(function(a){var b=a[0];a=a[1];var c=a.inviteCode,e=a.inviteExpireTs;a=a.inviterJid;return d("WAQueryGroupInvite").queryGroupInvite(b,c,e,a)["catch"](function(a){return d("WAResultOrError").makeError()})})));c=c.map(function(a){if(a.success===!0){a={extras:null,folder:null,groupStatus:"added",groupToCreate:a.value,key:null,serverTs:d("WATimeUtils").unixTime()};return a}return null}).filter(Boolean);yield d("WACreateGroup").createGroups(c)});return g.apply(this,arguments)}}function z(a){if(c("gkx")("23915"))for(a of a)a.subtype==="ciphertext"&&c("promiseDone")(d("MAWDebugMsg").writeDebugMsg(a.jid,"Message "+a.stanzaId+" has decryption error: "+a.decryptionError+" from user "+a.from,{decryptionError:a.decryptionError,protocolMsgId:{author:d("WAGlobals").getMyDeviceJid()===a.from?"@me":d("WAJids").extractUserJid(a.from),chat:a.jid,externalId:a.stanzaId}}))}function A(a){if(a.message==null)return a;if(a.message.type!=="ephemeral")return a;var b=a.serverTs;a.message.ephemeralLastUpdatedOrSetTimestamp=a.message.ephemeralLastUpdatedOrSetTimestamp===d("WATimeUtils").DEFAULT_UNIXTIME?b:a.message.ephemeralLastUpdatedOrSetTimestamp;return a}g["default"]=a}),98);
__d("MAWChangeGroupMemberAddModeApi",["MAWAdminMsgHelpers","MAWRunInTransaction","WAResultOrError","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";a=function(){for(var a=arguments.length,b=new Array(a),c=0;c<a;c++)b[c]=arguments[c];return d("MAWRunInTransaction").runInTransaction({GroupInfoStore:!0,MessagesStore:!0},function(a){return h.apply(void 0,[a].concat(b))},"changeGroupMemberAddMode")};var h=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e){var f=a.GroupInfoStore;a=a.MessagesStore;var g=(yield f.get(b));if(!g.success)return d("WAResultOrError").makeError("missing_group");yield f.update(b,function(a){return babelHelpers["extends"]({},a,{memberAddMode:e})});g=d("MAWAdminMsgHelpers").createMemberAddModeChangeAdminMsg(b,e,c);g!=null&&(yield a.create(g));return d("WAResultOrError").makeResult()});return function(b,c,d,e){return a.apply(this,arguments)}}();g.changeGroupMemberAddMode=a;g.changeGroupMemberAddModeTransactor=h}),98);
__d("MAWChangeGroupParticipantAdminStatusApi",["MAWAdminMsgHelpers","MAWRunInTransaction","WAResultOrError","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";a=function(){for(var a=arguments.length,b=new Array(a),c=0;c<a;c++)b[c]=arguments[c];return d("MAWRunInTransaction").runInTransaction({GroupInfoStore:!0,MessagesStore:!0,ParticipantsStore:!0},function(a){return h.apply(void 0,[a].concat(b))},"changeGroupParticipantAdminStatus")};var h=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e,f,g){var h=a.GroupInfoStore,i=a.MessagesStore;a=a.ParticipantsStore;var j=(yield h.get(c));if(!j.success)return d("WAResultOrError").makeError("missing_group");j=j.value;if(b!=null&&b.previous!=null&&j.participantVersion!==b.previous)return d("WAResultOrError").makeError("mismatch");j=f.map(function(a){return{addressable:a.addressable,chatJid:c,type:g,user:a.user}});yield a.bulkPut(j);if(b!=null){yield h.update(c,function(a){return babelHelpers["extends"]({},a,{participantVersion:b.current})});for(f=0;f<j.length;f++)g==="admin"?a=d("MAWAdminMsgHelpers").createParticipantPromoteAdminMsg(c,j[f].user,e):a=d("MAWAdminMsgHelpers").createParticipantDemoteAdminMsg(c,j[f].user,e),yield i.create(a)}return d("WAResultOrError").makeResult()});return function(b,c,d,e,f,g){return a.apply(this,arguments)}}();g.changeGroupParticipantAdminStatus=a;g.changeGroupParticipantAdminStatusTransactor=h}),98);
__d("MAWThreadTypes",["MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";b={chunk:(a=d("MAWTransactionMode")).READWRITE,deletedMessages:a.READWRITE,editMsgHistory:a.READWRITE,groupInfo:a.READWRITE,groupInvites:a.READWRITE,media:a.READWRITE,messages:a.READWRITE,participants:a.READWRITE,pendingStanzas:a.READWRITE,reactions:a.READWRITE,threads:a.READWRITE,unrenderedMessages:a.READWRITE,xma:a.READWRITE};g.ThreadRelatedTablesPermissions=b}),98);
__d("MAWDeleteGroupsApi",["MAWDbThreadTxns","MAWDexieTable","MAWGroupManagementTxns","MAWIndexedDb","MAWThreadTypes","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor(d("MAWThreadTypes").ThreadRelatedTablesPermissions,"deleteGroups",function(a){return function(b){return d("MAWDexieTable").dexieAll(b.map(function(b){var c=b.group;return d("MAWDbThreadTxns").getThread(a,c).then(function(b){return!b.success?d("WAResultOrError").makeError("missing_thread"):d("MAWGroupManagementTxns").deleteGroup(a,c,b.value).then(function(a){return d("WAResultOrError").makeResult({deletedGroupId:c,deletedMsgIds:a.deletedMessages})})})})).then(function(a){return a})}});g.deleteGroupsFromMAW=a}),98);
__d("WADeleteGroupFollowUpLowLevelApi",["MAWDexieTable","MAWTransactionMode","WADbPersonalSenderKeyStatusTxns","WADbSenderKeySessionTxns","WADbTransactor"],(function(a,b,c,d,e,f,g){"use strict";a=d("WADbTransactor").makeSignalTransactor({personalSenderKeyStatuses:d("MAWTransactionMode").READWRITE,receipts:d("MAWTransactionMode").READWRITE,senderKeySessions:d("MAWTransactionMode").READWRITE},"deleteGroupFollowUpLowLevel",function(a){return function(b,c){return d("MAWDexieTable").dexieAll([d("WADbPersonalSenderKeyStatusTxns").bulkDeletePersonalSenderKeyStatus(a,[b]),d("WADbSenderKeySessionTxns").deleteSenderKeysByGroupJid(a,b),h(a,c)]).then(function(){})}});function h(a,b){return a.receipts.where("waMsgId").anyOf(b)["delete"]().then(function(){})}g.deleteGroupFollowUpLowLevel=a}),98);
__d("MAWDeleteGroup",["MAWDeleteGroupsApi","Promise","WADeleteGroupFollowUpLowLevelApi","WALogger","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["deleteGroups failed to delete group to a non-existent thread"]);i=function(){return a};return a}function a(a,b){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c){c=(yield d("MAWDeleteGroupsApi").deleteGroupsFromMAW(c.map(function(b){return{deleter:a,group:b}})));return(h||(h=b("Promise"))).all(c.map(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(!a.success)d("WALogger").ERROR(i());else{a=a.value;var b=a.deletedGroupId;a=a.deletedMsgIds;yield d("WADeleteGroupFollowUpLowLevelApi").deleteGroupFollowUpLowLevel(b,a)}});return function(b){return a.apply(this,arguments)}}())).then(function(){})});return j.apply(this,arguments)}g["default"]=a}),98);
__d("MAWRemoveGroupInvitesApi",["MAWDbGroupInviteTxns","MAWIndexedDb","MAWTransactionMode","WALogger","justknobx"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["removeGroupInvites deleted "," record(s) from "," for ",""]);h=function(){return a};return a}a=d("MAWIndexedDb").makeMsgrTransactor({groupInvites:d("MAWTransactionMode").READWRITE},"removeGroupInvites",function(a){return function(b,e){return d("MAWDbGroupInviteTxns").deleteGroupInvitesByThreadAndInvitedParticipant(a,b,e).then(function(a){d("WALogger").DEV(h(),a,b,e),c("justknobx")._("1162")&&d("MAWIndexedDb").afterTransaction({tag:"DeleteGroupInvite",value:{threadJid:b}})}).then(function(){c("justknobx")._("1162")&&d("MAWIndexedDb").afterTransaction({tag:"GroupInviteLoaded",value:{actorId:e,threadJid:b}})})}});g.removeGroupInvites=a}),98);
__d("MAWRemoveGroupParticipantsApi",["MAWAdminMsgHelpers","MAWRunInTransaction","WAAPI","WAResultOrError","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";a=function(){for(var a=arguments.length,e=new Array(a),f=0;f<a;f++)e[f]=arguments[f];return d("MAWRunInTransaction").runInTransaction({GroupInfoStore:!0,MessagesStore:!0,ParticipantsStore:!0},function(a){return h.apply(void 0,[a].concat(e))},"removeGroupParticipants").then(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a.success&&(yield c("WAAPI").setRotateSenderKeyToTrue([e[1]]));return a});return function(b){return a.apply(this,arguments)}}())};var h=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e,f,g,h){h=a.GroupInfoStore;var i=a.MessagesStore;a=a.ParticipantsStore;var j=(yield h.get(c));if(!j.success)return d("WAResultOrError").makeError("missing_group");j=j.value;if(b!=null&&b.previous!=null&&j.participantVersion!==b.previous)return d("WAResultOrError").makeError("mismatch");j=f.map(function(a){return a.user});f=j.map(function(a){return{groupJid:c,userJid:a}});yield a.bulkDelete(f,{remover:e});if(b!=null){a=d("MAWAdminMsgHelpers").createParticipantRemoveAdminMsg(c,j,e);yield i.create(a);yield h.update(c,function(a){return babelHelpers["extends"]({},a,{participantVersion:b.current})},{updateParticipantMedatadata:g})}return d("WAResultOrError").makeResult()});return function(b,c,d,e,f,g,h){return a.apply(this,arguments)}}();g.removeGroupParticipants=a;g.removeGroupParticipantsTransactor=h}),98);
__d("MAWUpdateGroupSubjectApi",["MAWAdminMsgHelpers","MAWRunInTransaction","WAJids","WAResultOrError","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";a=function(){for(var a=arguments.length,b=new Array(a),c=0;c<a;c++)b[c]=arguments[c];return d("MAWRunInTransaction").runInTransaction({GroupInfoStore:!0,MessagesStore:!0,ParticipantsStore:!0},function(a){return h.apply(void 0,[a].concat(b))},"updateGroupSubject")};var h=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){var e=a.GroupInfoStore;a=a.MessagesStore;var f=(yield e.get(b));if(!f.success)return d("WAResultOrError").makeError("missing_group");f=f.value;if(f.subject.ts!=null&&(c.ts==null||f.subject.ts>c.ts))return d("WAResultOrError").makeResult();yield e.update(b,function(a){return babelHelpers["extends"]({},a,{subject:c})});e=(yield e.get(f.jid));if(!e.success)return d("WAResultOrError").makeError("missing_group");f=e.value;e=f.subject.user;b=d("MAWAdminMsgHelpers").createGroupNameChangeAdminMsg(b,f,e!=null?d("WAJids").userIdFromJid(e):void 0);b!=null&&(yield a.create(b));return d("WAResultOrError").makeResult()});return function(b,c,d){return a.apply(this,arguments)}}();g.updateGroupSubject=a;g.updateGroupSubjectTransactor=h}),98);
__d("MAWHandleGroupNotifications",["MAWAddGroupParticipantsApi","MAWChangeGroupMemberAddModeApi","MAWChangeGroupParticipantAdminStatusApi","MAWDeleteGroup","MAWRemoveGroupInvitesApi","MAWRemoveGroupParticipantsApi","MAWUpdateGroupSubjectApi","Promise","WAAPI","WACreateGroup","WAGlobals","WAResultOrError","asyncToGeneratorRuntime","err","justknobx"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){a=a.notification;switch(a.type){case"join":return i(a).then(function(){return d("WAResultOrError").makeResult()});case"add":return k(a);case"remove":return l(a);case"promote":return n(a);case"demote":return m(a);case"delete":var e=a.groupJid,f=a.participant;if(f==null)throw c("err")("Group delete notification without deleter JID: "+e);return c("MAWDeleteGroup")(f,[e]).then(function(){return d("WAResultOrError").makeResult()});case"subject":return o(a).then(function(){return d("WAResultOrError").makeResult()});case"memberAddMode":return p(a);default:a.type;return(h||(h=b("Promise"))).resolve(d("WAResultOrError").makeResult())}}function i(a){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(a.isE2EEMigration)return;var b=a.group,e=a.isNew,f=a.key,g=a.serverTs;yield d("WACreateGroup").createGroups([{extras:f!=null?{deduplicationKey:f,platform:"msgr"}:null,folder:null,groupStatus:e?"new":"added",groupToCreate:b,key:f,serverTs:g}]);e=a.group.participants.map(function(a){if(a.success)return a.value.user;else return a.error.user});var h=d("WAGlobals").getMyUserJid();f=c("justknobx")._("1162");f&&e.find(function(a){return a===h})&&(yield d("MAWRemoveGroupInvitesApi").removeGroupInvites(b.jid,h));yield c("WAAPI").getDevices({ignoreDhash:!1,reason:"added-to-group",users:new Set(e)})});return j.apply(this,arguments)}function k(a){var b=a.groupJid,e=a.participant,f=a.participants,g=a.previousVersionId,h=a.reason;a=a.versionId;if(e==null)throw c("err")("Group add participant notification without adder JID: "+b);return d("MAWAddGroupParticipantsApi").addGroupParticipants({current:a,previous:g},b,e,f,!1,h)}function l(a){var b=a.groupJid,e=a.participant,f=a.participants,g=a.previousVersionId;a=a.versionId;if(e==null)throw c("err")("Group remove participant notification without remover JID: "+b);var h=null;a!=null&&(h={current:a,previous:g});return d("MAWRemoveGroupParticipantsApi").removeGroupParticipants(h,b,e,f,!1)}function m(a){var b=a.groupJid,c=a.participant,e=a.participants,f=a.previousVersionId;a=a.versionId;return d("MAWChangeGroupParticipantAdminStatusApi").changeGroupParticipantAdminStatus({current:a,previous:f},b,c,e,"participant")}function n(a){var b=a.groupJid,c=a.participant,e=a.participants,f=a.previousVersionId;a=a.versionId;return d("MAWChangeGroupParticipantAdminStatusApi").changeGroupParticipantAdminStatus({current:a,previous:f},b,c,e,"admin")}function o(a){var b=a.groupJid,c=a.participant,e=a.subject;a=a.ts;return d("MAWUpdateGroupSubjectApi").updateGroupSubject(b,{content:e,ts:a,user:c}).then(function(a){})}function p(a){var b=a.groupJid,c=a.memberAddMode;a=a.participant;return d("MAWChangeGroupMemberAddModeApi").changeGroupMemberAddMode(b,a,c)}g.persistGroupNotification=a}),98);
__d("WASyncParticipantsApi",["WAResultOrError","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";a=function(a,c,e){var f,g,h,i,j,k,l,m;return b("regeneratorRuntime").async(function(n){while(1)switch(n.prev=n.next){case 0:f=a.ParticipantsStore;n.next=3;return b("regeneratorRuntime").awrap(f.bulkGetInGroup(c));case 3:g=n.sent;if(!(g.success!==!0)){n.next=6;break}return n.abrupt("return",d("WAResultOrError").makeError("missing_participants"));case 6:if(!(e.length===0&&g.value.length===0)){n.next=8;break}return n.abrupt("return",d("WAResultOrError").makeResult({removedJids:[],addedJids:[],typeUpdateJids:[]}));case 8:h=new Map();g.value.forEach(function(a){h.set(a.user,a)});i=new Set(e.map(function(a){return a.user}));j=[];k=[];l=[];m=[];h.forEach(function(a,b){i.has(b)||(a.type!=="invitedParticipant"?j.push({userJid:b,groupJid:c}):(m.push({type:a.type,userJid:a.user}),l.push(babelHelpers["extends"]({},a))))});e.forEach(function(a){var b=h.get(a.user);b==null?(k.push(a),a.type==="admin"&&m.push({type:a.type,userJid:a.user})):(b.type!==a.type&&m.push({type:a.type,userJid:a.user}),l.push(babelHelpers["extends"]({},b,a)))});n.next=19;return b("regeneratorRuntime").awrap(f.bulkPut(k));case 19:n.next=21;return b("regeneratorRuntime").awrap(f.bulkPut(l));case 21:n.next=23;return b("regeneratorRuntime").awrap(f.bulkDelete(j));case 23:return n.abrupt("return",d("WAResultOrError").makeResult({removedJids:j.map(function(a){a=a.userJid;return a}),addedJids:k.map(function(a){return a.user}),typeUpdateJids:m}));case 24:case"end":return n.stop()}},null,this)};g.syncParticipantsTransactor=a}),98);
__d("MAWResetGroupParticipantInfoApi",["MAWAdminMsgHelpers","MAWRunInTransaction","Promise","WAAPI","WALogger","WAResultOrError","WASyncParticipantsApi","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unexpectedly received an error when sync-ing participants"]);i=function(){return a};return a}a=function(){for(var a=arguments.length,e=new Array(a),f=0;f<a;f++)e[f]=arguments[f];return d("MAWRunInTransaction").runInTransaction({GroupInfoStore:!0,MessagesStore:!0,ParticipantsStore:!0},function(a){return j.apply(void 0,[a].concat(e))},"resetGroupParticipantInfo").then(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a.success&&(yield c("WAAPI").setRotateSenderKeyToTrue([e[0]]));return a});return function(b){return a.apply(this,arguments)}}())};var j=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,e,f){var g=a.GroupInfoStore,j=a.MessagesStore;a=a.ParticipantsStore;e=e.map(function(a){return{addressable:a.addressable,chatJid:c,type:a.type,user:a.user}});a=(yield d("WASyncParticipantsApi").syncParticipantsTransactor({ParticipantsStore:a},c,e));if(f!=null){e=(yield g.update(c,function(a){return babelHelpers["extends"]({},a,{participantVersion:f})}));if(!e.success)return e}if(a.success!==!0){d("WALogger").ERROR(i());return a}g=a.value;e=[];if(g.removedJids.length>0){a=d("MAWAdminMsgHelpers").createParticipantRemoveAdminMsg(c,g.removedJids,null);e.push(j.create(a))}if(g.addedJids.length>0){a=d("MAWAdminMsgHelpers").createParticipantAddAdminMessage(c,g.addedJids,null);e.push(j.create(a))}if(g.typeUpdateJids.length>0)for(a=0;a<g.typeUpdateJids.length;a++){var k=g.typeUpdateJids[a].type==="admin"?d("MAWAdminMsgHelpers").createParticipantPromoteAdminMsg(c,g.typeUpdateJids[a].userJid,null):d("MAWAdminMsgHelpers").createParticipantDemoteAdminMsg(c,g.typeUpdateJids[a].userJid,null);e.push(j.create(k))}return(h||(h=b("Promise"))).all(e).then(function(){return d("WAResultOrError").makeResult()})});return function(b,c,d,e){return a.apply(this,arguments)}}();g.resetGroupParticipantInfo=a;g.resetGroupParticipantInfoTransactor=j}),98);
__d("MAWProtocolQueueGroupNotification",["MAWHandleGroupNotifications","MAWResetGroupParticipantInfoApi","MAWSendSenderKeyDistributionMsg","Promise","WAAPI","WACreateGroup","WALogger","WAQueryGroup","WAResultOrError","WATimeUtils","WAWaitForUserUnblocked","asyncToGeneratorRuntime","err","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to create group infos"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to recover missing group info"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[doGroupRecovery] Cannot get a group, as per ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to query groups"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to query groups"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to get group info"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unexpectedly received a participant with an error"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["[ParticipantRecovery] Cannot get a group, as per ",""]);p=function(){return a};return a}function a(a){var b=a.notification;return d("MAWHandleGroupNotifications").persistGroupNotification(a).then(function(a){return a.success?a:d("WAResultOrError").makeResult({errorResult:a,groupNotification:b})})}function e(a){return q.apply(this,arguments)}function q(){q=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=[];yield (h||(h=b("Promise"))).all(a.map(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){try{var b=(yield d("WAQueryGroup").queryGroup(a,"participant_change_recovery"));if(b.success===!1){var f;d("WALogger").ERROR(p(),b.error);throw c("err")("[ParticipantRecovery] Cannot get a group, as per "+JSON.stringify((f=b.error)!=null?f:null))}f=b.value;b=f.participants.map(function(a){if(a.error){d("WALogger").ERROR(o());return null}return a.value}).filter(Boolean);b=(yield d("MAWResetGroupParticipantInfoApi").resetGroupParticipantInfo(a,b,f.participantVersion));f=b.error;!b.success&&f==="missing_group"&&e.push(a)}catch(a){d("WALogger").DEV(n()).devConsole(a)}});return function(b){return a.apply(this,arguments)}}()));try{c("WAAPI").queryGroups({groups:e,type:"array"})["catch"](function(a){d("WALogger").DEV(m()).devConsole(a)})}catch(a){d("WALogger").DEV(l()).devConsole(a)}});return q.apply(this,arguments)}function f(a){return r.apply(this,arguments)}function r(){r=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=[];yield (h||(h=b("Promise"))).all(a.map(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){try{a=(yield d("WAQueryGroup").queryGroup(a,"interactive"));if(a.success===!1){var b;d("WALogger").ERROR(k(),a.error);throw c("err")("[doGroupRecovery] Cannot get a group, as per "+JSON.stringify((b=a.error)!=null?b:null))}e.push(a.value)}catch(a){d("WALogger").DEV(j()).devConsole(a)}});return function(b){return a.apply(this,arguments)}}()));try{yield d("WACreateGroup").createGroups(e.map(function(a){return{extras:null,folder:null,groupStatus:"queried",groupToCreate:a,key:null,serverTs:d("WATimeUtils").unixTime()}})),c("promiseDone")(d("WAWaitForUserUnblocked").waitForUserUnblocked().then(function(){e.forEach(function(a){return d("MAWSendSenderKeyDistributionMsg").maybePreEstablishSessionsAndSendSenderKeyDistributionMsg(a.jid,a.participants.map(function(a){return a.success?a.value.user:null}).filter(Boolean))})}))}catch(a){d("WALogger").DEV(i()).devConsole(a)}});return r.apply(this,arguments)}g.handleProtocolQueueGroupNotification=a;g.doParticipantRecovery=e;g.doGroupRecovery=f}),98);
__d("MAWHandleConnectedAdminMsgApi",["MAWAdminWriteUsersConnectedMsgTxn","MAWIndexedDb","MAWTransactionMode","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleConnectedAdminMsg: chat ",""]);h=function(){return a};return a}b=d("MAWIndexedDb").makeMsgrTransactor({ftsBackloggedMessages:(a=d("MAWTransactionMode")).READWRITE,groupInfo:a.READONLY,messages:a.READWRITE,threads:a.READWRITE},"handleConnectedAdminMsg",function(a){return function(b){var c=b.chatJid,e=b.isOtherContactMsplit;b=b.notificationTs;d("WALogger").LOG(h(),c);return d("MAWAdminWriteUsersConnectedMsgTxn").writeUsersConnectedAdminMsg(a,c,e,b)}});g.handleConnectedAdminMsg=b}),98);
__d("MAWUpdateThreadFolderApi",["MAWBridgeTypesCreators","MAWDbThreadTxns","MAWIndexedDb","MAWTransactionMode","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Update thread "," folder with folder id ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Update thread ",""]);i=function(){return a};return a}a=d("MAWIndexedDb").makeMsgrTransactor({threads:d("MAWTransactionMode").READWRITE},"updateThreadFolder",function(a){return function(b,c){d("WALogger").LOG(i(),b);return d("MAWDbThreadTxns").getThread(a,b).then(function(b){if(!b.success)return;return d("MAWDbThreadTxns").updateThread(a,babelHelpers["extends"]({},b.value,{folder:c})).then(function(a){d("WALogger").LOG(h(),b.value.jid,c);d("MAWIndexedDb").afterTransaction({tag:"ThreadUpdated",value:d("MAWBridgeTypesCreators").createBridgeUpdatedThread({folder:c,threadJid:b.value.jid})});return})})}});g.updateThreadFolder=a}),98);
__d("MAWProtocolQueueNotification",["MAWBridge","MAWFolderTypes","MAWHandleConnectedAdminMsgApi","MAWProtocolQueueGroupNotification","MAWUpdateThreadFolderApi","Promise","WAJids","WALogger","WAResultOrError","WATagsLogger","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleThreadNotification (",") unknown thread action, jid: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleThreadNotification (",") connected, jid: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleThreadNotification (",") with folder id ",", jid: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Received unsupported notification type: ",""]);l=function(){return a};return a}function m(a){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var c=a.stanzaId;a=a.notification;var e=a.actions,f=a.chatJid,g=a.ts,l=d("WAJids").interpretAsUserJid(f),m=(yield d("MAWBridge").getBridge().sendAndReceive("event","getLSDBUsersIsMsplit",{users:[l].filter(Boolean)}));return(h||(h=b("Promise"))).all(e.map(function(a){switch(a.type){case"folder":var e;e=(e=a.folderId)!=null?e:d("MAWFolderTypes").FOLDER_ID.INBOX;d("WALogger").LOG(k(),c,e,f);return d("MAWUpdateThreadFolderApi").updateThreadFolder(f,e);case"connected":d("WALogger").LOG(j(),c,f);e=l!=null&&m.get(l)===!0;return d("MAWHandleConnectedAdminMsgApi").handleConnectedAdminMsg({chatJid:f,isOtherContactMsplit:e,notificationTs:g});default:a.type;d("WALogger").ERROR(i(),c,f);return(h||(h=b("Promise"))).reject("Handle thread notification: unknown thread action")}})).then(function(){})});return n.apply(this,arguments)}function a(a){return(h||(h=b("Promise"))).all(a.map(function(a){a=a.notification;a=o(a);return a})).then(function(b){var c={groupRecoveries:[],participantRecoveries:[]},d=[];b.map(function(b,e){if(b.success===!0){d.push(a[e].stanzaQueueId);if(b.value!=null){e=b.value;e.type==="group"&&(e.data.errorResult.error==="mismatch"?c.participantRecoveries.push(e.data.groupNotification.groupJid):c.groupRecoveries.push(e.data.groupNotification.groupJid))}}});return{followUpParams:c,toAck:d}})}function o(a){switch(a.type){case"group":return d("MAWProtocolQueueGroupNotification").handleProtocolQueueGroupNotification(a).then(function(a){return a.value?d("WAResultOrError").makeResult({data:a.value,type:"group"}):d("WAResultOrError").makeResult()});case"thread":return m(a).then(function(){return d("WAResultOrError").makeResult()});default:a;d("WATagsLogger").TAGS(["ProtocolQueue"]).ERROR(l(),a.type);return(h||(h=b("Promise"))).resolve(d("WAResultOrError").makeResult())}}g.handleIncomingNotificationStanzas=a}),98);
__d("MAWCOPNotificationsHandler",["MAWIsQuotaExceededError","MAWProtocolQueueGroupNotification","MAWProtocolQueueNotification","MAWSharedCOPLogger","MAWSharedCOPLoop","asyncToGeneratorRuntime","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Errors occurred while processing notifications batch, see transactor error reports."]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["notification consumer: ",""]);i=function(){return a};return a}function a(a,b){return j(a,b)["catch"](function(a){if(d("MAWIsQuotaExceededError").isQuotaExceededError(a))throw a;c("MAWSharedCOPLogger").ERROR(i(),a);return[]})}function j(a,b){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){if(a.length===0)return[];var e=(yield d("MAWProtocolQueueNotification").handleIncomingNotificationStanzas(a));e.toAck.length!==a.length&&c("MAWSharedCOPLogger").WARN(h());a=e.followUpParams;var f=a.groupRecoveries,g=a.participantRecoveries;g.length>0&&c("promiseDone")(b.awaitBackground(d("MAWSharedCOPLoop").makeCopGUID("ParticipantsRecovery"),function(){return d("MAWProtocolQueueGroupNotification").doParticipantRecovery(g)},d("MAWSharedCOPLoop").COPBehaviour.NON_BLOCKING));f.length>0&&c("promiseDone")(b.awaitBackground(d("MAWSharedCOPLoop").makeCopGUID("GroupsRecovery"),function(){return d("MAWProtocolQueueGroupNotification").doGroupRecovery(f)},d("MAWSharedCOPLoop").COPBehaviour.NON_BLOCKING));return e.toAck});return k.apply(this,arguments)}g["default"]=a}),98);
__d("MAWSharedProtocolQueueReceipt",["asyncToGeneratorRuntime"],(function(a,b,c,d,e,f){"use strict";function g(a){if(a.receiptType==="appdata")return{params:{externalIds:a.externalIds,receivers:[a.from]},type:"appdata"};var b,c,d=a.chat;switch(a.receiptType){case"user":c=a.externalIds;b=[{device:a.from.author,ts:a.ts}];break;case"group":c=a.externalIds;b=[{device:a.from.author,ts:a.ts}];break;default:a.receiptType;c=[a.externalId];b=a.receivers;break}var e=a.messageAuthor;a=a.type;if(e==="@me"||a==="sender")return{params:{msgs:c.map(function(a){return{author:"@me",chat:d,externalId:a}}),receivers:b,type:a},type:"msg-receipt"};else return{params:{msgs:c.map(function(a){return{author:e,chat:d,externalId:a}}),receivers:b,type:a},type:"not-from-me"}}function a(a,b){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=a.map(function(a){a=g(a.receipt);return a});yield b(c);return{followUpParams:void 0,toAck:a.map(function(a){return a.stanzaQueueId})}});return h.apply(this,arguments)}f.sharedHandleIncomingReceiptStanza=a}),66);
__d("WADbHandlePermitedIdentitiesApi",["MAWTransactionMode","WADbTransactor"],(function(a,b,c,d,e,f,g){"use strict";a=d("WADbTransactor").makeSignalTransactor({receipts:d("MAWTransactionMode").READWRITE},"handlePermitedIdentitiesPerDevice",function(a){return function(b){var c=Array.from(b.keys());return a.receipts.where("waMsgId").anyOf(c).toArray().then(function(a){return a.map(function(a){var c;c=(c=b.get(a.waMsgId))!=null?c:new Set();for(var c=c,d=Array.isArray(c),e=0,c=d?c:c[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var f,g;if(d){if(e>=c.length)break;g=c[e++]}else{e=c.next();if(e.done)break;g=e.value}g=g;(f=a.permittedIdentitiesPerDevice)==null?void 0:f["delete"](g)}return a})}).then(function(b){return a.receipts.bulkPut(b).then(function(){})})}});g.handlePermitedIdentitiesPerDevice=a}),98);
__d("MAWProtocolQueueReceipt",["MAWBulkWriteReceiptsApi","MAWSharedProtocolQueueReceipt","WADbHandlePermitedIdentitiesApi","WAReceiptUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return d("WADbHandlePermitedIdentitiesApi").handlePermitedIdentitiesPerDevice(d("WAReceiptUtils").calculateIdentitiesToDelete(a)).then(function(){return d("MAWSharedProtocolQueueReceipt").sharedHandleIncomingReceiptStanza(a,d("MAWBulkWriteReceiptsApi").bulkWriteReceipts)})}g.handleIncomingReceiptStanza=a}),98);
__d("MAWCOPReceiptsHandler",["MAWIsQuotaExceededError","MAWProtocolQueueReceipt","MAWSharedCOPLogger","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Errors occurred while processing receipts batch, see transactor error reports."]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["receipt consumer: ",""]);i=function(){return a};return a}function a(a){return j(a)["catch"](function(a){if(d("MAWIsQuotaExceededError").isQuotaExceededError(a))throw a;c("MAWSharedCOPLogger").ERROR(i(),a);return[]})}function j(a){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(a.length===0)return[];var b=(yield d("MAWProtocolQueueReceipt").handleIncomingReceiptStanza(a));b.toAck.length!==a.length&&c("MAWSharedCOPLogger").WARN(h());return b.toAck});return k.apply(this,arguments)}g["default"]=a}),98);
__d("MAWWriteAppDataRetryApi",["MAWIndexedDb","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({appData:d("MAWTransactionMode").READWRITE},"writeAppDataRetry",function(a){return function(b,c,d){return a.appData.get({externalId:b}).then(function(b){if(b==null)return;var e=b.permittedIdentitiesPerDevice,f=e.get(c);if(f==null)return;f.baseKey=d;e.set(c,f);return a.appData.update(b.appDataId,{permittedIdentitiesPerDevice:e}).then(function(){})})}});g.writeAppDataRetry=a}),98);
__d("WAMarkParticipantNeedsKeyApi",["MAWTransactionMode","WADbPersonalSenderKeyStatusTxns","WADbTransactor"],(function(a,b,c,d,e,f,g){"use strict";a=d("WADbTransactor").makeSignalTransactor({personalSenderKeyStatuses:d("MAWTransactionMode").READWRITE},"markParticipantNeedsKey",function(a){return function(b,c){return d("WADbPersonalSenderKeyStatusTxns").removeDevicesToMultiplePersonalSenderKeyStatuses(a,[b],[c]).then(function(){})}});g.markParticipantNeedsKey=a}),98);
__d("WASendAppDataIndividualProtocol",["WAAsMessageApplication","WAConvertAppData","WAEncUserMsg","WAErrorMessage","WAGetCurrentUserDeviceInfoApi","WAGlobals","WAMsgApplication.pb","WAResultOrError","WASmaxAppdataPublishPeerRPC","WATagsLogger","WATimeUtils","asyncToGeneratorRuntime","encodeProtobuf"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to send appdata. Error: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to fetch current device public identity key"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["MAWSendAppData Failed to encrypt appdata"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Sending appdata, externalId: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to send appdata retry to device with error: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to send appdata to device with error: ",""]);m=function(){return a};return a}var n=d("WATagsLogger").TAGS(["sendAppDataIndividual"]);function a(a,b,c,e,f){return o(a,b,c,void 0,e,f)["catch"](function(a){a=d("WAErrorMessage").maybeGetMessageFromError(a);n.ERROR(m(),a);return d("WAResultOrError").makeError("runtime-error")})}function c(a,b,c,e,f,g){return o(a,b,c,e,f,g)["catch"](function(a){a=d("WAErrorMessage").maybeGetMessageFromError(a);n.ERROR(l(),a);return d("WAResultOrError").makeError("runtime-error")})}function o(a,b,c,d,e,f){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e,f,g){n.LOG(k(),b);a=d("WAConvertAppData").convertAppData(a);var l={bytes:d("WAAsMessageApplication").castToMessageApplicationBytes(d("encodeProtobuf").encodeProtobuf(d("WAMsgApplication.pb").MessageApplicationSpec,a).readByteArray()),version:"v3"};a=(yield d("WAGlobals").getWaOneQueue().enqueue(function(a){a=a.cryptoManager;return d("WAEncUserMsg").encryptDeviceJidMessage(c,{messageBytes:l,type:"appdata"},{cryptoManager:a},void 0,g,f)},{operationType:"encrypt",flush:!0}));if(a==null){n.LOG(j());return d("WAResultOrError").makeError("encrypt-failure")}var m;e!=null&&(m={appdataT:d("WATimeUtils").unixTime(),encRetryMixinArgs:{encCount:e}});e={appdataTo:c,encVersionFutureproofMixinArgs:{encV:parseInt(a.v,10)},encTypeIndividualMixinArgs:{encType:a.type,encElementValue:a.ciphertext},retryMixinArgs:m};e={peerPeerSingle:e};var o=void 0;if(a.type==="pkmsg"){var p=(yield d("WAGetCurrentUserDeviceInfoApi").getCurrentUserDeviceInfo());p=p==null?void 0:p.identityKey;if(p==null){n.ERROR(i());return d("WAResultOrError").makeError("no-public-identity")}o={deviceIdentityElementValue:p}}p={appdataId:b,peerPeerFanoutOrPeerSingleMixinGroupArgs:e,deviceIdentityMixinArgs:o};b=(yield d("WASmaxAppdataPublishPeerRPC").sendPeerRPC(p));switch(b.name){case"PeerResponseSuccess":return d("WAResultOrError").makeResult({baseKey:a.baseKey});default:b.name;n.ERROR(h(),b.value.error);return d("WAResultOrError").makeError("ack-failure")}});return p.apply(this,arguments)}g.sendAppDataToIndividualDeviceProtocol=a;g.sendAppDataRetryToIndividualDeviceProtocol=c}),98);
__d("WAWriteMsgRetryApi",["MAWTransactionMode","WADbTransactor","WAMsg"],(function(a,b,c,d,e,f,g){"use strict";a=d("WADbTransactor").makeSignalTransactor({receipts:d("MAWTransactionMode").READWRITE},"writeMsgRetry",function(a){return function(b,c,e){return h(a,d("WAMsg").craftWAMsgIdString({author:b.author,chat:b.chat,externalId:b.externalId}),c,e)}});function h(a,b,c,d){return a.receipts.get({waMsgId:b}).then(function(b){if(b==null||b.permittedIdentitiesPerDevice==null)return;var e=b.permittedIdentitiesPerDevice,f=e.get(c);if(f==null)return;f.baseKey=d;e.set(c,f);return a.receipts.put(babelHelpers["extends"]({},b,{permittedIdentitiesPerDevice:e})).then(function(){})})}g.writeMsgRetry=a}),98);
__d("WAWriteMsgRetryCountApi",["MAWTransactionMode","WADbTransactor","WAMsg"],(function(a,b,c,d,e,f,g){"use strict";a=d("WADbTransactor").makeSignalTransactor({receipts:d("MAWTransactionMode").READWRITE},"writeMsgRetryCount",function(a){return function(b,c,e){return h(a,d("WAMsg").craftWAMsgIdString({author:b.author,chat:b.chat,externalId:b.externalId}),c,e)}});function h(a,b,c,d){return a.receipts.get({waMsgId:b}).then(function(b){var e;if(b==null||d==null)return;e=(e=b.retryCountsPerDevice)!=null?e:new Map();e.set(c,d);return a.receipts.put(babelHelpers["extends"]({},b,{retryCountsPerDevice:e})).then(function(){})})}g.writeMsgRetryCount=a}),98);
__d("MAWSharedHandleRetryRequest",["MAWBulkGetAppDataForRetryApi","MAWConstants","MAWDebugMsg","MAWQplProxy","MAWWriteAppDataRetryApi","Promise","WACryptoManagerUtils","WACryptoUtils","WAGenReportingMeta","WAGlobals","WAJids","WALoadReceiptApi","WALogger","WAMarkParticipantNeedsKeyApi","WASendAppDataIndividualProtocol","WASendMsgInternal","WASentBytesCache","WAWap","WAWriteMsgRetryApi","WAWriteMsgRetryCountApi","asyncToGeneratorRuntime","gkx","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleRetryRequest denied because receipt is null"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleRetryRequest denied because (messageId, deviceJID, retryCount) is already executed for retryCount ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleRetryRequest denied with type ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleRetryRequest denied with type "," id: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["bulkHandleRetryRequest unexpected receipt"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["bulkHandleRetryRequest called for ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unknown receipt categories: ",""]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleRetryRequest denied due to retry count"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["Received retry request from peer without recipient set"]);q=function(){return a};return a}function r(){var a=0,b=0,c=new Map();return{getMetrics:function(){var d;return{appDataMissing:(d=c.get("appDatamissing"))!=null?d:0,appDataUnauthorized:(d=c.get("appDataunauthorized"))!=null?d:0,appDataUnsupported:(d=c.get("appDataunsupported"))!=null?d:0,msgMissing:(d=c.get("msgmissing"))!=null?d:0,msgUnauthorized:(d=c.get("msgunauthorized"))!=null?d:0,msgUnsupported:(d=c.get("msgunsupported"))!=null?d:0,receiptFailures:b,receiptSuccesses:a}},markError:function(){return b++},markSuccess:function(){return a++},setError:function(a){var b=c.get(a);b!=null?c.set(a,b+1):c.set(a,1)}}}function s(a,b){return b+"_"+a}function a(a){return t.apply(this,arguments)}function t(){t=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(a.length===0)return[];d("WALogger").LOG(n(),a.map(function(a){a=a.externalId;return a}).join(","));var e=d("MAWQplProxy").startQplUserFlow(c("qpl")._(25308942,"164"),{bool:{bulk:!0},"int":{receipts:a.length},string:{origin:self.location.origin}}),f=new Set(a.filter(function(a){return a.category!=null&&!C(a)||D(a)}).map(function(a){return a.externalId})),g=a.filter(function(a){return!f.has(a.externalId)&&!C(a)}),i=a.filter(C);i=(yield (h||(h=b("Promise"))).all([u(i),x(g)]));g=i[0];i=i[1];e.addPoint("get_msg_for_retry_complete");var j=[],k=r();for(a of a){var l=g.get(a.externalId),o=i.get(s(a.from.author,a.externalId));f.has(a.externalId)?(e.addPoint("just_ack"),k.markError(),k.setError("just_ack"),E(a)):l!=null?(e.addPoint("app_data_for_retry"),yield F(a,l,e,!1,k),e.addPoint("app_data_for_retry_complete")):o!=null?(e.addPoint("msg_for_retry"),yield H(a,o,e,!1,k),e.addPoint("msg_for_retry_complete")):(d("WALogger").ERROR(m()),k.markError(),k.setError("unexpected_receipt"));j.push(B(a))}e.endSuccess({"int":babelHelpers["extends"]({},k.getMetrics())});return j});return t.apply(this,arguments)}function u(a){return v.apply(this,arguments)}function v(){v=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(a.length===0)return new Map();var b=a.map(function(a){var b=a.externalId;a=a.from;return{deviceJid:a.author,externalId:b}});b=(yield d("MAWBulkGetAppDataForRetryApi").bulkGetAppDataForRetry(b));return new Map(b.map(function(b,c){c=a[c];return[c.externalId,b]}))});return v.apply(this,arguments)}function w(a){return a.map(function(a){var b=a.externalId,c=a.from,e=a.recipient,f=c.chat;if(c.type==="device"&&d("WAJids").extractUserJid(c.author)===d("WAJids").extractUserJid(d("WAGlobals").getMyDeviceJid())){if(e==null){d("WALogger").ERROR(q());return}f=e}e={author:"@me",chat:f,externalId:b};return{deviceJid:c.author,protocolMsgId:e,retryCount:a.retryCount}})}function x(a){return y.apply(this,arguments)}function y(){y=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(a.length===0)return new Map();var b=w(a),c=a.filter(function(a,c){return b[c]!=null}),e=b.filter(Boolean);a=(yield d("WASentBytesCache").sentBytesCache().getMsgsForRetry(e));a=new Map(a.map(function(a,b){return[s(e[b].deviceJid,c[b].externalId),{msgForRetry:a,retryRequest:e[b]}]}));return a});return y.apply(this,arguments)}function z(a,b){return A.apply(this,arguments)}function A(){A=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=void 0,e=(yield d("WAGlobals").getWaOneQueue().enqueue(function(b){b=b.cryptoManager;return d("WACryptoManagerUtils").getParticipantInfo(a.from.author,b)},{flush:!1,operationType:"get_participant_info"}));if(a.keys!=null){var f=a.keys,g=a.timestamp;b={baseKey:b.baseKey,keys:f,timestamp:g};f=J(a,e);f?c={session:b,type:"compareTSAndUseSession"}:c={session:b,type:"useSession"}}else{g=e==null||a.regId!==e.regId;g&&(c={type:"requestNewSession"})}return c});return A.apply(this,arguments)}function B(a){var b,c=a.externalId;a=a.from;return(b=d("WAWap")).wap("ack",{"class":"receipt",id:b.CUSTOM_STRING(c),participant:b.PARTICIPANT_JID(a),to:b.TO_JID(a),type:"retry"})}function C(a){a=a.category;return a==="peer_appdata"||a==="peer"}function D(a){a=a.retryCount;return a>=d("MAWConstants").MESSAGE_RETRY_COUNT_LIMIT}function E(a){if(D(a)){d("WALogger").LOG(p());return}if(a.category!=null){d("WALogger").WARN(o(),a.category);return}}function F(a,b,c,d,e){return G.apply(this,arguments)}function G(){G=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e,f){e===void 0&&(e=!0);var g=a.externalId,h=a.from,i=a.retryCount;c.addPoint("get_app_data_for_retry");if(b.type!=="unacked"){d("WALogger").LOG(l(),b.type,g);e?c.endFail(b.type):c.addPoint(b.type);f==null?void 0:f.markError();f==null?void 0:f.setError("appData"+b.type);return}e=b.appData;b=b.deviceIdentity;a=(yield z(a,b));c.addPoint("get_session_info");e=(yield d("WASendAppDataIndividualProtocol").sendAppDataRetryToIndividualDeviceProtocol(e,g,h.author,i,b.pubKey,a));c.addPoint("send_app_data");if(i>=2&&e.success===!0&&e.value.baseKey!=null){b=e.value.baseKey;yield d("MAWWriteAppDataRetryApi").writeAppDataRetry(g,h.author,b)}f==null?void 0:f.markSuccess();return e});return G.apply(this,arguments)}function H(a,b,c,d,e){return I.apply(this,arguments)}function I(){I=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f,g){var h;f===void 0&&(f=!0);var l=b.msgForRetry;b=b.retryRequest;var m=a.externalId,n=a.from,o=a.retryCount,p=b.protocolMsgId.chat;if(l.type!=="unacked"){f&&e.endFail(l.type);d("WALogger").LOG(k(),l.type);g==null?void 0:g.markError();g==null?void 0:g.setError("msg"+l.type);return}if(l.retryCount!=null&&l.retryCount>0&&l.retryCount===o){f&&e.endFail("unauthorized");d("WALogger").LOG(j(),o);g==null?void 0:g.markError();g==null?void 0:g.setError("msgunauthorized");return}n.type==="group"&&(yield d("WAMarkParticipantNeedsKeyApi").markParticipantNeedsKey(n.chat,n.author),e.addPoint("mark_participant_needs_key_complete"));var q=l.frankingKey,r=l.frankingVersion,s=l.isInstamadillo,t=l.messageBytes,u=l.messageType,v=l.protocolMsgId,w=(yield d("WALoadReceiptApi").loadReceipt({author:v.author,chat:v.chat,externalId:v.externalId}).then(function(a){return a.success?a.value:null}));h=w==null?void 0:(h=w.permittedIdentitiesPerDevice)==null?void 0:h.get(b.deviceJid);if(w==null||h==null){f&&e.endFail("unauthorized");d("WALogger").LOG(i());g==null?void 0:g.markError();g==null?void 0:g.setError("msgunauthorized");return}w=(yield z(a,h));e.addPoint("get_session_info_complete");c("gkx")("24021")&&(yield d("MAWDebugMsg").writeDebugMsg(p,"Handling retry request for message: "+l.protocolMsgId.externalId.toString()+" to user "+n.author));f=(yield d("WAGenReportingMeta").genReportingMeta(t.bytes,q,r));a=(yield d("WASendMsgInternal").sendMessage({chat:p,count:o,deviceIdentity:null,externalId:m,identityKey:h.pubKey,messageBytes:t,messageType:u,protocolMsgId:v,reportingMeta:f,sessionInfo:w,to:n.author,type:"direct"},null,s));e.addPoint("send_message_complete");if(o>=2&&a.success&&a.value.baseKey!=null){l=a.value.baseKey;yield d("WAWriteMsgRetryApi").writeMsgRetry(b.protocolMsgId,n.author,l)}o>=1&&a.success&&(yield d("WAWriteMsgRetryCountApi").writeMsgRetryCount(b.protocolMsgId,n.author,o));g==null?void 0:g.markSuccess()});return I.apply(this,arguments)}function J(a,b){if(a.offline==null)return!1;var c=b==null||a.regId!==b.regId;b=b!=null&&a.keys!=null&&!d("WACryptoUtils").uint8ArraysEqual(b.pubKey,a.keys.identity);return c||b}g.bulkHandleRetryRequest=a}),98);
__d("MAWCOPRetryHandler",["MAWIsQuotaExceededError","MAWSharedCOPLogger","MAWSharedHandleRetryRequest","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["receipt consumer: ",""]);h=function(){return a};return a}function a(a){return i(a)["catch"](function(a){if(d("MAWIsQuotaExceededError").isQuotaExceededError(a))throw a;c("MAWSharedCOPLogger").ERROR(h(),a);return[]})}function i(a){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(a.length===0)return[];yield d("MAWSharedHandleRetryRequest").bulkHandleRetryRequest(a.map(function(a){return a.retry}));return a.map(function(a){return a.stanzaQueueId})});return j.apply(this,arguments)}g["default"]=a}),98);
__d("MAWSplitProtocolEntityByType",[],(function(a,b,c,d,e,f){"use strict";function a(a){var b={appdatas:[],instructions:[],messages:[],notifications:[],receipts:[],retries:[]};a.forEach(function(a){switch(a.type){case"message":b.messages.push(a);return;case"retryReceipt":b.retries.push(a);return;case"appdata":b.appdatas.push(a);return;case"notification":b.notifications.push(a);return;case"receipt":b.receipts.push(a);return;default:a;b.instructions.push(a);return}});return b}f["default"]=a}),66);
__d("MAWProtocolQueueProcess",["MAWCOPAppdataHandler","MAWCOPInstructionsHandler","MAWCOPMessagesHandler","MAWCOPNotificationsHandler","MAWCOPReceiptsHandler","MAWCOPRetryHandler","MAWSharedCOP","MAWSharedCOPLogger","MAWSplitProtocolEntityByType","Promise","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["New COP handler for "," msgs, "," appdatas, "," notifications, "," receipts, "," retries, "," instructions"]);i=function(){return a};return a}function a(a){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=c("MAWSplitProtocolEntityByType")(a);c("MAWSharedCOPLogger").LOG(i(),a.messages.length,a.appdatas.length,a.notifications.length,a.receipts.length,a.retries.length,a.instructions.length);var e=d("MAWSharedCOP").getCOP();e=(yield (h||(h=b("Promise"))).all([c("MAWCOPMessagesHandler")(a.messages,e.queue),c("MAWCOPInstructionsHandler")(a.instructions),c("MAWCOPReceiptsHandler")(a.receipts),c("MAWCOPAppdataHandler")(a.appdatas),c("MAWCOPNotificationsHandler")(a.notifications,e.queue),c("MAWCOPRetryHandler")(a.retries)])).flat();return e});return j.apply(this,arguments)}g.processProtocolQueueEntries=a}),98);
__d("SharedWorkerBootstrap",["CurrentSharedWorker","CurrentWorkerMessagePort"],(function(a,b,c,d,e,f,g){"use strict";function a(a){h(function(){return b.call(null,a)})}function c(a){h(function(){return a})}function h(a){d("CurrentSharedWorker").onInitComplete(function(){var b=a();if(typeof b==="function"||b!==null)try{b(d("CurrentWorkerMessagePort").getMessagePort())}catch(a){}})}g.start=a;g.startServerJS=c}),98);
__d("SharedOrWebWorkerBootstrapInit",["SharedWorkerBootstrap","WorkerBootstrap"],(function(a,b,c,d,e,f){"use strict";function a(a){"SharedWorkerGlobalScope"in self&&self instanceof self.SharedWorkerGlobalScope?b("SharedWorkerBootstrap").startServerJS(a):b("WorkerBootstrap").startServerJS(a)}f.startServerJS=a}),66);